DEBUG:root:This is a debug message
DEBUG:celery.utils.functional:
def unlock_chord(self, group_id, callback, interval=0, max_retries=1, result=2, Result=3, GroupResult=4, result_from_tuple=5, **kwargs):
    return 1

DEBUG:celery.utils.functional:
def sendEmbeddingRequest(user_id, total_tokens):
    return 1

DEBUG:celery.utils.functional:
def group(self, tasks, result, group_id, partial_args, add_to_parent=0):
    return 1

DEBUG:celery.utils.functional:
def xmap(task, it):
    return 1

DEBUG:celery.utils.functional:
def backend_cleanup():
    return 1

DEBUG:celery.utils.functional:
def chain(*args, **kwargs):
    return 1

DEBUG:celery.utils.functional:
def send_chat_request(user_id, project_id, session, total_tokens, answer):
    return 1

DEBUG:celery.utils.functional:
def xstarmap(task, it):
    return 1

DEBUG:celery.utils.functional:
def accumulate(self, *args, **kwargs):
    return 1

DEBUG:celery.utils.functional:
def set_vector_index_task(self, token):
    return 1

DEBUG:celery.utils.functional:
def process_set_vector_index(self, token, task_id):
    return 1

DEBUG:celery.utils.functional:
def chord(self, header, body, partial_args=0, interval=1, countdown=2, max_retries=3, eager=4, **kwargs):
    return 1

DEBUG:celery.utils.functional:
def chunks(task, it, n):
    return 1

DEBUG:myapp:Flask app started
INFO:werkzeug:[31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:5000
INFO:werkzeug:[33mPress CTRL+C to quit[0m
INFO:werkzeug:127.0.0.1 - - [31/Dec/2023 17:51:08] "[33mGET /files/e47f0f811145d03c33fd6639dc3f09c0839d0891e264d849a75df04f4d047625 HTTP/1.1[0m" 404 -
INFO:werkzeug:127.0.0.1 - - [31/Dec/2023 17:51:22] "OPTIONS /projects/e47f0f811145d03c33fd6639dc3f09c0839d0891e264d849a75df04f4d047625/5eeuIK7kur0alagO88iEMjUJNwlxrLC7 HTTP/1.1" 200 -
INFO:werkzeug:127.0.0.1 - - [31/Dec/2023 17:51:22] "[33mPOST /projects/e47f0f811145d03c33fd6639dc3f09c0839d0891e264d849a75df04f4d047625/5eeuIK7kur0alagO88iEMjUJNwlxrLC7 HTTP/1.1[0m" 404 -
DEBUG:root:This is a debug message
DEBUG:celery.utils.functional:
def unlock_chord(self, group_id, callback, interval=0, max_retries=1, result=2, Result=3, GroupResult=4, result_from_tuple=5, **kwargs):
    return 1

DEBUG:celery.utils.functional:
def sendEmbeddingRequest(user_id, total_tokens):
    return 1

DEBUG:celery.utils.functional:
def group(self, tasks, result, group_id, partial_args, add_to_parent=0):
    return 1

DEBUG:celery.utils.functional:
def xmap(task, it):
    return 1

DEBUG:celery.utils.functional:
def backend_cleanup():
    return 1

DEBUG:celery.utils.functional:
def chain(*args, **kwargs):
    return 1

DEBUG:celery.utils.functional:
def send_chat_request(user_id, project_id, session, total_tokens, answer):
    return 1

DEBUG:celery.utils.functional:
def xstarmap(task, it):
    return 1

DEBUG:celery.utils.functional:
def accumulate(self, *args, **kwargs):
    return 1

DEBUG:celery.utils.functional:
def set_vector_index_task(self, token):
    return 1

DEBUG:celery.utils.functional:
def process_set_vector_index(self, token, task_id):
    return 1

DEBUG:celery.utils.functional:
def chord(self, header, body, partial_args=0, interval=1, countdown=2, max_retries=3, eager=4, **kwargs):
    return 1

DEBUG:celery.utils.functional:
def chunks(task, it, n):
    return 1

DEBUG:myapp:Flask app started
INFO:werkzeug:[31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:5000
INFO:werkzeug:[33mPress CTRL+C to quit[0m
INFO:werkzeug:127.0.0.1 - - [31/Dec/2023 17:52:44] "[33mGET /files/e47f0f811145d03c33fd6639dc3f09c0839d0891e264d849a75df04f4d047625 HTTP/1.1[0m" 404 -
INFO:werkzeug:127.0.0.1 - - [31/Dec/2023 17:52:57] "[33mGET /files/e47f0f811145d03c33fd6639dc3f09c0839d0891e264d849a75df04f4d047625 HTTP/1.1[0m" 404 -
INFO:werkzeug:127.0.0.1 - - [31/Dec/2023 17:53:10] "OPTIONS /projects/e47f0f811145d03c33fd6639dc3f09c0839d0891e264d849a75df04f4d047625/0smVuIiyDwqsO6gj4o37BHHPxXQT5pp9 HTTP/1.1" 200 -
INFO:werkzeug:127.0.0.1 - - [31/Dec/2023 17:53:10] "[33mPOST /projects/e47f0f811145d03c33fd6639dc3f09c0839d0891e264d849a75df04f4d047625/0smVuIiyDwqsO6gj4o37BHHPxXQT5pp9 HTTP/1.1[0m" 404 -
DEBUG:myapp:Flask app started
INFO:werkzeug:[31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:5000
INFO:werkzeug:[33mPress CTRL+C to quit[0m
DEBUG:root:This is a debug message
DEBUG:celery.utils.functional:
def unlock_chord(self, group_id, callback, interval=0, max_retries=1, result=2, Result=3, GroupResult=4, result_from_tuple=5, **kwargs):
    return 1

DEBUG:celery.utils.functional:
def sendEmbeddingRequest(user_id, total_tokens):
    return 1

DEBUG:celery.utils.functional:
def group(self, tasks, result, group_id, partial_args, add_to_parent=0):
    return 1

DEBUG:celery.utils.functional:
def xmap(task, it):
    return 1

DEBUG:celery.utils.functional:
def backend_cleanup():
    return 1

DEBUG:celery.utils.functional:
def chain(*args, **kwargs):
    return 1

DEBUG:celery.utils.functional:
def send_chat_request(user_id, project_id, session, total_tokens, answer):
    return 1

DEBUG:celery.utils.functional:
def xstarmap(task, it):
    return 1

DEBUG:celery.utils.functional:
def accumulate(self, *args, **kwargs):
    return 1

DEBUG:celery.utils.functional:
def set_vector_index_task(self, token):
    return 1

DEBUG:celery.utils.functional:
def process_set_vector_index(self, token, task_id):
    return 1

DEBUG:celery.utils.functional:
def chord(self, header, body, partial_args=0, interval=1, countdown=2, max_retries=3, eager=4, **kwargs):
    return 1

DEBUG:celery.utils.functional:
def chunks(task, it, n):
    return 1

INFO:werkzeug:127.0.0.1 - - [31/Dec/2023 18:06:42] "OPTIONS /projects/e47f0f811145d03c33fd6639dc3f09c0839d0891e264d849a75df04f4d047625/0smVuIiyDwqsO6gj4o37BHHPxXQT5pp9 HTTP/1.1" 200 -
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.openai.com:443
DEBUG:urllib3.connectionpool:https://api.openai.com:443 "POST /v1/chat/completions HTTP/1.1" 200 None
INFO:myapp:[{'url_params': 'product_name=xiaomi&color=silver', 'is_related': 'yes', 'category': 'smartphones'}]
INFO:myapp:product_name=xiaomi&color=silver
INFO:myapp:prompt
INFO:myapp:You are AI assistant for a online shop. You should determine if a client is asking information about a product in our store. It can be a question about price, availability in stock, product characteristic, comparing 2 products. In this case you should contruct query parameters based on a client question. Construct them for every mentioned product. Add sort_price parameter if required .For example product_name=item_name&color=green&size=44&sort_price=desc|asc product_name is a required parameterList of available query parameters: color Use only these query parameters for consructing. Add a category. List of available categories: misc,smartphones. Write your asnwer as array of json objects. [{url_params: <url_here>, is_related: 'yes', category: <category_here> }] If the question is not related to products of the store, then your answer would be [{is_related: 'no'}] Be strict. Fix typos in product names. Dont write anything else. Your answer will be used for a next query. History of your conversaion: NoneClient question: hello do you have silver xiaomiYour answer:
DEBUG:urllib3.connectionpool:Starting new HTTP connection (1): wordpress:80
DEBUG:urllib3.connectionpool:http://wordpress:80 "GET /wp-json/chatty/v1/posts?product_name=xiaomi&color=silver HTTP/1.1" 200 1298
INFO:myapp:api data [{"id":17,"title":"Xiaomi 13","content":"<ul class=\"a-unordered-list a-vertical a-spacing-mini\">\r\n \t<li class=\"a-spacing-mini\"><span class=\"a-list-item\">Ultra-immersive display design Light up the screen to enjoy an unrivalled experience. The 1.61mm ultra-thin bezels offer a boundless vision.<\/span><\/li>\r\n \t<li class=\"a-spacing-mini\"><span class=\"a-list-item\">Built for more scenarios IP68 water and dust resistant* Born splash-proof and water-resistant, thanks to the precision manufacturing. Record special memories anytime and anywhere.<\/span><\/li>\r\n \t<li class=\"a-spacing-mini\"><span class=\"a-list-item\">Leica main camera with professional optical lens Captures every great moment<\/span><\/li>\r\n \t<li class=\"a-spacing-mini\"><span class=\"a-list-item\">Masterpiece performance Leading Snapdragon 8 Gen 2 Boosted performance, reduced consumption<\/span><\/li>\r\n<\/ul>","date":"27.12.2023","attributes":{"pa_color":["silver"]},"stock":null,"image_url":false,"sku":"141234","price":"16000","formatted_price":"<span class=\"woocommerce-Price-amount amount\"><bdi>16000,00&nbsp;<span class=\"woocommerce-Price-currencySymbol\">&#8381;<\/span><\/bdi><\/span>","product_link":"http:\/\/wordpress\/product\/%d0%ba%d1%80%d0%be%d1%81%d1%81%d0%be%d0%b2%d0%ba%d0%b8\/"}]
DEBUG:llama_index.storage.kvstore.simple_kvstore:Loading llama_index.storage.kvstore.simple_kvstore from projects/4/data\docstore.json.
DEBUG:fsspec.local:open file: C:/OSPanel/domains/ai_assistant/api/projects/4/data/docstore.json
DEBUG:llama_index.storage.kvstore.simple_kvstore:Loading llama_index.storage.kvstore.simple_kvstore from projects/4/data\index_store.json.
DEBUG:fsspec.local:open file: C:/OSPanel/domains/ai_assistant/api/projects/4/data/index_store.json
DEBUG:llama_index.vector_stores.simple:Loading llama_index.vector_stores.simple from projects/4/data\vector_store.json.
DEBUG:fsspec.local:open file: C:/OSPanel/domains/ai_assistant/api/projects/4/data/vector_store.json
DEBUG:llama_index.graph_stores.simple:Loading llama_index.graph_stores.simple from projects/4/data\graph_store.json.
DEBUG:fsspec.local:open file: C:/OSPanel/domains/ai_assistant/api/projects/4/data/graph_store.json
INFO:llama_index.indices.loading:Loading indices with ids: ['vector_index']
DEBUG:openai:message='Request to OpenAI API' method=post path=https://api.openai.com/v1/embeddings
DEBUG:openai:api_version=None data='{"input": ["hello do you have silver xiaomi"], "model": "text-embedding-ada-002", "encoding_format": "base64"}' message='Post details'
DEBUG:urllib3.util.retry:Converted retries value: 2 -> Retry(total=2, connect=None, read=None, redirect=None, status=None)
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.openai.com:443
DEBUG:urllib3.connectionpool:https://api.openai.com:443 "POST /v1/embeddings HTTP/1.1" 200 None
DEBUG:openai:message='OpenAI API response' path=https://api.openai.com/v1/embeddings processing_ms=17 request_id=df732b64a8485a7ab1d35b90ba364b88 response_code=200
DEBUG:llama_index.indices.utils:> Top 1 nodes:
> [Node 909c5dd5-e87e-4999-a794-761f96e44168] [Similarity score:             -0.0284913] Welcome to TechHub, your ultimate destination for cutting-edge technology and innovation! At Tech...
DEBUG:openai:message='Request to OpenAI API' method=post path=https://api.openai.com/v1/chat/completions
DEBUG:openai:api_version=None data='{"messages": [{"role": "system", "content": "Context information is below.\\n--------------------\\nWelcome to TechHub, your ultimate destination for cutting-edge technology and innovation! At TechHub, we pride ourselves on being a premier online store dedicated to providing a curated selection of the latest and greatest in tech gadgets, including laptops, smartphones, and more.\\n\\nAbout Us:\\n\\nAt the heart of TechHub is a passion for technology and a commitment to delivering top-notch products that seamlessly blend style, functionality, and performance. With a team of tech enthusiasts, we understand the ever-evolving nature of the digital landscape and strive to stay at the forefront of the latest trends and advancements.\\n\\nOur Mission:\\n\\nOur mission at TechHub is to empower our customers with the best tools and devices that enhance their digital lifestyle. Whether you\'re a professional looking for a high-performance laptop to boost productivity or a smartphone aficionado seeking the latest flagship model, we\'ve got you covered. We believe that technology should not only meet but exceed your expectations, making every interaction with your devices a seamless and enjoyable experience.\\n\\nQuality Assurance:\\n\\nTechHub is committed to delivering products of the highest quality. We carefully curate our inventory, partnering with leading brands known for their commitment to excellence. Each product undergoes rigorous testing to ensure reliability, durability, and top-notch performance. Our dedication to quality assurance is reflected in every item we offer.\\n\\nCustomer-Centric Approach:\\n\\nAt TechHub, our customers are at the core of everything we do. We prioritize your satisfaction and strive to provide an unparalleled shopping experience. Our customer support team is ready to assist you at every step, from product inquiries to after-sales support. We value your feedback and continuously work to improve our services based on your needs.\\n\\nSecure Shopping:\\n\\nYour online security is our priority. TechHub employs state-of-the-art encryption technology to ensure that your personal information remains secure and protected. Shop with confidence, knowing that your data is in safe hands.\\n\\nExplore the world of innovation at TechHub, where technology meets lifestyle. Discover the perfect blend of style and functionality with our carefully curated selection of laptops, smartphones, and other cutting-edge gadgets. Join us on this exciting journey, and let\'s embrace the future together!\\n--------------------\\n\\u0412\\u044b \\u2014 \\u0418\\u0418 \\u0430\\u0441\\u0441\\u0438\\u0441\\u0442\\u0435\\u043d\\u0442 \\u043a\\u043e\\u043c\\u043f\\u0430\\u043d\\u0438\\u0438. \\u0412\\u0430\\u043c \\u0431\\u0443\\u0434\\u0443\\u0442 \\u0437\\u0430\\u0434\\u0430\\u043d\\u044b \\u0432\\u043e\\u043f\\u0440\\u043e\\u0441\\u044b \\u043e \\u043d\\u0430\\u0448\\u0435\\u0439 \\u043a\\u043e\\u043c\\u043f\\u0430\\u043d\\u0438\\u0438. \\u0412\\u0435\\u0436\\u043b\\u0438\\u0432\\u043e \\u043e\\u0442\\u0432\\u0435\\u0447\\u0430\\u0439\\u0442\\u0435 \\u043d\\u0430 \\u0432\\u043e\\u043f\\u0440\\u043e\\u0441\\u044b.\\r\\n    \\u041d\\u0438\\u0436\\u0435 \\u043c\\u044b \\u043f\\u0440\\u0435\\u0434\\u043e\\u0441\\u0442\\u0430\\u0432\\u0438\\u043b\\u0438 \\u043a\\u043e\\u043d\\u0442\\u0435\\u043a\\u0441\\u0442\\u043d\\u0443\\u044e \\u0438\\u043d\\u0444\\u043e\\u0440\\u043c\\u0430\\u0446\\u0438\\u044e.\\r\\n    ---------------------\\r\\n    {context_str}\\r\\n    ---------------------\\r\\n    \\u0423\\u0447\\u0438\\u0442\\u044b\\u0432\\u0430\\u044f \\u044d\\u0442\\u0443 \\u0438\\u043d\\u0444\\u043e\\u0440\\u043c\\u0430\\u0446\\u0438\\u044e, \\u043e\\u0442\\u0432\\u0435\\u0442\\u044c\\u0442\\u0435, \\u043f\\u043e\\u0436\\u0430\\u043b\\u0443\\u0439\\u0441\\u0442\\u0430, \\u043d\\u0430 \\u0432\\u043e\\u043f\\u0440\\u043e\\u0441: {query_str}\\r\\n    . \\n Information about product [{\\"id\\":17,\\"title\\":\\"Xiaomi 13\\",\\"content\\":\\"<ul class=\\\\\\"a-unordered-list a-vertical a-spacing-mini\\\\\\">\\\\r\\\\n \\\\t<li class=\\\\\\"a-spacing-mini\\\\\\"><span class=\\\\\\"a-list-item\\\\\\">Ultra-immersive display design Light up the screen to enjoy an unrivalled experience. The 1.61mm ultra-thin bezels offer a boundless vision.<\\\\/span><\\\\/li>\\\\r\\\\n \\\\t<li class=\\\\\\"a-spacing-mini\\\\\\"><span class=\\\\\\"a-list-item\\\\\\">Built for more scenarios IP68 water and dust resistant* Born splash-proof and water-resistant, thanks to the precision manufacturing. Record special memories anytime and anywhere.<\\\\/span><\\\\/li>\\\\r\\\\n \\\\t<li class=\\\\\\"a-spacing-mini\\\\\\"><span class=\\\\\\"a-list-item\\\\\\">Leica main camera with professional optical lens Captures every great moment<\\\\/span><\\\\/li>\\\\r\\\\n \\\\t<li class=\\\\\\"a-spacing-mini\\\\\\"><span class=\\\\\\"a-list-item\\\\\\">Masterpiece performance Leading Snapdragon 8 Gen 2 Boosted performance, reduced consumption<\\\\/span><\\\\/li>\\\\r\\\\n<\\\\/ul>\\",\\"date\\":\\"27.12.2023\\",\\"attributes\\":{\\"pa_color\\":[\\"silver\\"]},\\"stock\\":null,\\"image_url\\":false,\\"sku\\":\\"141234\\",\\"price\\":\\"16000\\",\\"formatted_price\\":\\"<span class=\\\\\\"woocommerce-Price-amount amount\\\\\\"><bdi>16000,00&nbsp;<span class=\\\\\\"woocommerce-Price-currencySymbol\\\\\\">&#8381;<\\\\/span><\\\\/bdi><\\\\/span>\\",\\"product_link\\":\\"http:\\\\/\\\\/wordpress\\\\/product\\\\/%d0%ba%d1%80%d0%be%d1%81%d1%81%d0%be%d0%b2%d0%ba%d0%b8\\\\/\\"}]"}, {"role": "user", "content": "hello do you have silver xiaomi"}], "stream": false, "model": "gpt-3.5-turbo", "temperature": 0, "max_tokens": null}' message='Post details'
DEBUG:urllib3.connectionpool:https://api.openai.com:443 "POST /v1/chat/completions HTTP/1.1" 200 None
DEBUG:openai:message='OpenAI API response' path=https://api.openai.com/v1/chat/completions processing_ms=6267 request_id=d6c35bd77e3c26c823a13d87d925e9a0 response_code=200
INFO:myapp:{'api': 1, 'product_data': '{"attributes": "color", "categories": "misc,smartphones"}', 'website': 'asdf', 'id': 4, 'left_tokens': 27624, 'description': None, 'temperature': Decimal('0.00'), 'model': 'gpt-3.5-turbo', 'prompt': 'Вы — ИИ ассистент компании. Вам будут заданы вопросы о нашей компании. Вежливо отвечайте на вопросы.\r\n    Ниже мы предоставили контекстную информацию.\r\n    ---------------------\r\n    {context_str}\r\n    ---------------------\r\n    Учитывая эту информацию, ответьте, пожалуйста, на вопрос: {query_str}\r\n    ', 'response_mode': 'compact', 'user_id': 12, 'answer': None}
DEBUG:root:This is a debug message
DEBUG:celery.utils.functional:
def send_chat_request(user_id, project_id, session, total_tokens, answer):
    return 1

INFO:werkzeug:127.0.0.1 - - [31/Dec/2023 18:06:54] "POST /projects/e47f0f811145d03c33fd6639dc3f09c0839d0891e264d849a75df04f4d047625/0smVuIiyDwqsO6gj4o37BHHPxXQT5pp9 HTTP/1.1" 200 -
INFO:werkzeug:127.0.0.1 - - [31/Dec/2023 18:07:21] "OPTIONS /projects/e47f0f811145d03c33fd6639dc3f09c0839d0891e264d849a75df04f4d047625/0smVuIiyDwqsO6gj4o37BHHPxXQT5pp9 HTTP/1.1" 200 -
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.openai.com:443
DEBUG:urllib3.connectionpool:https://api.openai.com:443 "POST /v1/chat/completions HTTP/1.1" 200 None
INFO:myapp:[{'url_params': 'product_name=xiaomi 13&color=silver', 'is_related': 'yes', 'category': 'smartphones'}]
INFO:myapp:product_name=xiaomi 13&color=silver
INFO:myapp:prompt
INFO:myapp:You are AI assistant for a online shop. You should determine if a client is asking information about a product in our store. It can be a question about price, availability in stock, product characteristic, comparing 2 products. In this case you should contruct query parameters based on a client question. Construct them for every mentioned product. Add sort_price parameter if required .For example product_name=item_name&color=green&size=44&sort_price=desc|asc product_name is a required parameterList of available query parameters: color Use only these query parameters for consructing. Add a category. List of available categories: misc,smartphones. Write your asnwer as array of json objects. [{url_params: <url_here>, is_related: 'yes', category: <category_here> }] If the question is not related to products of the store, then your answer would be [{is_related: 'no'}] Be strict. Fix typos in product names. Dont write anything else. Your answer will be used for a next query. History of your conversaion: Client: hello do you have silver xiaomi,
Ai response: Yes, we have a silver Xiaomi product available. It is called Xiaomi 13. It features an ultra-immersive display design with 1.61mm ultra-thin bezels, making it a visually stunning device. It is also IP68 water and dust resistant, allowing you to use it in various scenarios without worrying about water damage. The device is equipped with a Leica main camera with a professional optical lens, ensuring that you capture every great moment. It is powered by the leading Snapdragon 8 Gen 2 processor, providing excellent performance while reducing power consumption. The price of the silver Xiaomi 13 is 16,000 rubles. You can find more information and make a purchase on our website: [Xiaomi 13 Product Link](http://wordpress/product/кроссовки/)Client question: how much does it costYour answer:
DEBUG:urllib3.connectionpool:Starting new HTTP connection (1): wordpress:80
DEBUG:urllib3.connectionpool:http://wordpress:80 "GET /wp-json/chatty/v1/posts?product_name=xiaomi+13&color=silver HTTP/1.1" 200 1298
INFO:myapp:api data [{"id":17,"title":"Xiaomi 13","content":"<ul class=\"a-unordered-list a-vertical a-spacing-mini\">\r\n \t<li class=\"a-spacing-mini\"><span class=\"a-list-item\">Ultra-immersive display design Light up the screen to enjoy an unrivalled experience. The 1.61mm ultra-thin bezels offer a boundless vision.<\/span><\/li>\r\n \t<li class=\"a-spacing-mini\"><span class=\"a-list-item\">Built for more scenarios IP68 water and dust resistant* Born splash-proof and water-resistant, thanks to the precision manufacturing. Record special memories anytime and anywhere.<\/span><\/li>\r\n \t<li class=\"a-spacing-mini\"><span class=\"a-list-item\">Leica main camera with professional optical lens Captures every great moment<\/span><\/li>\r\n \t<li class=\"a-spacing-mini\"><span class=\"a-list-item\">Masterpiece performance Leading Snapdragon 8 Gen 2 Boosted performance, reduced consumption<\/span><\/li>\r\n<\/ul>","date":"27.12.2023","attributes":{"pa_color":["silver"]},"stock":null,"image_url":false,"sku":"141234","price":"16000","formatted_price":"<span class=\"woocommerce-Price-amount amount\"><bdi>16000,00&nbsp;<span class=\"woocommerce-Price-currencySymbol\">&#8381;<\/span><\/bdi><\/span>","product_link":"http:\/\/wordpress\/product\/%d0%ba%d1%80%d0%be%d1%81%d1%81%d0%be%d0%b2%d0%ba%d0%b8\/"}]
DEBUG:llama_index.storage.kvstore.simple_kvstore:Loading llama_index.storage.kvstore.simple_kvstore from projects/4/data\docstore.json.
DEBUG:fsspec.local:open file: C:/OSPanel/domains/ai_assistant/api/projects/4/data/docstore.json
DEBUG:llama_index.storage.kvstore.simple_kvstore:Loading llama_index.storage.kvstore.simple_kvstore from projects/4/data\index_store.json.
DEBUG:fsspec.local:open file: C:/OSPanel/domains/ai_assistant/api/projects/4/data/index_store.json
DEBUG:llama_index.vector_stores.simple:Loading llama_index.vector_stores.simple from projects/4/data\vector_store.json.
DEBUG:fsspec.local:open file: C:/OSPanel/domains/ai_assistant/api/projects/4/data/vector_store.json
DEBUG:llama_index.graph_stores.simple:Loading llama_index.graph_stores.simple from projects/4/data\graph_store.json.
DEBUG:fsspec.local:open file: C:/OSPanel/domains/ai_assistant/api/projects/4/data/graph_store.json
INFO:llama_index.indices.loading:Loading indices with ids: ['vector_index']
DEBUG:openai:message='Request to OpenAI API' method=post path=https://api.openai.com/v1/embeddings
DEBUG:openai:api_version=None data='{"input": ["how much does it cost"], "model": "text-embedding-ada-002", "encoding_format": "base64"}' message='Post details'
DEBUG:urllib3.util.retry:Converted retries value: 2 -> Retry(total=2, connect=None, read=None, redirect=None, status=None)
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.openai.com:443
DEBUG:urllib3.connectionpool:https://api.openai.com:443 "POST /v1/embeddings HTTP/1.1" 200 None
DEBUG:openai:message='OpenAI API response' path=https://api.openai.com/v1/embeddings processing_ms=19 request_id=32415cb8ffb0d2829a18ef037000b691 response_code=200
DEBUG:llama_index.indices.utils:> Top 1 nodes:
> [Node 909c5dd5-e87e-4999-a794-761f96e44168] [Similarity score:             -0.0282805] Welcome to TechHub, your ultimate destination for cutting-edge technology and innovation! At Tech...
DEBUG:openai:message='Request to OpenAI API' method=post path=https://api.openai.com/v1/chat/completions
DEBUG:openai:api_version=None data='{"messages": [{"role": "system", "content": "Context information is below.\\n--------------------\\nWelcome to TechHub, your ultimate destination for cutting-edge technology and innovation! At TechHub, we pride ourselves on being a premier online store dedicated to providing a curated selection of the latest and greatest in tech gadgets, including laptops, smartphones, and more.\\n\\nAbout Us:\\n\\nAt the heart of TechHub is a passion for technology and a commitment to delivering top-notch products that seamlessly blend style, functionality, and performance. With a team of tech enthusiasts, we understand the ever-evolving nature of the digital landscape and strive to stay at the forefront of the latest trends and advancements.\\n\\nOur Mission:\\n\\nOur mission at TechHub is to empower our customers with the best tools and devices that enhance their digital lifestyle. Whether you\'re a professional looking for a high-performance laptop to boost productivity or a smartphone aficionado seeking the latest flagship model, we\'ve got you covered. We believe that technology should not only meet but exceed your expectations, making every interaction with your devices a seamless and enjoyable experience.\\n\\nQuality Assurance:\\n\\nTechHub is committed to delivering products of the highest quality. We carefully curate our inventory, partnering with leading brands known for their commitment to excellence. Each product undergoes rigorous testing to ensure reliability, durability, and top-notch performance. Our dedication to quality assurance is reflected in every item we offer.\\n\\nCustomer-Centric Approach:\\n\\nAt TechHub, our customers are at the core of everything we do. We prioritize your satisfaction and strive to provide an unparalleled shopping experience. Our customer support team is ready to assist you at every step, from product inquiries to after-sales support. We value your feedback and continuously work to improve our services based on your needs.\\n\\nSecure Shopping:\\n\\nYour online security is our priority. TechHub employs state-of-the-art encryption technology to ensure that your personal information remains secure and protected. Shop with confidence, knowing that your data is in safe hands.\\n\\nExplore the world of innovation at TechHub, where technology meets lifestyle. Discover the perfect blend of style and functionality with our carefully curated selection of laptops, smartphones, and other cutting-edge gadgets. Join us on this exciting journey, and let\'s embrace the future together!\\n--------------------\\n\\u0412\\u044b \\u2014 \\u0418\\u0418 \\u0430\\u0441\\u0441\\u0438\\u0441\\u0442\\u0435\\u043d\\u0442 \\u043a\\u043e\\u043c\\u043f\\u0430\\u043d\\u0438\\u0438. \\u0412\\u0430\\u043c \\u0431\\u0443\\u0434\\u0443\\u0442 \\u0437\\u0430\\u0434\\u0430\\u043d\\u044b \\u0432\\u043e\\u043f\\u0440\\u043e\\u0441\\u044b \\u043e \\u043d\\u0430\\u0448\\u0435\\u0439 \\u043a\\u043e\\u043c\\u043f\\u0430\\u043d\\u0438\\u0438. \\u0412\\u0435\\u0436\\u043b\\u0438\\u0432\\u043e \\u043e\\u0442\\u0432\\u0435\\u0447\\u0430\\u0439\\u0442\\u0435 \\u043d\\u0430 \\u0432\\u043e\\u043f\\u0440\\u043e\\u0441\\u044b.\\r\\n    \\u041d\\u0438\\u0436\\u0435 \\u043c\\u044b \\u043f\\u0440\\u0435\\u0434\\u043e\\u0441\\u0442\\u0430\\u0432\\u0438\\u043b\\u0438 \\u043a\\u043e\\u043d\\u0442\\u0435\\u043a\\u0441\\u0442\\u043d\\u0443\\u044e \\u0438\\u043d\\u0444\\u043e\\u0440\\u043c\\u0430\\u0446\\u0438\\u044e.\\r\\n    ---------------------\\r\\n    {context_str}\\r\\n    ---------------------\\r\\n    \\u0423\\u0447\\u0438\\u0442\\u044b\\u0432\\u0430\\u044f \\u044d\\u0442\\u0443 \\u0438\\u043d\\u0444\\u043e\\u0440\\u043c\\u0430\\u0446\\u0438\\u044e, \\u043e\\u0442\\u0432\\u0435\\u0442\\u044c\\u0442\\u0435, \\u043f\\u043e\\u0436\\u0430\\u043b\\u0443\\u0439\\u0441\\u0442\\u0430, \\u043d\\u0430 \\u0432\\u043e\\u043f\\u0440\\u043e\\u0441: {query_str}\\r\\n    . \\n Information about product [{\\"id\\":17,\\"title\\":\\"Xiaomi 13\\",\\"content\\":\\"<ul class=\\\\\\"a-unordered-list a-vertical a-spacing-mini\\\\\\">\\\\r\\\\n \\\\t<li class=\\\\\\"a-spacing-mini\\\\\\"><span class=\\\\\\"a-list-item\\\\\\">Ultra-immersive display design Light up the screen to enjoy an unrivalled experience. The 1.61mm ultra-thin bezels offer a boundless vision.<\\\\/span><\\\\/li>\\\\r\\\\n \\\\t<li class=\\\\\\"a-spacing-mini\\\\\\"><span class=\\\\\\"a-list-item\\\\\\">Built for more scenarios IP68 water and dust resistant* Born splash-proof and water-resistant, thanks to the precision manufacturing. Record special memories anytime and anywhere.<\\\\/span><\\\\/li>\\\\r\\\\n \\\\t<li class=\\\\\\"a-spacing-mini\\\\\\"><span class=\\\\\\"a-list-item\\\\\\">Leica main camera with professional optical lens Captures every great moment<\\\\/span><\\\\/li>\\\\r\\\\n \\\\t<li class=\\\\\\"a-spacing-mini\\\\\\"><span class=\\\\\\"a-list-item\\\\\\">Masterpiece performance Leading Snapdragon 8 Gen 2 Boosted performance, reduced consumption<\\\\/span><\\\\/li>\\\\r\\\\n<\\\\/ul>\\",\\"date\\":\\"27.12.2023\\",\\"attributes\\":{\\"pa_color\\":[\\"silver\\"]},\\"stock\\":null,\\"image_url\\":false,\\"sku\\":\\"141234\\",\\"price\\":\\"16000\\",\\"formatted_price\\":\\"<span class=\\\\\\"woocommerce-Price-amount amount\\\\\\"><bdi>16000,00&nbsp;<span class=\\\\\\"woocommerce-Price-currencySymbol\\\\\\">&#8381;<\\\\/span><\\\\/bdi><\\\\/span>\\",\\"product_link\\":\\"http:\\\\/\\\\/wordpress\\\\/product\\\\/%d0%ba%d1%80%d0%be%d1%81%d1%81%d0%be%d0%b2%d0%ba%d0%b8\\\\/\\"}]"}, {"role": "user", "content": "how much does it cost"}], "stream": false, "model": "gpt-3.5-turbo", "temperature": 0, "max_tokens": null}' message='Post details'
DEBUG:urllib3.connectionpool:https://api.openai.com:443 "POST /v1/chat/completions HTTP/1.1" 200 None
DEBUG:openai:message='OpenAI API response' path=https://api.openai.com/v1/chat/completions processing_ms=820 request_id=c0fb15330e18d7a049c313ef2afc6e6e response_code=200
INFO:myapp:{'api': 1, 'product_data': '{"attributes": "color", "categories": "misc,smartphones"}', 'website': 'asdf', 'id': 4, 'left_tokens': 26537, 'description': None, 'temperature': Decimal('0.00'), 'model': 'gpt-3.5-turbo', 'prompt': 'Вы — ИИ ассистент компании. Вам будут заданы вопросы о нашей компании. Вежливо отвечайте на вопросы.\r\n    Ниже мы предоставили контекстную информацию.\r\n    ---------------------\r\n    {context_str}\r\n    ---------------------\r\n    Учитывая эту информацию, ответьте, пожалуйста, на вопрос: {query_str}\r\n    ', 'response_mode': 'compact', 'user_id': 12, 'answer': 'Client: hello do you have silver xiaomi,\nAi response: Yes, we have a silver Xiaomi product available. It is called Xiaomi 13. It features an ultra-immersive display design with 1.61mm ultra-thin bezels, making it a visually stunning device. It is also IP68 water and dust resistant, allowing you to use it in various scenarios without worrying about water damage. The device is equipped with a Leica main camera with a professional optical lens, ensuring that you capture every great moment. It is powered by the leading Snapdragon 8 Gen 2 processor, providing excellent performance while reducing power consumption. The price of the silver Xiaomi 13 is 16,000 rubles. You can find more information and make a purchase on our website: [Xiaomi 13 Product Link](http://wordpress/product/кроссовки/)'}
ERROR:myapp:Exception on /projects/e47f0f811145d03c33fd6639dc3f09c0839d0891e264d849a75df04f4d047625/0smVuIiyDwqsO6gj4o37BHHPxXQT5pp9 [POST]
Traceback (most recent call last):
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\kombu\connection.py", line 556, in _ensured
    return fun(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\kombu\messaging.py", line 208, in _publish
    return channel.basic_publish(
           ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\kombu\transport\virtual\base.py", line 614, in basic_publish
    return self._put(routing_key, message, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\kombu\transport\redis.py", line 1016, in _put
    client.lpush(self._q_for_pri(queue, pri), dumps(message))
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\redis\commands\core.py", line 2721, in lpush
    return self.execute_command("LPUSH", name, *values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\redis\client.py", line 1269, in execute_command
    return conn.retry.call_with_retry(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\redis\retry.py", line 46, in call_with_retry
    return do()
           ^^^^
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\redis\client.py", line 1270, in <lambda>
    lambda: self._send_command_parse_response(
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\redis\client.py", line 1245, in _send_command_parse_response
    conn.send_command(*args)
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\redis\connection.py", line 855, in send_command
    self.send_packed_command(
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\redis\connection.py", line 828, in send_packed_command
    self.check_health()
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\redis\connection.py", line 820, in check_health
    self.retry.call_with_retry(self._send_ping, self._ping_failed)
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\redis\retry.py", line 46, in call_with_retry
    return do()
           ^^^^
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\redis\connection.py", line 810, in _send_ping
    if str_if_bytes(self.read_response()) != "PONG":
                    ^^^^^^^^^^^^^^^^^^^^
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\redis\connection.py", line 905, in read_response
    raise response
redis.exceptions.ResponseError: MISCONF Memurai is configured to save RDB snapshots, but it's currently unable to persist to disk. Commands that may modify the data set are disabled, because this instance is configured to report errors during writes if RDB snapshotting fails (stop-writes-on-bgsave-error option). Please check the Memurai logs for details about the RDB error.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\kombu\transport\virtual\base.py", line 951, in create_channel
    return self._avail_channels.pop()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
IndexError: pop from empty list

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\kombu\connection.py", line 472, in _reraise_as_library_errors
    yield
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\kombu\connection.py", line 578, in _ensured
    self._ensure_connection(
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\kombu\connection.py", line 459, in _ensure_connection
    return retry_over_time(
           ^^^^^^^^^^^^^^^^
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\kombu\utils\functional.py", line 318, in retry_over_time
    return fun(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\kombu\connection.py", line 934, in _connection_factory
    self._connection = self._establish_connection()
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\kombu\connection.py", line 860, in _establish_connection
    conn = self.transport.establish_connection()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\kombu\transport\virtual\base.py", line 975, in establish_connection
    self._avail_channels.append(self.create_channel(self))
                                ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\kombu\transport\virtual\base.py", line 953, in create_channel
    channel = self.Channel(connection)
              ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\kombu\transport\redis.py", line 741, in __init__
    self.client.ping()
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\redis\commands\core.py", line 1205, in ping
    return self.execute_command("PING", **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\redis\client.py", line 1269, in execute_command
    return conn.retry.call_with_retry(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\redis\retry.py", line 46, in call_with_retry
    return do()
           ^^^^
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\redis\client.py", line 1270, in <lambda>
    lambda: self._send_command_parse_response(
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\redis\client.py", line 1245, in _send_command_parse_response
    conn.send_command(*args)
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\redis\connection.py", line 855, in send_command
    self.send_packed_command(
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\redis\connection.py", line 828, in send_packed_command
    self.check_health()
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\redis\connection.py", line 820, in check_health
    self.retry.call_with_retry(self._send_ping, self._ping_failed)
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\redis\retry.py", line 46, in call_with_retry
    return do()
           ^^^^
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\redis\connection.py", line 810, in _send_ping
    if str_if_bytes(self.read_response()) != "PONG":
                    ^^^^^^^^^^^^^^^^^^^^
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\redis\connection.py", line 905, in read_response
    raise response
redis.exceptions.ResponseError: MISCONF Memurai is configured to save RDB snapshots, but it's currently unable to persist to disk. Commands that may modify the data set are disabled, because this instance is configured to report errors during writes if RDB snapshotting fails (stop-writes-on-bgsave-error option). Please check the Memurai logs for details about the RDB error.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\flask\app.py", line 2190, in wsgi_app
    response = self.full_dispatch_request()
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\flask\app.py", line 1486, in full_dispatch_request
    rv = self.handle_user_exception(e)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\flask_cors\extension.py", line 176, in wrapped_function
    return cors_after_request(app.make_response(f(*args, **kwargs)))
                                                ^^^^^^^^^^^^^^^^^^
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\flask_cors\extension.py", line 176, in wrapped_function
    return cors_after_request(app.make_response(f(*args, **kwargs)))
                                                ^^^^^^^^^^^^^^^^^^
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\flask\app.py", line 1484, in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\flask\app.py", line 1469, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\OSPanel\domains\ai_assistant\api\myapp.py", line 388, in get_project_details
    send_chat_request.apply_async(args=[project['user_id'], project['id'], session_id, token_counter.total_llm_token_count,f"Client: {query_text},\nAi response: {response.response}"])
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\celery\app\task.py", line 594, in apply_async
    return app.send_task(
           ^^^^^^^^^^^^^^
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\celery\app\base.py", line 798, in send_task
    amqp.send_task_message(P, name, message, **options)
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\celery\app\amqp.py", line 517, in send_task_message
    ret = producer.publish(
          ^^^^^^^^^^^^^^^^^
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\kombu\messaging.py", line 186, in publish
    return _publish(
           ^^^^^^^^^
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\kombu\connection.py", line 553, in _ensured
    with self._reraise_as_library_errors():
  File "C:\Users\Maxan\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 155, in __exit__
    self.gen.throw(typ, value, traceback)
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\kombu\connection.py", line 476, in _reraise_as_library_errors
    raise ConnectionError(str(exc)) from exc
kombu.exceptions.OperationalError: MISCONF Memurai is configured to save RDB snapshots, but it's currently unable to persist to disk. Commands that may modify the data set are disabled, because this instance is configured to report errors during writes if RDB snapshotting fails (stop-writes-on-bgsave-error option). Please check the Memurai logs for details about the RDB error.
INFO:werkzeug:127.0.0.1 - - [31/Dec/2023 18:07:27] "[35m[1mPOST /projects/e47f0f811145d03c33fd6639dc3f09c0839d0891e264d849a75df04f4d047625/0smVuIiyDwqsO6gj4o37BHHPxXQT5pp9 HTTP/1.1[0m" 500 -
DEBUG:root:This is a debug message
DEBUG:celery.utils.functional:
def unlock_chord(self, group_id, callback, interval=0, max_retries=1, result=2, Result=3, GroupResult=4, result_from_tuple=5, **kwargs):
    return 1

DEBUG:celery.utils.functional:
def sendEmbeddingRequest(user_id, total_tokens):
    return 1

DEBUG:celery.utils.functional:
def group(self, tasks, result, group_id, partial_args, add_to_parent=0):
    return 1

DEBUG:celery.utils.functional:
def xmap(task, it):
    return 1

DEBUG:celery.utils.functional:
def backend_cleanup():
    return 1

DEBUG:celery.utils.functional:
def chain(*args, **kwargs):
    return 1

DEBUG:celery.utils.functional:
def send_chat_request(user_id, project_id, session, total_tokens, answer):
    return 1

DEBUG:celery.utils.functional:
def xstarmap(task, it):
    return 1

DEBUG:celery.utils.functional:
def accumulate(self, *args, **kwargs):
    return 1

DEBUG:celery.utils.functional:
def set_vector_index_task(self, token):
    return 1

DEBUG:celery.utils.functional:
def process_set_vector_index(self, token, task_id):
    return 1

DEBUG:celery.utils.functional:
def chord(self, header, body, partial_args=0, interval=1, countdown=2, max_retries=3, eager=4, **kwargs):
    return 1

DEBUG:celery.utils.functional:
def chunks(task, it, n):
    return 1

DEBUG:myapp:Flask app started
INFO:werkzeug:[31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:5000
INFO:werkzeug:[33mPress CTRL+C to quit[0m
DEBUG:root:This is a debug message
DEBUG:celery.utils.functional:
def unlock_chord(self, group_id, callback, interval=0, max_retries=1, result=2, Result=3, GroupResult=4, result_from_tuple=5, **kwargs):
    return 1

DEBUG:celery.utils.functional:
def group(self, tasks, result, group_id, partial_args, add_to_parent=0):
    return 1

DEBUG:celery.utils.functional:
def send_chat_request(user_id, project_id, session, total_tokens, answer):
    return 1

DEBUG:celery.utils.functional:
def xmap(task, it):
    return 1

DEBUG:celery.utils.functional:
def sendEmbeddingRequest(user_id, total_tokens):
    return 1

DEBUG:celery.utils.functional:
def backend_cleanup():
    return 1

DEBUG:celery.utils.functional:
def set_vector_index_task(self, token):
    return 1

DEBUG:celery.utils.functional:
def process_set_vector_index(self, token, task_id):
    return 1

DEBUG:celery.utils.functional:
def chain(*args, **kwargs):
    return 1

DEBUG:celery.utils.functional:
def xstarmap(task, it):
    return 1

DEBUG:celery.utils.functional:
def accumulate(self, *args, **kwargs):
    return 1

DEBUG:celery.utils.functional:
def chord(self, header, body, partial_args=0, interval=1, countdown=2, max_retries=3, eager=4, **kwargs):
    return 1

DEBUG:celery.utils.functional:
def chunks(task, it, n):
    return 1

ERROR:myapp:Exception on /files/e47f0f811145d03c33fd6639dc3f09c0839d0891e264d849a75df04f4d047625 [GET]
Traceback (most recent call last):
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\flask\app.py", line 2190, in wsgi_app
    response = self.full_dispatch_request()
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\flask\app.py", line 1486, in full_dispatch_request
    rv = self.handle_user_exception(e)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\flask_cors\extension.py", line 176, in wrapped_function
    return cors_after_request(app.make_response(f(*args, **kwargs)))
                                                ^^^^^^^^^^^^^^^^^^
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\flask_cors\extension.py", line 176, in wrapped_function
    return cors_after_request(app.make_response(f(*args, **kwargs)))
                                                ^^^^^^^^^^^^^^^^^^
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\flask\app.py", line 1484, in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\flask\app.py", line 1469, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\OSPanel\domains\ai_assistant\api\myapp.py", line 110, in list_files
    project_id = project['project_id']
                 ~~~~~~~^^^^^^^^^^^^^^
KeyError: 'project_id'
INFO:werkzeug:127.0.0.1 - - [31/Dec/2023 18:09:22] "[35m[1mGET /files/e47f0f811145d03c33fd6639dc3f09c0839d0891e264d849a75df04f4d047625 HTTP/1.1[0m" 500 -
ERROR:myapp:Exception on /files/e47f0f811145d03c33fd6639dc3f09c0839d0891e264d849a75df04f4d047625 [GET]
Traceback (most recent call last):
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\flask\app.py", line 2190, in wsgi_app
    response = self.full_dispatch_request()
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\flask\app.py", line 1486, in full_dispatch_request
    rv = self.handle_user_exception(e)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\flask_cors\extension.py", line 176, in wrapped_function
    return cors_after_request(app.make_response(f(*args, **kwargs)))
                                                ^^^^^^^^^^^^^^^^^^
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\flask_cors\extension.py", line 176, in wrapped_function
    return cors_after_request(app.make_response(f(*args, **kwargs)))
                                                ^^^^^^^^^^^^^^^^^^
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\flask\app.py", line 1484, in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\flask\app.py", line 1469, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\OSPanel\domains\ai_assistant\api\myapp.py", line 110, in list_files
    project_id = project['project_id']
                 ~~~~~~~^^^^^^^^^^^^^^
KeyError: 'project_id'
INFO:werkzeug:127.0.0.1 - - [31/Dec/2023 18:09:35] "[35m[1mGET /files/e47f0f811145d03c33fd6639dc3f09c0839d0891e264d849a75df04f4d047625 HTTP/1.1[0m" 500 -
INFO:werkzeug:127.0.0.1 - - [31/Dec/2023 18:09:53] "OPTIONS /projects/e47f0f811145d03c33fd6639dc3f09c0839d0891e264d849a75df04f4d047625/IOGI8b2pgNxtEXyCk2DD4jZlsgeTxbwo HTTP/1.1" 200 -
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.openai.com:443
DEBUG:urllib3.connectionpool:https://api.openai.com:443 "POST /v1/chat/completions HTTP/1.1" 200 None
INFO:myapp:[{'url_params': 'product_name=xiaomi', 'is_related': 'yes', 'category': 'smartphones'}]
INFO:myapp:product_name=xiaomi
INFO:myapp:prompt
INFO:myapp:You are AI assistant for a online shop. You should determine if a client is asking information about a product in our store. It can be a question about price, availability in stock, product characteristic, comparing 2 products. In this case you should contruct query parameters based on a client question. Construct them for every mentioned product. Add sort_price parameter if required .For example product_name=item_name&color=green&size=44&sort_price=desc|asc List of available query parameters: product_name, color product_name is a required parameter. You should use it in every query.Use only these query parameters for consructing. Add a category. List of available categories: misc,smartphones. Write your asnwer as array of json objects. [{url_params: <url_here>, is_related: 'yes', category: <category_here> }] If the question is not related to products of the store, then your answer would be [{is_related: 'no'}] Be strict. Fix typos in product names. Dont write anything else. Your answer will be used for a next query. History of your conversaion: NoneClient question: hello, do you have xiaomiYour answer:
DEBUG:urllib3.connectionpool:Starting new HTTP connection (1): wordpress:80
DEBUG:urllib3.connectionpool:http://wordpress:80 "GET /wp-json/chatty/v1/posts?product_name=xiaomi HTTP/1.1" 200 1752
INFO:myapp:api data [{"id":17,"title":"Xiaomi 13","content":"<ul class=\"a-unordered-list a-vertical a-spacing-mini\">\r\n \t<li class=\"a-spacing-mini\"><span class=\"a-list-item\">Ultra-immersive display design Light up the screen to enjoy an unrivalled experience. The 1.61mm ultra-thin bezels offer a boundless vision.<\/span><\/li>\r\n \t<li class=\"a-spacing-mini\"><span class=\"a-list-item\">Built for more scenarios IP68 water and dust resistant* Born splash-proof and water-resistant, thanks to the precision manufacturing. Record special memories anytime and anywhere.<\/span><\/li>\r\n \t<li class=\"a-spacing-mini\"><span class=\"a-list-item\">Leica main camera with professional optical lens Captures every great moment<\/span><\/li>\r\n \t<li class=\"a-spacing-mini\"><span class=\"a-list-item\">Masterpiece performance Leading Snapdragon 8 Gen 2 Boosted performance, reduced consumption<\/span><\/li>\r\n<\/ul>","date":"27.12.2023","attributes":{"pa_color":["silver"]},"stock":null,"image_url":false,"sku":"141234","price":"16000","formatted_price":"<span class=\"woocommerce-Price-amount amount\"><bdi>16000,00&nbsp;<span class=\"woocommerce-Price-currencySymbol\">&#8381;<\/span><\/bdi><\/span>","product_link":"http:\/\/wordpress\/product\/%d0%ba%d1%80%d0%be%d1%81%d1%81%d0%be%d0%b2%d0%ba%d0%b8\/"},{"id":20,"title":"Xiaomi Redmi 12 128GB &#8212; Black &#8212; Unlocked &#8212; Dual-SIM","content":"","date":"29.12.2023","attributes":{"pa_color":["black"]},"stock":null,"image_url":false,"sku":"141234-1","price":"15000","formatted_price":"<span class=\"woocommerce-Price-amount amount\"><bdi>15000,00&nbsp;<span class=\"woocommerce-Price-currencySymbol\">&#8381;<\/span><\/bdi><\/span>","product_link":"http:\/\/wordpress\/product\/xiaomi-12-black\/"}]
DEBUG:llama_index.storage.kvstore.simple_kvstore:Loading llama_index.storage.kvstore.simple_kvstore from projects/4/data\docstore.json.
DEBUG:fsspec.local:open file: C:/OSPanel/domains/ai_assistant/api/projects/4/data/docstore.json
DEBUG:llama_index.storage.kvstore.simple_kvstore:Loading llama_index.storage.kvstore.simple_kvstore from projects/4/data\index_store.json.
DEBUG:fsspec.local:open file: C:/OSPanel/domains/ai_assistant/api/projects/4/data/index_store.json
DEBUG:llama_index.vector_stores.simple:Loading llama_index.vector_stores.simple from projects/4/data\vector_store.json.
DEBUG:fsspec.local:open file: C:/OSPanel/domains/ai_assistant/api/projects/4/data/vector_store.json
DEBUG:llama_index.graph_stores.simple:Loading llama_index.graph_stores.simple from projects/4/data\graph_store.json.
DEBUG:fsspec.local:open file: C:/OSPanel/domains/ai_assistant/api/projects/4/data/graph_store.json
INFO:llama_index.indices.loading:Loading indices with ids: ['vector_index']
DEBUG:openai:message='Request to OpenAI API' method=post path=https://api.openai.com/v1/embeddings
DEBUG:openai:api_version=None data='{"input": ["hello, do you have xiaomi"], "model": "text-embedding-ada-002", "encoding_format": "base64"}' message='Post details'
DEBUG:urllib3.util.retry:Converted retries value: 2 -> Retry(total=2, connect=None, read=None, redirect=None, status=None)
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.openai.com:443
DEBUG:urllib3.connectionpool:https://api.openai.com:443 "POST /v1/embeddings HTTP/1.1" 200 None
DEBUG:openai:message='OpenAI API response' path=https://api.openai.com/v1/embeddings processing_ms=18 request_id=01cac746a23f65b3acdbce1bf4297952 response_code=200
DEBUG:llama_index.indices.utils:> Top 1 nodes:
> [Node 909c5dd5-e87e-4999-a794-761f96e44168] [Similarity score:             -0.0278777] Welcome to TechHub, your ultimate destination for cutting-edge technology and innovation! At Tech...
DEBUG:openai:message='Request to OpenAI API' method=post path=https://api.openai.com/v1/chat/completions
DEBUG:openai:api_version=None data='{"messages": [{"role": "system", "content": "Context information is below.\\n--------------------\\nWelcome to TechHub, your ultimate destination for cutting-edge technology and innovation! At TechHub, we pride ourselves on being a premier online store dedicated to providing a curated selection of the latest and greatest in tech gadgets, including laptops, smartphones, and more.\\n\\nAbout Us:\\n\\nAt the heart of TechHub is a passion for technology and a commitment to delivering top-notch products that seamlessly blend style, functionality, and performance. With a team of tech enthusiasts, we understand the ever-evolving nature of the digital landscape and strive to stay at the forefront of the latest trends and advancements.\\n\\nOur Mission:\\n\\nOur mission at TechHub is to empower our customers with the best tools and devices that enhance their digital lifestyle. Whether you\'re a professional looking for a high-performance laptop to boost productivity or a smartphone aficionado seeking the latest flagship model, we\'ve got you covered. We believe that technology should not only meet but exceed your expectations, making every interaction with your devices a seamless and enjoyable experience.\\n\\nQuality Assurance:\\n\\nTechHub is committed to delivering products of the highest quality. We carefully curate our inventory, partnering with leading brands known for their commitment to excellence. Each product undergoes rigorous testing to ensure reliability, durability, and top-notch performance. Our dedication to quality assurance is reflected in every item we offer.\\n\\nCustomer-Centric Approach:\\n\\nAt TechHub, our customers are at the core of everything we do. We prioritize your satisfaction and strive to provide an unparalleled shopping experience. Our customer support team is ready to assist you at every step, from product inquiries to after-sales support. We value your feedback and continuously work to improve our services based on your needs.\\n\\nSecure Shopping:\\n\\nYour online security is our priority. TechHub employs state-of-the-art encryption technology to ensure that your personal information remains secure and protected. Shop with confidence, knowing that your data is in safe hands.\\n\\nExplore the world of innovation at TechHub, where technology meets lifestyle. Discover the perfect blend of style and functionality with our carefully curated selection of laptops, smartphones, and other cutting-edge gadgets. Join us on this exciting journey, and let\'s embrace the future together!\\n--------------------\\n\\u0412\\u044b \\u2014 \\u0418\\u0418 \\u0430\\u0441\\u0441\\u0438\\u0441\\u0442\\u0435\\u043d\\u0442 \\u043a\\u043e\\u043c\\u043f\\u0430\\u043d\\u0438\\u0438. \\u0412\\u0430\\u043c \\u0431\\u0443\\u0434\\u0443\\u0442 \\u0437\\u0430\\u0434\\u0430\\u043d\\u044b \\u0432\\u043e\\u043f\\u0440\\u043e\\u0441\\u044b \\u043e \\u043d\\u0430\\u0448\\u0435\\u0439 \\u043a\\u043e\\u043c\\u043f\\u0430\\u043d\\u0438\\u0438. \\u0412\\u0435\\u0436\\u043b\\u0438\\u0432\\u043e \\u043e\\u0442\\u0432\\u0435\\u0447\\u0430\\u0439\\u0442\\u0435 \\u043d\\u0430 \\u0432\\u043e\\u043f\\u0440\\u043e\\u0441\\u044b.\\r\\n    \\u041d\\u0438\\u0436\\u0435 \\u043c\\u044b \\u043f\\u0440\\u0435\\u0434\\u043e\\u0441\\u0442\\u0430\\u0432\\u0438\\u043b\\u0438 \\u043a\\u043e\\u043d\\u0442\\u0435\\u043a\\u0441\\u0442\\u043d\\u0443\\u044e \\u0438\\u043d\\u0444\\u043e\\u0440\\u043c\\u0430\\u0446\\u0438\\u044e.\\r\\n    ---------------------\\r\\n    {context_str}\\r\\n    ---------------------\\r\\n    \\u0423\\u0447\\u0438\\u0442\\u044b\\u0432\\u0430\\u044f \\u044d\\u0442\\u0443 \\u0438\\u043d\\u0444\\u043e\\u0440\\u043c\\u0430\\u0446\\u0438\\u044e, \\u043e\\u0442\\u0432\\u0435\\u0442\\u044c\\u0442\\u0435, \\u043f\\u043e\\u0436\\u0430\\u043b\\u0443\\u0439\\u0441\\u0442\\u0430, \\u043d\\u0430 \\u0432\\u043e\\u043f\\u0440\\u043e\\u0441: {query_str}\\r\\n    . \\n Information about product [{\\"id\\":17,\\"title\\":\\"Xiaomi 13\\",\\"content\\":\\"<ul class=\\\\\\"a-unordered-list a-vertical a-spacing-mini\\\\\\">\\\\r\\\\n \\\\t<li class=\\\\\\"a-spacing-mini\\\\\\"><span class=\\\\\\"a-list-item\\\\\\">Ultra-immersive display design Light up the screen to enjoy an unrivalled experience. The 1.61mm ultra-thin bezels offer a boundless vision.<\\\\/span><\\\\/li>\\\\r\\\\n \\\\t<li class=\\\\\\"a-spacing-mini\\\\\\"><span class=\\\\\\"a-list-item\\\\\\">Built for more scenarios IP68 water and dust resistant* Born splash-proof and water-resistant, thanks to the precision manufacturing. Record special memories anytime and anywhere.<\\\\/span><\\\\/li>\\\\r\\\\n \\\\t<li class=\\\\\\"a-spacing-mini\\\\\\"><span class=\\\\\\"a-list-item\\\\\\">Leica main camera with professional optical lens Captures every great moment<\\\\/span><\\\\/li>\\\\r\\\\n \\\\t<li class=\\\\\\"a-spacing-mini\\\\\\"><span class=\\\\\\"a-list-item\\\\\\">Masterpiece performance Leading Snapdragon 8 Gen 2 Boosted performance, reduced consumption<\\\\/span><\\\\/li>\\\\r\\\\n<\\\\/ul>\\",\\"date\\":\\"27.12.2023\\",\\"attributes\\":{\\"pa_color\\":[\\"silver\\"]},\\"stock\\":null,\\"image_url\\":false,\\"sku\\":\\"141234\\",\\"price\\":\\"16000\\",\\"formatted_price\\":\\"<span class=\\\\\\"woocommerce-Price-amount amount\\\\\\"><bdi>16000,00&nbsp;<span class=\\\\\\"woocommerce-Price-currencySymbol\\\\\\">&#8381;<\\\\/span><\\\\/bdi><\\\\/span>\\",\\"product_link\\":\\"http:\\\\/\\\\/wordpress\\\\/product\\\\/%d0%ba%d1%80%d0%be%d1%81%d1%81%d0%be%d0%b2%d0%ba%d0%b8\\\\/\\"},{\\"id\\":20,\\"title\\":\\"Xiaomi Redmi 12 128GB &#8212; Black &#8212; Unlocked &#8212; Dual-SIM\\",\\"content\\":\\"\\",\\"date\\":\\"29.12.2023\\",\\"attributes\\":{\\"pa_color\\":[\\"black\\"]},\\"stock\\":null,\\"image_url\\":false,\\"sku\\":\\"141234-1\\",\\"price\\":\\"15000\\",\\"formatted_price\\":\\"<span class=\\\\\\"woocommerce-Price-amount amount\\\\\\"><bdi>15000,00&nbsp;<span class=\\\\\\"woocommerce-Price-currencySymbol\\\\\\">&#8381;<\\\\/span><\\\\/bdi><\\\\/span>\\",\\"product_link\\":\\"http:\\\\/\\\\/wordpress\\\\/product\\\\/xiaomi-12-black\\\\/\\"}]"}, {"role": "user", "content": "hello, do you have xiaomi"}], "stream": false, "model": "gpt-3.5-turbo", "temperature": 0, "max_tokens": null}' message='Post details'
DEBUG:urllib3.connectionpool:https://api.openai.com:443 "POST /v1/chat/completions HTTP/1.1" 200 None
DEBUG:openai:message='OpenAI API response' path=https://api.openai.com/v1/chat/completions processing_ms=861 request_id=acdfeed940ff596f5fe2403eb87c11a9 response_code=200
INFO:myapp:{'api': 1, 'product_data': '{"attributes": "color", "categories": "misc,smartphones"}', 'website': 'asdf', 'id': 4, 'left_tokens': 26537, 'description': None, 'temperature': Decimal('0.00'), 'model': 'gpt-3.5-turbo', 'prompt': 'Вы — ИИ ассистент компании. Вам будут заданы вопросы о нашей компании. Вежливо отвечайте на вопросы.\r\n    Ниже мы предоставили контекстную информацию.\r\n    ---------------------\r\n    {context_str}\r\n    ---------------------\r\n    Учитывая эту информацию, ответьте, пожалуйста, на вопрос: {query_str}\r\n    ', 'response_mode': 'compact', 'user_id': 12, 'answer': None}
DEBUG:root:This is a debug message
DEBUG:celery.utils.functional:
def send_chat_request(user_id, project_id, session, total_tokens, answer):
    return 1

INFO:werkzeug:127.0.0.1 - - [31/Dec/2023 18:10:00] "POST /projects/e47f0f811145d03c33fd6639dc3f09c0839d0891e264d849a75df04f4d047625/IOGI8b2pgNxtEXyCk2DD4jZlsgeTxbwo HTTP/1.1" 200 -
INFO:werkzeug:127.0.0.1 - - [31/Dec/2023 18:10:40] "OPTIONS /projects/e47f0f811145d03c33fd6639dc3f09c0839d0891e264d849a75df04f4d047625/IOGI8b2pgNxtEXyCk2DD4jZlsgeTxbwo HTTP/1.1" 200 -
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.openai.com:443
DEBUG:urllib3.connectionpool:https://api.openai.com:443 "POST /v1/chat/completions HTTP/1.1" 200 None
INFO:myapp:[{'url_params': 'product_name=13 model', 'is_related': 'yes', 'category': 'misc'}]
INFO:myapp:product_name=13 model
INFO:myapp:prompt
INFO:myapp:You are AI assistant for a online shop. You should determine if a client is asking information about a product in our store. It can be a question about price, availability in stock, product characteristic, comparing 2 products. In this case you should contruct query parameters based on a client question. Construct them for every mentioned product. Add sort_price parameter if required .For example product_name=item_name&color=green&size=44&sort_price=desc|asc List of available query parameters: product_name, color product_name is a required parameter. You should use it in every query.Use only these query parameters for consructing. Add a category. List of available categories: misc,smartphones. Write your asnwer as array of json objects. [{url_params: <url_here>, is_related: 'yes', category: <category_here> }] If the question is not related to products of the store, then your answer would be [{is_related: 'no'}] Be strict. Fix typos in product names. Dont write anything else. Your answer will be used for a next query. History of your conversaion: Client: hello, do you have xiaomi,
Ai response: Yes, we have Xiaomi products available. Can you please specify which Xiaomi product you are interested in?Client question: i want 13 modelYour answer:
DEBUG:urllib3.connectionpool:Starting new HTTP connection (1): wordpress:80
DEBUG:urllib3.connectionpool:http://wordpress:80 "GET /wp-json/chatty/v1/posts?product_name=13+model HTTP/1.1" 200 95
INFO:myapp:api data Unfortunately we dont have 13 model in our store. But please checkout our similar products: 
[]
DEBUG:llama_index.storage.kvstore.simple_kvstore:Loading llama_index.storage.kvstore.simple_kvstore from projects/4/data\docstore.json.
DEBUG:fsspec.local:open file: C:/OSPanel/domains/ai_assistant/api/projects/4/data/docstore.json
DEBUG:llama_index.storage.kvstore.simple_kvstore:Loading llama_index.storage.kvstore.simple_kvstore from projects/4/data\index_store.json.
DEBUG:fsspec.local:open file: C:/OSPanel/domains/ai_assistant/api/projects/4/data/index_store.json
DEBUG:llama_index.vector_stores.simple:Loading llama_index.vector_stores.simple from projects/4/data\vector_store.json.
DEBUG:fsspec.local:open file: C:/OSPanel/domains/ai_assistant/api/projects/4/data/vector_store.json
DEBUG:llama_index.graph_stores.simple:Loading llama_index.graph_stores.simple from projects/4/data\graph_store.json.
DEBUG:fsspec.local:open file: C:/OSPanel/domains/ai_assistant/api/projects/4/data/graph_store.json
INFO:llama_index.indices.loading:Loading indices with ids: ['vector_index']
DEBUG:openai:message='Request to OpenAI API' method=post path=https://api.openai.com/v1/embeddings
DEBUG:openai:api_version=None data='{"input": ["i want 13 model"], "model": "text-embedding-ada-002", "encoding_format": "base64"}' message='Post details'
DEBUG:urllib3.util.retry:Converted retries value: 2 -> Retry(total=2, connect=None, read=None, redirect=None, status=None)
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.openai.com:443
DEBUG:urllib3.connectionpool:https://api.openai.com:443 "POST /v1/embeddings HTTP/1.1" 200 None
DEBUG:openai:message='OpenAI API response' path=https://api.openai.com/v1/embeddings processing_ms=19 request_id=b6c285e574a837430cdd4885c87f7ee9 response_code=200
DEBUG:llama_index.indices.utils:> Top 1 nodes:
> [Node 909c5dd5-e87e-4999-a794-761f96e44168] [Similarity score:             -0.0294736] Welcome to TechHub, your ultimate destination for cutting-edge technology and innovation! At Tech...
DEBUG:openai:message='Request to OpenAI API' method=post path=https://api.openai.com/v1/chat/completions
DEBUG:openai:api_version=None data='{"messages": [{"role": "system", "content": "Context information is below.\\n--------------------\\nWelcome to TechHub, your ultimate destination for cutting-edge technology and innovation! At TechHub, we pride ourselves on being a premier online store dedicated to providing a curated selection of the latest and greatest in tech gadgets, including laptops, smartphones, and more.\\n\\nAbout Us:\\n\\nAt the heart of TechHub is a passion for technology and a commitment to delivering top-notch products that seamlessly blend style, functionality, and performance. With a team of tech enthusiasts, we understand the ever-evolving nature of the digital landscape and strive to stay at the forefront of the latest trends and advancements.\\n\\nOur Mission:\\n\\nOur mission at TechHub is to empower our customers with the best tools and devices that enhance their digital lifestyle. Whether you\'re a professional looking for a high-performance laptop to boost productivity or a smartphone aficionado seeking the latest flagship model, we\'ve got you covered. We believe that technology should not only meet but exceed your expectations, making every interaction with your devices a seamless and enjoyable experience.\\n\\nQuality Assurance:\\n\\nTechHub is committed to delivering products of the highest quality. We carefully curate our inventory, partnering with leading brands known for their commitment to excellence. Each product undergoes rigorous testing to ensure reliability, durability, and top-notch performance. Our dedication to quality assurance is reflected in every item we offer.\\n\\nCustomer-Centric Approach:\\n\\nAt TechHub, our customers are at the core of everything we do. We prioritize your satisfaction and strive to provide an unparalleled shopping experience. Our customer support team is ready to assist you at every step, from product inquiries to after-sales support. We value your feedback and continuously work to improve our services based on your needs.\\n\\nSecure Shopping:\\n\\nYour online security is our priority. TechHub employs state-of-the-art encryption technology to ensure that your personal information remains secure and protected. Shop with confidence, knowing that your data is in safe hands.\\n\\nExplore the world of innovation at TechHub, where technology meets lifestyle. Discover the perfect blend of style and functionality with our carefully curated selection of laptops, smartphones, and other cutting-edge gadgets. Join us on this exciting journey, and let\'s embrace the future together!\\n--------------------\\n\\u0412\\u044b \\u2014 \\u0418\\u0418 \\u0430\\u0441\\u0441\\u0438\\u0441\\u0442\\u0435\\u043d\\u0442 \\u043a\\u043e\\u043c\\u043f\\u0430\\u043d\\u0438\\u0438. \\u0412\\u0430\\u043c \\u0431\\u0443\\u0434\\u0443\\u0442 \\u0437\\u0430\\u0434\\u0430\\u043d\\u044b \\u0432\\u043e\\u043f\\u0440\\u043e\\u0441\\u044b \\u043e \\u043d\\u0430\\u0448\\u0435\\u0439 \\u043a\\u043e\\u043c\\u043f\\u0430\\u043d\\u0438\\u0438. \\u0412\\u0435\\u0436\\u043b\\u0438\\u0432\\u043e \\u043e\\u0442\\u0432\\u0435\\u0447\\u0430\\u0439\\u0442\\u0435 \\u043d\\u0430 \\u0432\\u043e\\u043f\\u0440\\u043e\\u0441\\u044b.\\r\\n    \\u041d\\u0438\\u0436\\u0435 \\u043c\\u044b \\u043f\\u0440\\u0435\\u0434\\u043e\\u0441\\u0442\\u0430\\u0432\\u0438\\u043b\\u0438 \\u043a\\u043e\\u043d\\u0442\\u0435\\u043a\\u0441\\u0442\\u043d\\u0443\\u044e \\u0438\\u043d\\u0444\\u043e\\u0440\\u043c\\u0430\\u0446\\u0438\\u044e.\\r\\n    ---------------------\\r\\n    {context_str}\\r\\n    ---------------------\\r\\n    \\u0423\\u0447\\u0438\\u0442\\u044b\\u0432\\u0430\\u044f \\u044d\\u0442\\u0443 \\u0438\\u043d\\u0444\\u043e\\u0440\\u043c\\u0430\\u0446\\u0438\\u044e, \\u043e\\u0442\\u0432\\u0435\\u0442\\u044c\\u0442\\u0435, \\u043f\\u043e\\u0436\\u0430\\u043b\\u0443\\u0439\\u0441\\u0442\\u0430, \\u043d\\u0430 \\u0432\\u043e\\u043f\\u0440\\u043e\\u0441: {query_str}\\r\\n    . \\n Information about product Unfortunately we dont have 13 model in our store. But please checkout our similar products: \\n[]"}, {"role": "user", "content": "i want 13 model"}], "stream": false, "model": "gpt-3.5-turbo", "temperature": 0, "max_tokens": null}' message='Post details'
DEBUG:urllib3.connectionpool:https://api.openai.com:443 "POST /v1/chat/completions HTTP/1.1" 200 None
DEBUG:openai:message='OpenAI API response' path=https://api.openai.com/v1/chat/completions processing_ms=2682 request_id=69f967902e170eea8581ed8964f69019 response_code=200
INFO:myapp:{'api': 1, 'product_data': '{"attributes": "color", "categories": "misc,smartphones"}', 'website': 'asdf', 'id': 4, 'left_tokens': 25454, 'description': None, 'temperature': Decimal('0.00'), 'model': 'gpt-3.5-turbo', 'prompt': 'Вы — ИИ ассистент компании. Вам будут заданы вопросы о нашей компании. Вежливо отвечайте на вопросы.\r\n    Ниже мы предоставили контекстную информацию.\r\n    ---------------------\r\n    {context_str}\r\n    ---------------------\r\n    Учитывая эту информацию, ответьте, пожалуйста, на вопрос: {query_str}\r\n    ', 'response_mode': 'compact', 'user_id': 12, 'answer': 'Client: hello, do you have xiaomi,\nAi response: Yes, we have Xiaomi products available. Can you please specify which Xiaomi product you are interested in?'}
INFO:werkzeug:127.0.0.1 - - [31/Dec/2023 18:10:48] "POST /projects/e47f0f811145d03c33fd6639dc3f09c0839d0891e264d849a75df04f4d047625/IOGI8b2pgNxtEXyCk2DD4jZlsgeTxbwo HTTP/1.1" 200 -
DEBUG:root:This is a debug message
DEBUG:celery.utils.functional:
def unlock_chord(self, group_id, callback, interval=0, max_retries=1, result=2, Result=3, GroupResult=4, result_from_tuple=5, **kwargs):
    return 1

DEBUG:celery.utils.functional:
def group(self, tasks, result, group_id, partial_args, add_to_parent=0):
    return 1

DEBUG:celery.utils.functional:
def send_chat_request(user_id, project_id, session, total_tokens, answer):
    return 1

DEBUG:celery.utils.functional:
def xmap(task, it):
    return 1

DEBUG:celery.utils.functional:
def sendEmbeddingRequest(user_id, total_tokens):
    return 1

DEBUG:celery.utils.functional:
def backend_cleanup():
    return 1

DEBUG:celery.utils.functional:
def set_vector_index_task(self, token):
    return 1

DEBUG:celery.utils.functional:
def process_set_vector_index(self, token, task_id):
    return 1

DEBUG:celery.utils.functional:
def chain(*args, **kwargs):
    return 1

DEBUG:celery.utils.functional:
def xstarmap(task, it):
    return 1

DEBUG:celery.utils.functional:
def accumulate(self, *args, **kwargs):
    return 1

DEBUG:celery.utils.functional:
def chord(self, header, body, partial_args=0, interval=1, countdown=2, max_retries=3, eager=4, **kwargs):
    return 1

DEBUG:celery.utils.functional:
def chunks(task, it, n):
    return 1

DEBUG:myapp:Flask app started
INFO:werkzeug:[31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:5000
INFO:werkzeug:[33mPress CTRL+C to quit[0m
ERROR:myapp:Exception on /files/e47f0f811145d03c33fd6639dc3f09c0839d0891e264d849a75df04f4d047625 [GET]
Traceback (most recent call last):
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\flask\app.py", line 2190, in wsgi_app
    response = self.full_dispatch_request()
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\flask\app.py", line 1486, in full_dispatch_request
    rv = self.handle_user_exception(e)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\flask_cors\extension.py", line 176, in wrapped_function
    return cors_after_request(app.make_response(f(*args, **kwargs)))
                                                ^^^^^^^^^^^^^^^^^^
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\flask_cors\extension.py", line 176, in wrapped_function
    return cors_after_request(app.make_response(f(*args, **kwargs)))
                                                ^^^^^^^^^^^^^^^^^^
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\flask\app.py", line 1484, in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\flask\app.py", line 1469, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\OSPanel\domains\ai_assistant\api\myapp.py", line 110, in list_files
    project_id = project['project_id']
                 ~~~~~~~^^^^^^^^^^^^^^
KeyError: 'project_id'
INFO:werkzeug:127.0.0.1 - - [31/Dec/2023 18:12:53] "[35m[1mGET /files/e47f0f811145d03c33fd6639dc3f09c0839d0891e264d849a75df04f4d047625 HTTP/1.1[0m" 500 -
INFO:werkzeug:127.0.0.1 - - [31/Dec/2023 18:12:56] "OPTIONS /projects/e47f0f811145d03c33fd6639dc3f09c0839d0891e264d849a75df04f4d047625/IOGI8b2pgNxtEXyCk2DD4jZlsgeTxbwo HTTP/1.1" 200 -
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.openai.com:443
DEBUG:urllib3.connectionpool:https://api.openai.com:443 "POST /v1/chat/completions HTTP/1.1" 200 None
INFO:myapp:[{'url_params': 'product_name=xiaomi', 'is_related': 'yes', 'category': 'smartphones'}]
INFO:myapp:product_name=xiaomi
INFO:myapp:prompt
INFO:myapp:You are AI assistant for a online shop. You should determine if a client is asking information about a product in our store. It can be a question about price, availability in stock, product characteristic, comparing 2 products. In this case you should contruct query parameters based on a client question. Construct them for every mentioned product. Add sort_price parameter if required .For example product_name=item_name&color=green&size=44&sort_price=desc|asc List of available query parameters: product_name, color product_name is a required parameter. You should use it in every query.Use only these query parameters for consructing. Add a category. List of available categories: misc,smartphones. Write your asnwer as array of json objects. [{url_params: <url_here>, is_related: 'yes', category: <category_here> }] If the question is not related to products of the store, then your answer would be [{is_related: 'no'}] Be strict. Fix typos in product names. Dont write anything else. Your answer will be used for a next query. History of your conversaion with the client: Client: hello, do you have xiaomi,
Ai response: Yes, we have Xiaomi products available. Can you please specify which Xiaomi product you are interested in?
Client: i want 13 model,
Ai response: I apologize for the inconvenience, but we currently do not have a specific "13 model" in our store. However, we do offer a wide range of laptops and other tech gadgets that you might find suitable. Please feel free to browse our selection and let me know if there's anything else I can assist you with. .Client question: hello, do you have xiaomi .Your answer:
DEBUG:urllib3.connectionpool:Starting new HTTP connection (1): wordpress:80
DEBUG:urllib3.connectionpool:http://wordpress:80 "GET /wp-json/chatty/v1/posts?product_name=xiaomi HTTP/1.1" 200 1752
INFO:myapp:api data [{"id":17,"title":"Xiaomi 13","content":"<ul class=\"a-unordered-list a-vertical a-spacing-mini\">\r\n \t<li class=\"a-spacing-mini\"><span class=\"a-list-item\">Ultra-immersive display design Light up the screen to enjoy an unrivalled experience. The 1.61mm ultra-thin bezels offer a boundless vision.<\/span><\/li>\r\n \t<li class=\"a-spacing-mini\"><span class=\"a-list-item\">Built for more scenarios IP68 water and dust resistant* Born splash-proof and water-resistant, thanks to the precision manufacturing. Record special memories anytime and anywhere.<\/span><\/li>\r\n \t<li class=\"a-spacing-mini\"><span class=\"a-list-item\">Leica main camera with professional optical lens Captures every great moment<\/span><\/li>\r\n \t<li class=\"a-spacing-mini\"><span class=\"a-list-item\">Masterpiece performance Leading Snapdragon 8 Gen 2 Boosted performance, reduced consumption<\/span><\/li>\r\n<\/ul>","date":"27.12.2023","attributes":{"pa_color":["silver"]},"stock":null,"image_url":false,"sku":"141234","price":"16000","formatted_price":"<span class=\"woocommerce-Price-amount amount\"><bdi>16000,00&nbsp;<span class=\"woocommerce-Price-currencySymbol\">&#8381;<\/span><\/bdi><\/span>","product_link":"http:\/\/wordpress\/product\/%d0%ba%d1%80%d0%be%d1%81%d1%81%d0%be%d0%b2%d0%ba%d0%b8\/"},{"id":20,"title":"Xiaomi Redmi 12 128GB &#8212; Black &#8212; Unlocked &#8212; Dual-SIM","content":"","date":"29.12.2023","attributes":{"pa_color":["black"]},"stock":null,"image_url":false,"sku":"141234-1","price":"15000","formatted_price":"<span class=\"woocommerce-Price-amount amount\"><bdi>15000,00&nbsp;<span class=\"woocommerce-Price-currencySymbol\">&#8381;<\/span><\/bdi><\/span>","product_link":"http:\/\/wordpress\/product\/xiaomi-12-black\/"}]
DEBUG:llama_index.storage.kvstore.simple_kvstore:Loading llama_index.storage.kvstore.simple_kvstore from projects/4/data\docstore.json.
DEBUG:fsspec.local:open file: C:/OSPanel/domains/ai_assistant/api/projects/4/data/docstore.json
DEBUG:llama_index.storage.kvstore.simple_kvstore:Loading llama_index.storage.kvstore.simple_kvstore from projects/4/data\index_store.json.
DEBUG:fsspec.local:open file: C:/OSPanel/domains/ai_assistant/api/projects/4/data/index_store.json
DEBUG:llama_index.vector_stores.simple:Loading llama_index.vector_stores.simple from projects/4/data\vector_store.json.
DEBUG:fsspec.local:open file: C:/OSPanel/domains/ai_assistant/api/projects/4/data/vector_store.json
DEBUG:llama_index.graph_stores.simple:Loading llama_index.graph_stores.simple from projects/4/data\graph_store.json.
DEBUG:fsspec.local:open file: C:/OSPanel/domains/ai_assistant/api/projects/4/data/graph_store.json
INFO:llama_index.indices.loading:Loading indices with ids: ['vector_index']
DEBUG:openai:message='Request to OpenAI API' method=post path=https://api.openai.com/v1/embeddings
DEBUG:openai:api_version=None data='{"input": ["hello, do you have xiaomi"], "model": "text-embedding-ada-002", "encoding_format": "base64"}' message='Post details'
DEBUG:urllib3.util.retry:Converted retries value: 2 -> Retry(total=2, connect=None, read=None, redirect=None, status=None)
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.openai.com:443
DEBUG:urllib3.connectionpool:https://api.openai.com:443 "POST /v1/embeddings HTTP/1.1" 200 None
DEBUG:openai:message='OpenAI API response' path=https://api.openai.com/v1/embeddings processing_ms=20 request_id=db05ac374b2bb75da0d0860ea75ecf5e response_code=200
DEBUG:llama_index.indices.utils:> Top 1 nodes:
> [Node 909c5dd5-e87e-4999-a794-761f96e44168] [Similarity score:             -0.0278777] Welcome to TechHub, your ultimate destination for cutting-edge technology and innovation! At Tech...
DEBUG:openai:message='Request to OpenAI API' method=post path=https://api.openai.com/v1/chat/completions
DEBUG:openai:api_version=None data='{"messages": [{"role": "system", "content": "Context information is below.\\n--------------------\\nWelcome to TechHub, your ultimate destination for cutting-edge technology and innovation! At TechHub, we pride ourselves on being a premier online store dedicated to providing a curated selection of the latest and greatest in tech gadgets, including laptops, smartphones, and more.\\n\\nAbout Us:\\n\\nAt the heart of TechHub is a passion for technology and a commitment to delivering top-notch products that seamlessly blend style, functionality, and performance. With a team of tech enthusiasts, we understand the ever-evolving nature of the digital landscape and strive to stay at the forefront of the latest trends and advancements.\\n\\nOur Mission:\\n\\nOur mission at TechHub is to empower our customers with the best tools and devices that enhance their digital lifestyle. Whether you\'re a professional looking for a high-performance laptop to boost productivity or a smartphone aficionado seeking the latest flagship model, we\'ve got you covered. We believe that technology should not only meet but exceed your expectations, making every interaction with your devices a seamless and enjoyable experience.\\n\\nQuality Assurance:\\n\\nTechHub is committed to delivering products of the highest quality. We carefully curate our inventory, partnering with leading brands known for their commitment to excellence. Each product undergoes rigorous testing to ensure reliability, durability, and top-notch performance. Our dedication to quality assurance is reflected in every item we offer.\\n\\nCustomer-Centric Approach:\\n\\nAt TechHub, our customers are at the core of everything we do. We prioritize your satisfaction and strive to provide an unparalleled shopping experience. Our customer support team is ready to assist you at every step, from product inquiries to after-sales support. We value your feedback and continuously work to improve our services based on your needs.\\n\\nSecure Shopping:\\n\\nYour online security is our priority. TechHub employs state-of-the-art encryption technology to ensure that your personal information remains secure and protected. Shop with confidence, knowing that your data is in safe hands.\\n\\nExplore the world of innovation at TechHub, where technology meets lifestyle. Discover the perfect blend of style and functionality with our carefully curated selection of laptops, smartphones, and other cutting-edge gadgets. Join us on this exciting journey, and let\'s embrace the future together!\\n--------------------\\n\\u0412\\u044b \\u2014 \\u0418\\u0418 \\u0430\\u0441\\u0441\\u0438\\u0441\\u0442\\u0435\\u043d\\u0442 \\u043a\\u043e\\u043c\\u043f\\u0430\\u043d\\u0438\\u0438. \\u0412\\u0430\\u043c \\u0431\\u0443\\u0434\\u0443\\u0442 \\u0437\\u0430\\u0434\\u0430\\u043d\\u044b \\u0432\\u043e\\u043f\\u0440\\u043e\\u0441\\u044b \\u043e \\u043d\\u0430\\u0448\\u0435\\u0439 \\u043a\\u043e\\u043c\\u043f\\u0430\\u043d\\u0438\\u0438. \\u0412\\u0435\\u0436\\u043b\\u0438\\u0432\\u043e \\u043e\\u0442\\u0432\\u0435\\u0447\\u0430\\u0439\\u0442\\u0435 \\u043d\\u0430 \\u0432\\u043e\\u043f\\u0440\\u043e\\u0441\\u044b.\\r\\n    \\u041d\\u0438\\u0436\\u0435 \\u043c\\u044b \\u043f\\u0440\\u0435\\u0434\\u043e\\u0441\\u0442\\u0430\\u0432\\u0438\\u043b\\u0438 \\u043a\\u043e\\u043d\\u0442\\u0435\\u043a\\u0441\\u0442\\u043d\\u0443\\u044e \\u0438\\u043d\\u0444\\u043e\\u0440\\u043c\\u0430\\u0446\\u0438\\u044e.\\r\\n    ---------------------\\r\\n    {context_str}\\r\\n    ---------------------\\r\\n    \\u0423\\u0447\\u0438\\u0442\\u044b\\u0432\\u0430\\u044f \\u044d\\u0442\\u0443 \\u0438\\u043d\\u0444\\u043e\\u0440\\u043c\\u0430\\u0446\\u0438\\u044e, \\u043e\\u0442\\u0432\\u0435\\u0442\\u044c\\u0442\\u0435, \\u043f\\u043e\\u0436\\u0430\\u043b\\u0443\\u0439\\u0441\\u0442\\u0430, \\u043d\\u0430 \\u0432\\u043e\\u043f\\u0440\\u043e\\u0441: {query_str}\\r\\n    . \\n Information about product [{\\"id\\":17,\\"title\\":\\"Xiaomi 13\\",\\"content\\":\\"<ul class=\\\\\\"a-unordered-list a-vertical a-spacing-mini\\\\\\">\\\\r\\\\n \\\\t<li class=\\\\\\"a-spacing-mini\\\\\\"><span class=\\\\\\"a-list-item\\\\\\">Ultra-immersive display design Light up the screen to enjoy an unrivalled experience. The 1.61mm ultra-thin bezels offer a boundless vision.<\\\\/span><\\\\/li>\\\\r\\\\n \\\\t<li class=\\\\\\"a-spacing-mini\\\\\\"><span class=\\\\\\"a-list-item\\\\\\">Built for more scenarios IP68 water and dust resistant* Born splash-proof and water-resistant, thanks to the precision manufacturing. Record special memories anytime and anywhere.<\\\\/span><\\\\/li>\\\\r\\\\n \\\\t<li class=\\\\\\"a-spacing-mini\\\\\\"><span class=\\\\\\"a-list-item\\\\\\">Leica main camera with professional optical lens Captures every great moment<\\\\/span><\\\\/li>\\\\r\\\\n \\\\t<li class=\\\\\\"a-spacing-mini\\\\\\"><span class=\\\\\\"a-list-item\\\\\\">Masterpiece performance Leading Snapdragon 8 Gen 2 Boosted performance, reduced consumption<\\\\/span><\\\\/li>\\\\r\\\\n<\\\\/ul>\\",\\"date\\":\\"27.12.2023\\",\\"attributes\\":{\\"pa_color\\":[\\"silver\\"]},\\"stock\\":null,\\"image_url\\":false,\\"sku\\":\\"141234\\",\\"price\\":\\"16000\\",\\"formatted_price\\":\\"<span class=\\\\\\"woocommerce-Price-amount amount\\\\\\"><bdi>16000,00&nbsp;<span class=\\\\\\"woocommerce-Price-currencySymbol\\\\\\">&#8381;<\\\\/span><\\\\/bdi><\\\\/span>\\",\\"product_link\\":\\"http:\\\\/\\\\/wordpress\\\\/product\\\\/%d0%ba%d1%80%d0%be%d1%81%d1%81%d0%be%d0%b2%d0%ba%d0%b8\\\\/\\"},{\\"id\\":20,\\"title\\":\\"Xiaomi Redmi 12 128GB &#8212; Black &#8212; Unlocked &#8212; Dual-SIM\\",\\"content\\":\\"\\",\\"date\\":\\"29.12.2023\\",\\"attributes\\":{\\"pa_color\\":[\\"black\\"]},\\"stock\\":null,\\"image_url\\":false,\\"sku\\":\\"141234-1\\",\\"price\\":\\"15000\\",\\"formatted_price\\":\\"<span class=\\\\\\"woocommerce-Price-amount amount\\\\\\"><bdi>15000,00&nbsp;<span class=\\\\\\"woocommerce-Price-currencySymbol\\\\\\">&#8381;<\\\\/span><\\\\/bdi><\\\\/span>\\",\\"product_link\\":\\"http:\\\\/\\\\/wordpress\\\\/product\\\\/xiaomi-12-black\\\\/\\"}]"}, {"role": "user", "content": "hello, do you have xiaomi"}], "stream": false, "model": "gpt-3.5-turbo", "temperature": 0, "max_tokens": null}' message='Post details'
DEBUG:urllib3.connectionpool:https://api.openai.com:443 "POST /v1/chat/completions HTTP/1.1" 200 None
DEBUG:openai:message='OpenAI API response' path=https://api.openai.com/v1/chat/completions processing_ms=953 request_id=5b7621bed16deb221255e1bf876cb176 response_code=200
INFO:myapp:{'api': 1, 'product_data': '{"attributes": "color", "categories": "misc,smartphones"}', 'website': 'asdf', 'id': 4, 'left_tokens': 24809, 'description': None, 'temperature': Decimal('0.00'), 'model': 'gpt-3.5-turbo', 'prompt': 'Вы — ИИ ассистент компании. Вам будут заданы вопросы о нашей компании. Вежливо отвечайте на вопросы.\r\n    Ниже мы предоставили контекстную информацию.\r\n    ---------------------\r\n    {context_str}\r\n    ---------------------\r\n    Учитывая эту информацию, ответьте, пожалуйста, на вопрос: {query_str}\r\n    ', 'response_mode': 'compact', 'user_id': 12, 'answer': 'Client: hello, do you have xiaomi,\nAi response: Yes, we have Xiaomi products available. Can you please specify which Xiaomi product you are interested in?\r\nClient: i want 13 model,\nAi response: I apologize for the inconvenience, but we currently do not have a specific "13 model" in our store. However, we do offer a wide range of laptops and other tech gadgets that you might find suitable. Please feel free to browse our selection and let me know if there\'s anything else I can assist you with.'}
DEBUG:root:This is a debug message
DEBUG:celery.utils.functional:
def send_chat_request(user_id, project_id, session, total_tokens, answer):
    return 1

INFO:werkzeug:127.0.0.1 - - [31/Dec/2023 18:13:04] "POST /projects/e47f0f811145d03c33fd6639dc3f09c0839d0891e264d849a75df04f4d047625/IOGI8b2pgNxtEXyCk2DD4jZlsgeTxbwo HTTP/1.1" 200 -
ERROR:myapp:Exception on /files/e47f0f811145d03c33fd6639dc3f09c0839d0891e264d849a75df04f4d047625 [GET]
Traceback (most recent call last):
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\flask\app.py", line 2190, in wsgi_app
    response = self.full_dispatch_request()
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\flask\app.py", line 1486, in full_dispatch_request
    rv = self.handle_user_exception(e)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\flask_cors\extension.py", line 176, in wrapped_function
    return cors_after_request(app.make_response(f(*args, **kwargs)))
                                                ^^^^^^^^^^^^^^^^^^
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\flask_cors\extension.py", line 176, in wrapped_function
    return cors_after_request(app.make_response(f(*args, **kwargs)))
                                                ^^^^^^^^^^^^^^^^^^
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\flask\app.py", line 1484, in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\flask\app.py", line 1469, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\OSPanel\domains\ai_assistant\api\myapp.py", line 110, in list_files
    project_id = project['project_id']
                 ~~~~~~~^^^^^^^^^^^^^^
KeyError: 'project_id'
INFO:werkzeug:127.0.0.1 - - [31/Dec/2023 18:13:16] "[35m[1mGET /files/e47f0f811145d03c33fd6639dc3f09c0839d0891e264d849a75df04f4d047625 HTTP/1.1[0m" 500 -
INFO:werkzeug:127.0.0.1 - - [31/Dec/2023 18:13:26] "OPTIONS /projects/e47f0f811145d03c33fd6639dc3f09c0839d0891e264d849a75df04f4d047625/hTLUVvz4BcCpwNaDUpOYMEHqLPVkBW1t HTTP/1.1" 200 -
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.openai.com:443
DEBUG:urllib3.connectionpool:https://api.openai.com:443 "POST /v1/chat/completions HTTP/1.1" 200 None
INFO:myapp:[{'url_params': 'product_name=xiaomi', 'is_related': 'yes', 'category': 'smartphones'}]
INFO:myapp:product_name=xiaomi
INFO:myapp:prompt
INFO:myapp:You are AI assistant for a online shop. You should determine if a client is asking information about a product in our store. It can be a question about price, availability in stock, product characteristic, comparing 2 products. In this case you should contruct query parameters based on a client question. Construct them for every mentioned product. Add sort_price parameter if required .For example product_name=item_name&color=green&size=44&sort_price=desc|asc List of available query parameters: product_name, color product_name is a required parameter. You should use it in every query.Use only these query parameters for consructing. Add a category. List of available categories: misc,smartphones. Write your asnwer as array of json objects. [{url_params: <url_here>, is_related: 'yes', category: <category_here> }] If the question is not related to products of the store, then your answer would be [{is_related: 'no'}] Be strict. Fix typos in product names. Dont write anything else. Your answer will be used for a next query. History of your conversaion with the client: None .Client question: hello do you have xiaomi .Your answer:
DEBUG:urllib3.connectionpool:Starting new HTTP connection (1): wordpress:80
DEBUG:urllib3.connectionpool:http://wordpress:80 "GET /wp-json/chatty/v1/posts?product_name=xiaomi HTTP/1.1" 200 1752
INFO:myapp:api data [{"id":17,"title":"Xiaomi 13","content":"<ul class=\"a-unordered-list a-vertical a-spacing-mini\">\r\n \t<li class=\"a-spacing-mini\"><span class=\"a-list-item\">Ultra-immersive display design Light up the screen to enjoy an unrivalled experience. The 1.61mm ultra-thin bezels offer a boundless vision.<\/span><\/li>\r\n \t<li class=\"a-spacing-mini\"><span class=\"a-list-item\">Built for more scenarios IP68 water and dust resistant* Born splash-proof and water-resistant, thanks to the precision manufacturing. Record special memories anytime and anywhere.<\/span><\/li>\r\n \t<li class=\"a-spacing-mini\"><span class=\"a-list-item\">Leica main camera with professional optical lens Captures every great moment<\/span><\/li>\r\n \t<li class=\"a-spacing-mini\"><span class=\"a-list-item\">Masterpiece performance Leading Snapdragon 8 Gen 2 Boosted performance, reduced consumption<\/span><\/li>\r\n<\/ul>","date":"27.12.2023","attributes":{"pa_color":["silver"]},"stock":null,"image_url":false,"sku":"141234","price":"16000","formatted_price":"<span class=\"woocommerce-Price-amount amount\"><bdi>16000,00&nbsp;<span class=\"woocommerce-Price-currencySymbol\">&#8381;<\/span><\/bdi><\/span>","product_link":"http:\/\/wordpress\/product\/%d0%ba%d1%80%d0%be%d1%81%d1%81%d0%be%d0%b2%d0%ba%d0%b8\/"},{"id":20,"title":"Xiaomi Redmi 12 128GB &#8212; Black &#8212; Unlocked &#8212; Dual-SIM","content":"","date":"29.12.2023","attributes":{"pa_color":["black"]},"stock":null,"image_url":false,"sku":"141234-1","price":"15000","formatted_price":"<span class=\"woocommerce-Price-amount amount\"><bdi>15000,00&nbsp;<span class=\"woocommerce-Price-currencySymbol\">&#8381;<\/span><\/bdi><\/span>","product_link":"http:\/\/wordpress\/product\/xiaomi-12-black\/"}]
DEBUG:llama_index.storage.kvstore.simple_kvstore:Loading llama_index.storage.kvstore.simple_kvstore from projects/4/data\docstore.json.
DEBUG:fsspec.local:open file: C:/OSPanel/domains/ai_assistant/api/projects/4/data/docstore.json
DEBUG:llama_index.storage.kvstore.simple_kvstore:Loading llama_index.storage.kvstore.simple_kvstore from projects/4/data\index_store.json.
DEBUG:fsspec.local:open file: C:/OSPanel/domains/ai_assistant/api/projects/4/data/index_store.json
DEBUG:llama_index.vector_stores.simple:Loading llama_index.vector_stores.simple from projects/4/data\vector_store.json.
DEBUG:fsspec.local:open file: C:/OSPanel/domains/ai_assistant/api/projects/4/data/vector_store.json
DEBUG:llama_index.graph_stores.simple:Loading llama_index.graph_stores.simple from projects/4/data\graph_store.json.
DEBUG:fsspec.local:open file: C:/OSPanel/domains/ai_assistant/api/projects/4/data/graph_store.json
INFO:llama_index.indices.loading:Loading indices with ids: ['vector_index']
DEBUG:openai:message='Request to OpenAI API' method=post path=https://api.openai.com/v1/embeddings
DEBUG:openai:api_version=None data='{"input": ["hello do you have xiaomi"], "model": "text-embedding-ada-002", "encoding_format": "base64"}' message='Post details'
DEBUG:urllib3.util.retry:Converted retries value: 2 -> Retry(total=2, connect=None, read=None, redirect=None, status=None)
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.openai.com:443
DEBUG:urllib3.connectionpool:https://api.openai.com:443 "POST /v1/embeddings HTTP/1.1" 200 None
DEBUG:openai:message='OpenAI API response' path=https://api.openai.com/v1/embeddings processing_ms=17 request_id=8614a5a7375781f9b8fc7db4a8efe4f6 response_code=200
DEBUG:llama_index.indices.utils:> Top 1 nodes:
> [Node 909c5dd5-e87e-4999-a794-761f96e44168] [Similarity score:             -0.0278626] Welcome to TechHub, your ultimate destination for cutting-edge technology and innovation! At Tech...
DEBUG:openai:message='Request to OpenAI API' method=post path=https://api.openai.com/v1/chat/completions
DEBUG:openai:api_version=None data='{"messages": [{"role": "system", "content": "Context information is below.\\n--------------------\\nWelcome to TechHub, your ultimate destination for cutting-edge technology and innovation! At TechHub, we pride ourselves on being a premier online store dedicated to providing a curated selection of the latest and greatest in tech gadgets, including laptops, smartphones, and more.\\n\\nAbout Us:\\n\\nAt the heart of TechHub is a passion for technology and a commitment to delivering top-notch products that seamlessly blend style, functionality, and performance. With a team of tech enthusiasts, we understand the ever-evolving nature of the digital landscape and strive to stay at the forefront of the latest trends and advancements.\\n\\nOur Mission:\\n\\nOur mission at TechHub is to empower our customers with the best tools and devices that enhance their digital lifestyle. Whether you\'re a professional looking for a high-performance laptop to boost productivity or a smartphone aficionado seeking the latest flagship model, we\'ve got you covered. We believe that technology should not only meet but exceed your expectations, making every interaction with your devices a seamless and enjoyable experience.\\n\\nQuality Assurance:\\n\\nTechHub is committed to delivering products of the highest quality. We carefully curate our inventory, partnering with leading brands known for their commitment to excellence. Each product undergoes rigorous testing to ensure reliability, durability, and top-notch performance. Our dedication to quality assurance is reflected in every item we offer.\\n\\nCustomer-Centric Approach:\\n\\nAt TechHub, our customers are at the core of everything we do. We prioritize your satisfaction and strive to provide an unparalleled shopping experience. Our customer support team is ready to assist you at every step, from product inquiries to after-sales support. We value your feedback and continuously work to improve our services based on your needs.\\n\\nSecure Shopping:\\n\\nYour online security is our priority. TechHub employs state-of-the-art encryption technology to ensure that your personal information remains secure and protected. Shop with confidence, knowing that your data is in safe hands.\\n\\nExplore the world of innovation at TechHub, where technology meets lifestyle. Discover the perfect blend of style and functionality with our carefully curated selection of laptops, smartphones, and other cutting-edge gadgets. Join us on this exciting journey, and let\'s embrace the future together!\\n--------------------\\n\\u0412\\u044b \\u2014 \\u0418\\u0418 \\u0430\\u0441\\u0441\\u0438\\u0441\\u0442\\u0435\\u043d\\u0442 \\u043a\\u043e\\u043c\\u043f\\u0430\\u043d\\u0438\\u0438. \\u0412\\u0430\\u043c \\u0431\\u0443\\u0434\\u0443\\u0442 \\u0437\\u0430\\u0434\\u0430\\u043d\\u044b \\u0432\\u043e\\u043f\\u0440\\u043e\\u0441\\u044b \\u043e \\u043d\\u0430\\u0448\\u0435\\u0439 \\u043a\\u043e\\u043c\\u043f\\u0430\\u043d\\u0438\\u0438. \\u0412\\u0435\\u0436\\u043b\\u0438\\u0432\\u043e \\u043e\\u0442\\u0432\\u0435\\u0447\\u0430\\u0439\\u0442\\u0435 \\u043d\\u0430 \\u0432\\u043e\\u043f\\u0440\\u043e\\u0441\\u044b.\\r\\n    \\u041d\\u0438\\u0436\\u0435 \\u043c\\u044b \\u043f\\u0440\\u0435\\u0434\\u043e\\u0441\\u0442\\u0430\\u0432\\u0438\\u043b\\u0438 \\u043a\\u043e\\u043d\\u0442\\u0435\\u043a\\u0441\\u0442\\u043d\\u0443\\u044e \\u0438\\u043d\\u0444\\u043e\\u0440\\u043c\\u0430\\u0446\\u0438\\u044e.\\r\\n    ---------------------\\r\\n    {context_str}\\r\\n    ---------------------\\r\\n    \\u0423\\u0447\\u0438\\u0442\\u044b\\u0432\\u0430\\u044f \\u044d\\u0442\\u0443 \\u0438\\u043d\\u0444\\u043e\\u0440\\u043c\\u0430\\u0446\\u0438\\u044e, \\u043e\\u0442\\u0432\\u0435\\u0442\\u044c\\u0442\\u0435, \\u043f\\u043e\\u0436\\u0430\\u043b\\u0443\\u0439\\u0441\\u0442\\u0430, \\u043d\\u0430 \\u0432\\u043e\\u043f\\u0440\\u043e\\u0441: {query_str}\\r\\n    . \\n Information about product [{\\"id\\":17,\\"title\\":\\"Xiaomi 13\\",\\"content\\":\\"<ul class=\\\\\\"a-unordered-list a-vertical a-spacing-mini\\\\\\">\\\\r\\\\n \\\\t<li class=\\\\\\"a-spacing-mini\\\\\\"><span class=\\\\\\"a-list-item\\\\\\">Ultra-immersive display design Light up the screen to enjoy an unrivalled experience. The 1.61mm ultra-thin bezels offer a boundless vision.<\\\\/span><\\\\/li>\\\\r\\\\n \\\\t<li class=\\\\\\"a-spacing-mini\\\\\\"><span class=\\\\\\"a-list-item\\\\\\">Built for more scenarios IP68 water and dust resistant* Born splash-proof and water-resistant, thanks to the precision manufacturing. Record special memories anytime and anywhere.<\\\\/span><\\\\/li>\\\\r\\\\n \\\\t<li class=\\\\\\"a-spacing-mini\\\\\\"><span class=\\\\\\"a-list-item\\\\\\">Leica main camera with professional optical lens Captures every great moment<\\\\/span><\\\\/li>\\\\r\\\\n \\\\t<li class=\\\\\\"a-spacing-mini\\\\\\"><span class=\\\\\\"a-list-item\\\\\\">Masterpiece performance Leading Snapdragon 8 Gen 2 Boosted performance, reduced consumption<\\\\/span><\\\\/li>\\\\r\\\\n<\\\\/ul>\\",\\"date\\":\\"27.12.2023\\",\\"attributes\\":{\\"pa_color\\":[\\"silver\\"]},\\"stock\\":null,\\"image_url\\":false,\\"sku\\":\\"141234\\",\\"price\\":\\"16000\\",\\"formatted_price\\":\\"<span class=\\\\\\"woocommerce-Price-amount amount\\\\\\"><bdi>16000,00&nbsp;<span class=\\\\\\"woocommerce-Price-currencySymbol\\\\\\">&#8381;<\\\\/span><\\\\/bdi><\\\\/span>\\",\\"product_link\\":\\"http:\\\\/\\\\/wordpress\\\\/product\\\\/%d0%ba%d1%80%d0%be%d1%81%d1%81%d0%be%d0%b2%d0%ba%d0%b8\\\\/\\"},{\\"id\\":20,\\"title\\":\\"Xiaomi Redmi 12 128GB &#8212; Black &#8212; Unlocked &#8212; Dual-SIM\\",\\"content\\":\\"\\",\\"date\\":\\"29.12.2023\\",\\"attributes\\":{\\"pa_color\\":[\\"black\\"]},\\"stock\\":null,\\"image_url\\":false,\\"sku\\":\\"141234-1\\",\\"price\\":\\"15000\\",\\"formatted_price\\":\\"<span class=\\\\\\"woocommerce-Price-amount amount\\\\\\"><bdi>15000,00&nbsp;<span class=\\\\\\"woocommerce-Price-currencySymbol\\\\\\">&#8381;<\\\\/span><\\\\/bdi><\\\\/span>\\",\\"product_link\\":\\"http:\\\\/\\\\/wordpress\\\\/product\\\\/xiaomi-12-black\\\\/\\"}]"}, {"role": "user", "content": "hello do you have xiaomi"}], "stream": false, "model": "gpt-3.5-turbo", "temperature": 0, "max_tokens": null}' message='Post details'
DEBUG:urllib3.connectionpool:https://api.openai.com:443 "POST /v1/chat/completions HTTP/1.1" 200 None
DEBUG:openai:message='OpenAI API response' path=https://api.openai.com/v1/chat/completions processing_ms=804 request_id=a99be113156c96707cd28069e09a1c8d response_code=200
INFO:myapp:{'api': 1, 'product_data': '{"attributes": "color", "categories": "misc,smartphones"}', 'website': 'asdf', 'id': 4, 'left_tokens': 23726, 'description': None, 'temperature': Decimal('0.00'), 'model': 'gpt-3.5-turbo', 'prompt': 'Вы — ИИ ассистент компании. Вам будут заданы вопросы о нашей компании. Вежливо отвечайте на вопросы.\r\n    Ниже мы предоставили контекстную информацию.\r\n    ---------------------\r\n    {context_str}\r\n    ---------------------\r\n    Учитывая эту информацию, ответьте, пожалуйста, на вопрос: {query_str}\r\n    ', 'response_mode': 'compact', 'user_id': 12, 'answer': None}
INFO:werkzeug:127.0.0.1 - - [31/Dec/2023 18:13:31] "POST /projects/e47f0f811145d03c33fd6639dc3f09c0839d0891e264d849a75df04f4d047625/hTLUVvz4BcCpwNaDUpOYMEHqLPVkBW1t HTTP/1.1" 200 -
INFO:werkzeug:127.0.0.1 - - [31/Dec/2023 18:13:41] "OPTIONS /projects/e47f0f811145d03c33fd6639dc3f09c0839d0891e264d849a75df04f4d047625/hTLUVvz4BcCpwNaDUpOYMEHqLPVkBW1t HTTP/1.1" 200 -
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.openai.com:443
DEBUG:urllib3.connectionpool:https://api.openai.com:443 "POST /v1/chat/completions HTTP/1.1" 200 None
INFO:myapp:[{'url_params': 'product_name=xiaomi&product_version=13', 'is_related': 'yes', 'category': 'smartphones'}]
INFO:myapp:product_name=xiaomi&product_version=13
INFO:myapp:prompt
INFO:myapp:You are AI assistant for a online shop. You should determine if a client is asking information about a product in our store. It can be a question about price, availability in stock, product characteristic, comparing 2 products. In this case you should contruct query parameters based on a client question. Construct them for every mentioned product. Add sort_price parameter if required .For example product_name=item_name&color=green&size=44&sort_price=desc|asc List of available query parameters: product_name, color product_name is a required parameter. You should use it in every query.Use only these query parameters for consructing. Add a category. List of available categories: misc,smartphones. Write your asnwer as array of json objects. [{url_params: <url_here>, is_related: 'yes', category: <category_here> }] If the question is not related to products of the store, then your answer would be [{is_related: 'no'}] Be strict. Fix typos in product names. Dont write anything else. Your answer will be used for a next query. History of your conversaion with the client: Client: hello do you have xiaomi,
Ai response: Yes, we have Xiaomi products available. Can you please specify which Xiaomi product you are interested in? .Client question: i want 13 version .Your answer:
DEBUG:urllib3.connectionpool:Starting new HTTP connection (1): wordpress:80
DEBUG:urllib3.connectionpool:http://wordpress:80 "GET /wp-json/chatty/v1/posts?product_name=xiaomi&product_version=13 HTTP/1.1" 200 1752
INFO:myapp:api data [{"id":17,"title":"Xiaomi 13","content":"<ul class=\"a-unordered-list a-vertical a-spacing-mini\">\r\n \t<li class=\"a-spacing-mini\"><span class=\"a-list-item\">Ultra-immersive display design Light up the screen to enjoy an unrivalled experience. The 1.61mm ultra-thin bezels offer a boundless vision.<\/span><\/li>\r\n \t<li class=\"a-spacing-mini\"><span class=\"a-list-item\">Built for more scenarios IP68 water and dust resistant* Born splash-proof and water-resistant, thanks to the precision manufacturing. Record special memories anytime and anywhere.<\/span><\/li>\r\n \t<li class=\"a-spacing-mini\"><span class=\"a-list-item\">Leica main camera with professional optical lens Captures every great moment<\/span><\/li>\r\n \t<li class=\"a-spacing-mini\"><span class=\"a-list-item\">Masterpiece performance Leading Snapdragon 8 Gen 2 Boosted performance, reduced consumption<\/span><\/li>\r\n<\/ul>","date":"27.12.2023","attributes":{"pa_color":["silver"]},"stock":null,"image_url":false,"sku":"141234","price":"16000","formatted_price":"<span class=\"woocommerce-Price-amount amount\"><bdi>16000,00&nbsp;<span class=\"woocommerce-Price-currencySymbol\">&#8381;<\/span><\/bdi><\/span>","product_link":"http:\/\/wordpress\/product\/%d0%ba%d1%80%d0%be%d1%81%d1%81%d0%be%d0%b2%d0%ba%d0%b8\/"},{"id":20,"title":"Xiaomi Redmi 12 128GB &#8212; Black &#8212; Unlocked &#8212; Dual-SIM","content":"","date":"29.12.2023","attributes":{"pa_color":["black"]},"stock":null,"image_url":false,"sku":"141234-1","price":"15000","formatted_price":"<span class=\"woocommerce-Price-amount amount\"><bdi>15000,00&nbsp;<span class=\"woocommerce-Price-currencySymbol\">&#8381;<\/span><\/bdi><\/span>","product_link":"http:\/\/wordpress\/product\/xiaomi-12-black\/"}]
DEBUG:llama_index.storage.kvstore.simple_kvstore:Loading llama_index.storage.kvstore.simple_kvstore from projects/4/data\docstore.json.
DEBUG:fsspec.local:open file: C:/OSPanel/domains/ai_assistant/api/projects/4/data/docstore.json
DEBUG:llama_index.storage.kvstore.simple_kvstore:Loading llama_index.storage.kvstore.simple_kvstore from projects/4/data\index_store.json.
DEBUG:fsspec.local:open file: C:/OSPanel/domains/ai_assistant/api/projects/4/data/index_store.json
DEBUG:llama_index.vector_stores.simple:Loading llama_index.vector_stores.simple from projects/4/data\vector_store.json.
DEBUG:fsspec.local:open file: C:/OSPanel/domains/ai_assistant/api/projects/4/data/vector_store.json
DEBUG:llama_index.graph_stores.simple:Loading llama_index.graph_stores.simple from projects/4/data\graph_store.json.
DEBUG:fsspec.local:open file: C:/OSPanel/domains/ai_assistant/api/projects/4/data/graph_store.json
INFO:llama_index.indices.loading:Loading indices with ids: ['vector_index']
DEBUG:openai:message='Request to OpenAI API' method=post path=https://api.openai.com/v1/embeddings
DEBUG:openai:api_version=None data='{"input": ["i want 13 version"], "model": "text-embedding-ada-002", "encoding_format": "base64"}' message='Post details'
DEBUG:urllib3.util.retry:Converted retries value: 2 -> Retry(total=2, connect=None, read=None, redirect=None, status=None)
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.openai.com:443
DEBUG:urllib3.connectionpool:https://api.openai.com:443 "POST /v1/embeddings HTTP/1.1" 200 None
DEBUG:openai:message='OpenAI API response' path=https://api.openai.com/v1/embeddings processing_ms=18 request_id=4294be70588f29cb76c5ffc27e7b1391 response_code=200
DEBUG:llama_index.indices.utils:> Top 1 nodes:
> [Node 909c5dd5-e87e-4999-a794-761f96e44168] [Similarity score:             -0.0292431] Welcome to TechHub, your ultimate destination for cutting-edge technology and innovation! At Tech...
DEBUG:openai:message='Request to OpenAI API' method=post path=https://api.openai.com/v1/chat/completions
DEBUG:openai:api_version=None data='{"messages": [{"role": "system", "content": "Context information is below.\\n--------------------\\nWelcome to TechHub, your ultimate destination for cutting-edge technology and innovation! At TechHub, we pride ourselves on being a premier online store dedicated to providing a curated selection of the latest and greatest in tech gadgets, including laptops, smartphones, and more.\\n\\nAbout Us:\\n\\nAt the heart of TechHub is a passion for technology and a commitment to delivering top-notch products that seamlessly blend style, functionality, and performance. With a team of tech enthusiasts, we understand the ever-evolving nature of the digital landscape and strive to stay at the forefront of the latest trends and advancements.\\n\\nOur Mission:\\n\\nOur mission at TechHub is to empower our customers with the best tools and devices that enhance their digital lifestyle. Whether you\'re a professional looking for a high-performance laptop to boost productivity or a smartphone aficionado seeking the latest flagship model, we\'ve got you covered. We believe that technology should not only meet but exceed your expectations, making every interaction with your devices a seamless and enjoyable experience.\\n\\nQuality Assurance:\\n\\nTechHub is committed to delivering products of the highest quality. We carefully curate our inventory, partnering with leading brands known for their commitment to excellence. Each product undergoes rigorous testing to ensure reliability, durability, and top-notch performance. Our dedication to quality assurance is reflected in every item we offer.\\n\\nCustomer-Centric Approach:\\n\\nAt TechHub, our customers are at the core of everything we do. We prioritize your satisfaction and strive to provide an unparalleled shopping experience. Our customer support team is ready to assist you at every step, from product inquiries to after-sales support. We value your feedback and continuously work to improve our services based on your needs.\\n\\nSecure Shopping:\\n\\nYour online security is our priority. TechHub employs state-of-the-art encryption technology to ensure that your personal information remains secure and protected. Shop with confidence, knowing that your data is in safe hands.\\n\\nExplore the world of innovation at TechHub, where technology meets lifestyle. Discover the perfect blend of style and functionality with our carefully curated selection of laptops, smartphones, and other cutting-edge gadgets. Join us on this exciting journey, and let\'s embrace the future together!\\n--------------------\\n\\u0412\\u044b \\u2014 \\u0418\\u0418 \\u0430\\u0441\\u0441\\u0438\\u0441\\u0442\\u0435\\u043d\\u0442 \\u043a\\u043e\\u043c\\u043f\\u0430\\u043d\\u0438\\u0438. \\u0412\\u0430\\u043c \\u0431\\u0443\\u0434\\u0443\\u0442 \\u0437\\u0430\\u0434\\u0430\\u043d\\u044b \\u0432\\u043e\\u043f\\u0440\\u043e\\u0441\\u044b \\u043e \\u043d\\u0430\\u0448\\u0435\\u0439 \\u043a\\u043e\\u043c\\u043f\\u0430\\u043d\\u0438\\u0438. \\u0412\\u0435\\u0436\\u043b\\u0438\\u0432\\u043e \\u043e\\u0442\\u0432\\u0435\\u0447\\u0430\\u0439\\u0442\\u0435 \\u043d\\u0430 \\u0432\\u043e\\u043f\\u0440\\u043e\\u0441\\u044b.\\r\\n    \\u041d\\u0438\\u0436\\u0435 \\u043c\\u044b \\u043f\\u0440\\u0435\\u0434\\u043e\\u0441\\u0442\\u0430\\u0432\\u0438\\u043b\\u0438 \\u043a\\u043e\\u043d\\u0442\\u0435\\u043a\\u0441\\u0442\\u043d\\u0443\\u044e \\u0438\\u043d\\u0444\\u043e\\u0440\\u043c\\u0430\\u0446\\u0438\\u044e.\\r\\n    ---------------------\\r\\n    {context_str}\\r\\n    ---------------------\\r\\n    \\u0423\\u0447\\u0438\\u0442\\u044b\\u0432\\u0430\\u044f \\u044d\\u0442\\u0443 \\u0438\\u043d\\u0444\\u043e\\u0440\\u043c\\u0430\\u0446\\u0438\\u044e, \\u043e\\u0442\\u0432\\u0435\\u0442\\u044c\\u0442\\u0435, \\u043f\\u043e\\u0436\\u0430\\u043b\\u0443\\u0439\\u0441\\u0442\\u0430, \\u043d\\u0430 \\u0432\\u043e\\u043f\\u0440\\u043e\\u0441: {query_str}\\r\\n    . \\n Information about product [{\\"id\\":17,\\"title\\":\\"Xiaomi 13\\",\\"content\\":\\"<ul class=\\\\\\"a-unordered-list a-vertical a-spacing-mini\\\\\\">\\\\r\\\\n \\\\t<li class=\\\\\\"a-spacing-mini\\\\\\"><span class=\\\\\\"a-list-item\\\\\\">Ultra-immersive display design Light up the screen to enjoy an unrivalled experience. The 1.61mm ultra-thin bezels offer a boundless vision.<\\\\/span><\\\\/li>\\\\r\\\\n \\\\t<li class=\\\\\\"a-spacing-mini\\\\\\"><span class=\\\\\\"a-list-item\\\\\\">Built for more scenarios IP68 water and dust resistant* Born splash-proof and water-resistant, thanks to the precision manufacturing. Record special memories anytime and anywhere.<\\\\/span><\\\\/li>\\\\r\\\\n \\\\t<li class=\\\\\\"a-spacing-mini\\\\\\"><span class=\\\\\\"a-list-item\\\\\\">Leica main camera with professional optical lens Captures every great moment<\\\\/span><\\\\/li>\\\\r\\\\n \\\\t<li class=\\\\\\"a-spacing-mini\\\\\\"><span class=\\\\\\"a-list-item\\\\\\">Masterpiece performance Leading Snapdragon 8 Gen 2 Boosted performance, reduced consumption<\\\\/span><\\\\/li>\\\\r\\\\n<\\\\/ul>\\",\\"date\\":\\"27.12.2023\\",\\"attributes\\":{\\"pa_color\\":[\\"silver\\"]},\\"stock\\":null,\\"image_url\\":false,\\"sku\\":\\"141234\\",\\"price\\":\\"16000\\",\\"formatted_price\\":\\"<span class=\\\\\\"woocommerce-Price-amount amount\\\\\\"><bdi>16000,00&nbsp;<span class=\\\\\\"woocommerce-Price-currencySymbol\\\\\\">&#8381;<\\\\/span><\\\\/bdi><\\\\/span>\\",\\"product_link\\":\\"http:\\\\/\\\\/wordpress\\\\/product\\\\/%d0%ba%d1%80%d0%be%d1%81%d1%81%d0%be%d0%b2%d0%ba%d0%b8\\\\/\\"},{\\"id\\":20,\\"title\\":\\"Xiaomi Redmi 12 128GB &#8212; Black &#8212; Unlocked &#8212; Dual-SIM\\",\\"content\\":\\"\\",\\"date\\":\\"29.12.2023\\",\\"attributes\\":{\\"pa_color\\":[\\"black\\"]},\\"stock\\":null,\\"image_url\\":false,\\"sku\\":\\"141234-1\\",\\"price\\":\\"15000\\",\\"formatted_price\\":\\"<span class=\\\\\\"woocommerce-Price-amount amount\\\\\\"><bdi>15000,00&nbsp;<span class=\\\\\\"woocommerce-Price-currencySymbol\\\\\\">&#8381;<\\\\/span><\\\\/bdi><\\\\/span>\\",\\"product_link\\":\\"http:\\\\/\\\\/wordpress\\\\/product\\\\/xiaomi-12-black\\\\/\\"}]"}, {"role": "user", "content": "i want 13 version"}], "stream": false, "model": "gpt-3.5-turbo", "temperature": 0, "max_tokens": null}' message='Post details'
DEBUG:urllib3.connectionpool:https://api.openai.com:443 "POST /v1/chat/completions HTTP/1.1" 200 None
DEBUG:openai:message='OpenAI API response' path=https://api.openai.com/v1/chat/completions processing_ms=5685 request_id=632b8381f2b5b3038062680e1a0cd1d5 response_code=200
INFO:myapp:{'api': 1, 'product_data': '{"attributes": "color", "categories": "misc,smartphones"}', 'website': 'asdf', 'id': 4, 'left_tokens': 22644, 'description': None, 'temperature': Decimal('0.00'), 'model': 'gpt-3.5-turbo', 'prompt': 'Вы — ИИ ассистент компании. Вам будут заданы вопросы о нашей компании. Вежливо отвечайте на вопросы.\r\n    Ниже мы предоставили контекстную информацию.\r\n    ---------------------\r\n    {context_str}\r\n    ---------------------\r\n    Учитывая эту информацию, ответьте, пожалуйста, на вопрос: {query_str}\r\n    ', 'response_mode': 'compact', 'user_id': 12, 'answer': 'Client: hello do you have xiaomi,\nAi response: Yes, we have Xiaomi products available. Can you please specify which Xiaomi product you are interested in?'}
INFO:werkzeug:127.0.0.1 - - [31/Dec/2023 18:13:51] "POST /projects/e47f0f811145d03c33fd6639dc3f09c0839d0891e264d849a75df04f4d047625/hTLUVvz4BcCpwNaDUpOYMEHqLPVkBW1t HTTP/1.1" 200 -
ERROR:myapp:Exception on /files/e47f0f811145d03c33fd6639dc3f09c0839d0891e264d849a75df04f4d047625 [GET]
Traceback (most recent call last):
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\flask\app.py", line 2190, in wsgi_app
    response = self.full_dispatch_request()
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\flask\app.py", line 1486, in full_dispatch_request
    rv = self.handle_user_exception(e)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\flask_cors\extension.py", line 176, in wrapped_function
    return cors_after_request(app.make_response(f(*args, **kwargs)))
                                                ^^^^^^^^^^^^^^^^^^
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\flask_cors\extension.py", line 176, in wrapped_function
    return cors_after_request(app.make_response(f(*args, **kwargs)))
                                                ^^^^^^^^^^^^^^^^^^
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\flask\app.py", line 1484, in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\flask\app.py", line 1469, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\OSPanel\domains\ai_assistant\api\myapp.py", line 110, in list_files
    project_id = project['project_id']
                 ~~~~~~~^^^^^^^^^^^^^^
KeyError: 'project_id'
INFO:werkzeug:127.0.0.1 - - [31/Dec/2023 18:17:50] "[35m[1mGET /files/e47f0f811145d03c33fd6639dc3f09c0839d0891e264d849a75df04f4d047625 HTTP/1.1[0m" 500 -
DEBUG:root:This is a debug message
DEBUG:celery.utils.functional:
def unlock_chord(self, group_id, callback, interval=0, max_retries=1, result=2, Result=3, GroupResult=4, result_from_tuple=5, **kwargs):
    return 1

DEBUG:celery.utils.functional:
def sendEmbeddingRequest(user_id, total_tokens):
    return 1

DEBUG:celery.utils.functional:
def group(self, tasks, result, group_id, partial_args, add_to_parent=0):
    return 1

DEBUG:celery.utils.functional:
def xmap(task, it):
    return 1

DEBUG:celery.utils.functional:
def backend_cleanup():
    return 1

DEBUG:celery.utils.functional:
def chain(*args, **kwargs):
    return 1

DEBUG:celery.utils.functional:
def send_chat_request(user_id, project_id, session, total_tokens, answer, context):
    return 1

DEBUG:celery.utils.functional:
def xstarmap(task, it):
    return 1

DEBUG:celery.utils.functional:
def accumulate(self, *args, **kwargs):
    return 1

DEBUG:celery.utils.functional:
def set_vector_index_task(self, token):
    return 1

DEBUG:celery.utils.functional:
def process_set_vector_index(self, token, task_id):
    return 1

DEBUG:celery.utils.functional:
def chord(self, header, body, partial_args=0, interval=1, countdown=2, max_retries=3, eager=4, **kwargs):
    return 1

DEBUG:celery.utils.functional:
def chunks(task, it, n):
    return 1

DEBUG:myapp:Flask app started
INFO:werkzeug:[31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:5000
INFO:werkzeug:[33mPress CTRL+C to quit[0m
ERROR:myapp:Exception on /files/e47f0f811145d03c33fd6639dc3f09c0839d0891e264d849a75df04f4d047625 [GET]
Traceback (most recent call last):
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\flask\app.py", line 2190, in wsgi_app
    response = self.full_dispatch_request()
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\flask\app.py", line 1486, in full_dispatch_request
    rv = self.handle_user_exception(e)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\flask_cors\extension.py", line 176, in wrapped_function
    return cors_after_request(app.make_response(f(*args, **kwargs)))
                                                ^^^^^^^^^^^^^^^^^^
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\flask_cors\extension.py", line 176, in wrapped_function
    return cors_after_request(app.make_response(f(*args, **kwargs)))
                                                ^^^^^^^^^^^^^^^^^^
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\flask\app.py", line 1484, in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\flask\app.py", line 1469, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\OSPanel\domains\ai_assistant\api\myapp.py", line 110, in list_files
    project_id = project['project_id']
                 ~~~~~~~^^^^^^^^^^^^^^
KeyError: 'project_id'
INFO:werkzeug:127.0.0.1 - - [31/Dec/2023 22:04:05] "[35m[1mGET /files/e47f0f811145d03c33fd6639dc3f09c0839d0891e264d849a75df04f4d047625 HTTP/1.1[0m" 500 -
INFO:werkzeug:127.0.0.1 - - [31/Dec/2023 22:04:53] "OPTIONS /projects/e47f0f811145d03c33fd6639dc3f09c0839d0891e264d849a75df04f4d047625/SUG2IBW9asQTjhxmZaL0JzydpgqPGfmv HTTP/1.1" 200 -
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.openai.com:443
DEBUG:urllib3.connectionpool:https://api.openai.com:443 "POST /v1/chat/completions HTTP/1.1" 200 None
INFO:myapp:[{'url_params': 'product_name=xiaomi 13', 'is_related': 'yes', 'category': 'smartphones'}]
INFO:myapp:product_name=xiaomi 13
INFO:myapp:prompt
INFO:myapp:You are AI assistant for a online shop. You should determine if a client is asking information about a product in our store. It can be a question about price, availability in stock, product characteristic, comparing 2 products. In this case you should contruct query parameters based on a client question. Construct them for every mentioned product. Add sort_price parameter if required .For example product_name=item_name&color=green&size=44&sort_price=desc|asc List of available query parameters: product_name, color product_name is a required parameter. You should use it in every query.Use only these query parameters for consructing. Add a category. List of available categories: misc,smartphones. Write your asnwer as array of json objects. [{url_params: <url_here>, is_related: 'yes', category: <category_here> }] If the question is not related to products of the store, then your answer would be [{is_related: 'no'}] Be strict. Fix typos in product names. Dont write anything else. Your answer will be used for a next query. Client question: hello, do you have xiaomi 13? .Your answer:
DEBUG:urllib3.connectionpool:Starting new HTTP connection (1): wordpress:80
DEBUG:urllib3.connectionpool:http://wordpress:80 "GET /wp-json/chatty/v1/posts?product_name=xiaomi+13 HTTP/1.1" 200 1298
INFO:myapp:api data [{"id":17,"title":"Xiaomi 13","content":"<ul class=\"a-unordered-list a-vertical a-spacing-mini\">\r\n \t<li class=\"a-spacing-mini\"><span class=\"a-list-item\">Ultra-immersive display design Light up the screen to enjoy an unrivalled experience. The 1.61mm ultra-thin bezels offer a boundless vision.<\/span><\/li>\r\n \t<li class=\"a-spacing-mini\"><span class=\"a-list-item\">Built for more scenarios IP68 water and dust resistant* Born splash-proof and water-resistant, thanks to the precision manufacturing. Record special memories anytime and anywhere.<\/span><\/li>\r\n \t<li class=\"a-spacing-mini\"><span class=\"a-list-item\">Leica main camera with professional optical lens Captures every great moment<\/span><\/li>\r\n \t<li class=\"a-spacing-mini\"><span class=\"a-list-item\">Masterpiece performance Leading Snapdragon 8 Gen 2 Boosted performance, reduced consumption<\/span><\/li>\r\n<\/ul>","date":"27.12.2023","attributes":{"pa_color":["silver"]},"stock":null,"image_url":false,"sku":"141234","price":"16000","formatted_price":"<span class=\"woocommerce-Price-amount amount\"><bdi>16000,00&nbsp;<span class=\"woocommerce-Price-currencySymbol\">&#8381;<\/span><\/bdi><\/span>","product_link":"http:\/\/wordpress\/product\/%d0%ba%d1%80%d0%be%d1%81%d1%81%d0%be%d0%b2%d0%ba%d0%b8\/"}]
DEBUG:llama_index.storage.kvstore.simple_kvstore:Loading llama_index.storage.kvstore.simple_kvstore from projects/4/data\docstore.json.
DEBUG:fsspec.local:open file: C:/OSPanel/domains/ai_assistant/api/projects/4/data/docstore.json
DEBUG:llama_index.storage.kvstore.simple_kvstore:Loading llama_index.storage.kvstore.simple_kvstore from projects/4/data\index_store.json.
DEBUG:fsspec.local:open file: C:/OSPanel/domains/ai_assistant/api/projects/4/data/index_store.json
DEBUG:llama_index.vector_stores.simple:Loading llama_index.vector_stores.simple from projects/4/data\vector_store.json.
DEBUG:fsspec.local:open file: C:/OSPanel/domains/ai_assistant/api/projects/4/data/vector_store.json
DEBUG:llama_index.graph_stores.simple:Loading llama_index.graph_stores.simple from projects/4/data\graph_store.json.
DEBUG:fsspec.local:open file: C:/OSPanel/domains/ai_assistant/api/projects/4/data/graph_store.json
ERROR:myapp:Exception on /projects/e47f0f811145d03c33fd6639dc3f09c0839d0891e264d849a75df04f4d047625/SUG2IBW9asQTjhxmZaL0JzydpgqPGfmv [POST]
Traceback (most recent call last):
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\flask\app.py", line 2190, in wsgi_app
    response = self.full_dispatch_request()
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\flask\app.py", line 1486, in full_dispatch_request
    rv = self.handle_user_exception(e)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\flask_cors\extension.py", line 176, in wrapped_function
    return cors_after_request(app.make_response(f(*args, **kwargs)))
                                                ^^^^^^^^^^^^^^^^^^
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\flask_cors\extension.py", line 176, in wrapped_function
    return cors_after_request(app.make_response(f(*args, **kwargs)))
                                                ^^^^^^^^^^^^^^^^^^
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\flask\app.py", line 1484, in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\flask\app.py", line 1469, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\OSPanel\domains\ai_assistant\api\myapp.py", line 343, in get_project_details
    prompt = project['prompt'] + '. \n Information about relative products ' + project.get('context')
             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^~~~~~~~~~~~~~~~~~~~~~~~
TypeError: can only concatenate str (not "NoneType") to str
INFO:werkzeug:127.0.0.1 - - [31/Dec/2023 22:04:58] "[35m[1mPOST /projects/e47f0f811145d03c33fd6639dc3f09c0839d0891e264d849a75df04f4d047625/SUG2IBW9asQTjhxmZaL0JzydpgqPGfmv HTTP/1.1[0m" 500 -
DEBUG:root:This is a debug message
DEBUG:celery.utils.functional:
def unlock_chord(self, group_id, callback, interval=0, max_retries=1, result=2, Result=3, GroupResult=4, result_from_tuple=5, **kwargs):
    return 1

DEBUG:celery.utils.functional:
def group(self, tasks, result, group_id, partial_args, add_to_parent=0):
    return 1

DEBUG:celery.utils.functional:
def send_chat_request(user_id, project_id, session, total_tokens, answer, context):
    return 1

DEBUG:celery.utils.functional:
def xmap(task, it):
    return 1

DEBUG:celery.utils.functional:
def sendEmbeddingRequest(user_id, total_tokens):
    return 1

DEBUG:celery.utils.functional:
def backend_cleanup():
    return 1

DEBUG:celery.utils.functional:
def set_vector_index_task(self, token):
    return 1

DEBUG:celery.utils.functional:
def process_set_vector_index(self, token, task_id):
    return 1

DEBUG:celery.utils.functional:
def chain(*args, **kwargs):
    return 1

DEBUG:celery.utils.functional:
def xstarmap(task, it):
    return 1

DEBUG:celery.utils.functional:
def accumulate(self, *args, **kwargs):
    return 1

DEBUG:celery.utils.functional:
def chord(self, header, body, partial_args=0, interval=1, countdown=2, max_retries=3, eager=4, **kwargs):
    return 1

DEBUG:celery.utils.functional:
def chunks(task, it, n):
    return 1

DEBUG:myapp:Flask app started
INFO:werkzeug:[31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:5000
INFO:werkzeug:[33mPress CTRL+C to quit[0m
ERROR:myapp:Exception on /files/e47f0f811145d03c33fd6639dc3f09c0839d0891e264d849a75df04f4d047625 [GET]
Traceback (most recent call last):
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\flask\app.py", line 2190, in wsgi_app
    response = self.full_dispatch_request()
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\flask\app.py", line 1486, in full_dispatch_request
    rv = self.handle_user_exception(e)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\flask_cors\extension.py", line 176, in wrapped_function
    return cors_after_request(app.make_response(f(*args, **kwargs)))
                                                ^^^^^^^^^^^^^^^^^^
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\flask_cors\extension.py", line 176, in wrapped_function
    return cors_after_request(app.make_response(f(*args, **kwargs)))
                                                ^^^^^^^^^^^^^^^^^^
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\flask\app.py", line 1484, in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\flask\app.py", line 1469, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\OSPanel\domains\ai_assistant\api\myapp.py", line 110, in list_files
    project_id = project['project_id']
                 ~~~~~~~^^^^^^^^^^^^^^
KeyError: 'project_id'
INFO:werkzeug:127.0.0.1 - - [31/Dec/2023 22:09:11] "[35m[1mGET /files/e47f0f811145d03c33fd6639dc3f09c0839d0891e264d849a75df04f4d047625 HTTP/1.1[0m" 500 -
INFO:werkzeug:127.0.0.1 - - [31/Dec/2023 22:09:14] "OPTIONS /projects/e47f0f811145d03c33fd6639dc3f09c0839d0891e264d849a75df04f4d047625/FS6Y0NTF8QPOT4WgN8H4qD8x5gWM9q2X HTTP/1.1" 200 -
INFO:myapp:{'api': 1, 'product_data': '{"attributes": "color", "categories": "misc,smartphones"}', 'website': 'asdf', 'id': 4, 'left_tokens': 21443, 'description': None, 'temperature': Decimal('0.00'), 'model': 'gpt-3.5-turbo', 'prompt': 'Вы — ИИ ассистент компании. Вам будут заданы вопросы о нашей компании. Вежливо отвечайте на вопросы.\r\n    Ниже мы предоставили контекстную информацию.\r\n    ---------------------\r\n    {context_str}\r\n    ---------------------\r\n    Учитывая эту информацию, ответьте, пожалуйста, на вопрос: {query_str}\r\n    ', 'response_mode': 'compact', 'user_id': 12, 'answer': None, 'context': None}
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.openai.com:443
DEBUG:urllib3.connectionpool:https://api.openai.com:443 "POST /v1/chat/completions HTTP/1.1" 200 None
INFO:myapp:[{'url_params': 'product_name=xiaomi 13', 'is_related': 'yes', 'category': 'smartphones'}]
INFO:myapp:product_name=xiaomi 13
INFO:myapp:prompt
INFO:myapp:You are AI assistant for a online shop. You should determine if a client is asking information about a product in our store. It can be a question about price, availability in stock, product characteristic, comparing 2 products. In this case you should contruct query parameters based on a client question. Construct them for every mentioned product. Add sort_price parameter if required .For example product_name=item_name&color=green&size=44&sort_price=desc|asc List of available query parameters: product_name, color product_name is a required parameter. You should use it in every query.Use only these query parameters for consructing. Add a category. List of available categories: misc,smartphones. Write your asnwer as array of json objects. [{url_params: <url_here>, is_related: 'yes', category: <category_here> }] If the question is not related to products of the store, then your answer would be [{is_related: 'no'}] Be strict. Fix typos in product names. Dont write anything else. Your answer will be used for a next query. Client question: hello, do you have xiaomi 13? .Your answer:
DEBUG:urllib3.connectionpool:Starting new HTTP connection (1): wordpress:80
DEBUG:urllib3.connectionpool:http://wordpress:80 "GET /wp-json/chatty/v1/posts?product_name=xiaomi+13 HTTP/1.1" 200 1298
INFO:myapp:api data [{"id":17,"title":"Xiaomi 13","content":"<ul class=\"a-unordered-list a-vertical a-spacing-mini\">\r\n \t<li class=\"a-spacing-mini\"><span class=\"a-list-item\">Ultra-immersive display design Light up the screen to enjoy an unrivalled experience. The 1.61mm ultra-thin bezels offer a boundless vision.<\/span><\/li>\r\n \t<li class=\"a-spacing-mini\"><span class=\"a-list-item\">Built for more scenarios IP68 water and dust resistant* Born splash-proof and water-resistant, thanks to the precision manufacturing. Record special memories anytime and anywhere.<\/span><\/li>\r\n \t<li class=\"a-spacing-mini\"><span class=\"a-list-item\">Leica main camera with professional optical lens Captures every great moment<\/span><\/li>\r\n \t<li class=\"a-spacing-mini\"><span class=\"a-list-item\">Masterpiece performance Leading Snapdragon 8 Gen 2 Boosted performance, reduced consumption<\/span><\/li>\r\n<\/ul>","date":"27.12.2023","attributes":{"pa_color":["silver"]},"stock":null,"image_url":false,"sku":"141234","price":"16000","formatted_price":"<span class=\"woocommerce-Price-amount amount\"><bdi>16000,00&nbsp;<span class=\"woocommerce-Price-currencySymbol\">&#8381;<\/span><\/bdi><\/span>","product_link":"http:\/\/wordpress\/product\/%d0%ba%d1%80%d0%be%d1%81%d1%81%d0%be%d0%b2%d0%ba%d0%b8\/"}]
DEBUG:llama_index.storage.kvstore.simple_kvstore:Loading llama_index.storage.kvstore.simple_kvstore from projects/4/data\docstore.json.
DEBUG:fsspec.local:open file: C:/OSPanel/domains/ai_assistant/api/projects/4/data/docstore.json
DEBUG:llama_index.storage.kvstore.simple_kvstore:Loading llama_index.storage.kvstore.simple_kvstore from projects/4/data\index_store.json.
DEBUG:fsspec.local:open file: C:/OSPanel/domains/ai_assistant/api/projects/4/data/index_store.json
DEBUG:llama_index.vector_stores.simple:Loading llama_index.vector_stores.simple from projects/4/data\vector_store.json.
DEBUG:fsspec.local:open file: C:/OSPanel/domains/ai_assistant/api/projects/4/data/vector_store.json
DEBUG:llama_index.graph_stores.simple:Loading llama_index.graph_stores.simple from projects/4/data\graph_store.json.
DEBUG:fsspec.local:open file: C:/OSPanel/domains/ai_assistant/api/projects/4/data/graph_store.json
ERROR:myapp:Exception on /projects/e47f0f811145d03c33fd6639dc3f09c0839d0891e264d849a75df04f4d047625/FS6Y0NTF8QPOT4WgN8H4qD8x5gWM9q2X [POST]
Traceback (most recent call last):
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\flask\app.py", line 2190, in wsgi_app
    response = self.full_dispatch_request()
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\flask\app.py", line 1486, in full_dispatch_request
    rv = self.handle_user_exception(e)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\flask_cors\extension.py", line 176, in wrapped_function
    return cors_after_request(app.make_response(f(*args, **kwargs)))
                                                ^^^^^^^^^^^^^^^^^^
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\flask_cors\extension.py", line 176, in wrapped_function
    return cors_after_request(app.make_response(f(*args, **kwargs)))
                                                ^^^^^^^^^^^^^^^^^^
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\flask\app.py", line 1484, in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\flask\app.py", line 1469, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\OSPanel\domains\ai_assistant\api\myapp.py", line 344, in get_project_details
    prompt = project['prompt'] + '. \n Information about relative products ' + project.get('context')
             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^~~~~~~~~~~~~~~~~~~~~~~~
TypeError: can only concatenate str (not "NoneType") to str
INFO:werkzeug:127.0.0.1 - - [31/Dec/2023 22:09:17] "[35m[1mPOST /projects/e47f0f811145d03c33fd6639dc3f09c0839d0891e264d849a75df04f4d047625/FS6Y0NTF8QPOT4WgN8H4qD8x5gWM9q2X HTTP/1.1[0m" 500 -
DEBUG:root:This is a debug message
DEBUG:celery.utils.functional:
def unlock_chord(self, group_id, callback, interval=0, max_retries=1, result=2, Result=3, GroupResult=4, result_from_tuple=5, **kwargs):
    return 1

DEBUG:celery.utils.functional:
def sendEmbeddingRequest(user_id, total_tokens):
    return 1

DEBUG:celery.utils.functional:
def group(self, tasks, result, group_id, partial_args, add_to_parent=0):
    return 1

DEBUG:celery.utils.functional:
def xmap(task, it):
    return 1

DEBUG:celery.utils.functional:
def backend_cleanup():
    return 1

DEBUG:celery.utils.functional:
def chain(*args, **kwargs):
    return 1

DEBUG:celery.utils.functional:
def send_chat_request(user_id, project_id, session, total_tokens, answer, context):
    return 1

DEBUG:celery.utils.functional:
def xstarmap(task, it):
    return 1

DEBUG:celery.utils.functional:
def accumulate(self, *args, **kwargs):
    return 1

DEBUG:celery.utils.functional:
def set_vector_index_task(self, token):
    return 1

DEBUG:celery.utils.functional:
def process_set_vector_index(self, token, task_id):
    return 1

DEBUG:celery.utils.functional:
def chord(self, header, body, partial_args=0, interval=1, countdown=2, max_retries=3, eager=4, **kwargs):
    return 1

DEBUG:celery.utils.functional:
def chunks(task, it, n):
    return 1

DEBUG:myapp:Flask app started
INFO:werkzeug:[31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:5000
INFO:werkzeug:[33mPress CTRL+C to quit[0m
INFO:werkzeug:127.0.0.1 - - [31/Dec/2023 22:13:06] "OPTIONS /projects/e47f0f811145d03c33fd6639dc3f09c0839d0891e264d849a75df04f4d047625/FS6Y0NTF8QPOT4WgN8H4qD8x5gWM9q2X HTTP/1.1" 200 -
INFO:myapp:{'api': 1, 'product_data': '{"attributes": "color", "categories": "misc,smartphones"}', 'website': 'asdf', 'id': 4, 'left_tokens': 21443, 'description': None, 'temperature': Decimal('0.00'), 'model': 'gpt-3.5-turbo', 'prompt': 'Вы — ИИ ассистент компании. Вам будут заданы вопросы о нашей компании. Вежливо отвечайте на вопросы.\r\n    Ниже мы предоставили контекстную информацию.\r\n    ---------------------\r\n    {context_str}\r\n    ---------------------\r\n    Учитывая эту информацию, ответьте, пожалуйста, на вопрос: {query_str}\r\n    ', 'response_mode': 'compact', 'user_id': 12, 'answer': None, 'context': None}
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.openai.com:443
DEBUG:urllib3.connectionpool:https://api.openai.com:443 "POST /v1/chat/completions HTTP/1.1" 200 None
INFO:myapp:[{'url_params': 'product_name=xiaomi 13', 'is_related': 'yes', 'category': 'smartphones'}]
INFO:myapp:product_name=xiaomi 13
INFO:myapp:prompt
INFO:myapp:You are AI assistant for a online shop. You should determine if a client is asking information about a product in our store. It can be a question about price, availability in stock, product characteristic, comparing 2 products. In this case you should contruct query parameters based on a client question. Construct them for every mentioned product. Add sort_price parameter if required .For example product_name=item_name&color=green&size=44&sort_price=desc|asc List of available query parameters: product_name, color product_name is a required parameter. You should use it in every query.Use only these query parameters for consructing. Add a category. List of available categories: misc,smartphones. Write your asnwer as array of json objects. [{url_params: <url_here>, is_related: 'yes', category: <category_here> }] If the question is not related to products of the store, then your answer would be [{is_related: 'no'}] Be strict. Fix typos in product names. Dont write anything else. Your answer will be used for a next query. Client question: hello, do you have xiaomi 13? .Your answer:
DEBUG:urllib3.connectionpool:Starting new HTTP connection (1): wordpress:80
DEBUG:urllib3.connectionpool:http://wordpress:80 "GET /wp-json/chatty/v1/posts?product_name=xiaomi+13 HTTP/1.1" 200 1298
INFO:myapp:api data [{"id":17,"title":"Xiaomi 13","content":"<ul class=\"a-unordered-list a-vertical a-spacing-mini\">\r\n \t<li class=\"a-spacing-mini\"><span class=\"a-list-item\">Ultra-immersive display design Light up the screen to enjoy an unrivalled experience. The 1.61mm ultra-thin bezels offer a boundless vision.<\/span><\/li>\r\n \t<li class=\"a-spacing-mini\"><span class=\"a-list-item\">Built for more scenarios IP68 water and dust resistant* Born splash-proof and water-resistant, thanks to the precision manufacturing. Record special memories anytime and anywhere.<\/span><\/li>\r\n \t<li class=\"a-spacing-mini\"><span class=\"a-list-item\">Leica main camera with professional optical lens Captures every great moment<\/span><\/li>\r\n \t<li class=\"a-spacing-mini\"><span class=\"a-list-item\">Masterpiece performance Leading Snapdragon 8 Gen 2 Boosted performance, reduced consumption<\/span><\/li>\r\n<\/ul>","date":"27.12.2023","attributes":{"pa_color":["silver"]},"stock":null,"image_url":false,"sku":"141234","price":"16000","formatted_price":"<span class=\"woocommerce-Price-amount amount\"><bdi>16000,00&nbsp;<span class=\"woocommerce-Price-currencySymbol\">&#8381;<\/span><\/bdi><\/span>","product_link":"http:\/\/wordpress\/product\/%d0%ba%d1%80%d0%be%d1%81%d1%81%d0%be%d0%b2%d0%ba%d0%b8\/"}]
DEBUG:llama_index.storage.kvstore.simple_kvstore:Loading llama_index.storage.kvstore.simple_kvstore from projects/4/data\docstore.json.
DEBUG:fsspec.local:open file: C:/OSPanel/domains/ai_assistant/api/projects/4/data/docstore.json
DEBUG:llama_index.storage.kvstore.simple_kvstore:Loading llama_index.storage.kvstore.simple_kvstore from projects/4/data\index_store.json.
DEBUG:fsspec.local:open file: C:/OSPanel/domains/ai_assistant/api/projects/4/data/index_store.json
DEBUG:llama_index.vector_stores.simple:Loading llama_index.vector_stores.simple from projects/4/data\vector_store.json.
DEBUG:fsspec.local:open file: C:/OSPanel/domains/ai_assistant/api/projects/4/data/vector_store.json
DEBUG:llama_index.graph_stores.simple:Loading llama_index.graph_stores.simple from projects/4/data\graph_store.json.
DEBUG:fsspec.local:open file: C:/OSPanel/domains/ai_assistant/api/projects/4/data/graph_store.json
ERROR:myapp:Exception on /projects/e47f0f811145d03c33fd6639dc3f09c0839d0891e264d849a75df04f4d047625/FS6Y0NTF8QPOT4WgN8H4qD8x5gWM9q2X [POST]
Traceback (most recent call last):
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\flask\app.py", line 2190, in wsgi_app
    response = self.full_dispatch_request()
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\flask\app.py", line 1486, in full_dispatch_request
    rv = self.handle_user_exception(e)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\flask_cors\extension.py", line 176, in wrapped_function
    return cors_after_request(app.make_response(f(*args, **kwargs)))
                                                ^^^^^^^^^^^^^^^^^^
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\flask_cors\extension.py", line 176, in wrapped_function
    return cors_after_request(app.make_response(f(*args, **kwargs)))
                                                ^^^^^^^^^^^^^^^^^^
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\flask\app.py", line 1484, in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\flask\app.py", line 1469, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\OSPanel\domains\ai_assistant\api\myapp.py", line 344, in get_project_details
    prompt = project['prompt'] + '. \n Information about relative products ' + project.get('context')
             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^~~~~~~~~~~~~~~~~~~~~~~~
TypeError: can only concatenate str (not "NoneType") to str
INFO:werkzeug:127.0.0.1 - - [31/Dec/2023 22:13:10] "[35m[1mPOST /projects/e47f0f811145d03c33fd6639dc3f09c0839d0891e264d849a75df04f4d047625/FS6Y0NTF8QPOT4WgN8H4qD8x5gWM9q2X HTTP/1.1[0m" 500 -
DEBUG:root:This is a debug message
DEBUG:celery.utils.functional:
def unlock_chord(self, group_id, callback, interval=0, max_retries=1, result=2, Result=3, GroupResult=4, result_from_tuple=5, **kwargs):
    return 1

DEBUG:celery.utils.functional:
def sendEmbeddingRequest(user_id, total_tokens):
    return 1

DEBUG:celery.utils.functional:
def group(self, tasks, result, group_id, partial_args, add_to_parent=0):
    return 1

DEBUG:celery.utils.functional:
def xmap(task, it):
    return 1

DEBUG:celery.utils.functional:
def backend_cleanup():
    return 1

DEBUG:celery.utils.functional:
def chain(*args, **kwargs):
    return 1

DEBUG:celery.utils.functional:
def send_chat_request(user_id, project_id, session, total_tokens, answer, context):
    return 1

DEBUG:celery.utils.functional:
def xstarmap(task, it):
    return 1

DEBUG:celery.utils.functional:
def accumulate(self, *args, **kwargs):
    return 1

DEBUG:celery.utils.functional:
def set_vector_index_task(self, token):
    return 1

DEBUG:celery.utils.functional:
def process_set_vector_index(self, token, task_id):
    return 1

DEBUG:celery.utils.functional:
def chord(self, header, body, partial_args=0, interval=1, countdown=2, max_retries=3, eager=4, **kwargs):
    return 1

DEBUG:celery.utils.functional:
def chunks(task, it, n):
    return 1

DEBUG:myapp:Flask app started
INFO:werkzeug:[31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:5000
INFO:werkzeug:[33mPress CTRL+C to quit[0m
INFO:werkzeug:127.0.0.1 - - [31/Dec/2023 22:32:19] "GET /files/e47f0f811145d03c33fd6639dc3f09c0839d0891e264d849a75df04f4d047625 HTTP/1.1" 200 -
INFO:werkzeug:127.0.0.1 - - [31/Dec/2023 22:32:43] "OPTIONS /projects/e47f0f811145d03c33fd6639dc3f09c0839d0891e264d849a75df04f4d047625/AnHcN25H5fcBdLNbWGtcNxvWmda5uw0q HTTP/1.1" 200 -
INFO:myapp:{'api': 1, 'product_data': '{"attributes": "color", "categories": "misc,smartphones"}', 'website': 'asdf', 'id': 4, 'left_tokens': 21443, 'description': None, 'temperature': Decimal('0.00'), 'model': 'gpt-3.5-turbo', 'prompt': 'Вы — ИИ ассистент компании. Вам будут заданы вопросы о нашей компании. Вежливо отвечайте на вопросы.\r\n    Ниже мы предоставили контекстную информацию.\r\n    ---------------------\r\n    {context_str}\r\n    ---------------------\r\n    Учитывая эту информацию, ответьте, пожалуйста, на вопрос: {query_str}\r\n    ', 'response_mode': 'compact', 'user_id': 12, 'answer': None, 'context': None}
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.openai.com:443
DEBUG:urllib3.connectionpool:https://api.openai.com:443 "POST /v1/chat/completions HTTP/1.1" 200 None
INFO:myapp:[{'url_params': 'product_name=xiaomi 13', 'is_related': 'yes', 'category': 'smartphones'}]
INFO:myapp:product_name=xiaomi 13
INFO:myapp:prompt
INFO:myapp:You are AI assistant for a online shop. You should determine if a client is asking information about a product in our store. It can be a question about price, availability in stock, product characteristic, comparing 2 products. In this case you should contruct query parameters based on a client question. Construct them for every mentioned product. Add sort_price parameter if required .For example product_name=item_name&color=green&size=44&sort_price=desc|asc List of available query parameters: product_name, color product_name is a required parameter. You should use it in every query.Use only these query parameters for consructing. Add a category. List of available categories: misc,smartphones. Write your asnwer as array of json objects. [{url_params: <url_here>, is_related: 'yes', category: <category_here> }] If the question is not related to products of the store, then your answer would be [{is_related: 'no'}] Be strict. Fix typos in product names. Dont write anything else. Your answer will be used for a next query. Client question: hi mr AI, do you have xiaomi 13 in your store? .Your answer:
DEBUG:urllib3.connectionpool:Starting new HTTP connection (1): wordpress:80
DEBUG:urllib3.connectionpool:http://wordpress:80 "GET /wp-json/chatty/v1/posts?product_name=xiaomi+13 HTTP/1.1" 200 1298
INFO:myapp:api data [{"id":17,"title":"Xiaomi 13","content":"<ul class=\"a-unordered-list a-vertical a-spacing-mini\">\r\n \t<li class=\"a-spacing-mini\"><span class=\"a-list-item\">Ultra-immersive display design Light up the screen to enjoy an unrivalled experience. The 1.61mm ultra-thin bezels offer a boundless vision.<\/span><\/li>\r\n \t<li class=\"a-spacing-mini\"><span class=\"a-list-item\">Built for more scenarios IP68 water and dust resistant* Born splash-proof and water-resistant, thanks to the precision manufacturing. Record special memories anytime and anywhere.<\/span><\/li>\r\n \t<li class=\"a-spacing-mini\"><span class=\"a-list-item\">Leica main camera with professional optical lens Captures every great moment<\/span><\/li>\r\n \t<li class=\"a-spacing-mini\"><span class=\"a-list-item\">Masterpiece performance Leading Snapdragon 8 Gen 2 Boosted performance, reduced consumption<\/span><\/li>\r\n<\/ul>","date":"27.12.2023","attributes":{"pa_color":["silver"]},"stock":null,"image_url":false,"sku":"141234","price":"16000","formatted_price":"<span class=\"woocommerce-Price-amount amount\"><bdi>16000,00&nbsp;<span class=\"woocommerce-Price-currencySymbol\">&#8381;<\/span><\/bdi><\/span>","product_link":"http:\/\/wordpress\/product\/%d0%ba%d1%80%d0%be%d1%81%d1%81%d0%be%d0%b2%d0%ba%d0%b8\/"}]
DEBUG:llama_index.storage.kvstore.simple_kvstore:Loading llama_index.storage.kvstore.simple_kvstore from projects/4/data\docstore.json.
DEBUG:fsspec.local:open file: C:/OSPanel/domains/ai_assistant/api/projects/4/data/docstore.json
DEBUG:llama_index.storage.kvstore.simple_kvstore:Loading llama_index.storage.kvstore.simple_kvstore from projects/4/data\index_store.json.
DEBUG:fsspec.local:open file: C:/OSPanel/domains/ai_assistant/api/projects/4/data/index_store.json
DEBUG:llama_index.vector_stores.simple:Loading llama_index.vector_stores.simple from projects/4/data\vector_store.json.
DEBUG:fsspec.local:open file: C:/OSPanel/domains/ai_assistant/api/projects/4/data/vector_store.json
DEBUG:llama_index.graph_stores.simple:Loading llama_index.graph_stores.simple from projects/4/data\graph_store.json.
DEBUG:fsspec.local:open file: C:/OSPanel/domains/ai_assistant/api/projects/4/data/graph_store.json
INFO:llama_index.indices.loading:Loading indices with ids: ['vector_index']
DEBUG:openai:message='Request to OpenAI API' method=post path=https://api.openai.com/v1/embeddings
DEBUG:openai:api_version=None data='{"input": ["hi mr AI, do you have xiaomi 13 in your store?"], "model": "text-embedding-ada-002", "encoding_format": "base64"}' message='Post details'
DEBUG:urllib3.util.retry:Converted retries value: 2 -> Retry(total=2, connect=None, read=None, redirect=None, status=None)
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.openai.com:443
DEBUG:urllib3.connectionpool:https://api.openai.com:443 "POST /v1/embeddings HTTP/1.1" 200 None
DEBUG:openai:message='OpenAI API response' path=https://api.openai.com/v1/embeddings processing_ms=24 request_id=7548ee8c594294ffcfa60a569535240f response_code=200
DEBUG:llama_index.indices.utils:> Top 1 nodes:
> [Node 909c5dd5-e87e-4999-a794-761f96e44168] [Similarity score:             -0.0284745] Welcome to TechHub, your ultimate destination for cutting-edge technology and innovation! At Tech...
DEBUG:openai:message='Request to OpenAI API' method=post path=https://api.openai.com/v1/chat/completions
DEBUG:openai:api_version=None data='{"messages": [{"role": "system", "content": "Context information is below.\\n--------------------\\nWelcome to TechHub, your ultimate destination for cutting-edge technology and innovation! At TechHub, we pride ourselves on being a premier online store dedicated to providing a curated selection of the latest and greatest in tech gadgets, including laptops, smartphones, and more.\\n\\nAbout Us:\\n\\nAt the heart of TechHub is a passion for technology and a commitment to delivering top-notch products that seamlessly blend style, functionality, and performance. With a team of tech enthusiasts, we understand the ever-evolving nature of the digital landscape and strive to stay at the forefront of the latest trends and advancements.\\n\\nOur Mission:\\n\\nOur mission at TechHub is to empower our customers with the best tools and devices that enhance their digital lifestyle. Whether you\'re a professional looking for a high-performance laptop to boost productivity or a smartphone aficionado seeking the latest flagship model, we\'ve got you covered. We believe that technology should not only meet but exceed your expectations, making every interaction with your devices a seamless and enjoyable experience.\\n\\nQuality Assurance:\\n\\nTechHub is committed to delivering products of the highest quality. We carefully curate our inventory, partnering with leading brands known for their commitment to excellence. Each product undergoes rigorous testing to ensure reliability, durability, and top-notch performance. Our dedication to quality assurance is reflected in every item we offer.\\n\\nCustomer-Centric Approach:\\n\\nAt TechHub, our customers are at the core of everything we do. We prioritize your satisfaction and strive to provide an unparalleled shopping experience. Our customer support team is ready to assist you at every step, from product inquiries to after-sales support. We value your feedback and continuously work to improve our services based on your needs.\\n\\nSecure Shopping:\\n\\nYour online security is our priority. TechHub employs state-of-the-art encryption technology to ensure that your personal information remains secure and protected. Shop with confidence, knowing that your data is in safe hands.\\n\\nExplore the world of innovation at TechHub, where technology meets lifestyle. Discover the perfect blend of style and functionality with our carefully curated selection of laptops, smartphones, and other cutting-edge gadgets. Join us on this exciting journey, and let\'s embrace the future together!\\n--------------------\\n\\u0412\\u044b \\u2014 \\u0418\\u0418 \\u0430\\u0441\\u0441\\u0438\\u0441\\u0442\\u0435\\u043d\\u0442 \\u043a\\u043e\\u043c\\u043f\\u0430\\u043d\\u0438\\u0438. \\u0412\\u0430\\u043c \\u0431\\u0443\\u0434\\u0443\\u0442 \\u0437\\u0430\\u0434\\u0430\\u043d\\u044b \\u0432\\u043e\\u043f\\u0440\\u043e\\u0441\\u044b \\u043e \\u043d\\u0430\\u0448\\u0435\\u0439 \\u043a\\u043e\\u043c\\u043f\\u0430\\u043d\\u0438\\u0438. \\u0412\\u0435\\u0436\\u043b\\u0438\\u0432\\u043e \\u043e\\u0442\\u0432\\u0435\\u0447\\u0430\\u0439\\u0442\\u0435 \\u043d\\u0430 \\u0432\\u043e\\u043f\\u0440\\u043e\\u0441\\u044b.\\r\\n    \\u041d\\u0438\\u0436\\u0435 \\u043c\\u044b \\u043f\\u0440\\u0435\\u0434\\u043e\\u0441\\u0442\\u0430\\u0432\\u0438\\u043b\\u0438 \\u043a\\u043e\\u043d\\u0442\\u0435\\u043a\\u0441\\u0442\\u043d\\u0443\\u044e \\u0438\\u043d\\u0444\\u043e\\u0440\\u043c\\u0430\\u0446\\u0438\\u044e.\\r\\n    ---------------------\\r\\n    {context_str}\\r\\n    ---------------------\\r\\n    \\u0423\\u0447\\u0438\\u0442\\u044b\\u0432\\u0430\\u044f \\u044d\\u0442\\u0443 \\u0438\\u043d\\u0444\\u043e\\u0440\\u043c\\u0430\\u0446\\u0438\\u044e, \\u043e\\u0442\\u0432\\u0435\\u0442\\u044c\\u0442\\u0435, \\u043f\\u043e\\u0436\\u0430\\u043b\\u0443\\u0439\\u0441\\u0442\\u0430, \\u043d\\u0430 \\u0432\\u043e\\u043f\\u0440\\u043e\\u0441: {query_str}\\r\\n    . \\n Information about relative products [{\\"id\\":17,\\"title\\":\\"Xiaomi 13\\",\\"content\\":\\"<ul class=\\\\\\"a-unordered-list a-vertical a-spacing-mini\\\\\\">\\\\r\\\\n \\\\t<li class=\\\\\\"a-spacing-mini\\\\\\"><span class=\\\\\\"a-list-item\\\\\\">Ultra-immersive display design Light up the screen to enjoy an unrivalled experience. The 1.61mm ultra-thin bezels offer a boundless vision.<\\\\/span><\\\\/li>\\\\r\\\\n \\\\t<li class=\\\\\\"a-spacing-mini\\\\\\"><span class=\\\\\\"a-list-item\\\\\\">Built for more scenarios IP68 water and dust resistant* Born splash-proof and water-resistant, thanks to the precision manufacturing. Record special memories anytime and anywhere.<\\\\/span><\\\\/li>\\\\r\\\\n \\\\t<li class=\\\\\\"a-spacing-mini\\\\\\"><span class=\\\\\\"a-list-item\\\\\\">Leica main camera with professional optical lens Captures every great moment<\\\\/span><\\\\/li>\\\\r\\\\n \\\\t<li class=\\\\\\"a-spacing-mini\\\\\\"><span class=\\\\\\"a-list-item\\\\\\">Masterpiece performance Leading Snapdragon 8 Gen 2 Boosted performance, reduced consumption<\\\\/span><\\\\/li>\\\\r\\\\n<\\\\/ul>\\",\\"date\\":\\"27.12.2023\\",\\"attributes\\":{\\"pa_color\\":[\\"silver\\"]},\\"stock\\":null,\\"image_url\\":false,\\"sku\\":\\"141234\\",\\"price\\":\\"16000\\",\\"formatted_price\\":\\"<span class=\\\\\\"woocommerce-Price-amount amount\\\\\\"><bdi>16000,00&nbsp;<span class=\\\\\\"woocommerce-Price-currencySymbol\\\\\\">&#8381;<\\\\/span><\\\\/bdi><\\\\/span>\\",\\"product_link\\":\\"http:\\\\/\\\\/wordpress\\\\/product\\\\/%d0%ba%d1%80%d0%be%d1%81%d1%81%d0%be%d0%b2%d0%ba%d0%b8\\\\/\\"}]"}, {"role": "user", "content": "hi mr AI, do you have xiaomi 13 in your store?"}], "stream": false, "model": "gpt-3.5-turbo", "temperature": 0, "max_tokens": null}' message='Post details'
DEBUG:urllib3.connectionpool:https://api.openai.com:443 "POST /v1/chat/completions HTTP/1.1" 200 None
DEBUG:openai:message='OpenAI API response' path=https://api.openai.com/v1/chat/completions processing_ms=5084 request_id=e902200ac5533b8bb8edb7040878e076 response_code=200
INFO:myapp:{'api': 1, 'product_data': '{"attributes": "color", "categories": "misc,smartphones"}', 'website': 'asdf', 'id': 4, 'left_tokens': 21443, 'description': None, 'temperature': Decimal('0.00'), 'model': 'gpt-3.5-turbo', 'prompt': 'Вы — ИИ ассистент компании. Вам будут заданы вопросы о нашей компании. Вежливо отвечайте на вопросы.\r\n    Ниже мы предоставили контекстную информацию.\r\n    ---------------------\r\n    {context_str}\r\n    ---------------------\r\n    Учитывая эту информацию, ответьте, пожалуйста, на вопрос: {query_str}\r\n    ', 'response_mode': 'compact', 'user_id': 12, 'answer': None, 'context': None}
DEBUG:root:This is a debug message
DEBUG:celery.utils.functional:
def send_chat_request(user_id, project_id, session, total_tokens, answer, context):
    return 1

INFO:werkzeug:127.0.0.1 - - [31/Dec/2023 22:32:54] "POST /projects/e47f0f811145d03c33fd6639dc3f09c0839d0891e264d849a75df04f4d047625/AnHcN25H5fcBdLNbWGtcNxvWmda5uw0q HTTP/1.1" 200 -
INFO:werkzeug:127.0.0.1 - - [31/Dec/2023 22:38:12] "GET /files/e47f0f811145d03c33fd6639dc3f09c0839d0891e264d849a75df04f4d047625 HTTP/1.1" 200 -
INFO:werkzeug:127.0.0.1 - - [31/Dec/2023 22:38:15] "OPTIONS /projects/e47f0f811145d03c33fd6639dc3f09c0839d0891e264d849a75df04f4d047625/ucMUyS7SViy6fzrbBHgM6Q0rQC1xcted HTTP/1.1" 200 -
INFO:myapp:{'api': 1, 'product_data': '{"attributes": "color", "categories": "misc,smartphones"}', 'website': 'asdf', 'id': 4, 'left_tokens': 20363, 'description': None, 'temperature': Decimal('0.00'), 'model': 'gpt-3.5-turbo', 'prompt': 'Вы — ИИ ассистент компании. Вам будут заданы вопросы о нашей компании. Вежливо отвечайте на вопросы.\r\n    Ниже мы предоставили контекстную информацию.\r\n    ---------------------\r\n    {context_str}\r\n    ---------------------\r\n    Учитывая эту информацию, ответьте, пожалуйста, на вопрос: {query_str}\r\n    ', 'response_mode': 'compact', 'user_id': 12, 'answer': None, 'context': None}
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.openai.com:443
DEBUG:urllib3.connectionpool:https://api.openai.com:443 "POST /v1/chat/completions HTTP/1.1" 200 None
INFO:myapp:[{'url_params': 'product_name=xiaomi 13', 'is_related': 'yes', 'category': 'smartphones'}]
INFO:myapp:product_name=xiaomi 13
INFO:myapp:prompt
INFO:myapp:You are AI assistant for a online shop. You should determine if a client is asking information about a product in our store. It can be a question about price, availability in stock, product characteristic, comparing 2 products. In this case you should contruct query parameters based on a client question. Construct them for every mentioned product. Add sort_price parameter if required .For example product_name=item_name&color=green&size=44&sort_price=desc|asc List of available query parameters: product_name, color product_name is a required parameter. You should use it in every query.Use only these query parameters for consructing. Add a category. List of available categories: misc,smartphones. Write your asnwer as array of json objects. [{url_params: <url_here>, is_related: 'yes', category: <category_here> }] If the question is not related to products of the store, then your answer would be [{is_related: 'no'}] Be strict. Fix typos in product names. Dont write anything else. Your answer will be used for a next query. Client question: hi mr AI, do you have xiaomi 13 in your store? .Your answer:
DEBUG:urllib3.connectionpool:Starting new HTTP connection (1): wordpress:80
DEBUG:urllib3.connectionpool:http://wordpress:80 "GET /wp-json/chatty/v1/posts?product_name=xiaomi+13 HTTP/1.1" 200 1298
INFO:myapp:api data [{"id":17,"title":"Xiaomi 13","content":"<ul class=\"a-unordered-list a-vertical a-spacing-mini\">\r\n \t<li class=\"a-spacing-mini\"><span class=\"a-list-item\">Ultra-immersive display design Light up the screen to enjoy an unrivalled experience. The 1.61mm ultra-thin bezels offer a boundless vision.<\/span><\/li>\r\n \t<li class=\"a-spacing-mini\"><span class=\"a-list-item\">Built for more scenarios IP68 water and dust resistant* Born splash-proof and water-resistant, thanks to the precision manufacturing. Record special memories anytime and anywhere.<\/span><\/li>\r\n \t<li class=\"a-spacing-mini\"><span class=\"a-list-item\">Leica main camera with professional optical lens Captures every great moment<\/span><\/li>\r\n \t<li class=\"a-spacing-mini\"><span class=\"a-list-item\">Masterpiece performance Leading Snapdragon 8 Gen 2 Boosted performance, reduced consumption<\/span><\/li>\r\n<\/ul>","date":"27.12.2023","attributes":{"pa_color":["silver"]},"stock":null,"image_url":false,"sku":"141234","price":"16000","formatted_price":"<span class=\"woocommerce-Price-amount amount\"><bdi>16000,00&nbsp;<span class=\"woocommerce-Price-currencySymbol\">&#8381;<\/span><\/bdi><\/span>","product_link":"http:\/\/wordpress\/product\/%d0%ba%d1%80%d0%be%d1%81%d1%81%d0%be%d0%b2%d0%ba%d0%b8\/"}]
DEBUG:llama_index.storage.kvstore.simple_kvstore:Loading llama_index.storage.kvstore.simple_kvstore from projects/4/data\docstore.json.
DEBUG:fsspec.local:open file: C:/OSPanel/domains/ai_assistant/api/projects/4/data/docstore.json
DEBUG:llama_index.storage.kvstore.simple_kvstore:Loading llama_index.storage.kvstore.simple_kvstore from projects/4/data\index_store.json.
DEBUG:fsspec.local:open file: C:/OSPanel/domains/ai_assistant/api/projects/4/data/index_store.json
DEBUG:llama_index.vector_stores.simple:Loading llama_index.vector_stores.simple from projects/4/data\vector_store.json.
DEBUG:fsspec.local:open file: C:/OSPanel/domains/ai_assistant/api/projects/4/data/vector_store.json
DEBUG:llama_index.graph_stores.simple:Loading llama_index.graph_stores.simple from projects/4/data\graph_store.json.
DEBUG:fsspec.local:open file: C:/OSPanel/domains/ai_assistant/api/projects/4/data/graph_store.json
INFO:llama_index.indices.loading:Loading indices with ids: ['vector_index']
DEBUG:openai:message='Request to OpenAI API' method=post path=https://api.openai.com/v1/embeddings
DEBUG:openai:api_version=None data='{"input": ["hi mr AI, do you have xiaomi 13 in your store?"], "model": "text-embedding-ada-002", "encoding_format": "base64"}' message='Post details'
DEBUG:urllib3.util.retry:Converted retries value: 2 -> Retry(total=2, connect=None, read=None, redirect=None, status=None)
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.openai.com:443
DEBUG:urllib3.connectionpool:https://api.openai.com:443 "POST /v1/embeddings HTTP/1.1" 200 None
DEBUG:openai:message='OpenAI API response' path=https://api.openai.com/v1/embeddings processing_ms=17 request_id=fe7fa9e98955eed490cd3b3b9c2a45c3 response_code=200
DEBUG:llama_index.indices.utils:> Top 1 nodes:
> [Node 909c5dd5-e87e-4999-a794-761f96e44168] [Similarity score:             -0.0284745] Welcome to TechHub, your ultimate destination for cutting-edge technology and innovation! At Tech...
DEBUG:openai:message='Request to OpenAI API' method=post path=https://api.openai.com/v1/chat/completions
DEBUG:openai:api_version=None data='{"messages": [{"role": "system", "content": "Context information is below.\\n--------------------\\nWelcome to TechHub, your ultimate destination for cutting-edge technology and innovation! At TechHub, we pride ourselves on being a premier online store dedicated to providing a curated selection of the latest and greatest in tech gadgets, including laptops, smartphones, and more.\\n\\nAbout Us:\\n\\nAt the heart of TechHub is a passion for technology and a commitment to delivering top-notch products that seamlessly blend style, functionality, and performance. With a team of tech enthusiasts, we understand the ever-evolving nature of the digital landscape and strive to stay at the forefront of the latest trends and advancements.\\n\\nOur Mission:\\n\\nOur mission at TechHub is to empower our customers with the best tools and devices that enhance their digital lifestyle. Whether you\'re a professional looking for a high-performance laptop to boost productivity or a smartphone aficionado seeking the latest flagship model, we\'ve got you covered. We believe that technology should not only meet but exceed your expectations, making every interaction with your devices a seamless and enjoyable experience.\\n\\nQuality Assurance:\\n\\nTechHub is committed to delivering products of the highest quality. We carefully curate our inventory, partnering with leading brands known for their commitment to excellence. Each product undergoes rigorous testing to ensure reliability, durability, and top-notch performance. Our dedication to quality assurance is reflected in every item we offer.\\n\\nCustomer-Centric Approach:\\n\\nAt TechHub, our customers are at the core of everything we do. We prioritize your satisfaction and strive to provide an unparalleled shopping experience. Our customer support team is ready to assist you at every step, from product inquiries to after-sales support. We value your feedback and continuously work to improve our services based on your needs.\\n\\nSecure Shopping:\\n\\nYour online security is our priority. TechHub employs state-of-the-art encryption technology to ensure that your personal information remains secure and protected. Shop with confidence, knowing that your data is in safe hands.\\n\\nExplore the world of innovation at TechHub, where technology meets lifestyle. Discover the perfect blend of style and functionality with our carefully curated selection of laptops, smartphones, and other cutting-edge gadgets. Join us on this exciting journey, and let\'s embrace the future together!\\n--------------------\\n\\u0412\\u044b \\u2014 \\u0418\\u0418 \\u0430\\u0441\\u0441\\u0438\\u0441\\u0442\\u0435\\u043d\\u0442 \\u043a\\u043e\\u043c\\u043f\\u0430\\u043d\\u0438\\u0438. \\u0412\\u0430\\u043c \\u0431\\u0443\\u0434\\u0443\\u0442 \\u0437\\u0430\\u0434\\u0430\\u043d\\u044b \\u0432\\u043e\\u043f\\u0440\\u043e\\u0441\\u044b \\u043e \\u043d\\u0430\\u0448\\u0435\\u0439 \\u043a\\u043e\\u043c\\u043f\\u0430\\u043d\\u0438\\u0438. \\u0412\\u0435\\u0436\\u043b\\u0438\\u0432\\u043e \\u043e\\u0442\\u0432\\u0435\\u0447\\u0430\\u0439\\u0442\\u0435 \\u043d\\u0430 \\u0432\\u043e\\u043f\\u0440\\u043e\\u0441\\u044b.\\r\\n    \\u041d\\u0438\\u0436\\u0435 \\u043c\\u044b \\u043f\\u0440\\u0435\\u0434\\u043e\\u0441\\u0442\\u0430\\u0432\\u0438\\u043b\\u0438 \\u043a\\u043e\\u043d\\u0442\\u0435\\u043a\\u0441\\u0442\\u043d\\u0443\\u044e \\u0438\\u043d\\u0444\\u043e\\u0440\\u043c\\u0430\\u0446\\u0438\\u044e.\\r\\n    ---------------------\\r\\n    {context_str}\\r\\n    ---------------------\\r\\n    \\u0423\\u0447\\u0438\\u0442\\u044b\\u0432\\u0430\\u044f \\u044d\\u0442\\u0443 \\u0438\\u043d\\u0444\\u043e\\u0440\\u043c\\u0430\\u0446\\u0438\\u044e, \\u043e\\u0442\\u0432\\u0435\\u0442\\u044c\\u0442\\u0435, \\u043f\\u043e\\u0436\\u0430\\u043b\\u0443\\u0439\\u0441\\u0442\\u0430, \\u043d\\u0430 \\u0432\\u043e\\u043f\\u0440\\u043e\\u0441: {query_str}\\r\\n    . \\n Information about relative products [{\\"id\\":17,\\"title\\":\\"Xiaomi 13\\",\\"content\\":\\"<ul class=\\\\\\"a-unordered-list a-vertical a-spacing-mini\\\\\\">\\\\r\\\\n \\\\t<li class=\\\\\\"a-spacing-mini\\\\\\"><span class=\\\\\\"a-list-item\\\\\\">Ultra-immersive display design Light up the screen to enjoy an unrivalled experience. The 1.61mm ultra-thin bezels offer a boundless vision.<\\\\/span><\\\\/li>\\\\r\\\\n \\\\t<li class=\\\\\\"a-spacing-mini\\\\\\"><span class=\\\\\\"a-list-item\\\\\\">Built for more scenarios IP68 water and dust resistant* Born splash-proof and water-resistant, thanks to the precision manufacturing. Record special memories anytime and anywhere.<\\\\/span><\\\\/li>\\\\r\\\\n \\\\t<li class=\\\\\\"a-spacing-mini\\\\\\"><span class=\\\\\\"a-list-item\\\\\\">Leica main camera with professional optical lens Captures every great moment<\\\\/span><\\\\/li>\\\\r\\\\n \\\\t<li class=\\\\\\"a-spacing-mini\\\\\\"><span class=\\\\\\"a-list-item\\\\\\">Masterpiece performance Leading Snapdragon 8 Gen 2 Boosted performance, reduced consumption<\\\\/span><\\\\/li>\\\\r\\\\n<\\\\/ul>\\",\\"date\\":\\"27.12.2023\\",\\"attributes\\":{\\"pa_color\\":[\\"silver\\"]},\\"stock\\":null,\\"image_url\\":false,\\"sku\\":\\"141234\\",\\"price\\":\\"16000\\",\\"formatted_price\\":\\"<span class=\\\\\\"woocommerce-Price-amount amount\\\\\\"><bdi>16000,00&nbsp;<span class=\\\\\\"woocommerce-Price-currencySymbol\\\\\\">&#8381;<\\\\/span><\\\\/bdi><\\\\/span>\\",\\"product_link\\":\\"http:\\\\/\\\\/wordpress\\\\/product\\\\/%d0%ba%d1%80%d0%be%d1%81%d1%81%d0%be%d0%b2%d0%ba%d0%b8\\\\/\\"}]"}, {"role": "user", "content": "hi mr AI, do you have xiaomi 13 in your store?"}], "stream": false, "model": "gpt-3.5-turbo", "temperature": 0, "max_tokens": null}' message='Post details'
DEBUG:urllib3.connectionpool:https://api.openai.com:443 "POST /v1/chat/completions HTTP/1.1" 200 None
DEBUG:openai:message='OpenAI API response' path=https://api.openai.com/v1/chat/completions processing_ms=4843 request_id=4764d55217bf44da4f2fffe3da34353d response_code=200
INFO:myapp:{'api': 1, 'product_data': '{"attributes": "color", "categories": "misc,smartphones"}', 'website': 'asdf', 'id': 4, 'left_tokens': 20363, 'description': None, 'temperature': Decimal('0.00'), 'model': 'gpt-3.5-turbo', 'prompt': 'Вы — ИИ ассистент компании. Вам будут заданы вопросы о нашей компании. Вежливо отвечайте на вопросы.\r\n    Ниже мы предоставили контекстную информацию.\r\n    ---------------------\r\n    {context_str}\r\n    ---------------------\r\n    Учитывая эту информацию, ответьте, пожалуйста, на вопрос: {query_str}\r\n    ', 'response_mode': 'compact', 'user_id': 12, 'answer': None, 'context': None}
INFO:werkzeug:127.0.0.1 - - [31/Dec/2023 22:38:24] "POST /projects/e47f0f811145d03c33fd6639dc3f09c0839d0891e264d849a75df04f4d047625/ucMUyS7SViy6fzrbBHgM6Q0rQC1xcted HTTP/1.1" 200 -
INFO:werkzeug:127.0.0.1 - - [31/Dec/2023 22:40:19] "GET /files/e47f0f811145d03c33fd6639dc3f09c0839d0891e264d849a75df04f4d047625 HTTP/1.1" 200 -
INFO:werkzeug:127.0.0.1 - - [31/Dec/2023 22:40:24] "OPTIONS /projects/e47f0f811145d03c33fd6639dc3f09c0839d0891e264d849a75df04f4d047625/W7acu7ydsH5uKBbWwdZYMDMDNJlsYFX4 HTTP/1.1" 200 -
INFO:myapp:{'api': 1, 'product_data': '{"attributes": "color", "categories": "misc,smartphones"}', 'website': 'asdf', 'id': 4, 'left_tokens': 19283, 'description': None, 'temperature': Decimal('0.00'), 'model': 'gpt-3.5-turbo', 'prompt': 'Вы — ИИ ассистент компании. Вам будут заданы вопросы о нашей компании. Вежливо отвечайте на вопросы.\r\n    Ниже мы предоставили контекстную информацию.\r\n    ---------------------\r\n    {context_str}\r\n    ---------------------\r\n    Учитывая эту информацию, ответьте, пожалуйста, на вопрос: {query_str}\r\n    ', 'response_mode': 'compact', 'user_id': 12, 'answer': None, 'context': None}
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.openai.com:443
DEBUG:urllib3.connectionpool:https://api.openai.com:443 "POST /v1/chat/completions HTTP/1.1" 200 None
INFO:myapp:[{'url_params': 'product_name=xiaomi 13', 'is_related': 'yes', 'category': 'smartphones'}]
INFO:myapp:product_name=xiaomi 13
INFO:myapp:prompt
INFO:myapp:You are AI assistant for a online shop. You should determine if a client is asking information about a product in our store. It can be a question about price, availability in stock, product characteristic, comparing 2 products. In this case you should contruct query parameters based on a client question. Construct them for every mentioned product. Add sort_price parameter if required .For example product_name=item_name&color=green&size=44&sort_price=desc|asc List of available query parameters: product_name, color product_name is a required parameter. You should use it in every query.Use only these query parameters for consructing. Add a category. List of available categories: misc,smartphones. Write your asnwer as array of json objects. [{url_params: <url_here>, is_related: 'yes', category: <category_here> }] If the question is not related to products of the store, then your answer would be [{is_related: 'no'}] Be strict. Fix typos in product names. Dont write anything else. Your answer will be used for a next query. Client question: hi mr AI, do you have xiaomi 13 in your store? .Your answer:
DEBUG:urllib3.connectionpool:Starting new HTTP connection (1): wordpress:80
DEBUG:urllib3.connectionpool:http://wordpress:80 "GET /wp-json/chatty/v1/posts?product_name=xiaomi+13 HTTP/1.1" 200 1298
INFO:myapp:api data [{"id":17,"title":"Xiaomi 13","content":"<ul class=\"a-unordered-list a-vertical a-spacing-mini\">\r\n \t<li class=\"a-spacing-mini\"><span class=\"a-list-item\">Ultra-immersive display design Light up the screen to enjoy an unrivalled experience. The 1.61mm ultra-thin bezels offer a boundless vision.<\/span><\/li>\r\n \t<li class=\"a-spacing-mini\"><span class=\"a-list-item\">Built for more scenarios IP68 water and dust resistant* Born splash-proof and water-resistant, thanks to the precision manufacturing. Record special memories anytime and anywhere.<\/span><\/li>\r\n \t<li class=\"a-spacing-mini\"><span class=\"a-list-item\">Leica main camera with professional optical lens Captures every great moment<\/span><\/li>\r\n \t<li class=\"a-spacing-mini\"><span class=\"a-list-item\">Masterpiece performance Leading Snapdragon 8 Gen 2 Boosted performance, reduced consumption<\/span><\/li>\r\n<\/ul>","date":"27.12.2023","attributes":{"pa_color":["silver"]},"stock":null,"image_url":false,"sku":"141234","price":"16000","formatted_price":"<span class=\"woocommerce-Price-amount amount\"><bdi>16000,00&nbsp;<span class=\"woocommerce-Price-currencySymbol\">&#8381;<\/span><\/bdi><\/span>","product_link":"http:\/\/wordpress\/product\/%d0%ba%d1%80%d0%be%d1%81%d1%81%d0%be%d0%b2%d0%ba%d0%b8\/"}]
DEBUG:llama_index.storage.kvstore.simple_kvstore:Loading llama_index.storage.kvstore.simple_kvstore from projects/4/data\docstore.json.
DEBUG:fsspec.local:open file: C:/OSPanel/domains/ai_assistant/api/projects/4/data/docstore.json
DEBUG:llama_index.storage.kvstore.simple_kvstore:Loading llama_index.storage.kvstore.simple_kvstore from projects/4/data\index_store.json.
DEBUG:fsspec.local:open file: C:/OSPanel/domains/ai_assistant/api/projects/4/data/index_store.json
DEBUG:llama_index.vector_stores.simple:Loading llama_index.vector_stores.simple from projects/4/data\vector_store.json.
DEBUG:fsspec.local:open file: C:/OSPanel/domains/ai_assistant/api/projects/4/data/vector_store.json
DEBUG:llama_index.graph_stores.simple:Loading llama_index.graph_stores.simple from projects/4/data\graph_store.json.
DEBUG:fsspec.local:open file: C:/OSPanel/domains/ai_assistant/api/projects/4/data/graph_store.json
INFO:llama_index.indices.loading:Loading indices with ids: ['vector_index']
DEBUG:openai:message='Request to OpenAI API' method=post path=https://api.openai.com/v1/embeddings
DEBUG:openai:api_version=None data='{"input": ["hi mr AI, do you have xiaomi 13 in your store?"], "model": "text-embedding-ada-002", "encoding_format": "base64"}' message='Post details'
DEBUG:urllib3.util.retry:Converted retries value: 2 -> Retry(total=2, connect=None, read=None, redirect=None, status=None)
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.openai.com:443
DEBUG:urllib3.connectionpool:https://api.openai.com:443 "POST /v1/embeddings HTTP/1.1" 200 None
DEBUG:openai:message='OpenAI API response' path=https://api.openai.com/v1/embeddings processing_ms=18 request_id=d5015e7a20171d25917c93c428871c51 response_code=200
DEBUG:llama_index.indices.utils:> Top 1 nodes:
> [Node 909c5dd5-e87e-4999-a794-761f96e44168] [Similarity score:             -0.0284745] Welcome to TechHub, your ultimate destination for cutting-edge technology and innovation! At Tech...
DEBUG:openai:message='Request to OpenAI API' method=post path=https://api.openai.com/v1/chat/completions
DEBUG:openai:api_version=None data='{"messages": [{"role": "system", "content": "Context information is below.\\n--------------------\\nWelcome to TechHub, your ultimate destination for cutting-edge technology and innovation! At TechHub, we pride ourselves on being a premier online store dedicated to providing a curated selection of the latest and greatest in tech gadgets, including laptops, smartphones, and more.\\n\\nAbout Us:\\n\\nAt the heart of TechHub is a passion for technology and a commitment to delivering top-notch products that seamlessly blend style, functionality, and performance. With a team of tech enthusiasts, we understand the ever-evolving nature of the digital landscape and strive to stay at the forefront of the latest trends and advancements.\\n\\nOur Mission:\\n\\nOur mission at TechHub is to empower our customers with the best tools and devices that enhance their digital lifestyle. Whether you\'re a professional looking for a high-performance laptop to boost productivity or a smartphone aficionado seeking the latest flagship model, we\'ve got you covered. We believe that technology should not only meet but exceed your expectations, making every interaction with your devices a seamless and enjoyable experience.\\n\\nQuality Assurance:\\n\\nTechHub is committed to delivering products of the highest quality. We carefully curate our inventory, partnering with leading brands known for their commitment to excellence. Each product undergoes rigorous testing to ensure reliability, durability, and top-notch performance. Our dedication to quality assurance is reflected in every item we offer.\\n\\nCustomer-Centric Approach:\\n\\nAt TechHub, our customers are at the core of everything we do. We prioritize your satisfaction and strive to provide an unparalleled shopping experience. Our customer support team is ready to assist you at every step, from product inquiries to after-sales support. We value your feedback and continuously work to improve our services based on your needs.\\n\\nSecure Shopping:\\n\\nYour online security is our priority. TechHub employs state-of-the-art encryption technology to ensure that your personal information remains secure and protected. Shop with confidence, knowing that your data is in safe hands.\\n\\nExplore the world of innovation at TechHub, where technology meets lifestyle. Discover the perfect blend of style and functionality with our carefully curated selection of laptops, smartphones, and other cutting-edge gadgets. Join us on this exciting journey, and let\'s embrace the future together!\\n--------------------\\n\\u0412\\u044b \\u2014 \\u0418\\u0418 \\u0430\\u0441\\u0441\\u0438\\u0441\\u0442\\u0435\\u043d\\u0442 \\u043a\\u043e\\u043c\\u043f\\u0430\\u043d\\u0438\\u0438. \\u0412\\u0430\\u043c \\u0431\\u0443\\u0434\\u0443\\u0442 \\u0437\\u0430\\u0434\\u0430\\u043d\\u044b \\u0432\\u043e\\u043f\\u0440\\u043e\\u0441\\u044b \\u043e \\u043d\\u0430\\u0448\\u0435\\u0439 \\u043a\\u043e\\u043c\\u043f\\u0430\\u043d\\u0438\\u0438. \\u0412\\u0435\\u0436\\u043b\\u0438\\u0432\\u043e \\u043e\\u0442\\u0432\\u0435\\u0447\\u0430\\u0439\\u0442\\u0435 \\u043d\\u0430 \\u0432\\u043e\\u043f\\u0440\\u043e\\u0441\\u044b.\\r\\n    \\u041d\\u0438\\u0436\\u0435 \\u043c\\u044b \\u043f\\u0440\\u0435\\u0434\\u043e\\u0441\\u0442\\u0430\\u0432\\u0438\\u043b\\u0438 \\u043a\\u043e\\u043d\\u0442\\u0435\\u043a\\u0441\\u0442\\u043d\\u0443\\u044e \\u0438\\u043d\\u0444\\u043e\\u0440\\u043c\\u0430\\u0446\\u0438\\u044e.\\r\\n    ---------------------\\r\\n    {context_str}\\r\\n    ---------------------\\r\\n    \\u0423\\u0447\\u0438\\u0442\\u044b\\u0432\\u0430\\u044f \\u044d\\u0442\\u0443 \\u0438\\u043d\\u0444\\u043e\\u0440\\u043c\\u0430\\u0446\\u0438\\u044e, \\u043e\\u0442\\u0432\\u0435\\u0442\\u044c\\u0442\\u0435, \\u043f\\u043e\\u0436\\u0430\\u043b\\u0443\\u0439\\u0441\\u0442\\u0430, \\u043d\\u0430 \\u0432\\u043e\\u043f\\u0440\\u043e\\u0441: {query_str}\\r\\n    . \\n Information about relative products [{\\"id\\":17,\\"title\\":\\"Xiaomi 13\\",\\"content\\":\\"<ul class=\\\\\\"a-unordered-list a-vertical a-spacing-mini\\\\\\">\\\\r\\\\n \\\\t<li class=\\\\\\"a-spacing-mini\\\\\\"><span class=\\\\\\"a-list-item\\\\\\">Ultra-immersive display design Light up the screen to enjoy an unrivalled experience. The 1.61mm ultra-thin bezels offer a boundless vision.<\\\\/span><\\\\/li>\\\\r\\\\n \\\\t<li class=\\\\\\"a-spacing-mini\\\\\\"><span class=\\\\\\"a-list-item\\\\\\">Built for more scenarios IP68 water and dust resistant* Born splash-proof and water-resistant, thanks to the precision manufacturing. Record special memories anytime and anywhere.<\\\\/span><\\\\/li>\\\\r\\\\n \\\\t<li class=\\\\\\"a-spacing-mini\\\\\\"><span class=\\\\\\"a-list-item\\\\\\">Leica main camera with professional optical lens Captures every great moment<\\\\/span><\\\\/li>\\\\r\\\\n \\\\t<li class=\\\\\\"a-spacing-mini\\\\\\"><span class=\\\\\\"a-list-item\\\\\\">Masterpiece performance Leading Snapdragon 8 Gen 2 Boosted performance, reduced consumption<\\\\/span><\\\\/li>\\\\r\\\\n<\\\\/ul>\\",\\"date\\":\\"27.12.2023\\",\\"attributes\\":{\\"pa_color\\":[\\"silver\\"]},\\"stock\\":null,\\"image_url\\":false,\\"sku\\":\\"141234\\",\\"price\\":\\"16000\\",\\"formatted_price\\":\\"<span class=\\\\\\"woocommerce-Price-amount amount\\\\\\"><bdi>16000,00&nbsp;<span class=\\\\\\"woocommerce-Price-currencySymbol\\\\\\">&#8381;<\\\\/span><\\\\/bdi><\\\\/span>\\",\\"product_link\\":\\"http:\\\\/\\\\/wordpress\\\\/product\\\\/%d0%ba%d1%80%d0%be%d1%81%d1%81%d0%be%d0%b2%d0%ba%d0%b8\\\\/\\"}]"}, {"role": "user", "content": "hi mr AI, do you have xiaomi 13 in your store?"}], "stream": false, "model": "gpt-3.5-turbo", "temperature": 0, "max_tokens": null}' message='Post details'
DEBUG:urllib3.connectionpool:https://api.openai.com:443 "POST /v1/chat/completions HTTP/1.1" 200 None
DEBUG:openai:message='OpenAI API response' path=https://api.openai.com/v1/chat/completions processing_ms=4753 request_id=71701e9401b4237d9c4e2650776d3211 response_code=200
INFO:myapp:{'api': 1, 'product_data': '{"attributes": "color", "categories": "misc,smartphones"}', 'website': 'asdf', 'id': 4, 'left_tokens': 19283, 'description': None, 'temperature': Decimal('0.00'), 'model': 'gpt-3.5-turbo', 'prompt': 'Вы — ИИ ассистент компании. Вам будут заданы вопросы о нашей компании. Вежливо отвечайте на вопросы.\r\n    Ниже мы предоставили контекстную информацию.\r\n    ---------------------\r\n    {context_str}\r\n    ---------------------\r\n    Учитывая эту информацию, ответьте, пожалуйста, на вопрос: {query_str}\r\n    ', 'response_mode': 'compact', 'user_id': 12, 'answer': None, 'context': None}
INFO:werkzeug:127.0.0.1 - - [31/Dec/2023 22:40:32] "POST /projects/e47f0f811145d03c33fd6639dc3f09c0839d0891e264d849a75df04f4d047625/W7acu7ydsH5uKBbWwdZYMDMDNJlsYFX4 HTTP/1.1" 200 -
INFO:werkzeug:127.0.0.1 - - [31/Dec/2023 22:41:56] "OPTIONS /projects/e47f0f811145d03c33fd6639dc3f09c0839d0891e264d849a75df04f4d047625/W7acu7ydsH5uKBbWwdZYMDMDNJlsYFX4 HTTP/1.1" 200 -
INFO:myapp:{'api': 1, 'product_data': '{"attributes": "color", "categories": "misc,smartphones"}', 'website': 'asdf', 'id': 4, 'left_tokens': 18203, 'description': None, 'temperature': Decimal('0.00'), 'model': 'gpt-3.5-turbo', 'prompt': 'Вы — ИИ ассистент компании. Вам будут заданы вопросы о нашей компании. Вежливо отвечайте на вопросы.\r\n    Ниже мы предоставили контекстную информацию.\r\n    ---------------------\r\n    {context_str}\r\n    ---------------------\r\n    Учитывая эту информацию, ответьте, пожалуйста, на вопрос: {query_str}\r\n    ', 'response_mode': 'compact', 'user_id': 12, 'answer': 'Client: hi mr AI, do you have xiaomi 13 in your store?,\nAi response: Yes, we do have the Xiaomi 13 available in our store. It features an ultra-immersive display design with thin bezels, making for a boundless visual experience. It is also IP68 water and dust resistant, allowing you to capture special memories anytime and anywhere. The Xiaomi 13 is equipped with a Leica main camera with a professional optical lens, ensuring that you can capture every great moment. Additionally, it boasts a powerful performance with the Snapdragon 8 Gen 2 processor. The price for the Xiaomi 13 is 16,000 rubles. You can find more information and make a purchase on our website: [Xiaomi 13 Product Link](http://wordpress/product/кроссовки/)', 'context': '[{"id":17,"title":"Xiaomi 13","content":"<ul class=\\"a-unordered-list a-vertical a-spacing-mini\\">\\r\\n \\t<li class=\\"a-spacing-mini\\"><span class=\\"a-list-item\\">Ultra-immersive display design Light up the screen to enjoy an unrivalled experience. The 1.61mm ultra-thin bezels offer a boundless vision.<\\/span><\\/li>\\r\\n \\t<li class=\\"a-spacing-mini\\"><span class=\\"a-list-item\\">Built for more scenarios IP68 water and dust resistant* Born splash-proof and water-resistant, thanks to the precision manufacturing. Record special memories anytime and anywhere.<\\/span><\\/li>\\r\\n \\t<li class=\\"a-spacing-mini\\"><span class=\\"a-list-item\\">Leica main camera with professional optical lens Captures every great moment<\\/span><\\/li>\\r\\n \\t<li class=\\"a-spacing-mini\\"><span class=\\"a-list-item\\">Masterpiece performance Leading Snapdragon 8 Gen 2 Boosted performance, reduced consumption<\\/span><\\/li>\\r\\n<\\/ul>","date":"27.12.2023","attributes":{"pa_color":["silver"]},"stock":null,"image_url":false,"sku":"141234","price":"16000","formatted_price":"<span class=\\"woocommerce-Price-amount amount\\"><bdi>16000,00&nbsp;<span class=\\"woocommerce-Price-currencySymbol\\">&#8381;<\\/span><\\/bdi><\\/span>","product_link":"http:\\/\\/wordpress\\/product\\/%d0%ba%d1%80%d0%be%d1%81%d1%81%d0%be%d0%b2%d0%ba%d0%b8\\/"}]'}
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.openai.com:443
DEBUG:urllib3.connectionpool:https://api.openai.com:443 "POST /v1/chat/completions HTTP/1.1" 200 None
INFO:myapp:[{'url_params': 'product_name=xiaomi 12', 'is_related': 'yes', 'category': 'smartphones'}]
INFO:myapp:product_name=xiaomi 12
INFO:myapp:prompt
INFO:myapp:You are AI assistant for a online shop. You should determine if a client is asking information about a product in our store. It can be a question about price, availability in stock, product characteristic, comparing 2 products. In this case you should contruct query parameters based on a client question. Construct them for every mentioned product. Add sort_price parameter if required .For example product_name=item_name&color=green&size=44&sort_price=desc|asc List of available query parameters: product_name, color product_name is a required parameter. You should use it in every query.Use only these query parameters for consructing. Add a category. List of available categories: misc,smartphones. Write your asnwer as array of json objects. [{url_params: <url_here>, is_related: 'yes', category: <category_here> }] If the question is not related to products of the store, then your answer would be [{is_related: 'no'}] Be strict. Fix typos in product names. Dont write anything else. Your answer will be used for a next query. Client question: do you have xiaomi 12? .Your answer:
DEBUG:urllib3.connectionpool:Starting new HTTP connection (1): wordpress:80
DEBUG:urllib3.connectionpool:http://wordpress:80 "GET /wp-json/chatty/v1/posts?product_name=xiaomi+12 HTTP/1.1" 200 455
INFO:myapp:api data [{"id":20,"title":"Xiaomi Redmi 12 128GB &#8212; Black &#8212; Unlocked &#8212; Dual-SIM","content":"","date":"29.12.2023","attributes":{"pa_color":["black"]},"stock":null,"image_url":false,"sku":"141234-1","price":"15000","formatted_price":"<span class=\"woocommerce-Price-amount amount\"><bdi>15000,00&nbsp;<span class=\"woocommerce-Price-currencySymbol\">&#8381;<\/span><\/bdi><\/span>","product_link":"http:\/\/wordpress\/product\/xiaomi-12-black\/"}]
DEBUG:llama_index.storage.kvstore.simple_kvstore:Loading llama_index.storage.kvstore.simple_kvstore from projects/4/data\docstore.json.
DEBUG:fsspec.local:open file: C:/OSPanel/domains/ai_assistant/api/projects/4/data/docstore.json
DEBUG:llama_index.storage.kvstore.simple_kvstore:Loading llama_index.storage.kvstore.simple_kvstore from projects/4/data\index_store.json.
DEBUG:fsspec.local:open file: C:/OSPanel/domains/ai_assistant/api/projects/4/data/index_store.json
DEBUG:llama_index.vector_stores.simple:Loading llama_index.vector_stores.simple from projects/4/data\vector_store.json.
DEBUG:fsspec.local:open file: C:/OSPanel/domains/ai_assistant/api/projects/4/data/vector_store.json
DEBUG:llama_index.graph_stores.simple:Loading llama_index.graph_stores.simple from projects/4/data\graph_store.json.
DEBUG:fsspec.local:open file: C:/OSPanel/domains/ai_assistant/api/projects/4/data/graph_store.json
INFO:llama_index.indices.loading:Loading indices with ids: ['vector_index']
DEBUG:openai:message='Request to OpenAI API' method=post path=https://api.openai.com/v1/embeddings
DEBUG:openai:api_version=None data='{"input": ["do you have xiaomi 12?"], "model": "text-embedding-ada-002", "encoding_format": "base64"}' message='Post details'
DEBUG:urllib3.util.retry:Converted retries value: 2 -> Retry(total=2, connect=None, read=None, redirect=None, status=None)
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.openai.com:443
DEBUG:urllib3.connectionpool:https://api.openai.com:443 "POST /v1/embeddings HTTP/1.1" 200 None
DEBUG:openai:message='OpenAI API response' path=https://api.openai.com/v1/embeddings processing_ms=19 request_id=d82a0e37d657757989092b4d1ce00863 response_code=200
DEBUG:llama_index.indices.utils:> Top 1 nodes:
> [Node 909c5dd5-e87e-4999-a794-761f96e44168] [Similarity score:             -0.0287858] Welcome to TechHub, your ultimate destination for cutting-edge technology and innovation! At Tech...
DEBUG:openai:message='Request to OpenAI API' method=post path=https://api.openai.com/v1/chat/completions
DEBUG:openai:api_version=None data='{"messages": [{"role": "system", "content": "Context information is below.\\n--------------------\\nWelcome to TechHub, your ultimate destination for cutting-edge technology and innovation! At TechHub, we pride ourselves on being a premier online store dedicated to providing a curated selection of the latest and greatest in tech gadgets, including laptops, smartphones, and more.\\n\\nAbout Us:\\n\\nAt the heart of TechHub is a passion for technology and a commitment to delivering top-notch products that seamlessly blend style, functionality, and performance. With a team of tech enthusiasts, we understand the ever-evolving nature of the digital landscape and strive to stay at the forefront of the latest trends and advancements.\\n\\nOur Mission:\\n\\nOur mission at TechHub is to empower our customers with the best tools and devices that enhance their digital lifestyle. Whether you\'re a professional looking for a high-performance laptop to boost productivity or a smartphone aficionado seeking the latest flagship model, we\'ve got you covered. We believe that technology should not only meet but exceed your expectations, making every interaction with your devices a seamless and enjoyable experience.\\n\\nQuality Assurance:\\n\\nTechHub is committed to delivering products of the highest quality. We carefully curate our inventory, partnering with leading brands known for their commitment to excellence. Each product undergoes rigorous testing to ensure reliability, durability, and top-notch performance. Our dedication to quality assurance is reflected in every item we offer.\\n\\nCustomer-Centric Approach:\\n\\nAt TechHub, our customers are at the core of everything we do. We prioritize your satisfaction and strive to provide an unparalleled shopping experience. Our customer support team is ready to assist you at every step, from product inquiries to after-sales support. We value your feedback and continuously work to improve our services based on your needs.\\n\\nSecure Shopping:\\n\\nYour online security is our priority. TechHub employs state-of-the-art encryption technology to ensure that your personal information remains secure and protected. Shop with confidence, knowing that your data is in safe hands.\\n\\nExplore the world of innovation at TechHub, where technology meets lifestyle. Discover the perfect blend of style and functionality with our carefully curated selection of laptops, smartphones, and other cutting-edge gadgets. Join us on this exciting journey, and let\'s embrace the future together!\\n--------------------\\n\\u0412\\u044b \\u2014 \\u0418\\u0418 \\u0430\\u0441\\u0441\\u0438\\u0441\\u0442\\u0435\\u043d\\u0442 \\u043a\\u043e\\u043c\\u043f\\u0430\\u043d\\u0438\\u0438. \\u0412\\u0430\\u043c \\u0431\\u0443\\u0434\\u0443\\u0442 \\u0437\\u0430\\u0434\\u0430\\u043d\\u044b \\u0432\\u043e\\u043f\\u0440\\u043e\\u0441\\u044b \\u043e \\u043d\\u0430\\u0448\\u0435\\u0439 \\u043a\\u043e\\u043c\\u043f\\u0430\\u043d\\u0438\\u0438. \\u0412\\u0435\\u0436\\u043b\\u0438\\u0432\\u043e \\u043e\\u0442\\u0432\\u0435\\u0447\\u0430\\u0439\\u0442\\u0435 \\u043d\\u0430 \\u0432\\u043e\\u043f\\u0440\\u043e\\u0441\\u044b.\\r\\n    \\u041d\\u0438\\u0436\\u0435 \\u043c\\u044b \\u043f\\u0440\\u0435\\u0434\\u043e\\u0441\\u0442\\u0430\\u0432\\u0438\\u043b\\u0438 \\u043a\\u043e\\u043d\\u0442\\u0435\\u043a\\u0441\\u0442\\u043d\\u0443\\u044e \\u0438\\u043d\\u0444\\u043e\\u0440\\u043c\\u0430\\u0446\\u0438\\u044e.\\r\\n    ---------------------\\r\\n    {context_str}\\r\\n    ---------------------\\r\\n    \\u0423\\u0447\\u0438\\u0442\\u044b\\u0432\\u0430\\u044f \\u044d\\u0442\\u0443 \\u0438\\u043d\\u0444\\u043e\\u0440\\u043c\\u0430\\u0446\\u0438\\u044e, \\u043e\\u0442\\u0432\\u0435\\u0442\\u044c\\u0442\\u0435, \\u043f\\u043e\\u0436\\u0430\\u043b\\u0443\\u0439\\u0441\\u0442\\u0430, \\u043d\\u0430 \\u0432\\u043e\\u043f\\u0440\\u043e\\u0441: {query_str}\\r\\n    . \\n Information about relative products [{\\"id\\":17,\\"title\\":\\"Xiaomi 13\\",\\"content\\":\\"<ul class=\\\\\\"a-unordered-list a-vertical a-spacing-mini\\\\\\">\\\\r\\\\n \\\\t<li class=\\\\\\"a-spacing-mini\\\\\\"><span class=\\\\\\"a-list-item\\\\\\">Ultra-immersive display design Light up the screen to enjoy an unrivalled experience. The 1.61mm ultra-thin bezels offer a boundless vision.<\\\\/span><\\\\/li>\\\\r\\\\n \\\\t<li class=\\\\\\"a-spacing-mini\\\\\\"><span class=\\\\\\"a-list-item\\\\\\">Built for more scenarios IP68 water and dust resistant* Born splash-proof and water-resistant, thanks to the precision manufacturing. Record special memories anytime and anywhere.<\\\\/span><\\\\/li>\\\\r\\\\n \\\\t<li class=\\\\\\"a-spacing-mini\\\\\\"><span class=\\\\\\"a-list-item\\\\\\">Leica main camera with professional optical lens Captures every great moment<\\\\/span><\\\\/li>\\\\r\\\\n \\\\t<li class=\\\\\\"a-spacing-mini\\\\\\"><span class=\\\\\\"a-list-item\\\\\\">Masterpiece performance Leading Snapdragon 8 Gen 2 Boosted performance, reduced consumption<\\\\/span><\\\\/li>\\\\r\\\\n<\\\\/ul>\\",\\"date\\":\\"27.12.2023\\",\\"attributes\\":{\\"pa_color\\":[\\"silver\\"]},\\"stock\\":null,\\"image_url\\":false,\\"sku\\":\\"141234\\",\\"price\\":\\"16000\\",\\"formatted_price\\":\\"<span class=\\\\\\"woocommerce-Price-amount amount\\\\\\"><bdi>16000,00&nbsp;<span class=\\\\\\"woocommerce-Price-currencySymbol\\\\\\">&#8381;<\\\\/span><\\\\/bdi><\\\\/span>\\",\\"product_link\\":\\"http:\\\\/\\\\/wordpress\\\\/product\\\\/%d0%ba%d1%80%d0%be%d1%81%d1%81%d0%be%d0%b2%d0%ba%d0%b8\\\\/\\"}]"}, {"role": "user", "content": "do you have xiaomi 12?"}], "stream": false, "model": "gpt-3.5-turbo", "temperature": 0, "max_tokens": null}' message='Post details'
DEBUG:urllib3.connectionpool:https://api.openai.com:443 "POST /v1/chat/completions HTTP/1.1" 200 None
DEBUG:openai:message='OpenAI API response' path=https://api.openai.com/v1/chat/completions processing_ms=2886 request_id=45dda62058ddcc88cb6a725ab83eca5d response_code=200
INFO:myapp:{'api': 1, 'product_data': '{"attributes": "color", "categories": "misc,smartphones"}', 'website': 'asdf', 'id': 4, 'left_tokens': 18203, 'description': None, 'temperature': Decimal('0.00'), 'model': 'gpt-3.5-turbo', 'prompt': 'Вы — ИИ ассистент компании. Вам будут заданы вопросы о нашей компании. Вежливо отвечайте на вопросы.\r\n    Ниже мы предоставили контекстную информацию.\r\n    ---------------------\r\n    {context_str}\r\n    ---------------------\r\n    Учитывая эту информацию, ответьте, пожалуйста, на вопрос: {query_str}\r\n    ', 'response_mode': 'compact', 'user_id': 12, 'answer': 'Client: hi mr AI, do you have xiaomi 13 in your store?,\nAi response: Yes, we do have the Xiaomi 13 available in our store. It features an ultra-immersive display design with thin bezels, making for a boundless visual experience. It is also IP68 water and dust resistant, allowing you to capture special memories anytime and anywhere. The Xiaomi 13 is equipped with a Leica main camera with a professional optical lens, ensuring that you can capture every great moment. Additionally, it boasts a powerful performance with the Snapdragon 8 Gen 2 processor. The price for the Xiaomi 13 is 16,000 rubles. You can find more information and make a purchase on our website: [Xiaomi 13 Product Link](http://wordpress/product/кроссовки/)', 'context': '[{"id":17,"title":"Xiaomi 13","content":"<ul class=\\"a-unordered-list a-vertical a-spacing-mini\\">\\r\\n \\t<li class=\\"a-spacing-mini\\"><span class=\\"a-list-item\\">Ultra-immersive display design Light up the screen to enjoy an unrivalled experience. The 1.61mm ultra-thin bezels offer a boundless vision.<\\/span><\\/li>\\r\\n \\t<li class=\\"a-spacing-mini\\"><span class=\\"a-list-item\\">Built for more scenarios IP68 water and dust resistant* Born splash-proof and water-resistant, thanks to the precision manufacturing. Record special memories anytime and anywhere.<\\/span><\\/li>\\r\\n \\t<li class=\\"a-spacing-mini\\"><span class=\\"a-list-item\\">Leica main camera with professional optical lens Captures every great moment<\\/span><\\/li>\\r\\n \\t<li class=\\"a-spacing-mini\\"><span class=\\"a-list-item\\">Masterpiece performance Leading Snapdragon 8 Gen 2 Boosted performance, reduced consumption<\\/span><\\/li>\\r\\n<\\/ul>","date":"27.12.2023","attributes":{"pa_color":["silver"]},"stock":null,"image_url":false,"sku":"141234","price":"16000","formatted_price":"<span class=\\"woocommerce-Price-amount amount\\"><bdi>16000,00&nbsp;<span class=\\"woocommerce-Price-currencySymbol\\">&#8381;<\\/span><\\/bdi><\\/span>","product_link":"http:\\/\\/wordpress\\/product\\/%d0%ba%d1%80%d0%be%d1%81%d1%81%d0%be%d0%b2%d0%ba%d0%b8\\/"}]'}
ERROR:myapp:Exception on /projects/e47f0f811145d03c33fd6639dc3f09c0839d0891e264d849a75df04f4d047625/W7acu7ydsH5uKBbWwdZYMDMDNJlsYFX4 [POST]
Traceback (most recent call last):
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\kombu\connection.py", line 556, in _ensured
    return fun(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\kombu\messaging.py", line 208, in _publish
    return channel.basic_publish(
           ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\kombu\transport\virtual\base.py", line 614, in basic_publish
    return self._put(routing_key, message, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\kombu\transport\redis.py", line 1016, in _put
    client.lpush(self._q_for_pri(queue, pri), dumps(message))
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\redis\commands\core.py", line 2721, in lpush
    return self.execute_command("LPUSH", name, *values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\redis\client.py", line 1269, in execute_command
    return conn.retry.call_with_retry(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\redis\retry.py", line 46, in call_with_retry
    return do()
           ^^^^
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\redis\client.py", line 1270, in <lambda>
    lambda: self._send_command_parse_response(
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\redis\client.py", line 1245, in _send_command_parse_response
    conn.send_command(*args)
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\redis\connection.py", line 855, in send_command
    self.send_packed_command(
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\redis\connection.py", line 828, in send_packed_command
    self.check_health()
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\redis\connection.py", line 820, in check_health
    self.retry.call_with_retry(self._send_ping, self._ping_failed)
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\redis\retry.py", line 46, in call_with_retry
    return do()
           ^^^^
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\redis\connection.py", line 810, in _send_ping
    if str_if_bytes(self.read_response()) != "PONG":
                    ^^^^^^^^^^^^^^^^^^^^
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\redis\connection.py", line 905, in read_response
    raise response
redis.exceptions.ResponseError: MISCONF Memurai is configured to save RDB snapshots, but it's currently unable to persist to disk. Commands that may modify the data set are disabled, because this instance is configured to report errors during writes if RDB snapshotting fails (stop-writes-on-bgsave-error option). Please check the Memurai logs for details about the RDB error.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\kombu\transport\virtual\base.py", line 951, in create_channel
    return self._avail_channels.pop()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
IndexError: pop from empty list

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\kombu\connection.py", line 472, in _reraise_as_library_errors
    yield
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\kombu\connection.py", line 578, in _ensured
    self._ensure_connection(
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\kombu\connection.py", line 459, in _ensure_connection
    return retry_over_time(
           ^^^^^^^^^^^^^^^^
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\kombu\utils\functional.py", line 318, in retry_over_time
    return fun(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\kombu\connection.py", line 934, in _connection_factory
    self._connection = self._establish_connection()
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\kombu\connection.py", line 860, in _establish_connection
    conn = self.transport.establish_connection()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\kombu\transport\virtual\base.py", line 975, in establish_connection
    self._avail_channels.append(self.create_channel(self))
                                ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\kombu\transport\virtual\base.py", line 953, in create_channel
    channel = self.Channel(connection)
              ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\kombu\transport\redis.py", line 741, in __init__
    self.client.ping()
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\redis\commands\core.py", line 1205, in ping
    return self.execute_command("PING", **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\redis\client.py", line 1269, in execute_command
    return conn.retry.call_with_retry(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\redis\retry.py", line 46, in call_with_retry
    return do()
           ^^^^
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\redis\client.py", line 1270, in <lambda>
    lambda: self._send_command_parse_response(
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\redis\client.py", line 1245, in _send_command_parse_response
    conn.send_command(*args)
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\redis\connection.py", line 855, in send_command
    self.send_packed_command(
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\redis\connection.py", line 828, in send_packed_command
    self.check_health()
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\redis\connection.py", line 820, in check_health
    self.retry.call_with_retry(self._send_ping, self._ping_failed)
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\redis\retry.py", line 46, in call_with_retry
    return do()
           ^^^^
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\redis\connection.py", line 810, in _send_ping
    if str_if_bytes(self.read_response()) != "PONG":
                    ^^^^^^^^^^^^^^^^^^^^
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\redis\connection.py", line 905, in read_response
    raise response
redis.exceptions.ResponseError: MISCONF Memurai is configured to save RDB snapshots, but it's currently unable to persist to disk. Commands that may modify the data set are disabled, because this instance is configured to report errors during writes if RDB snapshotting fails (stop-writes-on-bgsave-error option). Please check the Memurai logs for details about the RDB error.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\flask\app.py", line 2190, in wsgi_app
    response = self.full_dispatch_request()
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\flask\app.py", line 1486, in full_dispatch_request
    rv = self.handle_user_exception(e)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\flask_cors\extension.py", line 176, in wrapped_function
    return cors_after_request(app.make_response(f(*args, **kwargs)))
                                                ^^^^^^^^^^^^^^^^^^
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\flask_cors\extension.py", line 176, in wrapped_function
    return cors_after_request(app.make_response(f(*args, **kwargs)))
                                                ^^^^^^^^^^^^^^^^^^
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\flask\app.py", line 1484, in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\flask\app.py", line 1469, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\OSPanel\domains\ai_assistant\api\myapp.py", line 389, in get_project_details
    send_chat_request.apply_async(args=[project['user_id'], project['id'], session_id, token_counter.total_llm_token_count,f"Client: {query_text},\nAi response: {response.response}", product_response])
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\celery\app\task.py", line 594, in apply_async
    return app.send_task(
           ^^^^^^^^^^^^^^
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\celery\app\base.py", line 798, in send_task
    amqp.send_task_message(P, name, message, **options)
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\celery\app\amqp.py", line 517, in send_task_message
    ret = producer.publish(
          ^^^^^^^^^^^^^^^^^
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\kombu\messaging.py", line 186, in publish
    return _publish(
           ^^^^^^^^^
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\kombu\connection.py", line 553, in _ensured
    with self._reraise_as_library_errors():
  File "C:\Users\Maxan\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 155, in __exit__
    self.gen.throw(typ, value, traceback)
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\kombu\connection.py", line 476, in _reraise_as_library_errors
    raise ConnectionError(str(exc)) from exc
kombu.exceptions.OperationalError: MISCONF Memurai is configured to save RDB snapshots, but it's currently unable to persist to disk. Commands that may modify the data set are disabled, because this instance is configured to report errors during writes if RDB snapshotting fails (stop-writes-on-bgsave-error option). Please check the Memurai logs for details about the RDB error.
INFO:werkzeug:127.0.0.1 - - [31/Dec/2023 22:42:03] "[35m[1mPOST /projects/e47f0f811145d03c33fd6639dc3f09c0839d0891e264d849a75df04f4d047625/W7acu7ydsH5uKBbWwdZYMDMDNJlsYFX4 HTTP/1.1[0m" 500 -
DEBUG:root:This is a debug message
DEBUG:celery.utils.functional:
def unlock_chord(self, group_id, callback, interval=0, max_retries=1, result=2, Result=3, GroupResult=4, result_from_tuple=5, **kwargs):
    return 1

DEBUG:celery.utils.functional:
def group(self, tasks, result, group_id, partial_args, add_to_parent=0):
    return 1

DEBUG:celery.utils.functional:
def send_chat_request(user_id, project_id, session, total_tokens, answer, context):
    return 1

DEBUG:celery.utils.functional:
def xmap(task, it):
    return 1

DEBUG:celery.utils.functional:
def sendEmbeddingRequest(user_id, total_tokens):
    return 1

DEBUG:celery.utils.functional:
def backend_cleanup():
    return 1

DEBUG:celery.utils.functional:
def set_vector_index_task(self, token):
    return 1

DEBUG:celery.utils.functional:
def process_set_vector_index(self, token, task_id):
    return 1

DEBUG:celery.utils.functional:
def chain(*args, **kwargs):
    return 1

DEBUG:celery.utils.functional:
def xstarmap(task, it):
    return 1

DEBUG:celery.utils.functional:
def accumulate(self, *args, **kwargs):
    return 1

DEBUG:celery.utils.functional:
def chord(self, header, body, partial_args=0, interval=1, countdown=2, max_retries=3, eager=4, **kwargs):
    return 1

DEBUG:celery.utils.functional:
def chunks(task, it, n):
    return 1

INFO:werkzeug:127.0.0.1 - - [31/Dec/2023 22:42:28] "OPTIONS /projects/e47f0f811145d03c33fd6639dc3f09c0839d0891e264d849a75df04f4d047625/W7acu7ydsH5uKBbWwdZYMDMDNJlsYFX4 HTTP/1.1" 200 -
INFO:myapp:{'api': 1, 'product_data': '{"attributes": "color", "categories": "misc,smartphones"}', 'website': 'asdf', 'id': 4, 'left_tokens': 18203, 'description': None, 'temperature': Decimal('0.00'), 'model': 'gpt-3.5-turbo', 'prompt': 'Вы — ИИ ассистент компании. Вам будут заданы вопросы о нашей компании. Вежливо отвечайте на вопросы.\r\n    Ниже мы предоставили контекстную информацию.\r\n    ---------------------\r\n    {context_str}\r\n    ---------------------\r\n    Учитывая эту информацию, ответьте, пожалуйста, на вопрос: {query_str}\r\n    ', 'response_mode': 'compact', 'user_id': 12, 'answer': 'Client: hi mr AI, do you have xiaomi 13 in your store?,\nAi response: Yes, we do have the Xiaomi 13 available in our store. It features an ultra-immersive display design with thin bezels, making for a boundless visual experience. It is also IP68 water and dust resistant, allowing you to capture special memories anytime and anywhere. The Xiaomi 13 is equipped with a Leica main camera with a professional optical lens, ensuring that you can capture every great moment. Additionally, it boasts a powerful performance with the Snapdragon 8 Gen 2 processor. The price for the Xiaomi 13 is 16,000 rubles. You can find more information and make a purchase on our website: [Xiaomi 13 Product Link](http://wordpress/product/кроссовки/)', 'context': '[{"id":17,"title":"Xiaomi 13","content":"<ul class=\\"a-unordered-list a-vertical a-spacing-mini\\">\\r\\n \\t<li class=\\"a-spacing-mini\\"><span class=\\"a-list-item\\">Ultra-immersive display design Light up the screen to enjoy an unrivalled experience. The 1.61mm ultra-thin bezels offer a boundless vision.<\\/span><\\/li>\\r\\n \\t<li class=\\"a-spacing-mini\\"><span class=\\"a-list-item\\">Built for more scenarios IP68 water and dust resistant* Born splash-proof and water-resistant, thanks to the precision manufacturing. Record special memories anytime and anywhere.<\\/span><\\/li>\\r\\n \\t<li class=\\"a-spacing-mini\\"><span class=\\"a-list-item\\">Leica main camera with professional optical lens Captures every great moment<\\/span><\\/li>\\r\\n \\t<li class=\\"a-spacing-mini\\"><span class=\\"a-list-item\\">Masterpiece performance Leading Snapdragon 8 Gen 2 Boosted performance, reduced consumption<\\/span><\\/li>\\r\\n<\\/ul>","date":"27.12.2023","attributes":{"pa_color":["silver"]},"stock":null,"image_url":false,"sku":"141234","price":"16000","formatted_price":"<span class=\\"woocommerce-Price-amount amount\\"><bdi>16000,00&nbsp;<span class=\\"woocommerce-Price-currencySymbol\\">&#8381;<\\/span><\\/bdi><\\/span>","product_link":"http:\\/\\/wordpress\\/product\\/%d0%ba%d1%80%d0%be%d1%81%d1%81%d0%be%d0%b2%d0%ba%d0%b8\\/"}]'}
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.openai.com:443
DEBUG:urllib3.connectionpool:https://api.openai.com:443 "POST /v1/chat/completions HTTP/1.1" 200 None
INFO:myapp:[{'url_params': 'product_name=xiaomi 12', 'is_related': 'yes', 'category': 'smartphones'}]
INFO:myapp:product_name=xiaomi 12
INFO:myapp:prompt
INFO:myapp:You are AI assistant for a online shop. You should determine if a client is asking information about a product in our store. It can be a question about price, availability in stock, product characteristic, comparing 2 products. In this case you should contruct query parameters based on a client question. Construct them for every mentioned product. Add sort_price parameter if required .For example product_name=item_name&color=green&size=44&sort_price=desc|asc List of available query parameters: product_name, color product_name is a required parameter. You should use it in every query.Use only these query parameters for consructing. Add a category. List of available categories: misc,smartphones. Write your asnwer as array of json objects. [{url_params: <url_here>, is_related: 'yes', category: <category_here> }] If the question is not related to products of the store, then your answer would be [{is_related: 'no'}] Be strict. Fix typos in product names. Dont write anything else. Your answer will be used for a next query. Client question: do you have xiaomi 12? .Your answer:
DEBUG:urllib3.connectionpool:Starting new HTTP connection (1): wordpress:80
DEBUG:urllib3.connectionpool:http://wordpress:80 "GET /wp-json/chatty/v1/posts?product_name=xiaomi+12 HTTP/1.1" 200 455
INFO:myapp:api data [{"id":20,"title":"Xiaomi Redmi 12 128GB &#8212; Black &#8212; Unlocked &#8212; Dual-SIM","content":"","date":"29.12.2023","attributes":{"pa_color":["black"]},"stock":null,"image_url":false,"sku":"141234-1","price":"15000","formatted_price":"<span class=\"woocommerce-Price-amount amount\"><bdi>15000,00&nbsp;<span class=\"woocommerce-Price-currencySymbol\">&#8381;<\/span><\/bdi><\/span>","product_link":"http:\/\/wordpress\/product\/xiaomi-12-black\/"}]
DEBUG:llama_index.storage.kvstore.simple_kvstore:Loading llama_index.storage.kvstore.simple_kvstore from projects/4/data\docstore.json.
DEBUG:fsspec.local:open file: C:/OSPanel/domains/ai_assistant/api/projects/4/data/docstore.json
DEBUG:llama_index.storage.kvstore.simple_kvstore:Loading llama_index.storage.kvstore.simple_kvstore from projects/4/data\index_store.json.
DEBUG:fsspec.local:open file: C:/OSPanel/domains/ai_assistant/api/projects/4/data/index_store.json
DEBUG:llama_index.vector_stores.simple:Loading llama_index.vector_stores.simple from projects/4/data\vector_store.json.
DEBUG:fsspec.local:open file: C:/OSPanel/domains/ai_assistant/api/projects/4/data/vector_store.json
DEBUG:llama_index.graph_stores.simple:Loading llama_index.graph_stores.simple from projects/4/data\graph_store.json.
DEBUG:fsspec.local:open file: C:/OSPanel/domains/ai_assistant/api/projects/4/data/graph_store.json
INFO:llama_index.indices.loading:Loading indices with ids: ['vector_index']
DEBUG:openai:message='Request to OpenAI API' method=post path=https://api.openai.com/v1/embeddings
DEBUG:openai:api_version=None data='{"input": ["do you have xiaomi 12?"], "model": "text-embedding-ada-002", "encoding_format": "base64"}' message='Post details'
DEBUG:urllib3.util.retry:Converted retries value: 2 -> Retry(total=2, connect=None, read=None, redirect=None, status=None)
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.openai.com:443
DEBUG:urllib3.connectionpool:https://api.openai.com:443 "POST /v1/embeddings HTTP/1.1" 200 None
DEBUG:openai:message='OpenAI API response' path=https://api.openai.com/v1/embeddings processing_ms=20 request_id=1285efe32c5c3cee68128926d1250233 response_code=200
DEBUG:llama_index.indices.utils:> Top 1 nodes:
> [Node 909c5dd5-e87e-4999-a794-761f96e44168] [Similarity score:             -0.0287858] Welcome to TechHub, your ultimate destination for cutting-edge technology and innovation! At Tech...
DEBUG:openai:message='Request to OpenAI API' method=post path=https://api.openai.com/v1/chat/completions
DEBUG:openai:api_version=None data='{"messages": [{"role": "system", "content": "Context information is below.\\n--------------------\\nWelcome to TechHub, your ultimate destination for cutting-edge technology and innovation! At TechHub, we pride ourselves on being a premier online store dedicated to providing a curated selection of the latest and greatest in tech gadgets, including laptops, smartphones, and more.\\n\\nAbout Us:\\n\\nAt the heart of TechHub is a passion for technology and a commitment to delivering top-notch products that seamlessly blend style, functionality, and performance. With a team of tech enthusiasts, we understand the ever-evolving nature of the digital landscape and strive to stay at the forefront of the latest trends and advancements.\\n\\nOur Mission:\\n\\nOur mission at TechHub is to empower our customers with the best tools and devices that enhance their digital lifestyle. Whether you\'re a professional looking for a high-performance laptop to boost productivity or a smartphone aficionado seeking the latest flagship model, we\'ve got you covered. We believe that technology should not only meet but exceed your expectations, making every interaction with your devices a seamless and enjoyable experience.\\n\\nQuality Assurance:\\n\\nTechHub is committed to delivering products of the highest quality. We carefully curate our inventory, partnering with leading brands known for their commitment to excellence. Each product undergoes rigorous testing to ensure reliability, durability, and top-notch performance. Our dedication to quality assurance is reflected in every item we offer.\\n\\nCustomer-Centric Approach:\\n\\nAt TechHub, our customers are at the core of everything we do. We prioritize your satisfaction and strive to provide an unparalleled shopping experience. Our customer support team is ready to assist you at every step, from product inquiries to after-sales support. We value your feedback and continuously work to improve our services based on your needs.\\n\\nSecure Shopping:\\n\\nYour online security is our priority. TechHub employs state-of-the-art encryption technology to ensure that your personal information remains secure and protected. Shop with confidence, knowing that your data is in safe hands.\\n\\nExplore the world of innovation at TechHub, where technology meets lifestyle. Discover the perfect blend of style and functionality with our carefully curated selection of laptops, smartphones, and other cutting-edge gadgets. Join us on this exciting journey, and let\'s embrace the future together!\\n--------------------\\n\\u0412\\u044b \\u2014 \\u0418\\u0418 \\u0430\\u0441\\u0441\\u0438\\u0441\\u0442\\u0435\\u043d\\u0442 \\u043a\\u043e\\u043c\\u043f\\u0430\\u043d\\u0438\\u0438. \\u0412\\u0430\\u043c \\u0431\\u0443\\u0434\\u0443\\u0442 \\u0437\\u0430\\u0434\\u0430\\u043d\\u044b \\u0432\\u043e\\u043f\\u0440\\u043e\\u0441\\u044b \\u043e \\u043d\\u0430\\u0448\\u0435\\u0439 \\u043a\\u043e\\u043c\\u043f\\u0430\\u043d\\u0438\\u0438. \\u0412\\u0435\\u0436\\u043b\\u0438\\u0432\\u043e \\u043e\\u0442\\u0432\\u0435\\u0447\\u0430\\u0439\\u0442\\u0435 \\u043d\\u0430 \\u0432\\u043e\\u043f\\u0440\\u043e\\u0441\\u044b.\\r\\n    \\u041d\\u0438\\u0436\\u0435 \\u043c\\u044b \\u043f\\u0440\\u0435\\u0434\\u043e\\u0441\\u0442\\u0430\\u0432\\u0438\\u043b\\u0438 \\u043a\\u043e\\u043d\\u0442\\u0435\\u043a\\u0441\\u0442\\u043d\\u0443\\u044e \\u0438\\u043d\\u0444\\u043e\\u0440\\u043c\\u0430\\u0446\\u0438\\u044e.\\r\\n    ---------------------\\r\\n    {context_str}\\r\\n    ---------------------\\r\\n    \\u0423\\u0447\\u0438\\u0442\\u044b\\u0432\\u0430\\u044f \\u044d\\u0442\\u0443 \\u0438\\u043d\\u0444\\u043e\\u0440\\u043c\\u0430\\u0446\\u0438\\u044e, \\u043e\\u0442\\u0432\\u0435\\u0442\\u044c\\u0442\\u0435, \\u043f\\u043e\\u0436\\u0430\\u043b\\u0443\\u0439\\u0441\\u0442\\u0430, \\u043d\\u0430 \\u0432\\u043e\\u043f\\u0440\\u043e\\u0441: {query_str}\\r\\n    . \\n Information about relative products [{\\"id\\":17,\\"title\\":\\"Xiaomi 13\\",\\"content\\":\\"<ul class=\\\\\\"a-unordered-list a-vertical a-spacing-mini\\\\\\">\\\\r\\\\n \\\\t<li class=\\\\\\"a-spacing-mini\\\\\\"><span class=\\\\\\"a-list-item\\\\\\">Ultra-immersive display design Light up the screen to enjoy an unrivalled experience. The 1.61mm ultra-thin bezels offer a boundless vision.<\\\\/span><\\\\/li>\\\\r\\\\n \\\\t<li class=\\\\\\"a-spacing-mini\\\\\\"><span class=\\\\\\"a-list-item\\\\\\">Built for more scenarios IP68 water and dust resistant* Born splash-proof and water-resistant, thanks to the precision manufacturing. Record special memories anytime and anywhere.<\\\\/span><\\\\/li>\\\\r\\\\n \\\\t<li class=\\\\\\"a-spacing-mini\\\\\\"><span class=\\\\\\"a-list-item\\\\\\">Leica main camera with professional optical lens Captures every great moment<\\\\/span><\\\\/li>\\\\r\\\\n \\\\t<li class=\\\\\\"a-spacing-mini\\\\\\"><span class=\\\\\\"a-list-item\\\\\\">Masterpiece performance Leading Snapdragon 8 Gen 2 Boosted performance, reduced consumption<\\\\/span><\\\\/li>\\\\r\\\\n<\\\\/ul>\\",\\"date\\":\\"27.12.2023\\",\\"attributes\\":{\\"pa_color\\":[\\"silver\\"]},\\"stock\\":null,\\"image_url\\":false,\\"sku\\":\\"141234\\",\\"price\\":\\"16000\\",\\"formatted_price\\":\\"<span class=\\\\\\"woocommerce-Price-amount amount\\\\\\"><bdi>16000,00&nbsp;<span class=\\\\\\"woocommerce-Price-currencySymbol\\\\\\">&#8381;<\\\\/span><\\\\/bdi><\\\\/span>\\",\\"product_link\\":\\"http:\\\\/\\\\/wordpress\\\\/product\\\\/%d0%ba%d1%80%d0%be%d1%81%d1%81%d0%be%d0%b2%d0%ba%d0%b8\\\\/\\"}]"}, {"role": "user", "content": "do you have xiaomi 12?"}], "stream": false, "model": "gpt-3.5-turbo", "temperature": 0, "max_tokens": null}' message='Post details'
DEBUG:urllib3.connectionpool:https://api.openai.com:443 "POST /v1/chat/completions HTTP/1.1" 200 None
DEBUG:openai:message='OpenAI API response' path=https://api.openai.com/v1/chat/completions processing_ms=2960 request_id=ccebbe3f9279e55b82a2b21552deccd0 response_code=200
INFO:myapp:{'api': 1, 'product_data': '{"attributes": "color", "categories": "misc,smartphones"}', 'website': 'asdf', 'id': 4, 'left_tokens': 18203, 'description': None, 'temperature': Decimal('0.00'), 'model': 'gpt-3.5-turbo', 'prompt': 'Вы — ИИ ассистент компании. Вам будут заданы вопросы о нашей компании. Вежливо отвечайте на вопросы.\r\n    Ниже мы предоставили контекстную информацию.\r\n    ---------------------\r\n    {context_str}\r\n    ---------------------\r\n    Учитывая эту информацию, ответьте, пожалуйста, на вопрос: {query_str}\r\n    ', 'response_mode': 'compact', 'user_id': 12, 'answer': 'Client: hi mr AI, do you have xiaomi 13 in your store?,\nAi response: Yes, we do have the Xiaomi 13 available in our store. It features an ultra-immersive display design with thin bezels, making for a boundless visual experience. It is also IP68 water and dust resistant, allowing you to capture special memories anytime and anywhere. The Xiaomi 13 is equipped with a Leica main camera with a professional optical lens, ensuring that you can capture every great moment. Additionally, it boasts a powerful performance with the Snapdragon 8 Gen 2 processor. The price for the Xiaomi 13 is 16,000 rubles. You can find more information and make a purchase on our website: [Xiaomi 13 Product Link](http://wordpress/product/кроссовки/)', 'context': '[{"id":17,"title":"Xiaomi 13","content":"<ul class=\\"a-unordered-list a-vertical a-spacing-mini\\">\\r\\n \\t<li class=\\"a-spacing-mini\\"><span class=\\"a-list-item\\">Ultra-immersive display design Light up the screen to enjoy an unrivalled experience. The 1.61mm ultra-thin bezels offer a boundless vision.<\\/span><\\/li>\\r\\n \\t<li class=\\"a-spacing-mini\\"><span class=\\"a-list-item\\">Built for more scenarios IP68 water and dust resistant* Born splash-proof and water-resistant, thanks to the precision manufacturing. Record special memories anytime and anywhere.<\\/span><\\/li>\\r\\n \\t<li class=\\"a-spacing-mini\\"><span class=\\"a-list-item\\">Leica main camera with professional optical lens Captures every great moment<\\/span><\\/li>\\r\\n \\t<li class=\\"a-spacing-mini\\"><span class=\\"a-list-item\\">Masterpiece performance Leading Snapdragon 8 Gen 2 Boosted performance, reduced consumption<\\/span><\\/li>\\r\\n<\\/ul>","date":"27.12.2023","attributes":{"pa_color":["silver"]},"stock":null,"image_url":false,"sku":"141234","price":"16000","formatted_price":"<span class=\\"woocommerce-Price-amount amount\\"><bdi>16000,00&nbsp;<span class=\\"woocommerce-Price-currencySymbol\\">&#8381;<\\/span><\\/bdi><\\/span>","product_link":"http:\\/\\/wordpress\\/product\\/%d0%ba%d1%80%d0%be%d1%81%d1%81%d0%be%d0%b2%d0%ba%d0%b8\\/"}]'}
INFO:werkzeug:127.0.0.1 - - [31/Dec/2023 22:42:35] "POST /projects/e47f0f811145d03c33fd6639dc3f09c0839d0891e264d849a75df04f4d047625/W7acu7ydsH5uKBbWwdZYMDMDNJlsYFX4 HTTP/1.1" 200 -
DEBUG:root:This is a debug message
DEBUG:celery.utils.functional:
def unlock_chord(self, group_id, callback, interval=0, max_retries=1, result=2, Result=3, GroupResult=4, result_from_tuple=5, **kwargs):
    return 1

DEBUG:celery.utils.functional:
def sendEmbeddingRequest(user_id, total_tokens):
    return 1

DEBUG:celery.utils.functional:
def group(self, tasks, result, group_id, partial_args, add_to_parent=0):
    return 1

DEBUG:celery.utils.functional:
def xmap(task, it):
    return 1

DEBUG:celery.utils.functional:
def backend_cleanup():
    return 1

DEBUG:celery.utils.functional:
def chain(*args, **kwargs):
    return 1

DEBUG:celery.utils.functional:
def send_chat_request(user_id, project_id, session, total_tokens, answer, context):
    return 1

DEBUG:celery.utils.functional:
def xstarmap(task, it):
    return 1

DEBUG:celery.utils.functional:
def accumulate(self, *args, **kwargs):
    return 1

DEBUG:celery.utils.functional:
def set_vector_index_task(self, token):
    return 1

DEBUG:celery.utils.functional:
def process_set_vector_index(self, token, task_id):
    return 1

DEBUG:celery.utils.functional:
def chord(self, header, body, partial_args=0, interval=1, countdown=2, max_retries=3, eager=4, **kwargs):
    return 1

DEBUG:celery.utils.functional:
def chunks(task, it, n):
    return 1

DEBUG:myapp:Flask app started
INFO:werkzeug:[31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:5000
INFO:werkzeug:[33mPress CTRL+C to quit[0m
INFO:werkzeug:127.0.0.1 - - [31/Dec/2023 22:47:29] "GET /files/e47f0f811145d03c33fd6639dc3f09c0839d0891e264d849a75df04f4d047625 HTTP/1.1" 200 -
INFO:werkzeug:127.0.0.1 - - [31/Dec/2023 22:47:40] "OPTIONS /projects/e47f0f811145d03c33fd6639dc3f09c0839d0891e264d849a75df04f4d047625/ToCR7RzWmGrroelgFqB01NTcQGdADPp4 HTTP/1.1" 200 -
INFO:myapp:{'api': 1, 'product_data': '{"attributes": "color", "categories": "misc,smartphones"}', 'website': 'asdf', 'id': 4, 'left_tokens': 17191, 'description': None, 'temperature': Decimal('0.00'), 'model': 'gpt-3.5-turbo', 'prompt': 'Вы — ИИ ассистент компании. Вам будут заданы вопросы о нашей компании. Вежливо отвечайте на вопросы.\r\n    Ниже мы предоставили контекстную информацию.\r\n    ---------------------\r\n    {context_str}\r\n    ---------------------\r\n    Учитывая эту информацию, ответьте, пожалуйста, на вопрос: {query_str}\r\n    ', 'response_mode': 'compact', 'user_id': 12, 'answer': None, 'context': None}
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.openai.com:443
DEBUG:urllib3.connectionpool:https://api.openai.com:443 "POST /v1/chat/completions HTTP/1.1" 200 None
INFO:myapp:[{'url_params': 'product_name=xiaomi 13', 'is_related': 'yes', 'category': 'smartphones'}]
INFO:myapp:product_name=xiaomi 13
INFO:myapp:prompt
INFO:myapp:You are AI assistant for a online shop. You should determine if a client is asking information about a product in our store. It can be a question about price, availability in stock, product characteristic, comparing 2 products. In this case you should contruct query parameters based on a client question. Construct them for every mentioned product. Add sort_price parameter if required .For example product_name=item_name&color=green&size=44&sort_price=desc|asc List of available query parameters: product_name, color product_name is a required parameter. You should use it in every query.Use only these query parameters for consructing. Add a category. List of available categories: misc,smartphones. Write your asnwer as array of json objects. [{url_params: <url_here>, is_related: 'yes', category: <category_here> }] If the question is not related to products of the store, then your answer would be [{is_related: 'no'}] Be strict. Fix typos in product names. Dont write anything else. Your answer will be used for a next query. Client question: hi mr AI, do you have xiaomi 13 in your store? .Your answer:
DEBUG:urllib3.connectionpool:Starting new HTTP connection (1): wordpress:80
DEBUG:urllib3.connectionpool:http://wordpress:80 "GET /wp-json/chatty/v1/posts?product_name=xiaomi+13 HTTP/1.1" 200 1298
INFO:myapp:api data [{"id":17,"title":"Xiaomi 13","content":"<ul class=\"a-unordered-list a-vertical a-spacing-mini\">\r\n \t<li class=\"a-spacing-mini\"><span class=\"a-list-item\">Ultra-immersive display design Light up the screen to enjoy an unrivalled experience. The 1.61mm ultra-thin bezels offer a boundless vision.<\/span><\/li>\r\n \t<li class=\"a-spacing-mini\"><span class=\"a-list-item\">Built for more scenarios IP68 water and dust resistant* Born splash-proof and water-resistant, thanks to the precision manufacturing. Record special memories anytime and anywhere.<\/span><\/li>\r\n \t<li class=\"a-spacing-mini\"><span class=\"a-list-item\">Leica main camera with professional optical lens Captures every great moment<\/span><\/li>\r\n \t<li class=\"a-spacing-mini\"><span class=\"a-list-item\">Masterpiece performance Leading Snapdragon 8 Gen 2 Boosted performance, reduced consumption<\/span><\/li>\r\n<\/ul>","date":"27.12.2023","attributes":{"pa_color":["silver"]},"stock":null,"image_url":false,"sku":"141234","price":"16000","formatted_price":"<span class=\"woocommerce-Price-amount amount\"><bdi>16000,00&nbsp;<span class=\"woocommerce-Price-currencySymbol\">&#8381;<\/span><\/bdi><\/span>","product_link":"http:\/\/wordpress\/product\/%d0%ba%d1%80%d0%be%d1%81%d1%81%d0%be%d0%b2%d0%ba%d0%b8\/"}]
DEBUG:llama_index.storage.kvstore.simple_kvstore:Loading llama_index.storage.kvstore.simple_kvstore from projects/4/data\docstore.json.
DEBUG:fsspec.local:open file: C:/OSPanel/domains/ai_assistant/api/projects/4/data/docstore.json
DEBUG:llama_index.storage.kvstore.simple_kvstore:Loading llama_index.storage.kvstore.simple_kvstore from projects/4/data\index_store.json.
DEBUG:fsspec.local:open file: C:/OSPanel/domains/ai_assistant/api/projects/4/data/index_store.json
DEBUG:llama_index.vector_stores.simple:Loading llama_index.vector_stores.simple from projects/4/data\vector_store.json.
DEBUG:fsspec.local:open file: C:/OSPanel/domains/ai_assistant/api/projects/4/data/vector_store.json
DEBUG:llama_index.graph_stores.simple:Loading llama_index.graph_stores.simple from projects/4/data\graph_store.json.
DEBUG:fsspec.local:open file: C:/OSPanel/domains/ai_assistant/api/projects/4/data/graph_store.json
ERROR:myapp:Exception on /projects/e47f0f811145d03c33fd6639dc3f09c0839d0891e264d849a75df04f4d047625/ToCR7RzWmGrroelgFqB01NTcQGdADPp4 [POST]
Traceback (most recent call last):
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\flask\app.py", line 2190, in wsgi_app
    response = self.full_dispatch_request()
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\flask\app.py", line 1486, in full_dispatch_request
    rv = self.handle_user_exception(e)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\flask_cors\extension.py", line 176, in wrapped_function
    return cors_after_request(app.make_response(f(*args, **kwargs)))
                                                ^^^^^^^^^^^^^^^^^^
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\flask_cors\extension.py", line 176, in wrapped_function
    return cors_after_request(app.make_response(f(*args, **kwargs)))
                                                ^^^^^^^^^^^^^^^^^^
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\flask\app.py", line 1484, in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\flask\app.py", line 1469, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\OSPanel\domains\ai_assistant\api\myapp.py", line 344, in get_project_details
    context = project.get('context') if project.get('context') + product_response is not None else product_response
                                        ~~~~~~~~~~~~~~~~~~~~~~~^~~~~~~~~~~~~~~~~~
TypeError: unsupported operand type(s) for +: 'NoneType' and 'str'
INFO:werkzeug:127.0.0.1 - - [31/Dec/2023 22:48:11] "[35m[1mPOST /projects/e47f0f811145d03c33fd6639dc3f09c0839d0891e264d849a75df04f4d047625/ToCR7RzWmGrroelgFqB01NTcQGdADPp4 HTTP/1.1[0m" 500 -
DEBUG:root:This is a debug message
DEBUG:celery.utils.functional:
def unlock_chord(self, group_id, callback, interval=0, max_retries=1, result=2, Result=3, GroupResult=4, result_from_tuple=5, **kwargs):
    return 1

DEBUG:celery.utils.functional:
def group(self, tasks, result, group_id, partial_args, add_to_parent=0):
    return 1

DEBUG:celery.utils.functional:
def send_chat_request(user_id, project_id, session, total_tokens, answer, context):
    return 1

DEBUG:celery.utils.functional:
def xmap(task, it):
    return 1

DEBUG:celery.utils.functional:
def sendEmbeddingRequest(user_id, total_tokens):
    return 1

DEBUG:celery.utils.functional:
def backend_cleanup():
    return 1

DEBUG:celery.utils.functional:
def set_vector_index_task(self, token):
    return 1

DEBUG:celery.utils.functional:
def process_set_vector_index(self, token, task_id):
    return 1

DEBUG:celery.utils.functional:
def chain(*args, **kwargs):
    return 1

DEBUG:celery.utils.functional:
def xstarmap(task, it):
    return 1

DEBUG:celery.utils.functional:
def accumulate(self, *args, **kwargs):
    return 1

DEBUG:celery.utils.functional:
def chord(self, header, body, partial_args=0, interval=1, countdown=2, max_retries=3, eager=4, **kwargs):
    return 1

DEBUG:celery.utils.functional:
def chunks(task, it, n):
    return 1

DEBUG:myapp:Flask app started
INFO:werkzeug:[31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:5000
INFO:werkzeug:[33mPress CTRL+C to quit[0m
INFO:werkzeug:127.0.0.1 - - [31/Dec/2023 22:52:59] "GET /files/e47f0f811145d03c33fd6639dc3f09c0839d0891e264d849a75df04f4d047625 HTTP/1.1" 200 -
INFO:werkzeug:127.0.0.1 - - [31/Dec/2023 22:53:02] "OPTIONS /projects/e47f0f811145d03c33fd6639dc3f09c0839d0891e264d849a75df04f4d047625/V8j3dcWD9tWYF3IvUzk9qJzWg0ng4AP3 HTTP/1.1" 200 -
INFO:myapp:{'api': 1, 'product_data': '{"attributes": "color", "categories": "misc,smartphones"}', 'website': 'asdf', 'id': 4, 'left_tokens': 17191, 'description': None, 'temperature': Decimal('0.00'), 'model': 'gpt-3.5-turbo', 'prompt': 'Вы — ИИ ассистент компании. Вам будут заданы вопросы о нашей компании. Вежливо отвечайте на вопросы.\r\n    Ниже мы предоставили контекстную информацию.\r\n    ---------------------\r\n    {context_str}\r\n    ---------------------\r\n    Учитывая эту информацию, ответьте, пожалуйста, на вопрос: {query_str}\r\n    ', 'response_mode': 'compact', 'user_id': 12, 'answer': None, 'context': None}
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.openai.com:443
DEBUG:urllib3.connectionpool:https://api.openai.com:443 "POST /v1/chat/completions HTTP/1.1" 200 None
INFO:myapp:[{'url_params': 'product_name=xiaomi 13', 'is_related': 'yes', 'category': 'smartphones'}]
INFO:myapp:product_name=xiaomi 13
INFO:myapp:prompt
INFO:myapp:You are AI assistant for a online shop. You should determine if a client is asking information about a product in our store. It can be a question about price, availability in stock, product characteristic, comparing 2 products. In this case you should contruct query parameters based on a client question. Construct them for every mentioned product. Add sort_price parameter if required .For example product_name=item_name&color=green&size=44&sort_price=desc|asc List of available query parameters: product_name, color product_name is a required parameter. You should use it in every query.Use only these query parameters for consructing. Add a category. List of available categories: misc,smartphones. Write your asnwer as array of json objects. [{url_params: <url_here>, is_related: 'yes', category: <category_here> }] If the question is not related to products of the store, then your answer would be [{is_related: 'no'}] Be strict. Fix typos in product names. Dont write anything else. Your answer will be used for a next query. Client question: hi mr AI, do you have xiaomi 13 in your store? .Your answer:
DEBUG:urllib3.connectionpool:Starting new HTTP connection (1): wordpress:80
DEBUG:urllib3.connectionpool:http://wordpress:80 "GET /wp-json/chatty/v1/posts?product_name=xiaomi+13 HTTP/1.1" 200 1298
INFO:myapp:api data [{"id":17,"title":"Xiaomi 13","content":"<ul class=\"a-unordered-list a-vertical a-spacing-mini\">\r\n \t<li class=\"a-spacing-mini\"><span class=\"a-list-item\">Ultra-immersive display design Light up the screen to enjoy an unrivalled experience. The 1.61mm ultra-thin bezels offer a boundless vision.<\/span><\/li>\r\n \t<li class=\"a-spacing-mini\"><span class=\"a-list-item\">Built for more scenarios IP68 water and dust resistant* Born splash-proof and water-resistant, thanks to the precision manufacturing. Record special memories anytime and anywhere.<\/span><\/li>\r\n \t<li class=\"a-spacing-mini\"><span class=\"a-list-item\">Leica main camera with professional optical lens Captures every great moment<\/span><\/li>\r\n \t<li class=\"a-spacing-mini\"><span class=\"a-list-item\">Masterpiece performance Leading Snapdragon 8 Gen 2 Boosted performance, reduced consumption<\/span><\/li>\r\n<\/ul>","date":"27.12.2023","attributes":{"pa_color":["silver"]},"stock":null,"image_url":false,"sku":"141234","price":"16000","formatted_price":"<span class=\"woocommerce-Price-amount amount\"><bdi>16000,00&nbsp;<span class=\"woocommerce-Price-currencySymbol\">&#8381;<\/span><\/bdi><\/span>","product_link":"http:\/\/wordpress\/product\/%d0%ba%d1%80%d0%be%d1%81%d1%81%d0%be%d0%b2%d0%ba%d0%b8\/"}]
DEBUG:llama_index.storage.kvstore.simple_kvstore:Loading llama_index.storage.kvstore.simple_kvstore from projects/4/data\docstore.json.
DEBUG:fsspec.local:open file: C:/OSPanel/domains/ai_assistant/api/projects/4/data/docstore.json
DEBUG:llama_index.storage.kvstore.simple_kvstore:Loading llama_index.storage.kvstore.simple_kvstore from projects/4/data\index_store.json.
DEBUG:fsspec.local:open file: C:/OSPanel/domains/ai_assistant/api/projects/4/data/index_store.json
DEBUG:llama_index.vector_stores.simple:Loading llama_index.vector_stores.simple from projects/4/data\vector_store.json.
DEBUG:fsspec.local:open file: C:/OSPanel/domains/ai_assistant/api/projects/4/data/vector_store.json
DEBUG:llama_index.graph_stores.simple:Loading llama_index.graph_stores.simple from projects/4/data\graph_store.json.
DEBUG:fsspec.local:open file: C:/OSPanel/domains/ai_assistant/api/projects/4/data/graph_store.json
INFO:llama_index.indices.loading:Loading indices with ids: ['vector_index']
DEBUG:openai:message='Request to OpenAI API' method=post path=https://api.openai.com/v1/embeddings
DEBUG:openai:api_version=None data='{"input": ["hi mr AI, do you have xiaomi 13 in your store?"], "model": "text-embedding-ada-002", "encoding_format": "base64"}' message='Post details'
DEBUG:urllib3.util.retry:Converted retries value: 2 -> Retry(total=2, connect=None, read=None, redirect=None, status=None)
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.openai.com:443
DEBUG:urllib3.connectionpool:https://api.openai.com:443 "POST /v1/embeddings HTTP/1.1" 200 None
DEBUG:openai:message='OpenAI API response' path=https://api.openai.com/v1/embeddings processing_ms=18 request_id=91fd59b5f83d2b6b1a9f20419801ace8 response_code=200
DEBUG:llama_index.indices.utils:> Top 1 nodes:
> [Node 909c5dd5-e87e-4999-a794-761f96e44168] [Similarity score:             -0.0284745] Welcome to TechHub, your ultimate destination for cutting-edge technology and innovation! At Tech...
DEBUG:openai:message='Request to OpenAI API' method=post path=https://api.openai.com/v1/chat/completions
DEBUG:openai:api_version=None data='{"messages": [{"role": "system", "content": "Context information is below.\\n--------------------\\nWelcome to TechHub, your ultimate destination for cutting-edge technology and innovation! At TechHub, we pride ourselves on being a premier online store dedicated to providing a curated selection of the latest and greatest in tech gadgets, including laptops, smartphones, and more.\\n\\nAbout Us:\\n\\nAt the heart of TechHub is a passion for technology and a commitment to delivering top-notch products that seamlessly blend style, functionality, and performance. With a team of tech enthusiasts, we understand the ever-evolving nature of the digital landscape and strive to stay at the forefront of the latest trends and advancements.\\n\\nOur Mission:\\n\\nOur mission at TechHub is to empower our customers with the best tools and devices that enhance their digital lifestyle. Whether you\'re a professional looking for a high-performance laptop to boost productivity or a smartphone aficionado seeking the latest flagship model, we\'ve got you covered. We believe that technology should not only meet but exceed your expectations, making every interaction with your devices a seamless and enjoyable experience.\\n\\nQuality Assurance:\\n\\nTechHub is committed to delivering products of the highest quality. We carefully curate our inventory, partnering with leading brands known for their commitment to excellence. Each product undergoes rigorous testing to ensure reliability, durability, and top-notch performance. Our dedication to quality assurance is reflected in every item we offer.\\n\\nCustomer-Centric Approach:\\n\\nAt TechHub, our customers are at the core of everything we do. We prioritize your satisfaction and strive to provide an unparalleled shopping experience. Our customer support team is ready to assist you at every step, from product inquiries to after-sales support. We value your feedback and continuously work to improve our services based on your needs.\\n\\nSecure Shopping:\\n\\nYour online security is our priority. TechHub employs state-of-the-art encryption technology to ensure that your personal information remains secure and protected. Shop with confidence, knowing that your data is in safe hands.\\n\\nExplore the world of innovation at TechHub, where technology meets lifestyle. Discover the perfect blend of style and functionality with our carefully curated selection of laptops, smartphones, and other cutting-edge gadgets. Join us on this exciting journey, and let\'s embrace the future together!\\n--------------------\\n\\u0412\\u044b \\u2014 \\u0418\\u0418 \\u0430\\u0441\\u0441\\u0438\\u0441\\u0442\\u0435\\u043d\\u0442 \\u043a\\u043e\\u043c\\u043f\\u0430\\u043d\\u0438\\u0438. \\u0412\\u0430\\u043c \\u0431\\u0443\\u0434\\u0443\\u0442 \\u0437\\u0430\\u0434\\u0430\\u043d\\u044b \\u0432\\u043e\\u043f\\u0440\\u043e\\u0441\\u044b \\u043e \\u043d\\u0430\\u0448\\u0435\\u0439 \\u043a\\u043e\\u043c\\u043f\\u0430\\u043d\\u0438\\u0438. \\u0412\\u0435\\u0436\\u043b\\u0438\\u0432\\u043e \\u043e\\u0442\\u0432\\u0435\\u0447\\u0430\\u0439\\u0442\\u0435 \\u043d\\u0430 \\u0432\\u043e\\u043f\\u0440\\u043e\\u0441\\u044b.\\r\\n    \\u041d\\u0438\\u0436\\u0435 \\u043c\\u044b \\u043f\\u0440\\u0435\\u0434\\u043e\\u0441\\u0442\\u0430\\u0432\\u0438\\u043b\\u0438 \\u043a\\u043e\\u043d\\u0442\\u0435\\u043a\\u0441\\u0442\\u043d\\u0443\\u044e \\u0438\\u043d\\u0444\\u043e\\u0440\\u043c\\u0430\\u0446\\u0438\\u044e.\\r\\n    ---------------------\\r\\n    {context_str}\\r\\n    ---------------------\\r\\n    \\u0423\\u0447\\u0438\\u0442\\u044b\\u0432\\u0430\\u044f \\u044d\\u0442\\u0443 \\u0438\\u043d\\u0444\\u043e\\u0440\\u043c\\u0430\\u0446\\u0438\\u044e, \\u043e\\u0442\\u0432\\u0435\\u0442\\u044c\\u0442\\u0435, \\u043f\\u043e\\u0436\\u0430\\u043b\\u0443\\u0439\\u0441\\u0442\\u0430, \\u043d\\u0430 \\u0432\\u043e\\u043f\\u0440\\u043e\\u0441: {query_str}\\r\\n    . \\n Information about relative products [{\\"id\\":17,\\"title\\":\\"Xiaomi 13\\",\\"content\\":\\"<ul class=\\\\\\"a-unordered-list a-vertical a-spacing-mini\\\\\\">\\\\r\\\\n \\\\t<li class=\\\\\\"a-spacing-mini\\\\\\"><span class=\\\\\\"a-list-item\\\\\\">Ultra-immersive display design Light up the screen to enjoy an unrivalled experience. The 1.61mm ultra-thin bezels offer a boundless vision.<\\\\/span><\\\\/li>\\\\r\\\\n \\\\t<li class=\\\\\\"a-spacing-mini\\\\\\"><span class=\\\\\\"a-list-item\\\\\\">Built for more scenarios IP68 water and dust resistant* Born splash-proof and water-resistant, thanks to the precision manufacturing. Record special memories anytime and anywhere.<\\\\/span><\\\\/li>\\\\r\\\\n \\\\t<li class=\\\\\\"a-spacing-mini\\\\\\"><span class=\\\\\\"a-list-item\\\\\\">Leica main camera with professional optical lens Captures every great moment<\\\\/span><\\\\/li>\\\\r\\\\n \\\\t<li class=\\\\\\"a-spacing-mini\\\\\\"><span class=\\\\\\"a-list-item\\\\\\">Masterpiece performance Leading Snapdragon 8 Gen 2 Boosted performance, reduced consumption<\\\\/span><\\\\/li>\\\\r\\\\n<\\\\/ul>\\",\\"date\\":\\"27.12.2023\\",\\"attributes\\":{\\"pa_color\\":[\\"silver\\"]},\\"stock\\":null,\\"image_url\\":false,\\"sku\\":\\"141234\\",\\"price\\":\\"16000\\",\\"formatted_price\\":\\"<span class=\\\\\\"woocommerce-Price-amount amount\\\\\\"><bdi>16000,00&nbsp;<span class=\\\\\\"woocommerce-Price-currencySymbol\\\\\\">&#8381;<\\\\/span><\\\\/bdi><\\\\/span>\\",\\"product_link\\":\\"http:\\\\/\\\\/wordpress\\\\/product\\\\/%d0%ba%d1%80%d0%be%d1%81%d1%81%d0%be%d0%b2%d0%ba%d0%b8\\\\/\\"}]"}, {"role": "user", "content": "hi mr AI, do you have xiaomi 13 in your store?"}], "stream": false, "model": "gpt-3.5-turbo", "temperature": 0, "max_tokens": null}' message='Post details'
DEBUG:urllib3.connectionpool:https://api.openai.com:443 "POST /v1/chat/completions HTTP/1.1" 200 None
DEBUG:openai:message='OpenAI API response' path=https://api.openai.com/v1/chat/completions processing_ms=5170 request_id=a001a5aa4250bcaf07b8cb855a79e35e response_code=200
INFO:myapp:{'api': 1, 'product_data': '{"attributes": "color", "categories": "misc,smartphones"}', 'website': 'asdf', 'id': 4, 'left_tokens': 17191, 'description': None, 'temperature': Decimal('0.00'), 'model': 'gpt-3.5-turbo', 'prompt': 'Вы — ИИ ассистент компании. Вам будут заданы вопросы о нашей компании. Вежливо отвечайте на вопросы.\r\n    Ниже мы предоставили контекстную информацию.\r\n    ---------------------\r\n    {context_str}\r\n    ---------------------\r\n    Учитывая эту информацию, ответьте, пожалуйста, на вопрос: {query_str}\r\n    ', 'response_mode': 'compact', 'user_id': 12, 'answer': None, 'context': None}
DEBUG:root:This is a debug message
DEBUG:celery.utils.functional:
def send_chat_request(user_id, project_id, session, total_tokens, answer, context):
    return 1

INFO:werkzeug:127.0.0.1 - - [31/Dec/2023 22:53:12] "POST /projects/e47f0f811145d03c33fd6639dc3f09c0839d0891e264d849a75df04f4d047625/V8j3dcWD9tWYF3IvUzk9qJzWg0ng4AP3 HTTP/1.1" 200 -
INFO:werkzeug:127.0.0.1 - - [31/Dec/2023 22:53:26] "OPTIONS /projects/e47f0f811145d03c33fd6639dc3f09c0839d0891e264d849a75df04f4d047625/V8j3dcWD9tWYF3IvUzk9qJzWg0ng4AP3 HTTP/1.1" 200 -
INFO:myapp:{'api': 1, 'product_data': '{"attributes": "color", "categories": "misc,smartphones"}', 'website': 'asdf', 'id': 4, 'left_tokens': 16111, 'description': None, 'temperature': Decimal('0.00'), 'model': 'gpt-3.5-turbo', 'prompt': 'Вы — ИИ ассистент компании. Вам будут заданы вопросы о нашей компании. Вежливо отвечайте на вопросы.\r\n    Ниже мы предоставили контекстную информацию.\r\n    ---------------------\r\n    {context_str}\r\n    ---------------------\r\n    Учитывая эту информацию, ответьте, пожалуйста, на вопрос: {query_str}\r\n    ', 'response_mode': 'compact', 'user_id': 12, 'answer': 'Client: hi mr AI, do you have xiaomi 13 in your store?,\nAi response: Yes, we do have the Xiaomi 13 available in our store. It features an ultra-immersive display design with thin bezels, making for a boundless visual experience. It is also IP68 water and dust resistant, allowing you to capture special memories anytime and anywhere. The Xiaomi 13 is equipped with a Leica main camera with a professional optical lens, ensuring that you can capture every great moment. Additionally, it boasts a powerful performance with the Snapdragon 8 Gen 2 processor. The price for the Xiaomi 13 is 16,000 rubles. You can find more information and make a purchase on our website: [Xiaomi 13 Product Link](http://wordpress/product/кроссовки/)', 'context': '[{"id":17,"title":"Xiaomi 13","content":"<ul class=\\"a-unordered-list a-vertical a-spacing-mini\\">\\r\\n \\t<li class=\\"a-spacing-mini\\"><span class=\\"a-list-item\\">Ultra-immersive display design Light up the screen to enjoy an unrivalled experience. The 1.61mm ultra-thin bezels offer a boundless vision.<\\/span><\\/li>\\r\\n \\t<li class=\\"a-spacing-mini\\"><span class=\\"a-list-item\\">Built for more scenarios IP68 water and dust resistant* Born splash-proof and water-resistant, thanks to the precision manufacturing. Record special memories anytime and anywhere.<\\/span><\\/li>\\r\\n \\t<li class=\\"a-spacing-mini\\"><span class=\\"a-list-item\\">Leica main camera with professional optical lens Captures every great moment<\\/span><\\/li>\\r\\n \\t<li class=\\"a-spacing-mini\\"><span class=\\"a-list-item\\">Masterpiece performance Leading Snapdragon 8 Gen 2 Boosted performance, reduced consumption<\\/span><\\/li>\\r\\n<\\/ul>","date":"27.12.2023","attributes":{"pa_color":["silver"]},"stock":null,"image_url":false,"sku":"141234","price":"16000","formatted_price":"<span class=\\"woocommerce-Price-amount amount\\"><bdi>16000,00&nbsp;<span class=\\"woocommerce-Price-currencySymbol\\">&#8381;<\\/span><\\/bdi><\\/span>","product_link":"http:\\/\\/wordpress\\/product\\/%d0%ba%d1%80%d0%be%d1%81%d1%81%d0%be%d0%b2%d0%ba%d0%b8\\/"}]'}
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.openai.com:443
DEBUG:urllib3.connectionpool:https://api.openai.com:443 "POST /v1/chat/completions HTTP/1.1" 200 None
INFO:myapp:[{'url_params': 'product_name=xiaomi 12', 'is_related': 'yes', 'category': 'smartphones'}]
INFO:myapp:product_name=xiaomi 12
INFO:myapp:prompt
INFO:myapp:You are AI assistant for a online shop. You should determine if a client is asking information about a product in our store. It can be a question about price, availability in stock, product characteristic, comparing 2 products. In this case you should contruct query parameters based on a client question. Construct them for every mentioned product. Add sort_price parameter if required .For example product_name=item_name&color=green&size=44&sort_price=desc|asc List of available query parameters: product_name, color product_name is a required parameter. You should use it in every query.Use only these query parameters for consructing. Add a category. List of available categories: misc,smartphones. Write your asnwer as array of json objects. [{url_params: <url_here>, is_related: 'yes', category: <category_here> }] If the question is not related to products of the store, then your answer would be [{is_related: 'no'}] Be strict. Fix typos in product names. Dont write anything else. Your answer will be used for a next query. Client question: do you have xiaomi 12? .Your answer:
DEBUG:urllib3.connectionpool:Starting new HTTP connection (1): wordpress:80
DEBUG:urllib3.connectionpool:http://wordpress:80 "GET /wp-json/chatty/v1/posts?product_name=xiaomi+12 HTTP/1.1" 200 455
INFO:myapp:api data [{"id":20,"title":"Xiaomi Redmi 12 128GB &#8212; Black &#8212; Unlocked &#8212; Dual-SIM","content":"","date":"29.12.2023","attributes":{"pa_color":["black"]},"stock":null,"image_url":false,"sku":"141234-1","price":"15000","formatted_price":"<span class=\"woocommerce-Price-amount amount\"><bdi>15000,00&nbsp;<span class=\"woocommerce-Price-currencySymbol\">&#8381;<\/span><\/bdi><\/span>","product_link":"http:\/\/wordpress\/product\/xiaomi-12-black\/"}]
DEBUG:llama_index.storage.kvstore.simple_kvstore:Loading llama_index.storage.kvstore.simple_kvstore from projects/4/data\docstore.json.
DEBUG:fsspec.local:open file: C:/OSPanel/domains/ai_assistant/api/projects/4/data/docstore.json
DEBUG:llama_index.storage.kvstore.simple_kvstore:Loading llama_index.storage.kvstore.simple_kvstore from projects/4/data\index_store.json.
DEBUG:fsspec.local:open file: C:/OSPanel/domains/ai_assistant/api/projects/4/data/index_store.json
DEBUG:llama_index.vector_stores.simple:Loading llama_index.vector_stores.simple from projects/4/data\vector_store.json.
DEBUG:fsspec.local:open file: C:/OSPanel/domains/ai_assistant/api/projects/4/data/vector_store.json
DEBUG:llama_index.graph_stores.simple:Loading llama_index.graph_stores.simple from projects/4/data\graph_store.json.
DEBUG:fsspec.local:open file: C:/OSPanel/domains/ai_assistant/api/projects/4/data/graph_store.json
INFO:llama_index.indices.loading:Loading indices with ids: ['vector_index']
DEBUG:openai:message='Request to OpenAI API' method=post path=https://api.openai.com/v1/embeddings
DEBUG:openai:api_version=None data='{"input": ["do you have xiaomi 12?"], "model": "text-embedding-ada-002", "encoding_format": "base64"}' message='Post details'
DEBUG:urllib3.util.retry:Converted retries value: 2 -> Retry(total=2, connect=None, read=None, redirect=None, status=None)
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.openai.com:443
DEBUG:urllib3.connectionpool:https://api.openai.com:443 "POST /v1/embeddings HTTP/1.1" 200 None
DEBUG:openai:message='OpenAI API response' path=https://api.openai.com/v1/embeddings processing_ms=15 request_id=c6246dea944cc30e2154bfc90d5e85fb response_code=200
DEBUG:llama_index.indices.utils:> Top 1 nodes:
> [Node 909c5dd5-e87e-4999-a794-761f96e44168] [Similarity score:             -0.0287858] Welcome to TechHub, your ultimate destination for cutting-edge technology and innovation! At Tech...
DEBUG:openai:message='Request to OpenAI API' method=post path=https://api.openai.com/v1/chat/completions
DEBUG:openai:api_version=None data='{"messages": [{"role": "system", "content": "Context information is below.\\n--------------------\\nWelcome to TechHub, your ultimate destination for cutting-edge technology and innovation! At TechHub, we pride ourselves on being a premier online store dedicated to providing a curated selection of the latest and greatest in tech gadgets, including laptops, smartphones, and more.\\n\\nAbout Us:\\n\\nAt the heart of TechHub is a passion for technology and a commitment to delivering top-notch products that seamlessly blend style, functionality, and performance. With a team of tech enthusiasts, we understand the ever-evolving nature of the digital landscape and strive to stay at the forefront of the latest trends and advancements.\\n\\nOur Mission:\\n\\nOur mission at TechHub is to empower our customers with the best tools and devices that enhance their digital lifestyle. Whether you\'re a professional looking for a high-performance laptop to boost productivity or a smartphone aficionado seeking the latest flagship model, we\'ve got you covered. We believe that technology should not only meet but exceed your expectations, making every interaction with your devices a seamless and enjoyable experience.\\n\\nQuality Assurance:\\n\\nTechHub is committed to delivering products of the highest quality. We carefully curate our inventory, partnering with leading brands known for their commitment to excellence. Each product undergoes rigorous testing to ensure reliability, durability, and top-notch performance. Our dedication to quality assurance is reflected in every item we offer.\\n\\nCustomer-Centric Approach:\\n\\nAt TechHub, our customers are at the core of everything we do. We prioritize your satisfaction and strive to provide an unparalleled shopping experience. Our customer support team is ready to assist you at every step, from product inquiries to after-sales support. We value your feedback and continuously work to improve our services based on your needs.\\n\\nSecure Shopping:\\n\\nYour online security is our priority. TechHub employs state-of-the-art encryption technology to ensure that your personal information remains secure and protected. Shop with confidence, knowing that your data is in safe hands.\\n\\nExplore the world of innovation at TechHub, where technology meets lifestyle. Discover the perfect blend of style and functionality with our carefully curated selection of laptops, smartphones, and other cutting-edge gadgets. Join us on this exciting journey, and let\'s embrace the future together!\\n--------------------\\n\\u0412\\u044b \\u2014 \\u0418\\u0418 \\u0430\\u0441\\u0441\\u0438\\u0441\\u0442\\u0435\\u043d\\u0442 \\u043a\\u043e\\u043c\\u043f\\u0430\\u043d\\u0438\\u0438. \\u0412\\u0430\\u043c \\u0431\\u0443\\u0434\\u0443\\u0442 \\u0437\\u0430\\u0434\\u0430\\u043d\\u044b \\u0432\\u043e\\u043f\\u0440\\u043e\\u0441\\u044b \\u043e \\u043d\\u0430\\u0448\\u0435\\u0439 \\u043a\\u043e\\u043c\\u043f\\u0430\\u043d\\u0438\\u0438. \\u0412\\u0435\\u0436\\u043b\\u0438\\u0432\\u043e \\u043e\\u0442\\u0432\\u0435\\u0447\\u0430\\u0439\\u0442\\u0435 \\u043d\\u0430 \\u0432\\u043e\\u043f\\u0440\\u043e\\u0441\\u044b.\\r\\n    \\u041d\\u0438\\u0436\\u0435 \\u043c\\u044b \\u043f\\u0440\\u0435\\u0434\\u043e\\u0441\\u0442\\u0430\\u0432\\u0438\\u043b\\u0438 \\u043a\\u043e\\u043d\\u0442\\u0435\\u043a\\u0441\\u0442\\u043d\\u0443\\u044e \\u0438\\u043d\\u0444\\u043e\\u0440\\u043c\\u0430\\u0446\\u0438\\u044e.\\r\\n    ---------------------\\r\\n    {context_str}\\r\\n    ---------------------\\r\\n    \\u0423\\u0447\\u0438\\u0442\\u044b\\u0432\\u0430\\u044f \\u044d\\u0442\\u0443 \\u0438\\u043d\\u0444\\u043e\\u0440\\u043c\\u0430\\u0446\\u0438\\u044e, \\u043e\\u0442\\u0432\\u0435\\u0442\\u044c\\u0442\\u0435, \\u043f\\u043e\\u0436\\u0430\\u043b\\u0443\\u0439\\u0441\\u0442\\u0430, \\u043d\\u0430 \\u0432\\u043e\\u043f\\u0440\\u043e\\u0441: {query_str}\\r\\n    . \\n Information about relative products [{\\"id\\":17,\\"title\\":\\"Xiaomi 13\\",\\"content\\":\\"<ul class=\\\\\\"a-unordered-list a-vertical a-spacing-mini\\\\\\">\\\\r\\\\n \\\\t<li class=\\\\\\"a-spacing-mini\\\\\\"><span class=\\\\\\"a-list-item\\\\\\">Ultra-immersive display design Light up the screen to enjoy an unrivalled experience. The 1.61mm ultra-thin bezels offer a boundless vision.<\\\\/span><\\\\/li>\\\\r\\\\n \\\\t<li class=\\\\\\"a-spacing-mini\\\\\\"><span class=\\\\\\"a-list-item\\\\\\">Built for more scenarios IP68 water and dust resistant* Born splash-proof and water-resistant, thanks to the precision manufacturing. Record special memories anytime and anywhere.<\\\\/span><\\\\/li>\\\\r\\\\n \\\\t<li class=\\\\\\"a-spacing-mini\\\\\\"><span class=\\\\\\"a-list-item\\\\\\">Leica main camera with professional optical lens Captures every great moment<\\\\/span><\\\\/li>\\\\r\\\\n \\\\t<li class=\\\\\\"a-spacing-mini\\\\\\"><span class=\\\\\\"a-list-item\\\\\\">Masterpiece performance Leading Snapdragon 8 Gen 2 Boosted performance, reduced consumption<\\\\/span><\\\\/li>\\\\r\\\\n<\\\\/ul>\\",\\"date\\":\\"27.12.2023\\",\\"attributes\\":{\\"pa_color\\":[\\"silver\\"]},\\"stock\\":null,\\"image_url\\":false,\\"sku\\":\\"141234\\",\\"price\\":\\"16000\\",\\"formatted_price\\":\\"<span class=\\\\\\"woocommerce-Price-amount amount\\\\\\"><bdi>16000,00&nbsp;<span class=\\\\\\"woocommerce-Price-currencySymbol\\\\\\">&#8381;<\\\\/span><\\\\/bdi><\\\\/span>\\",\\"product_link\\":\\"http:\\\\/\\\\/wordpress\\\\/product\\\\/%d0%ba%d1%80%d0%be%d1%81%d1%81%d0%be%d0%b2%d0%ba%d0%b8\\\\/\\"}][{\\"id\\":20,\\"title\\":\\"Xiaomi Redmi 12 128GB &#8212; Black &#8212; Unlocked &#8212; Dual-SIM\\",\\"content\\":\\"\\",\\"date\\":\\"29.12.2023\\",\\"attributes\\":{\\"pa_color\\":[\\"black\\"]},\\"stock\\":null,\\"image_url\\":false,\\"sku\\":\\"141234-1\\",\\"price\\":\\"15000\\",\\"formatted_price\\":\\"<span class=\\\\\\"woocommerce-Price-amount amount\\\\\\"><bdi>15000,00&nbsp;<span class=\\\\\\"woocommerce-Price-currencySymbol\\\\\\">&#8381;<\\\\/span><\\\\/bdi><\\\\/span>\\",\\"product_link\\":\\"http:\\\\/\\\\/wordpress\\\\/product\\\\/xiaomi-12-black\\\\/\\"}]"}, {"role": "user", "content": "do you have xiaomi 12?"}], "stream": false, "model": "gpt-3.5-turbo", "temperature": 0, "max_tokens": null}' message='Post details'
DEBUG:urllib3.connectionpool:https://api.openai.com:443 "POST /v1/chat/completions HTTP/1.1" 200 None
DEBUG:openai:message='OpenAI API response' path=https://api.openai.com/v1/chat/completions processing_ms=2794 request_id=78dacde4b25a332d69dd1e97e3df0e32 response_code=200
INFO:myapp:{'api': 1, 'product_data': '{"attributes": "color", "categories": "misc,smartphones"}', 'website': 'asdf', 'id': 4, 'left_tokens': 16111, 'description': None, 'temperature': Decimal('0.00'), 'model': 'gpt-3.5-turbo', 'prompt': 'Вы — ИИ ассистент компании. Вам будут заданы вопросы о нашей компании. Вежливо отвечайте на вопросы.\r\n    Ниже мы предоставили контекстную информацию.\r\n    ---------------------\r\n    {context_str}\r\n    ---------------------\r\n    Учитывая эту информацию, ответьте, пожалуйста, на вопрос: {query_str}\r\n    ', 'response_mode': 'compact', 'user_id': 12, 'answer': 'Client: hi mr AI, do you have xiaomi 13 in your store?,\nAi response: Yes, we do have the Xiaomi 13 available in our store. It features an ultra-immersive display design with thin bezels, making for a boundless visual experience. It is also IP68 water and dust resistant, allowing you to capture special memories anytime and anywhere. The Xiaomi 13 is equipped with a Leica main camera with a professional optical lens, ensuring that you can capture every great moment. Additionally, it boasts a powerful performance with the Snapdragon 8 Gen 2 processor. The price for the Xiaomi 13 is 16,000 rubles. You can find more information and make a purchase on our website: [Xiaomi 13 Product Link](http://wordpress/product/кроссовки/)', 'context': '[{"id":17,"title":"Xiaomi 13","content":"<ul class=\\"a-unordered-list a-vertical a-spacing-mini\\">\\r\\n \\t<li class=\\"a-spacing-mini\\"><span class=\\"a-list-item\\">Ultra-immersive display design Light up the screen to enjoy an unrivalled experience. The 1.61mm ultra-thin bezels offer a boundless vision.<\\/span><\\/li>\\r\\n \\t<li class=\\"a-spacing-mini\\"><span class=\\"a-list-item\\">Built for more scenarios IP68 water and dust resistant* Born splash-proof and water-resistant, thanks to the precision manufacturing. Record special memories anytime and anywhere.<\\/span><\\/li>\\r\\n \\t<li class=\\"a-spacing-mini\\"><span class=\\"a-list-item\\">Leica main camera with professional optical lens Captures every great moment<\\/span><\\/li>\\r\\n \\t<li class=\\"a-spacing-mini\\"><span class=\\"a-list-item\\">Masterpiece performance Leading Snapdragon 8 Gen 2 Boosted performance, reduced consumption<\\/span><\\/li>\\r\\n<\\/ul>","date":"27.12.2023","attributes":{"pa_color":["silver"]},"stock":null,"image_url":false,"sku":"141234","price":"16000","formatted_price":"<span class=\\"woocommerce-Price-amount amount\\"><bdi>16000,00&nbsp;<span class=\\"woocommerce-Price-currencySymbol\\">&#8381;<\\/span><\\/bdi><\\/span>","product_link":"http:\\/\\/wordpress\\/product\\/%d0%ba%d1%80%d0%be%d1%81%d1%81%d0%be%d0%b2%d0%ba%d0%b8\\/"}]'}
INFO:werkzeug:127.0.0.1 - - [31/Dec/2023 22:53:32] "POST /projects/e47f0f811145d03c33fd6639dc3f09c0839d0891e264d849a75df04f4d047625/V8j3dcWD9tWYF3IvUzk9qJzWg0ng4AP3 HTTP/1.1" 200 -
