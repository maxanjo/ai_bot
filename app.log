DEBUG:root:This is a debug message
DEBUG:celery.utils.functional:
def unlock_chord(self, group_id, callback, interval=0, max_retries=1, result=2, Result=3, GroupResult=4, result_from_tuple=5, **kwargs):
    return 1

DEBUG:celery.utils.functional:
def group(self, tasks, result, group_id, partial_args, add_to_parent=0):
    return 1

DEBUG:celery.utils.functional:
def send_chat_request(user_id, project_id, session, total_tokens, answer, context):
    return 1

DEBUG:celery.utils.functional:
def xmap(task, it):
    return 1

DEBUG:celery.utils.functional:
def sendEmbeddingRequest(user_id, total_tokens):
    return 1

DEBUG:celery.utils.functional:
def backend_cleanup():
    return 1

DEBUG:celery.utils.functional:
def set_vector_index_task(self, token):
    return 1

DEBUG:celery.utils.functional:
def process_set_vector_index(self, token, task_id):
    return 1

DEBUG:celery.utils.functional:
def chain(*args, **kwargs):
    return 1

DEBUG:celery.utils.functional:
def xstarmap(task, it):
    return 1

DEBUG:celery.utils.functional:
def accumulate(self, *args, **kwargs):
    return 1

DEBUG:celery.utils.functional:
def chord(self, header, body, partial_args=0, interval=1, countdown=2, max_retries=3, eager=4, **kwargs):
    return 1

DEBUG:celery.utils.functional:
def chunks(task, it, n):
    return 1

DEBUG:myapp:Flask app started
INFO:werkzeug:[31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:5000
INFO:werkzeug:[33mPress CTRL+C to quit[0m
INFO:werkzeug:127.0.0.1 - - [31/Dec/2023 23:05:47] "GET /files/e47f0f811145d03c33fd6639dc3f09c0839d0891e264d849a75df04f4d047625 HTTP/1.1" 200 -
INFO:werkzeug:127.0.0.1 - - [31/Dec/2023 23:05:51] "OPTIONS /projects/e47f0f811145d03c33fd6639dc3f09c0839d0891e264d849a75df04f4d047625/qe5LiZp0uKYYe9RKwJ8lGxHTfR9iIdzu HTTP/1.1" 200 -
INFO:myapp:{'api': 1, 'product_data': '{"attributes": "color", "categories": "misc,smartphones"}', 'website': 'asdf', 'id': 4, 'left_tokens': 12856, 'description': None, 'temperature': Decimal('0.00'), 'model': 'gpt-3.5-turbo', 'prompt': 'Вы — ИИ ассистент компании. Вам будут заданы вопросы о нашей компании. Вежливо отвечайте на вопросы.\r\n    Ниже мы предоставили контекстную информацию.\r\n    ---------------------\r\n    {context_str}\r\n    ---------------------\r\n    Учитывая эту информацию, ответьте, пожалуйста, на вопрос: {query_str}\r\n    ', 'response_mode': 'compact', 'user_id': 12, 'answer': "Client: i want xiaomi 13,\nAi response: Sure! We have the Xiaomi 13 available for purchase. It features an ultra-immersive display design with 1.61mm ultra-thin bezels, providing a boundless vision. It is also IP68 water and dust resistant, making it splash-proof and water-resistant. The Xiaomi 13 comes with a Leica main camera with a professional optical lens, allowing you to capture every great moment. It is powered by the leading Snapdragon 8 Gen 2 processor, offering boosted performance and reduced consumption. The price for the Xiaomi 13 is 16,000 rubles. You can find more information and make a purchase on our website: [Xiaomi 13](http://wordpress/product/кроссовки/)\r\nClient: is it better than xiaomi 12?,\nAi response: As an AI assistant, I don't have access to specific information about Xiaomi 12 or any other specific products unless it has been provided in the context. However, both Xiaomi 13 and Xiaomi 12 are part of the Xiaomi product lineup and are likely to have their own unique features and specifications. It would be best to compare the specifications and features of both models to determine which one suits your needs and preferences better.", 'context': '[{"id":17,"title":"Xiaomi 13","content":"<ul class=\\"a-unordered-list a-vertical a-spacing-mini\\">\\r\\n \\t<li class=\\"a-spacing-mini\\"><span class=\\"a-list-item\\">Ultra-immersive display design Light up the screen to enjoy an unrivalled experience. The 1.61mm ultra-thin bezels offer a boundless vision.<\\/span><\\/li>\\r\\n \\t<li class=\\"a-spacing-mini\\"><span class=\\"a-list-item\\">Built for more scenarios IP68 water and dust resistant* Born splash-proof and water-resistant, thanks to the precision manufacturing. Record special memories anytime and anywhere.<\\/span><\\/li>\\r\\n \\t<li class=\\"a-spacing-mini\\"><span class=\\"a-list-item\\">Leica main camera with professional optical lens Captures every great moment<\\/span><\\/li>\\r\\n \\t<li class=\\"a-spacing-mini\\"><span class=\\"a-list-item\\">Masterpiece performance Leading Snapdragon 8 Gen 2 Boosted performance, reduced consumption<\\/span><\\/li>\\r\\n<\\/ul>","date":"27.12.2023","attributes":{"pa_color":["silver"]},"stock":null,"image_url":false,"sku":"141234","price":"16000","formatted_price":"<span class=\\"woocommerce-Price-amount amount\\"><bdi>16000,00&nbsp;<span class=\\"woocommerce-Price-currencySymbol\\">&#8381;<\\/span><\\/bdi><\\/span>","product_link":"http:\\/\\/wordpress\\/product\\/%d0%ba%d1%80%d0%be%d1%81%d1%81%d0%be%d0%b2%d0%ba%d0%b8\\/"}]\r\nUnfortunately we dont have item_name in our store. But please checkout our similar products: \n[]'}
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.openai.com:443
DEBUG:urllib3.connectionpool:https://api.openai.com:443 "POST /v1/chat/completions HTTP/1.1" 200 None
DEBUG:llama_index.storage.kvstore.simple_kvstore:Loading llama_index.storage.kvstore.simple_kvstore from projects/4/data\docstore.json.
DEBUG:fsspec.local:open file: C:/OSPanel/domains/ai_assistant/api/projects/4/data/docstore.json
DEBUG:llama_index.storage.kvstore.simple_kvstore:Loading llama_index.storage.kvstore.simple_kvstore from projects/4/data\index_store.json.
DEBUG:fsspec.local:open file: C:/OSPanel/domains/ai_assistant/api/projects/4/data/index_store.json
DEBUG:llama_index.vector_stores.simple:Loading llama_index.vector_stores.simple from projects/4/data\vector_store.json.
DEBUG:fsspec.local:open file: C:/OSPanel/domains/ai_assistant/api/projects/4/data/vector_store.json
DEBUG:llama_index.graph_stores.simple:Loading llama_index.graph_stores.simple from projects/4/data\graph_store.json.
DEBUG:fsspec.local:open file: C:/OSPanel/domains/ai_assistant/api/projects/4/data/graph_store.json
INFO:llama_index.indices.loading:Loading indices with ids: ['vector_index']
DEBUG:openai:message='Request to OpenAI API' method=post path=https://api.openai.com/v1/embeddings
DEBUG:openai:api_version=None data='{"input": ["i want xiaomi 13"], "model": "text-embedding-ada-002", "encoding_format": "base64"}' message='Post details'
DEBUG:urllib3.util.retry:Converted retries value: 2 -> Retry(total=2, connect=None, read=None, redirect=None, status=None)
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.openai.com:443
DEBUG:urllib3.connectionpool:https://api.openai.com:443 "POST /v1/embeddings HTTP/1.1" 200 None
DEBUG:openai:message='OpenAI API response' path=https://api.openai.com/v1/embeddings processing_ms=15 request_id=2cb153a5582c55175c7caab07743fae1 response_code=200
DEBUG:llama_index.indices.utils:> Top 1 nodes:
> [Node 909c5dd5-e87e-4999-a794-761f96e44168] [Similarity score:             -0.0286855] Welcome to TechHub, your ultimate destination for cutting-edge technology and innovation! At Tech...
DEBUG:openai:message='Request to OpenAI API' method=post path=https://api.openai.com/v1/chat/completions
DEBUG:openai:api_version=None data='{"messages": [{"role": "system", "content": "Context information is below.\\n--------------------\\nWelcome to TechHub, your ultimate destination for cutting-edge technology and innovation! At TechHub, we pride ourselves on being a premier online store dedicated to providing a curated selection of the latest and greatest in tech gadgets, including laptops, smartphones, and more.\\n\\nAbout Us:\\n\\nAt the heart of TechHub is a passion for technology and a commitment to delivering top-notch products that seamlessly blend style, functionality, and performance. With a team of tech enthusiasts, we understand the ever-evolving nature of the digital landscape and strive to stay at the forefront of the latest trends and advancements.\\n\\nOur Mission:\\n\\nOur mission at TechHub is to empower our customers with the best tools and devices that enhance their digital lifestyle. Whether you\'re a professional looking for a high-performance laptop to boost productivity or a smartphone aficionado seeking the latest flagship model, we\'ve got you covered. We believe that technology should not only meet but exceed your expectations, making every interaction with your devices a seamless and enjoyable experience.\\n\\nQuality Assurance:\\n\\nTechHub is committed to delivering products of the highest quality. We carefully curate our inventory, partnering with leading brands known for their commitment to excellence. Each product undergoes rigorous testing to ensure reliability, durability, and top-notch performance. Our dedication to quality assurance is reflected in every item we offer.\\n\\nCustomer-Centric Approach:\\n\\nAt TechHub, our customers are at the core of everything we do. We prioritize your satisfaction and strive to provide an unparalleled shopping experience. Our customer support team is ready to assist you at every step, from product inquiries to after-sales support. We value your feedback and continuously work to improve our services based on your needs.\\n\\nSecure Shopping:\\n\\nYour online security is our priority. TechHub employs state-of-the-art encryption technology to ensure that your personal information remains secure and protected. Shop with confidence, knowing that your data is in safe hands.\\n\\nExplore the world of innovation at TechHub, where technology meets lifestyle. Discover the perfect blend of style and functionality with our carefully curated selection of laptops, smartphones, and other cutting-edge gadgets. Join us on this exciting journey, and let\'s embrace the future together!\\n--------------------\\n\\u0412\\u044b \\u2014 \\u0418\\u0418 \\u0430\\u0441\\u0441\\u0438\\u0441\\u0442\\u0435\\u043d\\u0442 \\u043a\\u043e\\u043c\\u043f\\u0430\\u043d\\u0438\\u0438. \\u0412\\u0430\\u043c \\u0431\\u0443\\u0434\\u0443\\u0442 \\u0437\\u0430\\u0434\\u0430\\u043d\\u044b \\u0432\\u043e\\u043f\\u0440\\u043e\\u0441\\u044b \\u043e \\u043d\\u0430\\u0448\\u0435\\u0439 \\u043a\\u043e\\u043c\\u043f\\u0430\\u043d\\u0438\\u0438. \\u0412\\u0435\\u0436\\u043b\\u0438\\u0432\\u043e \\u043e\\u0442\\u0432\\u0435\\u0447\\u0430\\u0439\\u0442\\u0435 \\u043d\\u0430 \\u0432\\u043e\\u043f\\u0440\\u043e\\u0441\\u044b.\\r\\n    \\u041d\\u0438\\u0436\\u0435 \\u043c\\u044b \\u043f\\u0440\\u0435\\u0434\\u043e\\u0441\\u0442\\u0430\\u0432\\u0438\\u043b\\u0438 \\u043a\\u043e\\u043d\\u0442\\u0435\\u043a\\u0441\\u0442\\u043d\\u0443\\u044e \\u0438\\u043d\\u0444\\u043e\\u0440\\u043c\\u0430\\u0446\\u0438\\u044e.\\r\\n    ---------------------\\r\\n    {context_str}\\r\\n    ---------------------\\r\\n    \\u0423\\u0447\\u0438\\u0442\\u044b\\u0432\\u0430\\u044f \\u044d\\u0442\\u0443 \\u0438\\u043d\\u0444\\u043e\\u0440\\u043c\\u0430\\u0446\\u0438\\u044e, \\u043e\\u0442\\u0432\\u0435\\u0442\\u044c\\u0442\\u0435, \\u043f\\u043e\\u0436\\u0430\\u043b\\u0443\\u0439\\u0441\\u0442\\u0430, \\u043d\\u0430 \\u0432\\u043e\\u043f\\u0440\\u043e\\u0441: {query_str}\\r\\n    . \\n Information about relative products [{\\"id\\":17,\\"title\\":\\"Xiaomi 13\\",\\"content\\":\\"<ul class=\\\\\\"a-unordered-list a-vertical a-spacing-mini\\\\\\">\\\\r\\\\n \\\\t<li class=\\\\\\"a-spacing-mini\\\\\\"><span class=\\\\\\"a-list-item\\\\\\">Ultra-immersive display design Light up the screen to enjoy an unrivalled experience. The 1.61mm ultra-thin bezels offer a boundless vision.<\\\\/span><\\\\/li>\\\\r\\\\n \\\\t<li class=\\\\\\"a-spacing-mini\\\\\\"><span class=\\\\\\"a-list-item\\\\\\">Built for more scenarios IP68 water and dust resistant* Born splash-proof and water-resistant, thanks to the precision manufacturing. Record special memories anytime and anywhere.<\\\\/span><\\\\/li>\\\\r\\\\n \\\\t<li class=\\\\\\"a-spacing-mini\\\\\\"><span class=\\\\\\"a-list-item\\\\\\">Leica main camera with professional optical lens Captures every great moment<\\\\/span><\\\\/li>\\\\r\\\\n \\\\t<li class=\\\\\\"a-spacing-mini\\\\\\"><span class=\\\\\\"a-list-item\\\\\\">Masterpiece performance Leading Snapdragon 8 Gen 2 Boosted performance, reduced consumption<\\\\/span><\\\\/li>\\\\r\\\\n<\\\\/ul>\\",\\"date\\":\\"27.12.2023\\",\\"attributes\\":{\\"pa_color\\":[\\"silver\\"]},\\"stock\\":null,\\"image_url\\":false,\\"sku\\":\\"141234\\",\\"price\\":\\"16000\\",\\"formatted_price\\":\\"<span class=\\\\\\"woocommerce-Price-amount amount\\\\\\"><bdi>16000,00&nbsp;<span class=\\\\\\"woocommerce-Price-currencySymbol\\\\\\">&#8381;<\\\\/span><\\\\/bdi><\\\\/span>\\",\\"product_link\\":\\"http:\\\\/\\\\/wordpress\\\\/product\\\\/%d0%ba%d1%80%d0%be%d1%81%d1%81%d0%be%d0%b2%d0%ba%d0%b8\\\\/\\"}]\\r\\nUnfortunately we dont have item_name in our store. But please checkout our similar products: \\n[]"}, {"role": "user", "content": "i want xiaomi 13"}], "stream": false, "model": "gpt-3.5-turbo", "temperature": 0, "max_tokens": null}' message='Post details'
DEBUG:urllib3.connectionpool:https://api.openai.com:443 "POST /v1/chat/completions HTTP/1.1" 200 None
DEBUG:openai:message='OpenAI API response' path=https://api.openai.com/v1/chat/completions processing_ms=1595 request_id=34f06c866030abb195e2afba68799f87 response_code=200
INFO:myapp:{'api': 1, 'product_data': '{"attributes": "color", "categories": "misc,smartphones"}', 'website': 'asdf', 'id': 4, 'left_tokens': 12856, 'description': None, 'temperature': Decimal('0.00'), 'model': 'gpt-3.5-turbo', 'prompt': 'Вы — ИИ ассистент компании. Вам будут заданы вопросы о нашей компании. Вежливо отвечайте на вопросы.\r\n    Ниже мы предоставили контекстную информацию.\r\n    ---------------------\r\n    {context_str}\r\n    ---------------------\r\n    Учитывая эту информацию, ответьте, пожалуйста, на вопрос: {query_str}\r\n    ', 'response_mode': 'compact', 'user_id': 12, 'answer': "Client: i want xiaomi 13,\nAi response: Sure! We have the Xiaomi 13 available for purchase. It features an ultra-immersive display design with 1.61mm ultra-thin bezels, providing a boundless vision. It is also IP68 water and dust resistant, making it splash-proof and water-resistant. The Xiaomi 13 comes with a Leica main camera with a professional optical lens, allowing you to capture every great moment. It is powered by the leading Snapdragon 8 Gen 2 processor, offering boosted performance and reduced consumption. The price for the Xiaomi 13 is 16,000 rubles. You can find more information and make a purchase on our website: [Xiaomi 13](http://wordpress/product/кроссовки/)\r\nClient: is it better than xiaomi 12?,\nAi response: As an AI assistant, I don't have access to specific information about Xiaomi 12 or any other specific products unless it has been provided in the context. However, both Xiaomi 13 and Xiaomi 12 are part of the Xiaomi product lineup and are likely to have their own unique features and specifications. It would be best to compare the specifications and features of both models to determine which one suits your needs and preferences better.", 'context': '[{"id":17,"title":"Xiaomi 13","content":"<ul class=\\"a-unordered-list a-vertical a-spacing-mini\\">\\r\\n \\t<li class=\\"a-spacing-mini\\"><span class=\\"a-list-item\\">Ultra-immersive display design Light up the screen to enjoy an unrivalled experience. The 1.61mm ultra-thin bezels offer a boundless vision.<\\/span><\\/li>\\r\\n \\t<li class=\\"a-spacing-mini\\"><span class=\\"a-list-item\\">Built for more scenarios IP68 water and dust resistant* Born splash-proof and water-resistant, thanks to the precision manufacturing. Record special memories anytime and anywhere.<\\/span><\\/li>\\r\\n \\t<li class=\\"a-spacing-mini\\"><span class=\\"a-list-item\\">Leica main camera with professional optical lens Captures every great moment<\\/span><\\/li>\\r\\n \\t<li class=\\"a-spacing-mini\\"><span class=\\"a-list-item\\">Masterpiece performance Leading Snapdragon 8 Gen 2 Boosted performance, reduced consumption<\\/span><\\/li>\\r\\n<\\/ul>","date":"27.12.2023","attributes":{"pa_color":["silver"]},"stock":null,"image_url":false,"sku":"141234","price":"16000","formatted_price":"<span class=\\"woocommerce-Price-amount amount\\"><bdi>16000,00&nbsp;<span class=\\"woocommerce-Price-currencySymbol\\">&#8381;<\\/span><\\/bdi><\\/span>","product_link":"http:\\/\\/wordpress\\/product\\/%d0%ba%d1%80%d0%be%d1%81%d1%81%d0%be%d0%b2%d0%ba%d0%b8\\/"}]\r\nUnfortunately we dont have item_name in our store. But please checkout our similar products: \n[]'}
DEBUG:root:This is a debug message
DEBUG:celery.utils.functional:
def send_chat_request(user_id, project_id, session, total_tokens, answer, context):
    return 1

INFO:werkzeug:127.0.0.1 - - [31/Dec/2023 23:05:58] "POST /projects/e47f0f811145d03c33fd6639dc3f09c0839d0891e264d849a75df04f4d047625/qe5LiZp0uKYYe9RKwJ8lGxHTfR9iIdzu HTTP/1.1" 200 -
INFO:werkzeug:127.0.0.1 - - [31/Dec/2023 23:08:02] "GET /files/e47f0f811145d03c33fd6639dc3f09c0839d0891e264d849a75df04f4d047625 HTTP/1.1" 200 -
INFO:werkzeug:127.0.0.1 - - [31/Dec/2023 23:08:04] "OPTIONS /projects/e47f0f811145d03c33fd6639dc3f09c0839d0891e264d849a75df04f4d047625/qe5LiZp0uKYYe9RKwJ8lGxHTfR9iIdzu HTTP/1.1" 200 -
INFO:myapp:{'api': 1, 'product_data': '{"attributes": "color", "categories": "misc,smartphones"}', 'website': 'asdf', 'id': 4, 'left_tokens': 11866, 'description': None, 'temperature': Decimal('0.00'), 'model': 'gpt-3.5-turbo', 'prompt': 'Вы — ИИ ассистент компании. Вам будут заданы вопросы о нашей компании. Вежливо отвечайте на вопросы.\r\n    Ниже мы предоставили контекстную информацию.\r\n    ---------------------\r\n    {context_str}\r\n    ---------------------\r\n    Учитывая эту информацию, ответьте, пожалуйста, на вопрос: {query_str}\r\n    ', 'response_mode': 'compact', 'user_id': 12, 'answer': "Client: i want xiaomi 13,\nAi response: Sure! We have the Xiaomi 13 available for purchase. It features an ultra-immersive display design with 1.61mm ultra-thin bezels, providing a boundless vision. It is also IP68 water and dust resistant, making it splash-proof and water-resistant. The Xiaomi 13 comes with a Leica main camera with a professional optical lens, allowing you to capture every great moment. It is powered by the leading Snapdragon 8 Gen 2 processor, offering boosted performance and reduced consumption. The price for the Xiaomi 13 is 16,000 rubles. You can find more information and make a purchase on our website: [Xiaomi 13](http://wordpress/product/кроссовки/)\r\nClient: is it better than xiaomi 12?,\nAi response: As an AI assistant, I don't have access to specific information about Xiaomi 12 or any other specific products unless it has been provided in the context. However, both Xiaomi 13 and Xiaomi 12 are part of the Xiaomi product lineup and are likely to have their own unique features and specifications. It would be best to compare the specifications and features of both models to determine which one suits your needs and preferences better.\r\nClient: i want xiaomi 13,\nAi response: Unfortunately, we don't have the Xiaomi 13 in our store. However, we have a selection of other similar products that you might be interested in. Please feel free to browse our website to explore our range of laptops and smartphones.", 'context': '[{"id":17,"title":"Xiaomi 13","content":"<ul class=\\"a-unordered-list a-vertical a-spacing-mini\\">\\r\\n \\t<li class=\\"a-spacing-mini\\"><span class=\\"a-list-item\\">Ultra-immersive display design Light up the screen to enjoy an unrivalled experience. The 1.61mm ultra-thin bezels offer a boundless vision.<\\/span><\\/li>\\r\\n \\t<li class=\\"a-spacing-mini\\"><span class=\\"a-list-item\\">Built for more scenarios IP68 water and dust resistant* Born splash-proof and water-resistant, thanks to the precision manufacturing. Record special memories anytime and anywhere.<\\/span><\\/li>\\r\\n \\t<li class=\\"a-spacing-mini\\"><span class=\\"a-list-item\\">Leica main camera with professional optical lens Captures every great moment<\\/span><\\/li>\\r\\n \\t<li class=\\"a-spacing-mini\\"><span class=\\"a-list-item\\">Masterpiece performance Leading Snapdragon 8 Gen 2 Boosted performance, reduced consumption<\\/span><\\/li>\\r\\n<\\/ul>","date":"27.12.2023","attributes":{"pa_color":["silver"]},"stock":null,"image_url":false,"sku":"141234","price":"16000","formatted_price":"<span class=\\"woocommerce-Price-amount amount\\"><bdi>16000,00&nbsp;<span class=\\"woocommerce-Price-currencySymbol\\">&#8381;<\\/span><\\/bdi><\\/span>","product_link":"http:\\/\\/wordpress\\/product\\/%d0%ba%d1%80%d0%be%d1%81%d1%81%d0%be%d0%b2%d0%ba%d0%b8\\/"}]\r\nUnfortunately we dont have item_name in our store. But please checkout our similar products: \n[]\r\n'}
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.openai.com:443
DEBUG:urllib3.connectionpool:https://api.openai.com:443 "POST /v1/chat/completions HTTP/1.1" 200 None
DEBUG:llama_index.storage.kvstore.simple_kvstore:Loading llama_index.storage.kvstore.simple_kvstore from projects/4/data\docstore.json.
DEBUG:fsspec.local:open file: C:/OSPanel/domains/ai_assistant/api/projects/4/data/docstore.json
DEBUG:llama_index.storage.kvstore.simple_kvstore:Loading llama_index.storage.kvstore.simple_kvstore from projects/4/data\index_store.json.
DEBUG:fsspec.local:open file: C:/OSPanel/domains/ai_assistant/api/projects/4/data/index_store.json
DEBUG:llama_index.vector_stores.simple:Loading llama_index.vector_stores.simple from projects/4/data\vector_store.json.
DEBUG:fsspec.local:open file: C:/OSPanel/domains/ai_assistant/api/projects/4/data/vector_store.json
DEBUG:llama_index.graph_stores.simple:Loading llama_index.graph_stores.simple from projects/4/data\graph_store.json.
DEBUG:fsspec.local:open file: C:/OSPanel/domains/ai_assistant/api/projects/4/data/graph_store.json
INFO:llama_index.indices.loading:Loading indices with ids: ['vector_index']
DEBUG:openai:message='Request to OpenAI API' method=post path=https://api.openai.com/v1/embeddings
DEBUG:openai:api_version=None data='{"input": ["i want xiaomi 13"], "model": "text-embedding-ada-002", "encoding_format": "base64"}' message='Post details'
DEBUG:urllib3.util.retry:Converted retries value: 2 -> Retry(total=2, connect=None, read=None, redirect=None, status=None)
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.openai.com:443
DEBUG:urllib3.connectionpool:https://api.openai.com:443 "POST /v1/embeddings HTTP/1.1" 200 None
DEBUG:openai:message='OpenAI API response' path=https://api.openai.com/v1/embeddings processing_ms=20 request_id=f4d05ccf1285307559351762ebda4b15 response_code=200
DEBUG:llama_index.indices.utils:> Top 1 nodes:
> [Node 909c5dd5-e87e-4999-a794-761f96e44168] [Similarity score:             -0.0286855] Welcome to TechHub, your ultimate destination for cutting-edge technology and innovation! At Tech...
DEBUG:openai:message='Request to OpenAI API' method=post path=https://api.openai.com/v1/chat/completions
DEBUG:openai:api_version=None data='{"messages": [{"role": "system", "content": "Context information is below.\\n--------------------\\nWelcome to TechHub, your ultimate destination for cutting-edge technology and innovation! At TechHub, we pride ourselves on being a premier online store dedicated to providing a curated selection of the latest and greatest in tech gadgets, including laptops, smartphones, and more.\\n\\nAbout Us:\\n\\nAt the heart of TechHub is a passion for technology and a commitment to delivering top-notch products that seamlessly blend style, functionality, and performance. With a team of tech enthusiasts, we understand the ever-evolving nature of the digital landscape and strive to stay at the forefront of the latest trends and advancements.\\n\\nOur Mission:\\n\\nOur mission at TechHub is to empower our customers with the best tools and devices that enhance their digital lifestyle. Whether you\'re a professional looking for a high-performance laptop to boost productivity or a smartphone aficionado seeking the latest flagship model, we\'ve got you covered. We believe that technology should not only meet but exceed your expectations, making every interaction with your devices a seamless and enjoyable experience.\\n\\nQuality Assurance:\\n\\nTechHub is committed to delivering products of the highest quality. We carefully curate our inventory, partnering with leading brands known for their commitment to excellence. Each product undergoes rigorous testing to ensure reliability, durability, and top-notch performance. Our dedication to quality assurance is reflected in every item we offer.\\n\\nCustomer-Centric Approach:\\n\\nAt TechHub, our customers are at the core of everything we do. We prioritize your satisfaction and strive to provide an unparalleled shopping experience. Our customer support team is ready to assist you at every step, from product inquiries to after-sales support. We value your feedback and continuously work to improve our services based on your needs.\\n\\nSecure Shopping:\\n\\nYour online security is our priority. TechHub employs state-of-the-art encryption technology to ensure that your personal information remains secure and protected. Shop with confidence, knowing that your data is in safe hands.\\n\\nExplore the world of innovation at TechHub, where technology meets lifestyle. Discover the perfect blend of style and functionality with our carefully curated selection of laptops, smartphones, and other cutting-edge gadgets. Join us on this exciting journey, and let\'s embrace the future together!\\n--------------------\\n\\u0412\\u044b \\u2014 \\u0418\\u0418 \\u0430\\u0441\\u0441\\u0438\\u0441\\u0442\\u0435\\u043d\\u0442 \\u043a\\u043e\\u043c\\u043f\\u0430\\u043d\\u0438\\u0438. \\u0412\\u0430\\u043c \\u0431\\u0443\\u0434\\u0443\\u0442 \\u0437\\u0430\\u0434\\u0430\\u043d\\u044b \\u0432\\u043e\\u043f\\u0440\\u043e\\u0441\\u044b \\u043e \\u043d\\u0430\\u0448\\u0435\\u0439 \\u043a\\u043e\\u043c\\u043f\\u0430\\u043d\\u0438\\u0438. \\u0412\\u0435\\u0436\\u043b\\u0438\\u0432\\u043e \\u043e\\u0442\\u0432\\u0435\\u0447\\u0430\\u0439\\u0442\\u0435 \\u043d\\u0430 \\u0432\\u043e\\u043f\\u0440\\u043e\\u0441\\u044b.\\r\\n    \\u041d\\u0438\\u0436\\u0435 \\u043c\\u044b \\u043f\\u0440\\u0435\\u0434\\u043e\\u0441\\u0442\\u0430\\u0432\\u0438\\u043b\\u0438 \\u043a\\u043e\\u043d\\u0442\\u0435\\u043a\\u0441\\u0442\\u043d\\u0443\\u044e \\u0438\\u043d\\u0444\\u043e\\u0440\\u043c\\u0430\\u0446\\u0438\\u044e.\\r\\n    ---------------------\\r\\n    {context_str}\\r\\n    ---------------------\\r\\n    \\u0423\\u0447\\u0438\\u0442\\u044b\\u0432\\u0430\\u044f \\u044d\\u0442\\u0443 \\u0438\\u043d\\u0444\\u043e\\u0440\\u043c\\u0430\\u0446\\u0438\\u044e, \\u043e\\u0442\\u0432\\u0435\\u0442\\u044c\\u0442\\u0435, \\u043f\\u043e\\u0436\\u0430\\u043b\\u0443\\u0439\\u0441\\u0442\\u0430, \\u043d\\u0430 \\u0432\\u043e\\u043f\\u0440\\u043e\\u0441: {query_str}\\r\\n    . \\n Information about relative products [{\\"id\\":17,\\"title\\":\\"Xiaomi 13\\",\\"content\\":\\"<ul class=\\\\\\"a-unordered-list a-vertical a-spacing-mini\\\\\\">\\\\r\\\\n \\\\t<li class=\\\\\\"a-spacing-mini\\\\\\"><span class=\\\\\\"a-list-item\\\\\\">Ultra-immersive display design Light up the screen to enjoy an unrivalled experience. The 1.61mm ultra-thin bezels offer a boundless vision.<\\\\/span><\\\\/li>\\\\r\\\\n \\\\t<li class=\\\\\\"a-spacing-mini\\\\\\"><span class=\\\\\\"a-list-item\\\\\\">Built for more scenarios IP68 water and dust resistant* Born splash-proof and water-resistant, thanks to the precision manufacturing. Record special memories anytime and anywhere.<\\\\/span><\\\\/li>\\\\r\\\\n \\\\t<li class=\\\\\\"a-spacing-mini\\\\\\"><span class=\\\\\\"a-list-item\\\\\\">Leica main camera with professional optical lens Captures every great moment<\\\\/span><\\\\/li>\\\\r\\\\n \\\\t<li class=\\\\\\"a-spacing-mini\\\\\\"><span class=\\\\\\"a-list-item\\\\\\">Masterpiece performance Leading Snapdragon 8 Gen 2 Boosted performance, reduced consumption<\\\\/span><\\\\/li>\\\\r\\\\n<\\\\/ul>\\",\\"date\\":\\"27.12.2023\\",\\"attributes\\":{\\"pa_color\\":[\\"silver\\"]},\\"stock\\":null,\\"image_url\\":false,\\"sku\\":\\"141234\\",\\"price\\":\\"16000\\",\\"formatted_price\\":\\"<span class=\\\\\\"woocommerce-Price-amount amount\\\\\\"><bdi>16000,00&nbsp;<span class=\\\\\\"woocommerce-Price-currencySymbol\\\\\\">&#8381;<\\\\/span><\\\\/bdi><\\\\/span>\\",\\"product_link\\":\\"http:\\\\/\\\\/wordpress\\\\/product\\\\/%d0%ba%d1%80%d0%be%d1%81%d1%81%d0%be%d0%b2%d0%ba%d0%b8\\\\/\\"}]\\r\\nUnfortunately we dont have item_name in our store. But please checkout our similar products: \\n[]"}, {"role": "user", "content": "i want xiaomi 13"}], "stream": false, "model": "gpt-3.5-turbo", "temperature": 0, "max_tokens": null}' message='Post details'
DEBUG:urllib3.connectionpool:https://api.openai.com:443 "POST /v1/chat/completions HTTP/1.1" 200 None
DEBUG:openai:message='OpenAI API response' path=https://api.openai.com/v1/chat/completions processing_ms=1619 request_id=6431c0fcb1dd86e67bec94d5259448a5 response_code=200
INFO:myapp:{'api': 1, 'product_data': '{"attributes": "color", "categories": "misc,smartphones"}', 'website': 'asdf', 'id': 4, 'left_tokens': 11866, 'description': None, 'temperature': Decimal('0.00'), 'model': 'gpt-3.5-turbo', 'prompt': 'Вы — ИИ ассистент компании. Вам будут заданы вопросы о нашей компании. Вежливо отвечайте на вопросы.\r\n    Ниже мы предоставили контекстную информацию.\r\n    ---------------------\r\n    {context_str}\r\n    ---------------------\r\n    Учитывая эту информацию, ответьте, пожалуйста, на вопрос: {query_str}\r\n    ', 'response_mode': 'compact', 'user_id': 12, 'answer': "Client: i want xiaomi 13,\nAi response: Sure! We have the Xiaomi 13 available for purchase. It features an ultra-immersive display design with 1.61mm ultra-thin bezels, providing a boundless vision. It is also IP68 water and dust resistant, making it splash-proof and water-resistant. The Xiaomi 13 comes with a Leica main camera with a professional optical lens, allowing you to capture every great moment. It is powered by the leading Snapdragon 8 Gen 2 processor, offering boosted performance and reduced consumption. The price for the Xiaomi 13 is 16,000 rubles. You can find more information and make a purchase on our website: [Xiaomi 13](http://wordpress/product/кроссовки/)\r\nClient: is it better than xiaomi 12?,\nAi response: As an AI assistant, I don't have access to specific information about Xiaomi 12 or any other specific products unless it has been provided in the context. However, both Xiaomi 13 and Xiaomi 12 are part of the Xiaomi product lineup and are likely to have their own unique features and specifications. It would be best to compare the specifications and features of both models to determine which one suits your needs and preferences better.\r\nClient: i want xiaomi 13,\nAi response: Unfortunately, we don't have the Xiaomi 13 in our store. However, we have a selection of other similar products that you might be interested in. Please feel free to browse our website to explore our range of laptops and smartphones.", 'context': '[{"id":17,"title":"Xiaomi 13","content":"<ul class=\\"a-unordered-list a-vertical a-spacing-mini\\">\\r\\n \\t<li class=\\"a-spacing-mini\\"><span class=\\"a-list-item\\">Ultra-immersive display design Light up the screen to enjoy an unrivalled experience. The 1.61mm ultra-thin bezels offer a boundless vision.<\\/span><\\/li>\\r\\n \\t<li class=\\"a-spacing-mini\\"><span class=\\"a-list-item\\">Built for more scenarios IP68 water and dust resistant* Born splash-proof and water-resistant, thanks to the precision manufacturing. Record special memories anytime and anywhere.<\\/span><\\/li>\\r\\n \\t<li class=\\"a-spacing-mini\\"><span class=\\"a-list-item\\">Leica main camera with professional optical lens Captures every great moment<\\/span><\\/li>\\r\\n \\t<li class=\\"a-spacing-mini\\"><span class=\\"a-list-item\\">Masterpiece performance Leading Snapdragon 8 Gen 2 Boosted performance, reduced consumption<\\/span><\\/li>\\r\\n<\\/ul>","date":"27.12.2023","attributes":{"pa_color":["silver"]},"stock":null,"image_url":false,"sku":"141234","price":"16000","formatted_price":"<span class=\\"woocommerce-Price-amount amount\\"><bdi>16000,00&nbsp;<span class=\\"woocommerce-Price-currencySymbol\\">&#8381;<\\/span><\\/bdi><\\/span>","product_link":"http:\\/\\/wordpress\\/product\\/%d0%ba%d1%80%d0%be%d1%81%d1%81%d0%be%d0%b2%d0%ba%d0%b8\\/"}]\r\nUnfortunately we dont have item_name in our store. But please checkout our similar products: \n[]\r\n'}
INFO:werkzeug:127.0.0.1 - - [31/Dec/2023 23:08:09] "POST /projects/e47f0f811145d03c33fd6639dc3f09c0839d0891e264d849a75df04f4d047625/qe5LiZp0uKYYe9RKwJ8lGxHTfR9iIdzu HTTP/1.1" 200 -
DEBUG:root:This is a debug message
DEBUG:celery.utils.functional:
def unlock_chord(self, group_id, callback, interval=0, max_retries=1, result=2, Result=3, GroupResult=4, result_from_tuple=5, **kwargs):
    return 1

DEBUG:celery.utils.functional:
def group(self, tasks, result, group_id, partial_args, add_to_parent=0):
    return 1

DEBUG:celery.utils.functional:
def send_chat_request(user_id, project_id, session, total_tokens, answer, context):
    return 1

DEBUG:celery.utils.functional:
def xmap(task, it):
    return 1

DEBUG:celery.utils.functional:
def sendEmbeddingRequest(user_id, total_tokens):
    return 1

DEBUG:celery.utils.functional:
def backend_cleanup():
    return 1

DEBUG:celery.utils.functional:
def set_vector_index_task(self, token):
    return 1

DEBUG:celery.utils.functional:
def process_set_vector_index(self, token, task_id):
    return 1

DEBUG:celery.utils.functional:
def chain(*args, **kwargs):
    return 1

DEBUG:celery.utils.functional:
def xstarmap(task, it):
    return 1

DEBUG:celery.utils.functional:
def accumulate(self, *args, **kwargs):
    return 1

DEBUG:celery.utils.functional:
def chord(self, header, body, partial_args=0, interval=1, countdown=2, max_retries=3, eager=4, **kwargs):
    return 1

DEBUG:celery.utils.functional:
def chunks(task, it, n):
    return 1

DEBUG:myapp:Flask app started
INFO:werkzeug:[31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:5000
INFO:werkzeug:[33mPress CTRL+C to quit[0m
INFO:werkzeug:127.0.0.1 - - [31/Dec/2023 23:08:33] "GET /files/e47f0f811145d03c33fd6639dc3f09c0839d0891e264d849a75df04f4d047625 HTTP/1.1" 200 -
INFO:werkzeug:127.0.0.1 - - [31/Dec/2023 23:08:53] "OPTIONS /projects/e47f0f811145d03c33fd6639dc3f09c0839d0891e264d849a75df04f4d047625/muP1mAescqmU3XarnFTBxn5zmnVbaCOi HTTP/1.1" 200 -
INFO:myapp:{'api': 1, 'product_data': '{"attributes": "color", "categories": "misc,smartphones"}', 'website': 'asdf', 'id': 4, 'left_tokens': 10876, 'description': None, 'temperature': Decimal('0.00'), 'model': 'gpt-3.5-turbo', 'prompt': 'Вы — ИИ ассистент компании. Вам будут заданы вопросы о нашей компании. Вежливо отвечайте на вопросы.\r\n    Ниже мы предоставили контекстную информацию.\r\n    ---------------------\r\n    {context_str}\r\n    ---------------------\r\n    Учитывая эту информацию, ответьте, пожалуйста, на вопрос: {query_str}\r\n    ', 'response_mode': 'compact', 'user_id': 12, 'answer': None, 'context': None}
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.openai.com:443
DEBUG:urllib3.connectionpool:https://api.openai.com:443 "POST /v1/chat/completions HTTP/1.1" 200 None
INFO:myapp:[{'url_params': 'product_name=xiaomi 13', 'is_related': 'yes', 'category': 'smartphones'}]
INFO:myapp:product_name=xiaomi 13
INFO:myapp:prompt
INFO:myapp:You are AI assistant for a online shop. You should determine if a client is asking or information about a product in our store. It can be a question about price, availability in stock, product characteristic, comparing 2 products. In this case you should contruct query parameters based on a client question. Construct them for every mentioned product. Add sort_price parameter if required .For example product_name=item_name&color=green&size=44&sort_price=desc|asc List of available query parameters: product_name, color product_name is a required parameter. You should use it in every query.Use only these query parameters for consructing. Add a category. List of available categories: misc,smartphones. Write your asnwer as array of json objects. [{url_params: <url_here>, is_related: 'yes', category: <category_here> }] If the question is not related to products of the store, then your answer would be [{is_related: 'no'}] Be strict. Fix typos in product names. Dont write anything else. Your answer will be used for a next query. Client question: i want xiaomi 13 .Your answer:
DEBUG:urllib3.connectionpool:Starting new HTTP connection (1): wordpress:80
DEBUG:urllib3.connectionpool:http://wordpress:80 "GET /wp-json/chatty/v1/posts?product_name=xiaomi+13 HTTP/1.1" 200 1298
INFO:myapp:api data [{"id":17,"title":"Xiaomi 13","content":"<ul class=\"a-unordered-list a-vertical a-spacing-mini\">\r\n \t<li class=\"a-spacing-mini\"><span class=\"a-list-item\">Ultra-immersive display design Light up the screen to enjoy an unrivalled experience. The 1.61mm ultra-thin bezels offer a boundless vision.<\/span><\/li>\r\n \t<li class=\"a-spacing-mini\"><span class=\"a-list-item\">Built for more scenarios IP68 water and dust resistant* Born splash-proof and water-resistant, thanks to the precision manufacturing. Record special memories anytime and anywhere.<\/span><\/li>\r\n \t<li class=\"a-spacing-mini\"><span class=\"a-list-item\">Leica main camera with professional optical lens Captures every great moment<\/span><\/li>\r\n \t<li class=\"a-spacing-mini\"><span class=\"a-list-item\">Masterpiece performance Leading Snapdragon 8 Gen 2 Boosted performance, reduced consumption<\/span><\/li>\r\n<\/ul>","date":"27.12.2023","attributes":{"pa_color":["silver"]},"stock":null,"image_url":false,"sku":"141234","price":"16000","formatted_price":"<span class=\"woocommerce-Price-amount amount\"><bdi>16000,00&nbsp;<span class=\"woocommerce-Price-currencySymbol\">&#8381;<\/span><\/bdi><\/span>","product_link":"http:\/\/wordpress\/product\/%d0%ba%d1%80%d0%be%d1%81%d1%81%d0%be%d0%b2%d0%ba%d0%b8\/"}]
DEBUG:llama_index.storage.kvstore.simple_kvstore:Loading llama_index.storage.kvstore.simple_kvstore from projects/4/data\docstore.json.
DEBUG:fsspec.local:open file: C:/OSPanel/domains/ai_assistant/api/projects/4/data/docstore.json
DEBUG:llama_index.storage.kvstore.simple_kvstore:Loading llama_index.storage.kvstore.simple_kvstore from projects/4/data\index_store.json.
DEBUG:fsspec.local:open file: C:/OSPanel/domains/ai_assistant/api/projects/4/data/index_store.json
DEBUG:llama_index.vector_stores.simple:Loading llama_index.vector_stores.simple from projects/4/data\vector_store.json.
DEBUG:fsspec.local:open file: C:/OSPanel/domains/ai_assistant/api/projects/4/data/vector_store.json
DEBUG:llama_index.graph_stores.simple:Loading llama_index.graph_stores.simple from projects/4/data\graph_store.json.
DEBUG:fsspec.local:open file: C:/OSPanel/domains/ai_assistant/api/projects/4/data/graph_store.json
INFO:llama_index.indices.loading:Loading indices with ids: ['vector_index']
DEBUG:openai:message='Request to OpenAI API' method=post path=https://api.openai.com/v1/embeddings
DEBUG:openai:api_version=None data='{"input": ["i want xiaomi 13"], "model": "text-embedding-ada-002", "encoding_format": "base64"}' message='Post details'
DEBUG:urllib3.util.retry:Converted retries value: 2 -> Retry(total=2, connect=None, read=None, redirect=None, status=None)
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.openai.com:443
DEBUG:urllib3.connectionpool:https://api.openai.com:443 "POST /v1/embeddings HTTP/1.1" 200 None
DEBUG:openai:message='OpenAI API response' path=https://api.openai.com/v1/embeddings processing_ms=16 request_id=c05ff8b5f1378d180370bf7ee0b673de response_code=200
DEBUG:llama_index.indices.utils:> Top 1 nodes:
> [Node 909c5dd5-e87e-4999-a794-761f96e44168] [Similarity score:             -0.0286855] Welcome to TechHub, your ultimate destination for cutting-edge technology and innovation! At Tech...
DEBUG:openai:message='Request to OpenAI API' method=post path=https://api.openai.com/v1/chat/completions
DEBUG:openai:api_version=None data='{"messages": [{"role": "system", "content": "Context information is below.\\n--------------------\\nWelcome to TechHub, your ultimate destination for cutting-edge technology and innovation! At TechHub, we pride ourselves on being a premier online store dedicated to providing a curated selection of the latest and greatest in tech gadgets, including laptops, smartphones, and more.\\n\\nAbout Us:\\n\\nAt the heart of TechHub is a passion for technology and a commitment to delivering top-notch products that seamlessly blend style, functionality, and performance. With a team of tech enthusiasts, we understand the ever-evolving nature of the digital landscape and strive to stay at the forefront of the latest trends and advancements.\\n\\nOur Mission:\\n\\nOur mission at TechHub is to empower our customers with the best tools and devices that enhance their digital lifestyle. Whether you\'re a professional looking for a high-performance laptop to boost productivity or a smartphone aficionado seeking the latest flagship model, we\'ve got you covered. We believe that technology should not only meet but exceed your expectations, making every interaction with your devices a seamless and enjoyable experience.\\n\\nQuality Assurance:\\n\\nTechHub is committed to delivering products of the highest quality. We carefully curate our inventory, partnering with leading brands known for their commitment to excellence. Each product undergoes rigorous testing to ensure reliability, durability, and top-notch performance. Our dedication to quality assurance is reflected in every item we offer.\\n\\nCustomer-Centric Approach:\\n\\nAt TechHub, our customers are at the core of everything we do. We prioritize your satisfaction and strive to provide an unparalleled shopping experience. Our customer support team is ready to assist you at every step, from product inquiries to after-sales support. We value your feedback and continuously work to improve our services based on your needs.\\n\\nSecure Shopping:\\n\\nYour online security is our priority. TechHub employs state-of-the-art encryption technology to ensure that your personal information remains secure and protected. Shop with confidence, knowing that your data is in safe hands.\\n\\nExplore the world of innovation at TechHub, where technology meets lifestyle. Discover the perfect blend of style and functionality with our carefully curated selection of laptops, smartphones, and other cutting-edge gadgets. Join us on this exciting journey, and let\'s embrace the future together!\\n--------------------\\n\\u0412\\u044b \\u2014 \\u0418\\u0418 \\u0430\\u0441\\u0441\\u0438\\u0441\\u0442\\u0435\\u043d\\u0442 \\u043a\\u043e\\u043c\\u043f\\u0430\\u043d\\u0438\\u0438. \\u0412\\u0430\\u043c \\u0431\\u0443\\u0434\\u0443\\u0442 \\u0437\\u0430\\u0434\\u0430\\u043d\\u044b \\u0432\\u043e\\u043f\\u0440\\u043e\\u0441\\u044b \\u043e \\u043d\\u0430\\u0448\\u0435\\u0439 \\u043a\\u043e\\u043c\\u043f\\u0430\\u043d\\u0438\\u0438. \\u0412\\u0435\\u0436\\u043b\\u0438\\u0432\\u043e \\u043e\\u0442\\u0432\\u0435\\u0447\\u0430\\u0439\\u0442\\u0435 \\u043d\\u0430 \\u0432\\u043e\\u043f\\u0440\\u043e\\u0441\\u044b.\\r\\n    \\u041d\\u0438\\u0436\\u0435 \\u043c\\u044b \\u043f\\u0440\\u0435\\u0434\\u043e\\u0441\\u0442\\u0430\\u0432\\u0438\\u043b\\u0438 \\u043a\\u043e\\u043d\\u0442\\u0435\\u043a\\u0441\\u0442\\u043d\\u0443\\u044e \\u0438\\u043d\\u0444\\u043e\\u0440\\u043c\\u0430\\u0446\\u0438\\u044e.\\r\\n    ---------------------\\r\\n    {context_str}\\r\\n    ---------------------\\r\\n    \\u0423\\u0447\\u0438\\u0442\\u044b\\u0432\\u0430\\u044f \\u044d\\u0442\\u0443 \\u0438\\u043d\\u0444\\u043e\\u0440\\u043c\\u0430\\u0446\\u0438\\u044e, \\u043e\\u0442\\u0432\\u0435\\u0442\\u044c\\u0442\\u0435, \\u043f\\u043e\\u0436\\u0430\\u043b\\u0443\\u0439\\u0441\\u0442\\u0430, \\u043d\\u0430 \\u0432\\u043e\\u043f\\u0440\\u043e\\u0441: {query_str}\\r\\n    . \\n Information about relative products [{\\"id\\":17,\\"title\\":\\"Xiaomi 13\\",\\"content\\":\\"<ul class=\\\\\\"a-unordered-list a-vertical a-spacing-mini\\\\\\">\\\\r\\\\n \\\\t<li class=\\\\\\"a-spacing-mini\\\\\\"><span class=\\\\\\"a-list-item\\\\\\">Ultra-immersive display design Light up the screen to enjoy an unrivalled experience. The 1.61mm ultra-thin bezels offer a boundless vision.<\\\\/span><\\\\/li>\\\\r\\\\n \\\\t<li class=\\\\\\"a-spacing-mini\\\\\\"><span class=\\\\\\"a-list-item\\\\\\">Built for more scenarios IP68 water and dust resistant* Born splash-proof and water-resistant, thanks to the precision manufacturing. Record special memories anytime and anywhere.<\\\\/span><\\\\/li>\\\\r\\\\n \\\\t<li class=\\\\\\"a-spacing-mini\\\\\\"><span class=\\\\\\"a-list-item\\\\\\">Leica main camera with professional optical lens Captures every great moment<\\\\/span><\\\\/li>\\\\r\\\\n \\\\t<li class=\\\\\\"a-spacing-mini\\\\\\"><span class=\\\\\\"a-list-item\\\\\\">Masterpiece performance Leading Snapdragon 8 Gen 2 Boosted performance, reduced consumption<\\\\/span><\\\\/li>\\\\r\\\\n<\\\\/ul>\\",\\"date\\":\\"27.12.2023\\",\\"attributes\\":{\\"pa_color\\":[\\"silver\\"]},\\"stock\\":null,\\"image_url\\":false,\\"sku\\":\\"141234\\",\\"price\\":\\"16000\\",\\"formatted_price\\":\\"<span class=\\\\\\"woocommerce-Price-amount amount\\\\\\"><bdi>16000,00&nbsp;<span class=\\\\\\"woocommerce-Price-currencySymbol\\\\\\">&#8381;<\\\\/span><\\\\/bdi><\\\\/span>\\",\\"product_link\\":\\"http:\\\\/\\\\/wordpress\\\\/product\\\\/%d0%ba%d1%80%d0%be%d1%81%d1%81%d0%be%d0%b2%d0%ba%d0%b8\\\\/\\"}]"}, {"role": "user", "content": "i want xiaomi 13"}], "stream": false, "model": "gpt-3.5-turbo", "temperature": 0, "max_tokens": null}' message='Post details'
DEBUG:urllib3.connectionpool:https://api.openai.com:443 "POST /v1/chat/completions HTTP/1.1" 200 None
DEBUG:openai:message='OpenAI API response' path=https://api.openai.com/v1/chat/completions processing_ms=4662 request_id=9a7dd42305a5bc92444bd6879058f856 response_code=200
INFO:myapp:{'api': 1, 'product_data': '{"attributes": "color", "categories": "misc,smartphones"}', 'website': 'asdf', 'id': 4, 'left_tokens': 10876, 'description': None, 'temperature': Decimal('0.00'), 'model': 'gpt-3.5-turbo', 'prompt': 'Вы — ИИ ассистент компании. Вам будут заданы вопросы о нашей компании. Вежливо отвечайте на вопросы.\r\n    Ниже мы предоставили контекстную информацию.\r\n    ---------------------\r\n    {context_str}\r\n    ---------------------\r\n    Учитывая эту информацию, ответьте, пожалуйста, на вопрос: {query_str}\r\n    ', 'response_mode': 'compact', 'user_id': 12, 'answer': None, 'context': None}
DEBUG:root:This is a debug message
DEBUG:celery.utils.functional:
def send_chat_request(user_id, project_id, session, total_tokens, answer, context):
    return 1

INFO:werkzeug:127.0.0.1 - - [31/Dec/2023 23:09:03] "POST /projects/e47f0f811145d03c33fd6639dc3f09c0839d0891e264d849a75df04f4d047625/muP1mAescqmU3XarnFTBxn5zmnVbaCOi HTTP/1.1" 200 -
INFO:werkzeug:127.0.0.1 - - [31/Dec/2023 23:09:52] "OPTIONS /projects/e47f0f811145d03c33fd6639dc3f09c0839d0891e264d849a75df04f4d047625/muP1mAescqmU3XarnFTBxn5zmnVbaCOi HTTP/1.1" 200 -
INFO:myapp:{'api': 1, 'product_data': '{"attributes": "color", "categories": "misc,smartphones"}', 'website': 'asdf', 'id': 4, 'left_tokens': 9804, 'description': None, 'temperature': Decimal('0.00'), 'model': 'gpt-3.5-turbo', 'prompt': 'Вы — ИИ ассистент компании. Вам будут заданы вопросы о нашей компании. Вежливо отвечайте на вопросы.\r\n    Ниже мы предоставили контекстную информацию.\r\n    ---------------------\r\n    {context_str}\r\n    ---------------------\r\n    Учитывая эту информацию, ответьте, пожалуйста, на вопрос: {query_str}\r\n    ', 'response_mode': 'compact', 'user_id': 12, 'answer': 'Client: i want xiaomi 13,\nAi response: Sure! We have the Xiaomi 13 available for purchase. It features an ultra-immersive display design with 1.61mm ultra-thin bezels, providing a boundless vision. It is also IP68 water and dust resistant, making it splash-proof and water-resistant. The Xiaomi 13 comes with a Leica main camera with a professional optical lens, allowing you to capture every great moment. It is powered by the leading Snapdragon 8 Gen 2 processor, offering boosted performance and reduced consumption. The price for the Xiaomi 13 is 16,000 rubles. You can find more information and make a purchase on our website: [Xiaomi 13](http://wordpress/product/кроссовки/)', 'context': '[{"id":17,"title":"Xiaomi 13","content":"<ul class=\\"a-unordered-list a-vertical a-spacing-mini\\">\\r\\n \\t<li class=\\"a-spacing-mini\\"><span class=\\"a-list-item\\">Ultra-immersive display design Light up the screen to enjoy an unrivalled experience. The 1.61mm ultra-thin bezels offer a boundless vision.<\\/span><\\/li>\\r\\n \\t<li class=\\"a-spacing-mini\\"><span class=\\"a-list-item\\">Built for more scenarios IP68 water and dust resistant* Born splash-proof and water-resistant, thanks to the precision manufacturing. Record special memories anytime and anywhere.<\\/span><\\/li>\\r\\n \\t<li class=\\"a-spacing-mini\\"><span class=\\"a-list-item\\">Leica main camera with professional optical lens Captures every great moment<\\/span><\\/li>\\r\\n \\t<li class=\\"a-spacing-mini\\"><span class=\\"a-list-item\\">Masterpiece performance Leading Snapdragon 8 Gen 2 Boosted performance, reduced consumption<\\/span><\\/li>\\r\\n<\\/ul>","date":"27.12.2023","attributes":{"pa_color":["silver"]},"stock":null,"image_url":false,"sku":"141234","price":"16000","formatted_price":"<span class=\\"woocommerce-Price-amount amount\\"><bdi>16000,00&nbsp;<span class=\\"woocommerce-Price-currencySymbol\\">&#8381;<\\/span><\\/bdi><\\/span>","product_link":"http:\\/\\/wordpress\\/product\\/%d0%ba%d1%80%d0%be%d1%81%d1%81%d0%be%d0%b2%d0%ba%d0%b8\\/"}]'}
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.openai.com:443
DEBUG:urllib3.connectionpool:https://api.openai.com:443 "POST /v1/chat/completions HTTP/1.1" 200 None
INFO:myapp:[{'url_params': 'product_name=xiaomi 12', 'is_related': 'yes', 'category': 'smartphones'}]
INFO:myapp:product_name=xiaomi 12
INFO:myapp:prompt
INFO:myapp:You are AI assistant for a online shop. You should determine if a client is asking or information about a product in our store. It can be a question about price, availability in stock, product characteristic, comparing 2 products. In this case you should contruct query parameters based on a client question. Construct them for every mentioned product. Add sort_price parameter if required .For example product_name=item_name&color=green&size=44&sort_price=desc|asc List of available query parameters: product_name, color product_name is a required parameter. You should use it in every query.Use only these query parameters for consructing. Add a category. List of available categories: misc,smartphones. Write your asnwer as array of json objects. [{url_params: <url_here>, is_related: 'yes', category: <category_here> }] If the question is not related to products of the store, then your answer would be [{is_related: 'no'}] Be strict. Fix typos in product names. Dont write anything else. Your answer will be used for a next query. Client question: is it better that xiaomi 12? .Your answer:
DEBUG:urllib3.connectionpool:Starting new HTTP connection (1): wordpress:80
DEBUG:urllib3.connectionpool:http://wordpress:80 "GET /wp-json/chatty/v1/posts?product_name=xiaomi+12 HTTP/1.1" 200 455
INFO:myapp:api data [{"id":20,"title":"Xiaomi Redmi 12 128GB &#8212; Black &#8212; Unlocked &#8212; Dual-SIM","content":"","date":"29.12.2023","attributes":{"pa_color":["black"]},"stock":null,"image_url":false,"sku":"141234-1","price":"15000","formatted_price":"<span class=\"woocommerce-Price-amount amount\"><bdi>15000,00&nbsp;<span class=\"woocommerce-Price-currencySymbol\">&#8381;<\/span><\/bdi><\/span>","product_link":"http:\/\/wordpress\/product\/xiaomi-12-black\/"}]
INFO:werkzeug:127.0.0.1 - - [31/Dec/2023 23:09:55] "[31m[1mPOST /projects/e47f0f811145d03c33fd6639dc3f09c0839d0891e264d849a75df04f4d047625/muP1mAescqmU3XarnFTBxn5zmnVbaCOi HTTP/1.1[0m" 403 -
INFO:werkzeug:127.0.0.1 - - [31/Dec/2023 23:11:14] "GET /files/e47f0f811145d03c33fd6639dc3f09c0839d0891e264d849a75df04f4d047625 HTTP/1.1" 200 -
INFO:werkzeug:127.0.0.1 - - [31/Dec/2023 23:11:21] "GET /files/e47f0f811145d03c33fd6639dc3f09c0839d0891e264d849a75df04f4d047625 HTTP/1.1" 200 -
INFO:werkzeug:127.0.0.1 - - [31/Dec/2023 23:11:33] "GET /files/e47f0f811145d03c33fd6639dc3f09c0839d0891e264d849a75df04f4d047625 HTTP/1.1" 200 -
INFO:werkzeug:127.0.0.1 - - [31/Dec/2023 23:11:41] "OPTIONS /projects/e47f0f811145d03c33fd6639dc3f09c0839d0891e264d849a75df04f4d047625/muP1mAescqmU3XarnFTBxn5zmnVbaCOi HTTP/1.1" 200 -
INFO:myapp:{'api': 1, 'product_data': '{"attributes": "color", "categories": "misc,smartphones"}', 'website': 'asdf', 'id': 4, 'left_tokens': 100000, 'description': None, 'temperature': Decimal('0.00'), 'model': 'gpt-3.5-turbo', 'prompt': 'Вы — ИИ ассистент компании. Вам будут заданы вопросы о нашей компании. Вежливо отвечайте на вопросы.\r\n    Ниже мы предоставили контекстную информацию.\r\n    ---------------------\r\n    {context_str}\r\n    ---------------------\r\n    Учитывая эту информацию, ответьте, пожалуйста, на вопрос: {query_str}\r\n    ', 'response_mode': 'compact', 'user_id': 12, 'answer': 'Client: i want xiaomi 13,\nAi response: Sure! We have the Xiaomi 13 available for purchase. It features an ultra-immersive display design with 1.61mm ultra-thin bezels, providing a boundless vision. It is also IP68 water and dust resistant, making it splash-proof and water-resistant. The Xiaomi 13 comes with a Leica main camera with a professional optical lens, allowing you to capture every great moment. It is powered by the leading Snapdragon 8 Gen 2 processor, offering boosted performance and reduced consumption. The price for the Xiaomi 13 is 16,000 rubles. You can find more information and make a purchase on our website: [Xiaomi 13](http://wordpress/product/кроссовки/)', 'context': '[{"id":17,"title":"Xiaomi 13","content":"<ul class=\\"a-unordered-list a-vertical a-spacing-mini\\">\\r\\n \\t<li class=\\"a-spacing-mini\\"><span class=\\"a-list-item\\">Ultra-immersive display design Light up the screen to enjoy an unrivalled experience. The 1.61mm ultra-thin bezels offer a boundless vision.<\\/span><\\/li>\\r\\n \\t<li class=\\"a-spacing-mini\\"><span class=\\"a-list-item\\">Built for more scenarios IP68 water and dust resistant* Born splash-proof and water-resistant, thanks to the precision manufacturing. Record special memories anytime and anywhere.<\\/span><\\/li>\\r\\n \\t<li class=\\"a-spacing-mini\\"><span class=\\"a-list-item\\">Leica main camera with professional optical lens Captures every great moment<\\/span><\\/li>\\r\\n \\t<li class=\\"a-spacing-mini\\"><span class=\\"a-list-item\\">Masterpiece performance Leading Snapdragon 8 Gen 2 Boosted performance, reduced consumption<\\/span><\\/li>\\r\\n<\\/ul>","date":"27.12.2023","attributes":{"pa_color":["silver"]},"stock":null,"image_url":false,"sku":"141234","price":"16000","formatted_price":"<span class=\\"woocommerce-Price-amount amount\\"><bdi>16000,00&nbsp;<span class=\\"woocommerce-Price-currencySymbol\\">&#8381;<\\/span><\\/bdi><\\/span>","product_link":"http:\\/\\/wordpress\\/product\\/%d0%ba%d1%80%d0%be%d1%81%d1%81%d0%be%d0%b2%d0%ba%d0%b8\\/"}]'}
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.openai.com:443
DEBUG:urllib3.connectionpool:https://api.openai.com:443 "POST /v1/chat/completions HTTP/1.1" 200 None
INFO:myapp:[{'url_params': 'product_name=xiaomi 13', 'is_related': 'yes', 'category': 'smartphones'}]
INFO:myapp:product_name=xiaomi 13
INFO:myapp:prompt
INFO:myapp:You are AI assistant for a online shop. You should determine if a client is asking or information about a product in our store. It can be a question about price, availability in stock, product characteristic, comparing 2 products. In this case you should contruct query parameters based on a client question. Construct them for every mentioned product. Add sort_price parameter if required .For example product_name=item_name&color=green&size=44&sort_price=desc|asc List of available query parameters: product_name, color product_name is a required parameter. You should use it in every query.Use only these query parameters for consructing. Add a category. List of available categories: misc,smartphones. Write your asnwer as array of json objects. [{url_params: <url_here>, is_related: 'yes', category: <category_here> }] If the question is not related to products of the store, then your answer would be [{is_related: 'no'}] Be strict. Fix typos in product names. Dont write anything else. Your answer will be used for a next query. Client question: i want xiaomi 13 .Your answer:
DEBUG:urllib3.connectionpool:Starting new HTTP connection (1): wordpress:80
DEBUG:urllib3.connectionpool:http://wordpress:80 "GET /wp-json/chatty/v1/posts?product_name=xiaomi+13 HTTP/1.1" 200 1298
INFO:myapp:api data [{"id":17,"title":"Xiaomi 13","content":"<ul class=\"a-unordered-list a-vertical a-spacing-mini\">\r\n \t<li class=\"a-spacing-mini\"><span class=\"a-list-item\">Ultra-immersive display design Light up the screen to enjoy an unrivalled experience. The 1.61mm ultra-thin bezels offer a boundless vision.<\/span><\/li>\r\n \t<li class=\"a-spacing-mini\"><span class=\"a-list-item\">Built for more scenarios IP68 water and dust resistant* Born splash-proof and water-resistant, thanks to the precision manufacturing. Record special memories anytime and anywhere.<\/span><\/li>\r\n \t<li class=\"a-spacing-mini\"><span class=\"a-list-item\">Leica main camera with professional optical lens Captures every great moment<\/span><\/li>\r\n \t<li class=\"a-spacing-mini\"><span class=\"a-list-item\">Masterpiece performance Leading Snapdragon 8 Gen 2 Boosted performance, reduced consumption<\/span><\/li>\r\n<\/ul>","date":"27.12.2023","attributes":{"pa_color":["silver"]},"stock":null,"image_url":false,"sku":"141234","price":"16000","formatted_price":"<span class=\"woocommerce-Price-amount amount\"><bdi>16000,00&nbsp;<span class=\"woocommerce-Price-currencySymbol\">&#8381;<\/span><\/bdi><\/span>","product_link":"http:\/\/wordpress\/product\/%d0%ba%d1%80%d0%be%d1%81%d1%81%d0%be%d0%b2%d0%ba%d0%b8\/"}]
DEBUG:llama_index.storage.kvstore.simple_kvstore:Loading llama_index.storage.kvstore.simple_kvstore from projects/4/data\docstore.json.
DEBUG:fsspec.local:open file: C:/OSPanel/domains/ai_assistant/api/projects/4/data/docstore.json
DEBUG:llama_index.storage.kvstore.simple_kvstore:Loading llama_index.storage.kvstore.simple_kvstore from projects/4/data\index_store.json.
DEBUG:fsspec.local:open file: C:/OSPanel/domains/ai_assistant/api/projects/4/data/index_store.json
DEBUG:llama_index.vector_stores.simple:Loading llama_index.vector_stores.simple from projects/4/data\vector_store.json.
DEBUG:fsspec.local:open file: C:/OSPanel/domains/ai_assistant/api/projects/4/data/vector_store.json
DEBUG:llama_index.graph_stores.simple:Loading llama_index.graph_stores.simple from projects/4/data\graph_store.json.
DEBUG:fsspec.local:open file: C:/OSPanel/domains/ai_assistant/api/projects/4/data/graph_store.json
INFO:llama_index.indices.loading:Loading indices with ids: ['vector_index']
DEBUG:openai:message='Request to OpenAI API' method=post path=https://api.openai.com/v1/embeddings
DEBUG:openai:api_version=None data='{"input": ["i want xiaomi 13"], "model": "text-embedding-ada-002", "encoding_format": "base64"}' message='Post details'
DEBUG:urllib3.util.retry:Converted retries value: 2 -> Retry(total=2, connect=None, read=None, redirect=None, status=None)
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.openai.com:443
DEBUG:urllib3.connectionpool:https://api.openai.com:443 "POST /v1/embeddings HTTP/1.1" 200 None
DEBUG:openai:message='OpenAI API response' path=https://api.openai.com/v1/embeddings processing_ms=19 request_id=3563a7ffaf6cf842a2b8790c4c4fbe14 response_code=200
DEBUG:llama_index.indices.utils:> Top 1 nodes:
> [Node 909c5dd5-e87e-4999-a794-761f96e44168] [Similarity score:             -0.0286855] Welcome to TechHub, your ultimate destination for cutting-edge technology and innovation! At Tech...
DEBUG:openai:message='Request to OpenAI API' method=post path=https://api.openai.com/v1/chat/completions
DEBUG:openai:api_version=None data='{"messages": [{"role": "system", "content": "Context information is below.\\n--------------------\\nWelcome to TechHub, your ultimate destination for cutting-edge technology and innovation! At TechHub, we pride ourselves on being a premier online store dedicated to providing a curated selection of the latest and greatest in tech gadgets, including laptops, smartphones, and more.\\n\\nAbout Us:\\n\\nAt the heart of TechHub is a passion for technology and a commitment to delivering top-notch products that seamlessly blend style, functionality, and performance. With a team of tech enthusiasts, we understand the ever-evolving nature of the digital landscape and strive to stay at the forefront of the latest trends and advancements.\\n\\nOur Mission:\\n\\nOur mission at TechHub is to empower our customers with the best tools and devices that enhance their digital lifestyle. Whether you\'re a professional looking for a high-performance laptop to boost productivity or a smartphone aficionado seeking the latest flagship model, we\'ve got you covered. We believe that technology should not only meet but exceed your expectations, making every interaction with your devices a seamless and enjoyable experience.\\n\\nQuality Assurance:\\n\\nTechHub is committed to delivering products of the highest quality. We carefully curate our inventory, partnering with leading brands known for their commitment to excellence. Each product undergoes rigorous testing to ensure reliability, durability, and top-notch performance. Our dedication to quality assurance is reflected in every item we offer.\\n\\nCustomer-Centric Approach:\\n\\nAt TechHub, our customers are at the core of everything we do. We prioritize your satisfaction and strive to provide an unparalleled shopping experience. Our customer support team is ready to assist you at every step, from product inquiries to after-sales support. We value your feedback and continuously work to improve our services based on your needs.\\n\\nSecure Shopping:\\n\\nYour online security is our priority. TechHub employs state-of-the-art encryption technology to ensure that your personal information remains secure and protected. Shop with confidence, knowing that your data is in safe hands.\\n\\nExplore the world of innovation at TechHub, where technology meets lifestyle. Discover the perfect blend of style and functionality with our carefully curated selection of laptops, smartphones, and other cutting-edge gadgets. Join us on this exciting journey, and let\'s embrace the future together!\\n--------------------\\n\\u0412\\u044b \\u2014 \\u0418\\u0418 \\u0430\\u0441\\u0441\\u0438\\u0441\\u0442\\u0435\\u043d\\u0442 \\u043a\\u043e\\u043c\\u043f\\u0430\\u043d\\u0438\\u0438. \\u0412\\u0430\\u043c \\u0431\\u0443\\u0434\\u0443\\u0442 \\u0437\\u0430\\u0434\\u0430\\u043d\\u044b \\u0432\\u043e\\u043f\\u0440\\u043e\\u0441\\u044b \\u043e \\u043d\\u0430\\u0448\\u0435\\u0439 \\u043a\\u043e\\u043c\\u043f\\u0430\\u043d\\u0438\\u0438. \\u0412\\u0435\\u0436\\u043b\\u0438\\u0432\\u043e \\u043e\\u0442\\u0432\\u0435\\u0447\\u0430\\u0439\\u0442\\u0435 \\u043d\\u0430 \\u0432\\u043e\\u043f\\u0440\\u043e\\u0441\\u044b.\\r\\n    \\u041d\\u0438\\u0436\\u0435 \\u043c\\u044b \\u043f\\u0440\\u0435\\u0434\\u043e\\u0441\\u0442\\u0430\\u0432\\u0438\\u043b\\u0438 \\u043a\\u043e\\u043d\\u0442\\u0435\\u043a\\u0441\\u0442\\u043d\\u0443\\u044e \\u0438\\u043d\\u0444\\u043e\\u0440\\u043c\\u0430\\u0446\\u0438\\u044e.\\r\\n    ---------------------\\r\\n    {context_str}\\r\\n    ---------------------\\r\\n    \\u0423\\u0447\\u0438\\u0442\\u044b\\u0432\\u0430\\u044f \\u044d\\u0442\\u0443 \\u0438\\u043d\\u0444\\u043e\\u0440\\u043c\\u0430\\u0446\\u0438\\u044e, \\u043e\\u0442\\u0432\\u0435\\u0442\\u044c\\u0442\\u0435, \\u043f\\u043e\\u0436\\u0430\\u043b\\u0443\\u0439\\u0441\\u0442\\u0430, \\u043d\\u0430 \\u0432\\u043e\\u043f\\u0440\\u043e\\u0441: {query_str}\\r\\n    . \\n Information about relative products [{\\"id\\":17,\\"title\\":\\"Xiaomi 13\\",\\"content\\":\\"<ul class=\\\\\\"a-unordered-list a-vertical a-spacing-mini\\\\\\">\\\\r\\\\n \\\\t<li class=\\\\\\"a-spacing-mini\\\\\\"><span class=\\\\\\"a-list-item\\\\\\">Ultra-immersive display design Light up the screen to enjoy an unrivalled experience. The 1.61mm ultra-thin bezels offer a boundless vision.<\\\\/span><\\\\/li>\\\\r\\\\n \\\\t<li class=\\\\\\"a-spacing-mini\\\\\\"><span class=\\\\\\"a-list-item\\\\\\">Built for more scenarios IP68 water and dust resistant* Born splash-proof and water-resistant, thanks to the precision manufacturing. Record special memories anytime and anywhere.<\\\\/span><\\\\/li>\\\\r\\\\n \\\\t<li class=\\\\\\"a-spacing-mini\\\\\\"><span class=\\\\\\"a-list-item\\\\\\">Leica main camera with professional optical lens Captures every great moment<\\\\/span><\\\\/li>\\\\r\\\\n \\\\t<li class=\\\\\\"a-spacing-mini\\\\\\"><span class=\\\\\\"a-list-item\\\\\\">Masterpiece performance Leading Snapdragon 8 Gen 2 Boosted performance, reduced consumption<\\\\/span><\\\\/li>\\\\r\\\\n<\\\\/ul>\\",\\"date\\":\\"27.12.2023\\",\\"attributes\\":{\\"pa_color\\":[\\"silver\\"]},\\"stock\\":null,\\"image_url\\":false,\\"sku\\":\\"141234\\",\\"price\\":\\"16000\\",\\"formatted_price\\":\\"<span class=\\\\\\"woocommerce-Price-amount amount\\\\\\"><bdi>16000,00&nbsp;<span class=\\\\\\"woocommerce-Price-currencySymbol\\\\\\">&#8381;<\\\\/span><\\\\/bdi><\\\\/span>\\",\\"product_link\\":\\"http:\\\\/\\\\/wordpress\\\\/product\\\\/%d0%ba%d1%80%d0%be%d1%81%d1%81%d0%be%d0%b2%d0%ba%d0%b8\\\\/\\"}][{\\"id\\":17,\\"title\\":\\"Xiaomi 13\\",\\"content\\":\\"<ul class=\\\\\\"a-unordered-list a-vertical a-spacing-mini\\\\\\">\\\\r\\\\n \\\\t<li class=\\\\\\"a-spacing-mini\\\\\\"><span class=\\\\\\"a-list-item\\\\\\">Ultra-immersive display design Light up the screen to enjoy an unrivalled experience. The 1.61mm ultra-thin bezels offer a boundless vision.<\\\\/span><\\\\/li>\\\\r\\\\n \\\\t<li class=\\\\\\"a-spacing-mini\\\\\\"><span class=\\\\\\"a-list-item\\\\\\">Built for more scenarios IP68 water and dust resistant* Born splash-proof and water-resistant, thanks to the precision manufacturing. Record special memories anytime and anywhere.<\\\\/span><\\\\/li>\\\\r\\\\n \\\\t<li class=\\\\\\"a-spacing-mini\\\\\\"><span class=\\\\\\"a-list-item\\\\\\">Leica main camera with professional optical lens Captures every great moment<\\\\/span><\\\\/li>\\\\r\\\\n \\\\t<li class=\\\\\\"a-spacing-mini\\\\\\"><span class=\\\\\\"a-list-item\\\\\\">Masterpiece performance Leading Snapdragon 8 Gen 2 Boosted performance, reduced consumption<\\\\/span><\\\\/li>\\\\r\\\\n<\\\\/ul>\\",\\"date\\":\\"27.12.2023\\",\\"attributes\\":{\\"pa_color\\":[\\"silver\\"]},\\"stock\\":null,\\"image_url\\":false,\\"sku\\":\\"141234\\",\\"price\\":\\"16000\\",\\"formatted_price\\":\\"<span class=\\\\\\"woocommerce-Price-amount amount\\\\\\"><bdi>16000,00&nbsp;<span class=\\\\\\"woocommerce-Price-currencySymbol\\\\\\">&#8381;<\\\\/span><\\\\/bdi><\\\\/span>\\",\\"product_link\\":\\"http:\\\\/\\\\/wordpress\\\\/product\\\\/%d0%ba%d1%80%d0%be%d1%81%d1%81%d0%be%d0%b2%d0%ba%d0%b8\\\\/\\"}]"}, {"role": "user", "content": "i want xiaomi 13"}], "stream": false, "model": "gpt-3.5-turbo", "temperature": 0, "max_tokens": null}' message='Post details'
DEBUG:urllib3.connectionpool:https://api.openai.com:443 "POST /v1/chat/completions HTTP/1.1" 200 None
DEBUG:openai:message='OpenAI API response' path=https://api.openai.com/v1/chat/completions processing_ms=4877 request_id=47009f8252bb395b2aae40aca3a04f93 response_code=200
INFO:myapp:{'api': 1, 'product_data': '{"attributes": "color", "categories": "misc,smartphones"}', 'website': 'asdf', 'id': 4, 'left_tokens': 100000, 'description': None, 'temperature': Decimal('0.00'), 'model': 'gpt-3.5-turbo', 'prompt': 'Вы — ИИ ассистент компании. Вам будут заданы вопросы о нашей компании. Вежливо отвечайте на вопросы.\r\n    Ниже мы предоставили контекстную информацию.\r\n    ---------------------\r\n    {context_str}\r\n    ---------------------\r\n    Учитывая эту информацию, ответьте, пожалуйста, на вопрос: {query_str}\r\n    ', 'response_mode': 'compact', 'user_id': 12, 'answer': 'Client: i want xiaomi 13,\nAi response: Sure! We have the Xiaomi 13 available for purchase. It features an ultra-immersive display design with 1.61mm ultra-thin bezels, providing a boundless vision. It is also IP68 water and dust resistant, making it splash-proof and water-resistant. The Xiaomi 13 comes with a Leica main camera with a professional optical lens, allowing you to capture every great moment. It is powered by the leading Snapdragon 8 Gen 2 processor, offering boosted performance and reduced consumption. The price for the Xiaomi 13 is 16,000 rubles. You can find more information and make a purchase on our website: [Xiaomi 13](http://wordpress/product/кроссовки/)', 'context': '[{"id":17,"title":"Xiaomi 13","content":"<ul class=\\"a-unordered-list a-vertical a-spacing-mini\\">\\r\\n \\t<li class=\\"a-spacing-mini\\"><span class=\\"a-list-item\\">Ultra-immersive display design Light up the screen to enjoy an unrivalled experience. The 1.61mm ultra-thin bezels offer a boundless vision.<\\/span><\\/li>\\r\\n \\t<li class=\\"a-spacing-mini\\"><span class=\\"a-list-item\\">Built for more scenarios IP68 water and dust resistant* Born splash-proof and water-resistant, thanks to the precision manufacturing. Record special memories anytime and anywhere.<\\/span><\\/li>\\r\\n \\t<li class=\\"a-spacing-mini\\"><span class=\\"a-list-item\\">Leica main camera with professional optical lens Captures every great moment<\\/span><\\/li>\\r\\n \\t<li class=\\"a-spacing-mini\\"><span class=\\"a-list-item\\">Masterpiece performance Leading Snapdragon 8 Gen 2 Boosted performance, reduced consumption<\\/span><\\/li>\\r\\n<\\/ul>","date":"27.12.2023","attributes":{"pa_color":["silver"]},"stock":null,"image_url":false,"sku":"141234","price":"16000","formatted_price":"<span class=\\"woocommerce-Price-amount amount\\"><bdi>16000,00&nbsp;<span class=\\"woocommerce-Price-currencySymbol\\">&#8381;<\\/span><\\/bdi><\\/span>","product_link":"http:\\/\\/wordpress\\/product\\/%d0%ba%d1%80%d0%be%d1%81%d1%81%d0%be%d0%b2%d0%ba%d0%b8\\/"}]'}
INFO:werkzeug:127.0.0.1 - - [31/Dec/2023 23:11:50] "POST /projects/e47f0f811145d03c33fd6639dc3f09c0839d0891e264d849a75df04f4d047625/muP1mAescqmU3XarnFTBxn5zmnVbaCOi HTTP/1.1" 200 -
INFO:werkzeug:127.0.0.1 - - [31/Dec/2023 23:11:54] "GET /files/e47f0f811145d03c33fd6639dc3f09c0839d0891e264d849a75df04f4d047625 HTTP/1.1" 200 -
INFO:werkzeug:127.0.0.1 - - [31/Dec/2023 23:12:04] "OPTIONS /projects/e47f0f811145d03c33fd6639dc3f09c0839d0891e264d849a75df04f4d047625/tplIFi6pWGBPTIf32ToAWbLfhORxnj2g HTTP/1.1" 200 -
INFO:myapp:{'api': 1, 'product_data': '{"attributes": "color", "categories": "misc,smartphones"}', 'website': 'asdf', 'id': 4, 'left_tokens': 98554, 'description': None, 'temperature': Decimal('0.00'), 'model': 'gpt-3.5-turbo', 'prompt': 'Вы — ИИ ассистент компании. Вам будут заданы вопросы о нашей компании. Вежливо отвечайте на вопросы.\r\n    Ниже мы предоставили контекстную информацию.\r\n    ---------------------\r\n    {context_str}\r\n    ---------------------\r\n    Учитывая эту информацию, ответьте, пожалуйста, на вопрос: {query_str}\r\n    ', 'response_mode': 'compact', 'user_id': 12, 'answer': None, 'context': None}
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.openai.com:443
DEBUG:urllib3.connectionpool:https://api.openai.com:443 "POST /v1/chat/completions HTTP/1.1" 200 None
INFO:myapp:[{'url_params': 'product_name=xiaomi 13', 'is_related': 'yes', 'category': 'smartphones'}]
INFO:myapp:product_name=xiaomi 13
INFO:myapp:prompt
INFO:myapp:You are AI assistant for a online shop. You should determine if a client is asking or information about a product in our store. It can be a question about price, availability in stock, product characteristic, comparing 2 products. In this case you should contruct query parameters based on a client question. Construct them for every mentioned product. Add sort_price parameter if required .For example product_name=item_name&color=green&size=44&sort_price=desc|asc List of available query parameters: product_name, color product_name is a required parameter. You should use it in every query.Use only these query parameters for consructing. Add a category. List of available categories: misc,smartphones. Write your asnwer as array of json objects. [{url_params: <url_here>, is_related: 'yes', category: <category_here> }] If the question is not related to products of the store, then your answer would be [{is_related: 'no'}] Be strict. Fix typos in product names. Dont write anything else. Your answer will be used for a next query. Client question: i want xiaomi 13 .Your answer:
DEBUG:urllib3.connectionpool:Starting new HTTP connection (1): wordpress:80
DEBUG:urllib3.connectionpool:http://wordpress:80 "GET /wp-json/chatty/v1/posts?product_name=xiaomi+13 HTTP/1.1" 200 1298
INFO:myapp:api data [{"id":17,"title":"Xiaomi 13","content":"<ul class=\"a-unordered-list a-vertical a-spacing-mini\">\r\n \t<li class=\"a-spacing-mini\"><span class=\"a-list-item\">Ultra-immersive display design Light up the screen to enjoy an unrivalled experience. The 1.61mm ultra-thin bezels offer a boundless vision.<\/span><\/li>\r\n \t<li class=\"a-spacing-mini\"><span class=\"a-list-item\">Built for more scenarios IP68 water and dust resistant* Born splash-proof and water-resistant, thanks to the precision manufacturing. Record special memories anytime and anywhere.<\/span><\/li>\r\n \t<li class=\"a-spacing-mini\"><span class=\"a-list-item\">Leica main camera with professional optical lens Captures every great moment<\/span><\/li>\r\n \t<li class=\"a-spacing-mini\"><span class=\"a-list-item\">Masterpiece performance Leading Snapdragon 8 Gen 2 Boosted performance, reduced consumption<\/span><\/li>\r\n<\/ul>","date":"27.12.2023","attributes":{"pa_color":["silver"]},"stock":null,"image_url":false,"sku":"141234","price":"16000","formatted_price":"<span class=\"woocommerce-Price-amount amount\"><bdi>16000,00&nbsp;<span class=\"woocommerce-Price-currencySymbol\">&#8381;<\/span><\/bdi><\/span>","product_link":"http:\/\/wordpress\/product\/%d0%ba%d1%80%d0%be%d1%81%d1%81%d0%be%d0%b2%d0%ba%d0%b8\/"}]
DEBUG:llama_index.storage.kvstore.simple_kvstore:Loading llama_index.storage.kvstore.simple_kvstore from projects/4/data\docstore.json.
DEBUG:fsspec.local:open file: C:/OSPanel/domains/ai_assistant/api/projects/4/data/docstore.json
DEBUG:llama_index.storage.kvstore.simple_kvstore:Loading llama_index.storage.kvstore.simple_kvstore from projects/4/data\index_store.json.
DEBUG:fsspec.local:open file: C:/OSPanel/domains/ai_assistant/api/projects/4/data/index_store.json
DEBUG:llama_index.vector_stores.simple:Loading llama_index.vector_stores.simple from projects/4/data\vector_store.json.
DEBUG:fsspec.local:open file: C:/OSPanel/domains/ai_assistant/api/projects/4/data/vector_store.json
DEBUG:llama_index.graph_stores.simple:Loading llama_index.graph_stores.simple from projects/4/data\graph_store.json.
DEBUG:fsspec.local:open file: C:/OSPanel/domains/ai_assistant/api/projects/4/data/graph_store.json
INFO:llama_index.indices.loading:Loading indices with ids: ['vector_index']
DEBUG:openai:message='Request to OpenAI API' method=post path=https://api.openai.com/v1/embeddings
DEBUG:openai:api_version=None data='{"input": ["i want xiaomi 13"], "model": "text-embedding-ada-002", "encoding_format": "base64"}' message='Post details'
DEBUG:urllib3.util.retry:Converted retries value: 2 -> Retry(total=2, connect=None, read=None, redirect=None, status=None)
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.openai.com:443
DEBUG:urllib3.connectionpool:https://api.openai.com:443 "POST /v1/embeddings HTTP/1.1" 200 None
DEBUG:openai:message='OpenAI API response' path=https://api.openai.com/v1/embeddings processing_ms=25 request_id=525b5c3fe54d421dc0e584ebcb54c22d response_code=200
DEBUG:llama_index.indices.utils:> Top 1 nodes:
> [Node 909c5dd5-e87e-4999-a794-761f96e44168] [Similarity score:             -0.0286855] Welcome to TechHub, your ultimate destination for cutting-edge technology and innovation! At Tech...
DEBUG:openai:message='Request to OpenAI API' method=post path=https://api.openai.com/v1/chat/completions
DEBUG:openai:api_version=None data='{"messages": [{"role": "system", "content": "Context information is below.\\n--------------------\\nWelcome to TechHub, your ultimate destination for cutting-edge technology and innovation! At TechHub, we pride ourselves on being a premier online store dedicated to providing a curated selection of the latest and greatest in tech gadgets, including laptops, smartphones, and more.\\n\\nAbout Us:\\n\\nAt the heart of TechHub is a passion for technology and a commitment to delivering top-notch products that seamlessly blend style, functionality, and performance. With a team of tech enthusiasts, we understand the ever-evolving nature of the digital landscape and strive to stay at the forefront of the latest trends and advancements.\\n\\nOur Mission:\\n\\nOur mission at TechHub is to empower our customers with the best tools and devices that enhance their digital lifestyle. Whether you\'re a professional looking for a high-performance laptop to boost productivity or a smartphone aficionado seeking the latest flagship model, we\'ve got you covered. We believe that technology should not only meet but exceed your expectations, making every interaction with your devices a seamless and enjoyable experience.\\n\\nQuality Assurance:\\n\\nTechHub is committed to delivering products of the highest quality. We carefully curate our inventory, partnering with leading brands known for their commitment to excellence. Each product undergoes rigorous testing to ensure reliability, durability, and top-notch performance. Our dedication to quality assurance is reflected in every item we offer.\\n\\nCustomer-Centric Approach:\\n\\nAt TechHub, our customers are at the core of everything we do. We prioritize your satisfaction and strive to provide an unparalleled shopping experience. Our customer support team is ready to assist you at every step, from product inquiries to after-sales support. We value your feedback and continuously work to improve our services based on your needs.\\n\\nSecure Shopping:\\n\\nYour online security is our priority. TechHub employs state-of-the-art encryption technology to ensure that your personal information remains secure and protected. Shop with confidence, knowing that your data is in safe hands.\\n\\nExplore the world of innovation at TechHub, where technology meets lifestyle. Discover the perfect blend of style and functionality with our carefully curated selection of laptops, smartphones, and other cutting-edge gadgets. Join us on this exciting journey, and let\'s embrace the future together!\\n--------------------\\n\\u0412\\u044b \\u2014 \\u0418\\u0418 \\u0430\\u0441\\u0441\\u0438\\u0441\\u0442\\u0435\\u043d\\u0442 \\u043a\\u043e\\u043c\\u043f\\u0430\\u043d\\u0438\\u0438. \\u0412\\u0430\\u043c \\u0431\\u0443\\u0434\\u0443\\u0442 \\u0437\\u0430\\u0434\\u0430\\u043d\\u044b \\u0432\\u043e\\u043f\\u0440\\u043e\\u0441\\u044b \\u043e \\u043d\\u0430\\u0448\\u0435\\u0439 \\u043a\\u043e\\u043c\\u043f\\u0430\\u043d\\u0438\\u0438. \\u0412\\u0435\\u0436\\u043b\\u0438\\u0432\\u043e \\u043e\\u0442\\u0432\\u0435\\u0447\\u0430\\u0439\\u0442\\u0435 \\u043d\\u0430 \\u0432\\u043e\\u043f\\u0440\\u043e\\u0441\\u044b.\\r\\n    \\u041d\\u0438\\u0436\\u0435 \\u043c\\u044b \\u043f\\u0440\\u0435\\u0434\\u043e\\u0441\\u0442\\u0430\\u0432\\u0438\\u043b\\u0438 \\u043a\\u043e\\u043d\\u0442\\u0435\\u043a\\u0441\\u0442\\u043d\\u0443\\u044e \\u0438\\u043d\\u0444\\u043e\\u0440\\u043c\\u0430\\u0446\\u0438\\u044e.\\r\\n    ---------------------\\r\\n    {context_str}\\r\\n    ---------------------\\r\\n    \\u0423\\u0447\\u0438\\u0442\\u044b\\u0432\\u0430\\u044f \\u044d\\u0442\\u0443 \\u0438\\u043d\\u0444\\u043e\\u0440\\u043c\\u0430\\u0446\\u0438\\u044e, \\u043e\\u0442\\u0432\\u0435\\u0442\\u044c\\u0442\\u0435, \\u043f\\u043e\\u0436\\u0430\\u043b\\u0443\\u0439\\u0441\\u0442\\u0430, \\u043d\\u0430 \\u0432\\u043e\\u043f\\u0440\\u043e\\u0441: {query_str}\\r\\n    . \\n Information about relative products [{\\"id\\":17,\\"title\\":\\"Xiaomi 13\\",\\"content\\":\\"<ul class=\\\\\\"a-unordered-list a-vertical a-spacing-mini\\\\\\">\\\\r\\\\n \\\\t<li class=\\\\\\"a-spacing-mini\\\\\\"><span class=\\\\\\"a-list-item\\\\\\">Ultra-immersive display design Light up the screen to enjoy an unrivalled experience. The 1.61mm ultra-thin bezels offer a boundless vision.<\\\\/span><\\\\/li>\\\\r\\\\n \\\\t<li class=\\\\\\"a-spacing-mini\\\\\\"><span class=\\\\\\"a-list-item\\\\\\">Built for more scenarios IP68 water and dust resistant* Born splash-proof and water-resistant, thanks to the precision manufacturing. Record special memories anytime and anywhere.<\\\\/span><\\\\/li>\\\\r\\\\n \\\\t<li class=\\\\\\"a-spacing-mini\\\\\\"><span class=\\\\\\"a-list-item\\\\\\">Leica main camera with professional optical lens Captures every great moment<\\\\/span><\\\\/li>\\\\r\\\\n \\\\t<li class=\\\\\\"a-spacing-mini\\\\\\"><span class=\\\\\\"a-list-item\\\\\\">Masterpiece performance Leading Snapdragon 8 Gen 2 Boosted performance, reduced consumption<\\\\/span><\\\\/li>\\\\r\\\\n<\\\\/ul>\\",\\"date\\":\\"27.12.2023\\",\\"attributes\\":{\\"pa_color\\":[\\"silver\\"]},\\"stock\\":null,\\"image_url\\":false,\\"sku\\":\\"141234\\",\\"price\\":\\"16000\\",\\"formatted_price\\":\\"<span class=\\\\\\"woocommerce-Price-amount amount\\\\\\"><bdi>16000,00&nbsp;<span class=\\\\\\"woocommerce-Price-currencySymbol\\\\\\">&#8381;<\\\\/span><\\\\/bdi><\\\\/span>\\",\\"product_link\\":\\"http:\\\\/\\\\/wordpress\\\\/product\\\\/%d0%ba%d1%80%d0%be%d1%81%d1%81%d0%be%d0%b2%d0%ba%d0%b8\\\\/\\"}]"}, {"role": "user", "content": "i want xiaomi 13"}], "stream": false, "model": "gpt-3.5-turbo", "temperature": 0, "max_tokens": null}' message='Post details'
DEBUG:urllib3.connectionpool:https://api.openai.com:443 "POST /v1/chat/completions HTTP/1.1" 200 None
DEBUG:openai:message='OpenAI API response' path=https://api.openai.com/v1/chat/completions processing_ms=4633 request_id=66ad0978c34da07d31113b8ead6f39a2 response_code=200
INFO:myapp:{'api': 1, 'product_data': '{"attributes": "color", "categories": "misc,smartphones"}', 'website': 'asdf', 'id': 4, 'left_tokens': 98554, 'description': None, 'temperature': Decimal('0.00'), 'model': 'gpt-3.5-turbo', 'prompt': 'Вы — ИИ ассистент компании. Вам будут заданы вопросы о нашей компании. Вежливо отвечайте на вопросы.\r\n    Ниже мы предоставили контекстную информацию.\r\n    ---------------------\r\n    {context_str}\r\n    ---------------------\r\n    Учитывая эту информацию, ответьте, пожалуйста, на вопрос: {query_str}\r\n    ', 'response_mode': 'compact', 'user_id': 12, 'answer': None, 'context': None}
INFO:werkzeug:127.0.0.1 - - [31/Dec/2023 23:12:11] "POST /projects/e47f0f811145d03c33fd6639dc3f09c0839d0891e264d849a75df04f4d047625/tplIFi6pWGBPTIf32ToAWbLfhORxnj2g HTTP/1.1" 200 -
INFO:werkzeug:127.0.0.1 - - [31/Dec/2023 23:12:23] "OPTIONS /projects/e47f0f811145d03c33fd6639dc3f09c0839d0891e264d849a75df04f4d047625/tplIFi6pWGBPTIf32ToAWbLfhORxnj2g HTTP/1.1" 200 -
INFO:myapp:{'api': 1, 'product_data': '{"attributes": "color", "categories": "misc,smartphones"}', 'website': 'asdf', 'id': 4, 'left_tokens': 97480, 'description': None, 'temperature': Decimal('0.00'), 'model': 'gpt-3.5-turbo', 'prompt': 'Вы — ИИ ассистент компании. Вам будут заданы вопросы о нашей компании. Вежливо отвечайте на вопросы.\r\n    Ниже мы предоставили контекстную информацию.\r\n    ---------------------\r\n    {context_str}\r\n    ---------------------\r\n    Учитывая эту информацию, ответьте, пожалуйста, на вопрос: {query_str}\r\n    ', 'response_mode': 'compact', 'user_id': 12, 'answer': 'Client: i want xiaomi 13,\nAi response: Sure! We have the Xiaomi 13 available for purchase. It features an ultra-immersive display design with 1.61mm ultra-thin bezels, providing a boundless vision. It is also IP68 water and dust resistant, making it splash-proof and water-resistant. The Xiaomi 13 comes with a Leica main camera with a professional optical lens, allowing you to capture every great moment. It is powered by the leading Snapdragon 8 Gen 2 for boosted performance and reduced consumption. The price for the Xiaomi 13 is 16,000 rubles. You can find more information and make a purchase on our website using the following link: [Xiaomi 13](http://wordpress/product/кроссовки/)', 'context': '[{"id":17,"title":"Xiaomi 13","content":"<ul class=\\"a-unordered-list a-vertical a-spacing-mini\\">\\r\\n \\t<li class=\\"a-spacing-mini\\"><span class=\\"a-list-item\\">Ultra-immersive display design Light up the screen to enjoy an unrivalled experience. The 1.61mm ultra-thin bezels offer a boundless vision.<\\/span><\\/li>\\r\\n \\t<li class=\\"a-spacing-mini\\"><span class=\\"a-list-item\\">Built for more scenarios IP68 water and dust resistant* Born splash-proof and water-resistant, thanks to the precision manufacturing. Record special memories anytime and anywhere.<\\/span><\\/li>\\r\\n \\t<li class=\\"a-spacing-mini\\"><span class=\\"a-list-item\\">Leica main camera with professional optical lens Captures every great moment<\\/span><\\/li>\\r\\n \\t<li class=\\"a-spacing-mini\\"><span class=\\"a-list-item\\">Masterpiece performance Leading Snapdragon 8 Gen 2 Boosted performance, reduced consumption<\\/span><\\/li>\\r\\n<\\/ul>","date":"27.12.2023","attributes":{"pa_color":["silver"]},"stock":null,"image_url":false,"sku":"141234","price":"16000","formatted_price":"<span class=\\"woocommerce-Price-amount amount\\"><bdi>16000,00&nbsp;<span class=\\"woocommerce-Price-currencySymbol\\">&#8381;<\\/span><\\/bdi><\\/span>","product_link":"http:\\/\\/wordpress\\/product\\/%d0%ba%d1%80%d0%be%d1%81%d1%81%d0%be%d0%b2%d0%ba%d0%b8\\/"}]'}
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.openai.com:443
DEBUG:urllib3.connectionpool:https://api.openai.com:443 "POST /v1/chat/completions HTTP/1.1" 200 None
INFO:myapp:[{'url_params': 'product_name=xiaomi 12', 'is_related': 'yes', 'category': 'smartphones'}]
INFO:myapp:product_name=xiaomi 12
INFO:myapp:prompt
INFO:myapp:You are AI assistant for a online shop. You should determine if a client is asking or information about a product in our store. It can be a question about price, availability in stock, product characteristic, comparing 2 products. In this case you should contruct query parameters based on a client question. Construct them for every mentioned product. Add sort_price parameter if required .For example product_name=item_name&color=green&size=44&sort_price=desc|asc List of available query parameters: product_name, color product_name is a required parameter. You should use it in every query.Use only these query parameters for consructing. Add a category. List of available categories: misc,smartphones. Write your asnwer as array of json objects. [{url_params: <url_here>, is_related: 'yes', category: <category_here> }] If the question is not related to products of the store, then your answer would be [{is_related: 'no'}] Be strict. Fix typos in product names. Dont write anything else. Your answer will be used for a next query. Client question: is it better that xiaomi 12? .Your answer:
DEBUG:urllib3.connectionpool:Starting new HTTP connection (1): wordpress:80
DEBUG:urllib3.connectionpool:http://wordpress:80 "GET /wp-json/chatty/v1/posts?product_name=xiaomi+12 HTTP/1.1" 200 455
INFO:myapp:api data [{"id":20,"title":"Xiaomi Redmi 12 128GB &#8212; Black &#8212; Unlocked &#8212; Dual-SIM","content":"","date":"29.12.2023","attributes":{"pa_color":["black"]},"stock":null,"image_url":false,"sku":"141234-1","price":"15000","formatted_price":"<span class=\"woocommerce-Price-amount amount\"><bdi>15000,00&nbsp;<span class=\"woocommerce-Price-currencySymbol\">&#8381;<\/span><\/bdi><\/span>","product_link":"http:\/\/wordpress\/product\/xiaomi-12-black\/"}]
DEBUG:llama_index.storage.kvstore.simple_kvstore:Loading llama_index.storage.kvstore.simple_kvstore from projects/4/data\docstore.json.
DEBUG:fsspec.local:open file: C:/OSPanel/domains/ai_assistant/api/projects/4/data/docstore.json
DEBUG:llama_index.storage.kvstore.simple_kvstore:Loading llama_index.storage.kvstore.simple_kvstore from projects/4/data\index_store.json.
DEBUG:fsspec.local:open file: C:/OSPanel/domains/ai_assistant/api/projects/4/data/index_store.json
DEBUG:llama_index.vector_stores.simple:Loading llama_index.vector_stores.simple from projects/4/data\vector_store.json.
DEBUG:fsspec.local:open file: C:/OSPanel/domains/ai_assistant/api/projects/4/data/vector_store.json
DEBUG:llama_index.graph_stores.simple:Loading llama_index.graph_stores.simple from projects/4/data\graph_store.json.
DEBUG:fsspec.local:open file: C:/OSPanel/domains/ai_assistant/api/projects/4/data/graph_store.json
INFO:llama_index.indices.loading:Loading indices with ids: ['vector_index']
DEBUG:openai:message='Request to OpenAI API' method=post path=https://api.openai.com/v1/embeddings
DEBUG:openai:api_version=None data='{"input": ["is it better that xiaomi 12?"], "model": "text-embedding-ada-002", "encoding_format": "base64"}' message='Post details'
DEBUG:urllib3.util.retry:Converted retries value: 2 -> Retry(total=2, connect=None, read=None, redirect=None, status=None)
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.openai.com:443
DEBUG:urllib3.connectionpool:https://api.openai.com:443 "POST /v1/embeddings HTTP/1.1" 200 None
DEBUG:openai:message='OpenAI API response' path=https://api.openai.com/v1/embeddings processing_ms=20 request_id=88f035534c0c7ac69c0d662ff9f5dc68 response_code=200
DEBUG:llama_index.indices.utils:> Top 1 nodes:
> [Node 909c5dd5-e87e-4999-a794-761f96e44168] [Similarity score:             -0.0292097] Welcome to TechHub, your ultimate destination for cutting-edge technology and innovation! At Tech...
DEBUG:openai:message='Request to OpenAI API' method=post path=https://api.openai.com/v1/chat/completions
DEBUG:openai:api_version=None data='{"messages": [{"role": "system", "content": "Context information is below.\\n--------------------\\nWelcome to TechHub, your ultimate destination for cutting-edge technology and innovation! At TechHub, we pride ourselves on being a premier online store dedicated to providing a curated selection of the latest and greatest in tech gadgets, including laptops, smartphones, and more.\\n\\nAbout Us:\\n\\nAt the heart of TechHub is a passion for technology and a commitment to delivering top-notch products that seamlessly blend style, functionality, and performance. With a team of tech enthusiasts, we understand the ever-evolving nature of the digital landscape and strive to stay at the forefront of the latest trends and advancements.\\n\\nOur Mission:\\n\\nOur mission at TechHub is to empower our customers with the best tools and devices that enhance their digital lifestyle. Whether you\'re a professional looking for a high-performance laptop to boost productivity or a smartphone aficionado seeking the latest flagship model, we\'ve got you covered. We believe that technology should not only meet but exceed your expectations, making every interaction with your devices a seamless and enjoyable experience.\\n\\nQuality Assurance:\\n\\nTechHub is committed to delivering products of the highest quality. We carefully curate our inventory, partnering with leading brands known for their commitment to excellence. Each product undergoes rigorous testing to ensure reliability, durability, and top-notch performance. Our dedication to quality assurance is reflected in every item we offer.\\n\\nCustomer-Centric Approach:\\n\\nAt TechHub, our customers are at the core of everything we do. We prioritize your satisfaction and strive to provide an unparalleled shopping experience. Our customer support team is ready to assist you at every step, from product inquiries to after-sales support. We value your feedback and continuously work to improve our services based on your needs.\\n\\nSecure Shopping:\\n\\nYour online security is our priority. TechHub employs state-of-the-art encryption technology to ensure that your personal information remains secure and protected. Shop with confidence, knowing that your data is in safe hands.\\n\\nExplore the world of innovation at TechHub, where technology meets lifestyle. Discover the perfect blend of style and functionality with our carefully curated selection of laptops, smartphones, and other cutting-edge gadgets. Join us on this exciting journey, and let\'s embrace the future together!\\n--------------------\\n\\u0412\\u044b \\u2014 \\u0418\\u0418 \\u0430\\u0441\\u0441\\u0438\\u0441\\u0442\\u0435\\u043d\\u0442 \\u043a\\u043e\\u043c\\u043f\\u0430\\u043d\\u0438\\u0438. \\u0412\\u0430\\u043c \\u0431\\u0443\\u0434\\u0443\\u0442 \\u0437\\u0430\\u0434\\u0430\\u043d\\u044b \\u0432\\u043e\\u043f\\u0440\\u043e\\u0441\\u044b \\u043e \\u043d\\u0430\\u0448\\u0435\\u0439 \\u043a\\u043e\\u043c\\u043f\\u0430\\u043d\\u0438\\u0438. \\u0412\\u0435\\u0436\\u043b\\u0438\\u0432\\u043e \\u043e\\u0442\\u0432\\u0435\\u0447\\u0430\\u0439\\u0442\\u0435 \\u043d\\u0430 \\u0432\\u043e\\u043f\\u0440\\u043e\\u0441\\u044b.\\r\\n    \\u041d\\u0438\\u0436\\u0435 \\u043c\\u044b \\u043f\\u0440\\u0435\\u0434\\u043e\\u0441\\u0442\\u0430\\u0432\\u0438\\u043b\\u0438 \\u043a\\u043e\\u043d\\u0442\\u0435\\u043a\\u0441\\u0442\\u043d\\u0443\\u044e \\u0438\\u043d\\u0444\\u043e\\u0440\\u043c\\u0430\\u0446\\u0438\\u044e.\\r\\n    ---------------------\\r\\n    {context_str}\\r\\n    ---------------------\\r\\n    \\u0423\\u0447\\u0438\\u0442\\u044b\\u0432\\u0430\\u044f \\u044d\\u0442\\u0443 \\u0438\\u043d\\u0444\\u043e\\u0440\\u043c\\u0430\\u0446\\u0438\\u044e, \\u043e\\u0442\\u0432\\u0435\\u0442\\u044c\\u0442\\u0435, \\u043f\\u043e\\u0436\\u0430\\u043b\\u0443\\u0439\\u0441\\u0442\\u0430, \\u043d\\u0430 \\u0432\\u043e\\u043f\\u0440\\u043e\\u0441: {query_str}\\r\\n    . \\n Information about relative products [{\\"id\\":17,\\"title\\":\\"Xiaomi 13\\",\\"content\\":\\"<ul class=\\\\\\"a-unordered-list a-vertical a-spacing-mini\\\\\\">\\\\r\\\\n \\\\t<li class=\\\\\\"a-spacing-mini\\\\\\"><span class=\\\\\\"a-list-item\\\\\\">Ultra-immersive display design Light up the screen to enjoy an unrivalled experience. The 1.61mm ultra-thin bezels offer a boundless vision.<\\\\/span><\\\\/li>\\\\r\\\\n \\\\t<li class=\\\\\\"a-spacing-mini\\\\\\"><span class=\\\\\\"a-list-item\\\\\\">Built for more scenarios IP68 water and dust resistant* Born splash-proof and water-resistant, thanks to the precision manufacturing. Record special memories anytime and anywhere.<\\\\/span><\\\\/li>\\\\r\\\\n \\\\t<li class=\\\\\\"a-spacing-mini\\\\\\"><span class=\\\\\\"a-list-item\\\\\\">Leica main camera with professional optical lens Captures every great moment<\\\\/span><\\\\/li>\\\\r\\\\n \\\\t<li class=\\\\\\"a-spacing-mini\\\\\\"><span class=\\\\\\"a-list-item\\\\\\">Masterpiece performance Leading Snapdragon 8 Gen 2 Boosted performance, reduced consumption<\\\\/span><\\\\/li>\\\\r\\\\n<\\\\/ul>\\",\\"date\\":\\"27.12.2023\\",\\"attributes\\":{\\"pa_color\\":[\\"silver\\"]},\\"stock\\":null,\\"image_url\\":false,\\"sku\\":\\"141234\\",\\"price\\":\\"16000\\",\\"formatted_price\\":\\"<span class=\\\\\\"woocommerce-Price-amount amount\\\\\\"><bdi>16000,00&nbsp;<span class=\\\\\\"woocommerce-Price-currencySymbol\\\\\\">&#8381;<\\\\/span><\\\\/bdi><\\\\/span>\\",\\"product_link\\":\\"http:\\\\/\\\\/wordpress\\\\/product\\\\/%d0%ba%d1%80%d0%be%d1%81%d1%81%d0%be%d0%b2%d0%ba%d0%b8\\\\/\\"}][{\\"id\\":20,\\"title\\":\\"Xiaomi Redmi 12 128GB &#8212; Black &#8212; Unlocked &#8212; Dual-SIM\\",\\"content\\":\\"\\",\\"date\\":\\"29.12.2023\\",\\"attributes\\":{\\"pa_color\\":[\\"black\\"]},\\"stock\\":null,\\"image_url\\":false,\\"sku\\":\\"141234-1\\",\\"price\\":\\"15000\\",\\"formatted_price\\":\\"<span class=\\\\\\"woocommerce-Price-amount amount\\\\\\"><bdi>15000,00&nbsp;<span class=\\\\\\"woocommerce-Price-currencySymbol\\\\\\">&#8381;<\\\\/span><\\\\/bdi><\\\\/span>\\",\\"product_link\\":\\"http:\\\\/\\\\/wordpress\\\\/product\\\\/xiaomi-12-black\\\\/\\"}]"}, {"role": "user", "content": "is it better that xiaomi 12?"}], "stream": false, "model": "gpt-3.5-turbo", "temperature": 0, "max_tokens": null}' message='Post details'
DEBUG:urllib3.connectionpool:https://api.openai.com:443 "POST /v1/chat/completions HTTP/1.1" 200 None
DEBUG:openai:message='OpenAI API response' path=https://api.openai.com/v1/chat/completions processing_ms=6049 request_id=0ebdfb72ce463f93cf5b613770850698 response_code=200
INFO:myapp:{'api': 1, 'product_data': '{"attributes": "color", "categories": "misc,smartphones"}', 'website': 'asdf', 'id': 4, 'left_tokens': 97480, 'description': None, 'temperature': Decimal('0.00'), 'model': 'gpt-3.5-turbo', 'prompt': 'Вы — ИИ ассистент компании. Вам будут заданы вопросы о нашей компании. Вежливо отвечайте на вопросы.\r\n    Ниже мы предоставили контекстную информацию.\r\n    ---------------------\r\n    {context_str}\r\n    ---------------------\r\n    Учитывая эту информацию, ответьте, пожалуйста, на вопрос: {query_str}\r\n    ', 'response_mode': 'compact', 'user_id': 12, 'answer': 'Client: i want xiaomi 13,\nAi response: Sure! We have the Xiaomi 13 available for purchase. It features an ultra-immersive display design with 1.61mm ultra-thin bezels, providing a boundless vision. It is also IP68 water and dust resistant, making it splash-proof and water-resistant. The Xiaomi 13 comes with a Leica main camera with a professional optical lens, allowing you to capture every great moment. It is powered by the leading Snapdragon 8 Gen 2 for boosted performance and reduced consumption. The price for the Xiaomi 13 is 16,000 rubles. You can find more information and make a purchase on our website using the following link: [Xiaomi 13](http://wordpress/product/кроссовки/)', 'context': '[{"id":17,"title":"Xiaomi 13","content":"<ul class=\\"a-unordered-list a-vertical a-spacing-mini\\">\\r\\n \\t<li class=\\"a-spacing-mini\\"><span class=\\"a-list-item\\">Ultra-immersive display design Light up the screen to enjoy an unrivalled experience. The 1.61mm ultra-thin bezels offer a boundless vision.<\\/span><\\/li>\\r\\n \\t<li class=\\"a-spacing-mini\\"><span class=\\"a-list-item\\">Built for more scenarios IP68 water and dust resistant* Born splash-proof and water-resistant, thanks to the precision manufacturing. Record special memories anytime and anywhere.<\\/span><\\/li>\\r\\n \\t<li class=\\"a-spacing-mini\\"><span class=\\"a-list-item\\">Leica main camera with professional optical lens Captures every great moment<\\/span><\\/li>\\r\\n \\t<li class=\\"a-spacing-mini\\"><span class=\\"a-list-item\\">Masterpiece performance Leading Snapdragon 8 Gen 2 Boosted performance, reduced consumption<\\/span><\\/li>\\r\\n<\\/ul>","date":"27.12.2023","attributes":{"pa_color":["silver"]},"stock":null,"image_url":false,"sku":"141234","price":"16000","formatted_price":"<span class=\\"woocommerce-Price-amount amount\\"><bdi>16000,00&nbsp;<span class=\\"woocommerce-Price-currencySymbol\\">&#8381;<\\/span><\\/bdi><\\/span>","product_link":"http:\\/\\/wordpress\\/product\\/%d0%ba%d1%80%d0%be%d1%81%d1%81%d0%be%d0%b2%d0%ba%d0%b8\\/"}]'}
ERROR:myapp:Exception on /projects/e47f0f811145d03c33fd6639dc3f09c0839d0891e264d849a75df04f4d047625/tplIFi6pWGBPTIf32ToAWbLfhORxnj2g [POST]
Traceback (most recent call last):
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\kombu\connection.py", line 556, in _ensured
    return fun(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\kombu\messaging.py", line 208, in _publish
    return channel.basic_publish(
           ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\kombu\transport\virtual\base.py", line 614, in basic_publish
    return self._put(routing_key, message, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\kombu\transport\redis.py", line 1016, in _put
    client.lpush(self._q_for_pri(queue, pri), dumps(message))
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\redis\commands\core.py", line 2721, in lpush
    return self.execute_command("LPUSH", name, *values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\redis\client.py", line 1269, in execute_command
    return conn.retry.call_with_retry(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\redis\retry.py", line 46, in call_with_retry
    return do()
           ^^^^
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\redis\client.py", line 1270, in <lambda>
    lambda: self._send_command_parse_response(
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\redis\client.py", line 1246, in _send_command_parse_response
    return self.parse_response(conn, command_name, **options)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\redis\client.py", line 1286, in parse_response
    response = connection.read_response()
               ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\redis\connection.py", line 905, in read_response
    raise response
redis.exceptions.ResponseError: MISCONF Memurai is configured to save RDB snapshots, but it's currently unable to persist to disk. Commands that may modify the data set are disabled, because this instance is configured to report errors during writes if RDB snapshotting fails (stop-writes-on-bgsave-error option). Please check the Memurai logs for details about the RDB error.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\kombu\transport\virtual\base.py", line 951, in create_channel
    return self._avail_channels.pop()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
IndexError: pop from empty list

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\kombu\connection.py", line 472, in _reraise_as_library_errors
    yield
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\kombu\connection.py", line 578, in _ensured
    self._ensure_connection(
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\kombu\connection.py", line 459, in _ensure_connection
    return retry_over_time(
           ^^^^^^^^^^^^^^^^
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\kombu\utils\functional.py", line 318, in retry_over_time
    return fun(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\kombu\connection.py", line 934, in _connection_factory
    self._connection = self._establish_connection()
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\kombu\connection.py", line 860, in _establish_connection
    conn = self.transport.establish_connection()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\kombu\transport\virtual\base.py", line 975, in establish_connection
    self._avail_channels.append(self.create_channel(self))
                                ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\kombu\transport\virtual\base.py", line 953, in create_channel
    channel = self.Channel(connection)
              ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\kombu\transport\redis.py", line 741, in __init__
    self.client.ping()
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\redis\commands\core.py", line 1205, in ping
    return self.execute_command("PING", **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\redis\client.py", line 1269, in execute_command
    return conn.retry.call_with_retry(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\redis\retry.py", line 46, in call_with_retry
    return do()
           ^^^^
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\redis\client.py", line 1270, in <lambda>
    lambda: self._send_command_parse_response(
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\redis\client.py", line 1245, in _send_command_parse_response
    conn.send_command(*args)
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\redis\connection.py", line 855, in send_command
    self.send_packed_command(
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\redis\connection.py", line 828, in send_packed_command
    self.check_health()
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\redis\connection.py", line 820, in check_health
    self.retry.call_with_retry(self._send_ping, self._ping_failed)
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\redis\retry.py", line 46, in call_with_retry
    return do()
           ^^^^
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\redis\connection.py", line 810, in _send_ping
    if str_if_bytes(self.read_response()) != "PONG":
                    ^^^^^^^^^^^^^^^^^^^^
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\redis\connection.py", line 905, in read_response
    raise response
redis.exceptions.ResponseError: MISCONF Memurai is configured to save RDB snapshots, but it's currently unable to persist to disk. Commands that may modify the data set are disabled, because this instance is configured to report errors during writes if RDB snapshotting fails (stop-writes-on-bgsave-error option). Please check the Memurai logs for details about the RDB error.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\flask\app.py", line 2190, in wsgi_app
    response = self.full_dispatch_request()
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\flask\app.py", line 1486, in full_dispatch_request
    rv = self.handle_user_exception(e)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\flask_cors\extension.py", line 176, in wrapped_function
    return cors_after_request(app.make_response(f(*args, **kwargs)))
                                                ^^^^^^^^^^^^^^^^^^
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\flask_cors\extension.py", line 176, in wrapped_function
    return cors_after_request(app.make_response(f(*args, **kwargs)))
                                                ^^^^^^^^^^^^^^^^^^
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\flask\app.py", line 1484, in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\flask\app.py", line 1469, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\OSPanel\domains\ai_assistant\api\myapp.py", line 391, in get_project_details
    send_chat_request.apply_async(args=[project['user_id'], project['id'], session_id, token_counter.total_llm_token_count,f"Client: {query_text},\nAi response: {response.response}", product_response])
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\celery\app\task.py", line 594, in apply_async
    return app.send_task(
           ^^^^^^^^^^^^^^
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\celery\app\base.py", line 798, in send_task
    amqp.send_task_message(P, name, message, **options)
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\celery\app\amqp.py", line 517, in send_task_message
    ret = producer.publish(
          ^^^^^^^^^^^^^^^^^
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\kombu\messaging.py", line 186, in publish
    return _publish(
           ^^^^^^^^^
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\kombu\connection.py", line 553, in _ensured
    with self._reraise_as_library_errors():
  File "C:\Users\Maxan\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 155, in __exit__
    self.gen.throw(typ, value, traceback)
  File "C:\OSPanel\domains\ai_assistant\api\env\Lib\site-packages\kombu\connection.py", line 476, in _reraise_as_library_errors
    raise ConnectionError(str(exc)) from exc
kombu.exceptions.OperationalError: MISCONF Memurai is configured to save RDB snapshots, but it's currently unable to persist to disk. Commands that may modify the data set are disabled, because this instance is configured to report errors during writes if RDB snapshotting fails (stop-writes-on-bgsave-error option). Please check the Memurai logs for details about the RDB error.
INFO:werkzeug:127.0.0.1 - - [31/Dec/2023 23:12:33] "[35m[1mPOST /projects/e47f0f811145d03c33fd6639dc3f09c0839d0891e264d849a75df04f4d047625/tplIFi6pWGBPTIf32ToAWbLfhORxnj2g HTTP/1.1[0m" 500 -
DEBUG:root:This is a debug message
DEBUG:celery.utils.functional:
def unlock_chord(self, group_id, callback, interval=0, max_retries=1, result=2, Result=3, GroupResult=4, result_from_tuple=5, **kwargs):
    return 1

DEBUG:celery.utils.functional:
def group(self, tasks, result, group_id, partial_args, add_to_parent=0):
    return 1

DEBUG:celery.utils.functional:
def send_chat_request(user_id, project_id, session, total_tokens, answer, context):
    return 1

DEBUG:celery.utils.functional:
def xmap(task, it):
    return 1

DEBUG:celery.utils.functional:
def sendEmbeddingRequest(user_id, total_tokens):
    return 1

DEBUG:celery.utils.functional:
def backend_cleanup():
    return 1

DEBUG:celery.utils.functional:
def set_vector_index_task(self, token):
    return 1

DEBUG:celery.utils.functional:
def process_set_vector_index(self, token, task_id):
    return 1

DEBUG:celery.utils.functional:
def chain(*args, **kwargs):
    return 1

DEBUG:celery.utils.functional:
def xstarmap(task, it):
    return 1

DEBUG:celery.utils.functional:
def accumulate(self, *args, **kwargs):
    return 1

DEBUG:celery.utils.functional:
def chord(self, header, body, partial_args=0, interval=1, countdown=2, max_retries=3, eager=4, **kwargs):
    return 1

DEBUG:celery.utils.functional:
def chunks(task, it, n):
    return 1

INFO:werkzeug:127.0.0.1 - - [31/Dec/2023 23:13:15] "GET /files/e47f0f811145d03c33fd6639dc3f09c0839d0891e264d849a75df04f4d047625 HTTP/1.1" 200 -
INFO:werkzeug:127.0.0.1 - - [31/Dec/2023 23:13:23] "OPTIONS /projects/e47f0f811145d03c33fd6639dc3f09c0839d0891e264d849a75df04f4d047625/1ZbVTyW8FP5ni91hgAtEt21ahEhE1FvF HTTP/1.1" 200 -
INFO:myapp:{'api': 1, 'product_data': '{"attributes": "color", "categories": "misc,smartphones"}', 'website': 'asdf', 'id': 4, 'left_tokens': 97480, 'description': None, 'temperature': Decimal('0.00'), 'model': 'gpt-3.5-turbo', 'prompt': 'Вы — ИИ ассистент компании. Вам будут заданы вопросы о нашей компании. Вежливо отвечайте на вопросы.\r\n    Ниже мы предоставили контекстную информацию.\r\n    ---------------------\r\n    {context_str}\r\n    ---------------------\r\n    Учитывая эту информацию, ответьте, пожалуйста, на вопрос: {query_str}\r\n    ', 'response_mode': 'compact', 'user_id': 12, 'answer': None, 'context': None}
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.openai.com:443
DEBUG:urllib3.connectionpool:https://api.openai.com:443 "POST /v1/chat/completions HTTP/1.1" 200 None
INFO:myapp:[{'url_params': 'product_name=xiaomi 13', 'is_related': 'yes', 'category': 'smartphones'}]
INFO:myapp:product_name=xiaomi 13
INFO:myapp:prompt
INFO:myapp:You are AI assistant for a online shop. You should determine if a client is asking or information about a product in our store. It can be a question about price, availability in stock, product characteristic, comparing 2 products. In this case you should contruct query parameters based on a client question. Construct them for every mentioned product. Add sort_price parameter if required .For example product_name=item_name&color=green&size=44&sort_price=desc|asc List of available query parameters: product_name, color product_name is a required parameter. You should use it in every query.Use only these query parameters for consructing. Add a category. List of available categories: misc,smartphones. Write your asnwer as array of json objects. [{url_params: <url_here>, is_related: 'yes', category: <category_here> }] If the question is not related to products of the store, then your answer would be [{is_related: 'no'}] Be strict. Fix typos in product names. Dont write anything else. Your answer will be used for a next query. Client question: i want xiaomi 13 .Your answer:
DEBUG:urllib3.connectionpool:Starting new HTTP connection (1): wordpress:80
DEBUG:urllib3.connectionpool:http://wordpress:80 "GET /wp-json/chatty/v1/posts?product_name=xiaomi+13 HTTP/1.1" 200 1298
INFO:myapp:api data [{"id":17,"title":"Xiaomi 13","content":"<ul class=\"a-unordered-list a-vertical a-spacing-mini\">\r\n \t<li class=\"a-spacing-mini\"><span class=\"a-list-item\">Ultra-immersive display design Light up the screen to enjoy an unrivalled experience. The 1.61mm ultra-thin bezels offer a boundless vision.<\/span><\/li>\r\n \t<li class=\"a-spacing-mini\"><span class=\"a-list-item\">Built for more scenarios IP68 water and dust resistant* Born splash-proof and water-resistant, thanks to the precision manufacturing. Record special memories anytime and anywhere.<\/span><\/li>\r\n \t<li class=\"a-spacing-mini\"><span class=\"a-list-item\">Leica main camera with professional optical lens Captures every great moment<\/span><\/li>\r\n \t<li class=\"a-spacing-mini\"><span class=\"a-list-item\">Masterpiece performance Leading Snapdragon 8 Gen 2 Boosted performance, reduced consumption<\/span><\/li>\r\n<\/ul>","date":"27.12.2023","attributes":{"pa_color":["silver"]},"stock":null,"image_url":false,"sku":"141234","price":"16000","formatted_price":"<span class=\"woocommerce-Price-amount amount\"><bdi>16000,00&nbsp;<span class=\"woocommerce-Price-currencySymbol\">&#8381;<\/span><\/bdi><\/span>","product_link":"http:\/\/wordpress\/product\/%d0%ba%d1%80%d0%be%d1%81%d1%81%d0%be%d0%b2%d0%ba%d0%b8\/"}]
DEBUG:llama_index.storage.kvstore.simple_kvstore:Loading llama_index.storage.kvstore.simple_kvstore from projects/4/data\docstore.json.
DEBUG:fsspec.local:open file: C:/OSPanel/domains/ai_assistant/api/projects/4/data/docstore.json
DEBUG:llama_index.storage.kvstore.simple_kvstore:Loading llama_index.storage.kvstore.simple_kvstore from projects/4/data\index_store.json.
DEBUG:fsspec.local:open file: C:/OSPanel/domains/ai_assistant/api/projects/4/data/index_store.json
DEBUG:llama_index.vector_stores.simple:Loading llama_index.vector_stores.simple from projects/4/data\vector_store.json.
DEBUG:fsspec.local:open file: C:/OSPanel/domains/ai_assistant/api/projects/4/data/vector_store.json
DEBUG:llama_index.graph_stores.simple:Loading llama_index.graph_stores.simple from projects/4/data\graph_store.json.
DEBUG:fsspec.local:open file: C:/OSPanel/domains/ai_assistant/api/projects/4/data/graph_store.json
INFO:llama_index.indices.loading:Loading indices with ids: ['vector_index']
DEBUG:openai:message='Request to OpenAI API' method=post path=https://api.openai.com/v1/embeddings
DEBUG:openai:api_version=None data='{"input": ["i want xiaomi 13"], "model": "text-embedding-ada-002", "encoding_format": "base64"}' message='Post details'
DEBUG:urllib3.util.retry:Converted retries value: 2 -> Retry(total=2, connect=None, read=None, redirect=None, status=None)
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.openai.com:443
DEBUG:urllib3.connectionpool:https://api.openai.com:443 "POST /v1/embeddings HTTP/1.1" 200 None
DEBUG:openai:message='OpenAI API response' path=https://api.openai.com/v1/embeddings processing_ms=19 request_id=eb24a6295583b4bd27519513c0b720b0 response_code=200
DEBUG:llama_index.indices.utils:> Top 1 nodes:
> [Node 909c5dd5-e87e-4999-a794-761f96e44168] [Similarity score:             -0.0286855] Welcome to TechHub, your ultimate destination for cutting-edge technology and innovation! At Tech...
DEBUG:openai:message='Request to OpenAI API' method=post path=https://api.openai.com/v1/chat/completions
DEBUG:openai:api_version=None data='{"messages": [{"role": "system", "content": "Context information is below.\\n--------------------\\nWelcome to TechHub, your ultimate destination for cutting-edge technology and innovation! At TechHub, we pride ourselves on being a premier online store dedicated to providing a curated selection of the latest and greatest in tech gadgets, including laptops, smartphones, and more.\\n\\nAbout Us:\\n\\nAt the heart of TechHub is a passion for technology and a commitment to delivering top-notch products that seamlessly blend style, functionality, and performance. With a team of tech enthusiasts, we understand the ever-evolving nature of the digital landscape and strive to stay at the forefront of the latest trends and advancements.\\n\\nOur Mission:\\n\\nOur mission at TechHub is to empower our customers with the best tools and devices that enhance their digital lifestyle. Whether you\'re a professional looking for a high-performance laptop to boost productivity or a smartphone aficionado seeking the latest flagship model, we\'ve got you covered. We believe that technology should not only meet but exceed your expectations, making every interaction with your devices a seamless and enjoyable experience.\\n\\nQuality Assurance:\\n\\nTechHub is committed to delivering products of the highest quality. We carefully curate our inventory, partnering with leading brands known for their commitment to excellence. Each product undergoes rigorous testing to ensure reliability, durability, and top-notch performance. Our dedication to quality assurance is reflected in every item we offer.\\n\\nCustomer-Centric Approach:\\n\\nAt TechHub, our customers are at the core of everything we do. We prioritize your satisfaction and strive to provide an unparalleled shopping experience. Our customer support team is ready to assist you at every step, from product inquiries to after-sales support. We value your feedback and continuously work to improve our services based on your needs.\\n\\nSecure Shopping:\\n\\nYour online security is our priority. TechHub employs state-of-the-art encryption technology to ensure that your personal information remains secure and protected. Shop with confidence, knowing that your data is in safe hands.\\n\\nExplore the world of innovation at TechHub, where technology meets lifestyle. Discover the perfect blend of style and functionality with our carefully curated selection of laptops, smartphones, and other cutting-edge gadgets. Join us on this exciting journey, and let\'s embrace the future together!\\n--------------------\\n\\u0412\\u044b \\u2014 \\u0418\\u0418 \\u0430\\u0441\\u0441\\u0438\\u0441\\u0442\\u0435\\u043d\\u0442 \\u043a\\u043e\\u043c\\u043f\\u0430\\u043d\\u0438\\u0438. \\u0412\\u0430\\u043c \\u0431\\u0443\\u0434\\u0443\\u0442 \\u0437\\u0430\\u0434\\u0430\\u043d\\u044b \\u0432\\u043e\\u043f\\u0440\\u043e\\u0441\\u044b \\u043e \\u043d\\u0430\\u0448\\u0435\\u0439 \\u043a\\u043e\\u043c\\u043f\\u0430\\u043d\\u0438\\u0438. \\u0412\\u0435\\u0436\\u043b\\u0438\\u0432\\u043e \\u043e\\u0442\\u0432\\u0435\\u0447\\u0430\\u0439\\u0442\\u0435 \\u043d\\u0430 \\u0432\\u043e\\u043f\\u0440\\u043e\\u0441\\u044b.\\r\\n    \\u041d\\u0438\\u0436\\u0435 \\u043c\\u044b \\u043f\\u0440\\u0435\\u0434\\u043e\\u0441\\u0442\\u0430\\u0432\\u0438\\u043b\\u0438 \\u043a\\u043e\\u043d\\u0442\\u0435\\u043a\\u0441\\u0442\\u043d\\u0443\\u044e \\u0438\\u043d\\u0444\\u043e\\u0440\\u043c\\u0430\\u0446\\u0438\\u044e.\\r\\n    ---------------------\\r\\n    {context_str}\\r\\n    ---------------------\\r\\n    \\u0423\\u0447\\u0438\\u0442\\u044b\\u0432\\u0430\\u044f \\u044d\\u0442\\u0443 \\u0438\\u043d\\u0444\\u043e\\u0440\\u043c\\u0430\\u0446\\u0438\\u044e, \\u043e\\u0442\\u0432\\u0435\\u0442\\u044c\\u0442\\u0435, \\u043f\\u043e\\u0436\\u0430\\u043b\\u0443\\u0439\\u0441\\u0442\\u0430, \\u043d\\u0430 \\u0432\\u043e\\u043f\\u0440\\u043e\\u0441: {query_str}\\r\\n    . \\n Information about relative products [{\\"id\\":17,\\"title\\":\\"Xiaomi 13\\",\\"content\\":\\"<ul class=\\\\\\"a-unordered-list a-vertical a-spacing-mini\\\\\\">\\\\r\\\\n \\\\t<li class=\\\\\\"a-spacing-mini\\\\\\"><span class=\\\\\\"a-list-item\\\\\\">Ultra-immersive display design Light up the screen to enjoy an unrivalled experience. The 1.61mm ultra-thin bezels offer a boundless vision.<\\\\/span><\\\\/li>\\\\r\\\\n \\\\t<li class=\\\\\\"a-spacing-mini\\\\\\"><span class=\\\\\\"a-list-item\\\\\\">Built for more scenarios IP68 water and dust resistant* Born splash-proof and water-resistant, thanks to the precision manufacturing. Record special memories anytime and anywhere.<\\\\/span><\\\\/li>\\\\r\\\\n \\\\t<li class=\\\\\\"a-spacing-mini\\\\\\"><span class=\\\\\\"a-list-item\\\\\\">Leica main camera with professional optical lens Captures every great moment<\\\\/span><\\\\/li>\\\\r\\\\n \\\\t<li class=\\\\\\"a-spacing-mini\\\\\\"><span class=\\\\\\"a-list-item\\\\\\">Masterpiece performance Leading Snapdragon 8 Gen 2 Boosted performance, reduced consumption<\\\\/span><\\\\/li>\\\\r\\\\n<\\\\/ul>\\",\\"date\\":\\"27.12.2023\\",\\"attributes\\":{\\"pa_color\\":[\\"silver\\"]},\\"stock\\":null,\\"image_url\\":false,\\"sku\\":\\"141234\\",\\"price\\":\\"16000\\",\\"formatted_price\\":\\"<span class=\\\\\\"woocommerce-Price-amount amount\\\\\\"><bdi>16000,00&nbsp;<span class=\\\\\\"woocommerce-Price-currencySymbol\\\\\\">&#8381;<\\\\/span><\\\\/bdi><\\\\/span>\\",\\"product_link\\":\\"http:\\\\/\\\\/wordpress\\\\/product\\\\/%d0%ba%d1%80%d0%be%d1%81%d1%81%d0%be%d0%b2%d0%ba%d0%b8\\\\/\\"}]"}, {"role": "user", "content": "i want xiaomi 13"}], "stream": false, "model": "gpt-3.5-turbo", "temperature": 0, "max_tokens": null}' message='Post details'
DEBUG:urllib3.connectionpool:https://api.openai.com:443 "POST /v1/chat/completions HTTP/1.1" 200 None
DEBUG:openai:message='OpenAI API response' path=https://api.openai.com/v1/chat/completions processing_ms=4905 request_id=c0eea16bc33c39f8b4d4cad431ca28f0 response_code=200
INFO:myapp:{'api': 1, 'product_data': '{"attributes": "color", "categories": "misc,smartphones"}', 'website': 'asdf', 'id': 4, 'left_tokens': 97480, 'description': None, 'temperature': Decimal('0.00'), 'model': 'gpt-3.5-turbo', 'prompt': 'Вы — ИИ ассистент компании. Вам будут заданы вопросы о нашей компании. Вежливо отвечайте на вопросы.\r\n    Ниже мы предоставили контекстную информацию.\r\n    ---------------------\r\n    {context_str}\r\n    ---------------------\r\n    Учитывая эту информацию, ответьте, пожалуйста, на вопрос: {query_str}\r\n    ', 'response_mode': 'compact', 'user_id': 12, 'answer': None, 'context': None}
INFO:werkzeug:127.0.0.1 - - [31/Dec/2023 23:13:32] "POST /projects/e47f0f811145d03c33fd6639dc3f09c0839d0891e264d849a75df04f4d047625/1ZbVTyW8FP5ni91hgAtEt21ahEhE1FvF HTTP/1.1" 200 -
INFO:werkzeug:127.0.0.1 - - [31/Dec/2023 23:13:46] "OPTIONS /projects/e47f0f811145d03c33fd6639dc3f09c0839d0891e264d849a75df04f4d047625/1ZbVTyW8FP5ni91hgAtEt21ahEhE1FvF HTTP/1.1" 200 -
INFO:myapp:{'api': 1, 'product_data': '{"attributes": "color", "categories": "misc,smartphones"}', 'website': 'asdf', 'id': 4, 'left_tokens': 96408, 'description': None, 'temperature': Decimal('0.00'), 'model': 'gpt-3.5-turbo', 'prompt': 'Вы — ИИ ассистент компании. Вам будут заданы вопросы о нашей компании. Вежливо отвечайте на вопросы.\r\n    Ниже мы предоставили контекстную информацию.\r\n    ---------------------\r\n    {context_str}\r\n    ---------------------\r\n    Учитывая эту информацию, ответьте, пожалуйста, на вопрос: {query_str}\r\n    ', 'response_mode': 'compact', 'user_id': 12, 'answer': 'Client: i want xiaomi 13,\nAi response: Sure! We have the Xiaomi 13 available for purchase. It features an ultra-immersive display design with 1.61mm ultra-thin bezels, providing a boundless vision. It is also IP68 water and dust resistant, making it splash-proof and water-resistant. The Xiaomi 13 comes with a Leica main camera with a professional optical lens, allowing you to capture every great moment. It is powered by the leading Snapdragon 8 Gen 2 processor, offering boosted performance and reduced consumption. The price for the Xiaomi 13 is 16,000 rubles. You can find more information and make a purchase on our website: [Xiaomi 13](http://wordpress/product/кроссовки/)', 'context': '[{"id":17,"title":"Xiaomi 13","content":"<ul class=\\"a-unordered-list a-vertical a-spacing-mini\\">\\r\\n \\t<li class=\\"a-spacing-mini\\"><span class=\\"a-list-item\\">Ultra-immersive display design Light up the screen to enjoy an unrivalled experience. The 1.61mm ultra-thin bezels offer a boundless vision.<\\/span><\\/li>\\r\\n \\t<li class=\\"a-spacing-mini\\"><span class=\\"a-list-item\\">Built for more scenarios IP68 water and dust resistant* Born splash-proof and water-resistant, thanks to the precision manufacturing. Record special memories anytime and anywhere.<\\/span><\\/li>\\r\\n \\t<li class=\\"a-spacing-mini\\"><span class=\\"a-list-item\\">Leica main camera with professional optical lens Captures every great moment<\\/span><\\/li>\\r\\n \\t<li class=\\"a-spacing-mini\\"><span class=\\"a-list-item\\">Masterpiece performance Leading Snapdragon 8 Gen 2 Boosted performance, reduced consumption<\\/span><\\/li>\\r\\n<\\/ul>","date":"27.12.2023","attributes":{"pa_color":["silver"]},"stock":null,"image_url":false,"sku":"141234","price":"16000","formatted_price":"<span class=\\"woocommerce-Price-amount amount\\"><bdi>16000,00&nbsp;<span class=\\"woocommerce-Price-currencySymbol\\">&#8381;<\\/span><\\/bdi><\\/span>","product_link":"http:\\/\\/wordpress\\/product\\/%d0%ba%d1%80%d0%be%d1%81%d1%81%d0%be%d0%b2%d0%ba%d0%b8\\/"}]'}
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.openai.com:443
DEBUG:urllib3.connectionpool:https://api.openai.com:443 "POST /v1/chat/completions HTTP/1.1" 200 None
INFO:myapp:[{'url_params': 'product_name=xiaomi 12&sort_price=desc', 'is_related': 'yes', 'category': 'smartphones'}]
INFO:myapp:product_name=xiaomi 12&sort_price=desc
INFO:myapp:prompt
INFO:myapp:You are AI assistant for a online shop. You should determine if a client is asking or information about a product in our store. It can be a question about price, availability in stock, product characteristic, comparing 2 products. In this case you should contruct query parameters based on a client question. Construct them for every mentioned product. Add sort_price parameter if required .For example product_name=item_name&color=green&size=44&sort_price=desc|asc List of available query parameters: product_name, color product_name is a required parameter. You should use it in every query.Use only these query parameters for consructing. Add a category. List of available categories: misc,smartphones. Write your asnwer as array of json objects. [{url_params: <url_here>, is_related: 'yes', category: <category_here> }] If the question is not related to products of the store, then your answer would be [{is_related: 'no'}] Be strict. Fix typos in product names. Dont write anything else. Your answer will be used for a next query. Client question: it it better than xiaomi 12? .Your answer:
DEBUG:urllib3.connectionpool:Starting new HTTP connection (1): wordpress:80
DEBUG:urllib3.connectionpool:http://wordpress:80 "GET /wp-json/chatty/v1/posts?product_name=xiaomi+12&sort_price=desc HTTP/1.1" 200 455
INFO:myapp:api data [{"id":20,"title":"Xiaomi Redmi 12 128GB &#8212; Black &#8212; Unlocked &#8212; Dual-SIM","content":"","date":"29.12.2023","attributes":{"pa_color":["black"]},"stock":null,"image_url":false,"sku":"141234-1","price":"15000","formatted_price":"<span class=\"woocommerce-Price-amount amount\"><bdi>15000,00&nbsp;<span class=\"woocommerce-Price-currencySymbol\">&#8381;<\/span><\/bdi><\/span>","product_link":"http:\/\/wordpress\/product\/xiaomi-12-black\/"}]
DEBUG:llama_index.storage.kvstore.simple_kvstore:Loading llama_index.storage.kvstore.simple_kvstore from projects/4/data\docstore.json.
DEBUG:fsspec.local:open file: C:/OSPanel/domains/ai_assistant/api/projects/4/data/docstore.json
DEBUG:llama_index.storage.kvstore.simple_kvstore:Loading llama_index.storage.kvstore.simple_kvstore from projects/4/data\index_store.json.
DEBUG:fsspec.local:open file: C:/OSPanel/domains/ai_assistant/api/projects/4/data/index_store.json
DEBUG:llama_index.vector_stores.simple:Loading llama_index.vector_stores.simple from projects/4/data\vector_store.json.
DEBUG:fsspec.local:open file: C:/OSPanel/domains/ai_assistant/api/projects/4/data/vector_store.json
DEBUG:llama_index.graph_stores.simple:Loading llama_index.graph_stores.simple from projects/4/data\graph_store.json.
DEBUG:fsspec.local:open file: C:/OSPanel/domains/ai_assistant/api/projects/4/data/graph_store.json
INFO:llama_index.indices.loading:Loading indices with ids: ['vector_index']
DEBUG:openai:message='Request to OpenAI API' method=post path=https://api.openai.com/v1/embeddings
DEBUG:openai:api_version=None data='{"input": ["it it better than xiaomi 12?"], "model": "text-embedding-ada-002", "encoding_format": "base64"}' message='Post details'
DEBUG:urllib3.util.retry:Converted retries value: 2 -> Retry(total=2, connect=None, read=None, redirect=None, status=None)
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.openai.com:443
DEBUG:urllib3.connectionpool:https://api.openai.com:443 "POST /v1/embeddings HTTP/1.1" 200 None
DEBUG:openai:message='OpenAI API response' path=https://api.openai.com/v1/embeddings processing_ms=34 request_id=805a8021a2b725f8b2b0413489455930 response_code=200
DEBUG:llama_index.indices.utils:> Top 1 nodes:
> [Node 909c5dd5-e87e-4999-a794-761f96e44168] [Similarity score:             -0.0283603] Welcome to TechHub, your ultimate destination for cutting-edge technology and innovation! At Tech...
DEBUG:openai:message='Request to OpenAI API' method=post path=https://api.openai.com/v1/chat/completions
DEBUG:openai:api_version=None data='{"messages": [{"role": "system", "content": "Context information is below.\\n--------------------\\nWelcome to TechHub, your ultimate destination for cutting-edge technology and innovation! At TechHub, we pride ourselves on being a premier online store dedicated to providing a curated selection of the latest and greatest in tech gadgets, including laptops, smartphones, and more.\\n\\nAbout Us:\\n\\nAt the heart of TechHub is a passion for technology and a commitment to delivering top-notch products that seamlessly blend style, functionality, and performance. With a team of tech enthusiasts, we understand the ever-evolving nature of the digital landscape and strive to stay at the forefront of the latest trends and advancements.\\n\\nOur Mission:\\n\\nOur mission at TechHub is to empower our customers with the best tools and devices that enhance their digital lifestyle. Whether you\'re a professional looking for a high-performance laptop to boost productivity or a smartphone aficionado seeking the latest flagship model, we\'ve got you covered. We believe that technology should not only meet but exceed your expectations, making every interaction with your devices a seamless and enjoyable experience.\\n\\nQuality Assurance:\\n\\nTechHub is committed to delivering products of the highest quality. We carefully curate our inventory, partnering with leading brands known for their commitment to excellence. Each product undergoes rigorous testing to ensure reliability, durability, and top-notch performance. Our dedication to quality assurance is reflected in every item we offer.\\n\\nCustomer-Centric Approach:\\n\\nAt TechHub, our customers are at the core of everything we do. We prioritize your satisfaction and strive to provide an unparalleled shopping experience. Our customer support team is ready to assist you at every step, from product inquiries to after-sales support. We value your feedback and continuously work to improve our services based on your needs.\\n\\nSecure Shopping:\\n\\nYour online security is our priority. TechHub employs state-of-the-art encryption technology to ensure that your personal information remains secure and protected. Shop with confidence, knowing that your data is in safe hands.\\n\\nExplore the world of innovation at TechHub, where technology meets lifestyle. Discover the perfect blend of style and functionality with our carefully curated selection of laptops, smartphones, and other cutting-edge gadgets. Join us on this exciting journey, and let\'s embrace the future together!\\n--------------------\\n\\u0412\\u044b \\u2014 \\u0418\\u0418 \\u0430\\u0441\\u0441\\u0438\\u0441\\u0442\\u0435\\u043d\\u0442 \\u043a\\u043e\\u043c\\u043f\\u0430\\u043d\\u0438\\u0438. \\u0412\\u0430\\u043c \\u0431\\u0443\\u0434\\u0443\\u0442 \\u0437\\u0430\\u0434\\u0430\\u043d\\u044b \\u0432\\u043e\\u043f\\u0440\\u043e\\u0441\\u044b \\u043e \\u043d\\u0430\\u0448\\u0435\\u0439 \\u043a\\u043e\\u043c\\u043f\\u0430\\u043d\\u0438\\u0438. \\u0412\\u0435\\u0436\\u043b\\u0438\\u0432\\u043e \\u043e\\u0442\\u0432\\u0435\\u0447\\u0430\\u0439\\u0442\\u0435 \\u043d\\u0430 \\u0432\\u043e\\u043f\\u0440\\u043e\\u0441\\u044b.\\r\\n    \\u041d\\u0438\\u0436\\u0435 \\u043c\\u044b \\u043f\\u0440\\u0435\\u0434\\u043e\\u0441\\u0442\\u0430\\u0432\\u0438\\u043b\\u0438 \\u043a\\u043e\\u043d\\u0442\\u0435\\u043a\\u0441\\u0442\\u043d\\u0443\\u044e \\u0438\\u043d\\u0444\\u043e\\u0440\\u043c\\u0430\\u0446\\u0438\\u044e.\\r\\n    ---------------------\\r\\n    {context_str}\\r\\n    ---------------------\\r\\n    \\u0423\\u0447\\u0438\\u0442\\u044b\\u0432\\u0430\\u044f \\u044d\\u0442\\u0443 \\u0438\\u043d\\u0444\\u043e\\u0440\\u043c\\u0430\\u0446\\u0438\\u044e, \\u043e\\u0442\\u0432\\u0435\\u0442\\u044c\\u0442\\u0435, \\u043f\\u043e\\u0436\\u0430\\u043b\\u0443\\u0439\\u0441\\u0442\\u0430, \\u043d\\u0430 \\u0432\\u043e\\u043f\\u0440\\u043e\\u0441: {query_str}\\r\\n    . \\n Information about relative products [{\\"id\\":17,\\"title\\":\\"Xiaomi 13\\",\\"content\\":\\"<ul class=\\\\\\"a-unordered-list a-vertical a-spacing-mini\\\\\\">\\\\r\\\\n \\\\t<li class=\\\\\\"a-spacing-mini\\\\\\"><span class=\\\\\\"a-list-item\\\\\\">Ultra-immersive display design Light up the screen to enjoy an unrivalled experience. The 1.61mm ultra-thin bezels offer a boundless vision.<\\\\/span><\\\\/li>\\\\r\\\\n \\\\t<li class=\\\\\\"a-spacing-mini\\\\\\"><span class=\\\\\\"a-list-item\\\\\\">Built for more scenarios IP68 water and dust resistant* Born splash-proof and water-resistant, thanks to the precision manufacturing. Record special memories anytime and anywhere.<\\\\/span><\\\\/li>\\\\r\\\\n \\\\t<li class=\\\\\\"a-spacing-mini\\\\\\"><span class=\\\\\\"a-list-item\\\\\\">Leica main camera with professional optical lens Captures every great moment<\\\\/span><\\\\/li>\\\\r\\\\n \\\\t<li class=\\\\\\"a-spacing-mini\\\\\\"><span class=\\\\\\"a-list-item\\\\\\">Masterpiece performance Leading Snapdragon 8 Gen 2 Boosted performance, reduced consumption<\\\\/span><\\\\/li>\\\\r\\\\n<\\\\/ul>\\",\\"date\\":\\"27.12.2023\\",\\"attributes\\":{\\"pa_color\\":[\\"silver\\"]},\\"stock\\":null,\\"image_url\\":false,\\"sku\\":\\"141234\\",\\"price\\":\\"16000\\",\\"formatted_price\\":\\"<span class=\\\\\\"woocommerce-Price-amount amount\\\\\\"><bdi>16000,00&nbsp;<span class=\\\\\\"woocommerce-Price-currencySymbol\\\\\\">&#8381;<\\\\/span><\\\\/bdi><\\\\/span>\\",\\"product_link\\":\\"http:\\\\/\\\\/wordpress\\\\/product\\\\/%d0%ba%d1%80%d0%be%d1%81%d1%81%d0%be%d0%b2%d0%ba%d0%b8\\\\/\\"}][{\\"id\\":20,\\"title\\":\\"Xiaomi Redmi 12 128GB &#8212; Black &#8212; Unlocked &#8212; Dual-SIM\\",\\"content\\":\\"\\",\\"date\\":\\"29.12.2023\\",\\"attributes\\":{\\"pa_color\\":[\\"black\\"]},\\"stock\\":null,\\"image_url\\":false,\\"sku\\":\\"141234-1\\",\\"price\\":\\"15000\\",\\"formatted_price\\":\\"<span class=\\\\\\"woocommerce-Price-amount amount\\\\\\"><bdi>15000,00&nbsp;<span class=\\\\\\"woocommerce-Price-currencySymbol\\\\\\">&#8381;<\\\\/span><\\\\/bdi><\\\\/span>\\",\\"product_link\\":\\"http:\\\\/\\\\/wordpress\\\\/product\\\\/xiaomi-12-black\\\\/\\"}]"}, {"role": "user", "content": "it it better than xiaomi 12?"}], "stream": false, "model": "gpt-3.5-turbo", "temperature": 0, "max_tokens": null}' message='Post details'
DEBUG:urllib3.connectionpool:https://api.openai.com:443 "POST /v1/chat/completions HTTP/1.1" 200 None
DEBUG:openai:message='OpenAI API response' path=https://api.openai.com/v1/chat/completions processing_ms=5239 request_id=2c08ba0faabada944cfb07737e94542a response_code=200
INFO:myapp:{'api': 1, 'product_data': '{"attributes": "color", "categories": "misc,smartphones"}', 'website': 'asdf', 'id': 4, 'left_tokens': 96408, 'description': None, 'temperature': Decimal('0.00'), 'model': 'gpt-3.5-turbo', 'prompt': 'Вы — ИИ ассистент компании. Вам будут заданы вопросы о нашей компании. Вежливо отвечайте на вопросы.\r\n    Ниже мы предоставили контекстную информацию.\r\n    ---------------------\r\n    {context_str}\r\n    ---------------------\r\n    Учитывая эту информацию, ответьте, пожалуйста, на вопрос: {query_str}\r\n    ', 'response_mode': 'compact', 'user_id': 12, 'answer': 'Client: i want xiaomi 13,\nAi response: Sure! We have the Xiaomi 13 available for purchase. It features an ultra-immersive display design with 1.61mm ultra-thin bezels, providing a boundless vision. It is also IP68 water and dust resistant, making it splash-proof and water-resistant. The Xiaomi 13 comes with a Leica main camera with a professional optical lens, allowing you to capture every great moment. It is powered by the leading Snapdragon 8 Gen 2 processor, offering boosted performance and reduced consumption. The price for the Xiaomi 13 is 16,000 rubles. You can find more information and make a purchase on our website: [Xiaomi 13](http://wordpress/product/кроссовки/)', 'context': '[{"id":17,"title":"Xiaomi 13","content":"<ul class=\\"a-unordered-list a-vertical a-spacing-mini\\">\\r\\n \\t<li class=\\"a-spacing-mini\\"><span class=\\"a-list-item\\">Ultra-immersive display design Light up the screen to enjoy an unrivalled experience. The 1.61mm ultra-thin bezels offer a boundless vision.<\\/span><\\/li>\\r\\n \\t<li class=\\"a-spacing-mini\\"><span class=\\"a-list-item\\">Built for more scenarios IP68 water and dust resistant* Born splash-proof and water-resistant, thanks to the precision manufacturing. Record special memories anytime and anywhere.<\\/span><\\/li>\\r\\n \\t<li class=\\"a-spacing-mini\\"><span class=\\"a-list-item\\">Leica main camera with professional optical lens Captures every great moment<\\/span><\\/li>\\r\\n \\t<li class=\\"a-spacing-mini\\"><span class=\\"a-list-item\\">Masterpiece performance Leading Snapdragon 8 Gen 2 Boosted performance, reduced consumption<\\/span><\\/li>\\r\\n<\\/ul>","date":"27.12.2023","attributes":{"pa_color":["silver"]},"stock":null,"image_url":false,"sku":"141234","price":"16000","formatted_price":"<span class=\\"woocommerce-Price-amount amount\\"><bdi>16000,00&nbsp;<span class=\\"woocommerce-Price-currencySymbol\\">&#8381;<\\/span><\\/bdi><\\/span>","product_link":"http:\\/\\/wordpress\\/product\\/%d0%ba%d1%80%d0%be%d1%81%d1%81%d0%be%d0%b2%d0%ba%d0%b8\\/"}]'}
INFO:werkzeug:127.0.0.1 - - [31/Dec/2023 23:13:56] "POST /projects/e47f0f811145d03c33fd6639dc3f09c0839d0891e264d849a75df04f4d047625/1ZbVTyW8FP5ni91hgAtEt21ahEhE1FvF HTTP/1.1" 200 -
